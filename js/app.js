const BAKIM_MODU=!1;function showGlobalError(e){try{console.warn("[Pusula]",e)}catch(e){}try{const t=localStorage.getItem("sSportRole")||"";"admin"!==t&&"locadmin"!==t||Swal.fire({toast:!0,position:"bottom-end",icon:"warning",title:String(e||"Uyarƒ±"),showConfirmButton:!1,timer:2500})}catch(e){}}let SCRIPT_URL=localStorage.getItem("PUSULA_SCRIPT_URL")||"https://script.google.com/macros/s/AKfycby3kd04k2u9XdVDD1-vdbQQAsHNW6WLIn8bNYxTlVCL3U1a0WqZo6oPp9zfBWIpwJEinQ/exec";async function apiCall(e,t={}){const a=void 0!==currentUser&&currentUser?currentUser:localStorage.getItem("sSportUser")||"",n=("function"==typeof getToken?getToken():localStorage.getItem("sSportToken"))||"",i=await fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:e,username:a,token:n,...t})}),l=await i.json();if("success"!==l.result)throw new Error(l.message||l.error||"API error");return l}"undefined"==typeof Swal&&(window.Swal={fire:(e,t,a)=>{try{alert(e&&e.title||e||t||a||"")}catch(e){}}});let jokers={call:1,half:1,double:1},doubleChanceUsed=!1,firstAnswerIndex=-1;const VALID_CATEGORIES=["Teknik","ƒ∞kna","Kampanya","Bilgi"],MONTH_NAMES=["Ocak","≈ûubat","Mart","Nisan","Mayƒ±s","Haziran","Temmuz","Aƒüustos","Eyl√ºl","Ekim","Kasƒ±m","Aralƒ±k"];let __dataLoadedResolve,database=[],cardsData=[],newsData=[],sportsData=[],salesScripts=[],quizQuestions=[],quickDecisionQuestions=[];window.__dataLoadedPromise=new Promise(e=>{__dataLoadedResolve=e});let techWizardData={},currentUser="",menuPermissions=null,homeBlocks={};function loadHomeBlocks(){return apiCall("getHomeBlocks",{}).then(e=>{homeBlocks=e&&e.blocks?e.blocks:{};try{localStorage.setItem("homeBlocksCache",JSON.stringify(homeBlocks||{}))}catch(e){}try{renderHomePanels()}catch(e){}return homeBlocks}).catch(e=>{try{homeBlocks=JSON.parse(localStorage.getItem("homeBlocksCache")||"{}")||{}}catch(e){homeBlocks={}}try{renderHomePanels()}catch(e){}return homeBlocks})}function normalizeRole(e){return String(e||"").trim().toLowerCase()}function normalizeGroup(e){const t=String(e||"").trim().toLowerCase().replaceAll("≈ü","s").replaceAll("≈û","s").replaceAll("ƒ±","i").replaceAll("ƒ∞","i").replaceAll("ƒü","g").replaceAll("ƒû","g").replaceAll("√º","u").replaceAll("√ú","u").replaceAll("√∂","o").replaceAll("√ñ","o").replaceAll("√ß","c").replaceAll("√á","c");return t.includes("telesat")?"Telesatƒ±≈ü":t.includes("teknik")?"Teknik":t.includes("chat")?"Chat":String(e||"").trim()}function normalizeList(e){return e?String(e).split(",").map(e=>e.trim()).filter(Boolean):[]}function getMyGroup(){return normalizeGroup(localStorage.getItem("sSportGroup")||"")}function getMyRole(){return normalizeRole(localStorage.getItem("sSportRole")||"")}function isAllowedByPerm(e){if(!e)return!0;if(!1===e.enabled)return!1;const t=getMyRole(),a=getMyGroup(),n=e.allowedRoles||[];let i=e.allowedGroups||[];return i.indexOf("ALL")>-1&&(i=[]),(!n.length||-1!==n.indexOf(t))&&(!i.length||-1!==i.indexOf(a))}function applyMenuPermissions(){try{document.querySelectorAll("[data-menu-key]").forEach(e=>{const t=e.getAttribute("data-menu-key"),a=menuPermissions&&menuPermissions[t];e.style.display=isAllowedByPerm(a)?"":"none"}),document.querySelectorAll("[data-shortcut-key]").forEach(e=>{const t=e.getAttribute("data-shortcut-key"),a=menuPermissions&&menuPermissions[t];e.style.display=isAllowedByPerm(a)?"":"none"})}catch(e){}}function loadMenuPermissions(){return apiCall("getMenuPermissions",{}).then(e=>{e&&"success"===e.result&&(menuPermissions={},(e.items||[]).forEach(e=>{menuPermissions[e.key]={allowedGroups:normalizeList(e.allowedGroups),enabled:!1!==e.enabled&&"FALSE"!==String(e.enabled).toUpperCase(),allowedRoles:normalizeList(e.allowedRoles)}}),applyMenuPermissions())}).catch(()=>{})}function openMenuPermissions(){"locadmin"===getMyRole()?apiCall("getMenuPermissions",{}).then(e=>{if(!e||"success"!==e.result)return void Swal.fire("Hata","Yetkiler okunamadƒ±","error");let t=(e.groups||[]).map(e=>String(e||"").trim()).filter(Boolean);if(!t.length){const a=new Set;(e.items||[]).forEach(e=>{normalizeList(e.allowedGroups).forEach(e=>{const t=String(e||"").trim();t&&"ALL"!==t.toUpperCase()&&a.add(t)})}),t=[...a]}const a={chat:"Chat","telesatƒ±≈ü":"Telesatƒ±≈ü",telesatis:"Telesatƒ±≈ü","y√∂netim":"Y√∂netim",yonetim:"Y√∂netim",teknik:"Teknik"};t=t.map(e=>{const t=e.toLowerCase();return a[t]||e.charAt(0).toUpperCase()+e.slice(1)});const n=e.items||[],i=n.map(e=>{const a=normalizeList(e.allowedGroups),n=!(!1===e.enabled||"FALSE"===String(e.enabled).toUpperCase()),i=t.map(t=>{const n=0===a.length||a.indexOf("ALL")>-1||a.indexOf(t)>-1;return`<td style="text-align:center">\n          <input type="checkbox" data-mk="${e.key}" data-g="${t}" ${n?"checked":""}/>\n        </td>`}).join("");return`<tr>\n        <td style="font-weight:600">${escapeHtml(e.title||e.label||e.key)}</td>\n        <td style="text-align:center"><input type="checkbox" data-enabled="${e.key}" ${n?"checked":""}/></td>\n        ${i}\n      </tr>`}).join(""),l=`\n      <div style="text-align:left;margin-bottom:10px;color:#444">\n        Men√º/sekme bazlƒ± ‚Äúhangi grup g√∂rs√ºn‚Äù ayarƒ±. ƒ∞≈üaretli olmayan gruplar men√ºy√º g√∂rmez.\n      </div>\n      <div style="max-height:420px;overflow:auto;border:1px solid rgba(0,0,0,.08);border-radius:12px">\n        <table style="width:100%;border-collapse:collapse">\n          <thead style="position:sticky;top:0;background:#f7f7f7;z-index:1">\n            <tr>\n              <th style="text-align:left;padding:12px">Men√º</th>\n              <th style="text-align:center;padding:12px;width:90px">Aktif</th>\n              ${t.map(e=>`<th style="text-align:center;padding:12px">${escapeHtml(e)}</th>`).join("")}\n            </tr>\n          </thead>\n          <tbody>\n            ${i}\n          </tbody>\n        </table>\n      </div>`;Swal.fire({title:"Yetki Y√∂netimi",html:l,width:980,showCancelButton:!0,confirmButtonText:"Kaydet",cancelButtonText:"Vazge√ß",preConfirm:()=>{const e={};return n.forEach(t=>{e[t.key]={allowedGroups:[],enabled:!0}}),document.querySelectorAll('input[type="checkbox"][data-enabled]').forEach(t=>{const a=t.getAttribute("data-enabled");e[a]&&(e[a].enabled=!!t.checked)}),document.querySelectorAll('input[type="checkbox"][data-mk]').forEach(t=>{const a=t.getAttribute("data-mk"),n=t.getAttribute("data-g");t.checked&&e[a]&&e[a].allowedGroups.push(n)}),Object.keys(e).forEach(a=>{(e[a].allowedGroups||[]).length===t.length&&(e[a].allowedGroups=["ALL"])}),e}}).then(e=>{if(!e.isConfirmed)return;apiCall("setMenuPermissions",{items:e.value||{}}).then(e=>{e&&"success"===e.result?(Swal.fire("Kaydedildi","Yetkiler g√ºncellendi.","success"),loadMenuPermissions()):Swal.fire("Hata",e&&e.message||"Kaydedilemedi","error")})})}):Swal.fire("Yetkisiz","Yetki Y√∂netimi sadece LocAdmin rol√ºnde kullanƒ±labilir.","warning")}let sessionTimeout,isAdminMode=!1,isLocAdmin=!1,isEditingActive=!1,activeCards=[],currentCategory="home",adminUserList=[],allEvaluationsData=[],wizardStepsData={},trainingData=[],dashboardChart=null,feedbackLogsData=[];function getToken(){return localStorage.getItem("sSportToken")}function setHomeWelcomeUser(e){try{const t=document.getElementById("home-welcome-user");t&&(t.textContent=e||"Misafir")}catch(e){}}function getFavs(){return JSON.parse(localStorage.getItem("sSportFavs")||"[]")}function toggleFavorite(e){event.stopPropagation();let t=getFavs();t.includes(e)?t=t.filter(t=>t!==e):t.push(e),localStorage.setItem("sSportFavs",JSON.stringify(t));try{const a=t.includes(e);Swal.fire({toast:!0,position:"top-end",icon:a?"success":"info",title:a?"Favorilere eklendi":"Favorilerden kaldƒ±rƒ±ldƒ±",showConfirmButton:!1,timer:1200})}catch(e){}"fav"===currentCategory?filterCategory(document.querySelector(".btn-fav"),"fav"):renderCards(activeCards);try{updateSearchResultCount(activeCards.length||0,database.length)}catch(e){}}function isFav(e){return getFavs().includes(e)}function formatDateToDDMMYYYY(e){if(!e)return"N/A";if(e.match(/^\d{2}\.\d{2}\.\d{4}/))return e.split(" ")[0];try{const t=new Date(e);if(isNaN(t.getTime()))return e;const a=String(t.getDate()).padStart(2,"0"),n=String(t.getMonth()+1).padStart(2,"0");return`${a}.${n}.${t.getFullYear()}`}catch(t){return e}}function parseDateTRToTS(e){try{if(!e)return 0;const t=String(e).split(" ")[0];if(t.includes(".")){const e=t.split(".");if(e.length>=3){const t=parseInt(e[0],10),a=parseInt(e[1],10),n=parseInt(e[2],10);return new Date(n,a-1,t).getTime()||0}}return new Date(e).getTime()||0}catch(e){return 0}}function isNew(e){if(!e)return!1;let t;if(e.indexOf(".")>-1){const a=e.split(" ")[0].split(".");t=new Date(a[2],a[1]-1,a[0])}else t=new Date(e);if(isNaN(t.getTime()))return!1;const a=new Date,n=Math.abs(a-t);return Math.ceil(n/864e5)<=3}function getCategorySelectHtml(e,t){let a=VALID_CATEGORIES.map(t=>`<option value="${t}" ${t===e?"selected":""}>${t}</option>`).join("");return e&&!VALID_CATEGORIES.includes(e)&&(a=`<option value="${e}" selected>${e} (Hata)</option>`+a),`<select id="${t}" class="swal2-input" style="width:100%; margin-top:5px;">${a}</select>`}function escapeForJsString(e){return e?e.toString().replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,""):""}function copyScriptContent(e){copyText(decodeURIComponent(e))}function copyText(e){const t=document.createElement("textarea");t.value=e.replace(/\\n/g,"\n"),document.body.appendChild(t),t.select();try{document.execCommand("copy"),Swal.fire({icon:"success",title:"Kopyalandƒ±",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})}catch(e){Swal.fire({icon:"error",title:"Kopyalanamadƒ±",text:"L√ºtfen manuel kopyalayƒ±n.",toast:!0,position:"top-end",showConfirmButton:!1,timer:2500})}document.body.removeChild(t)}function checkSession(){const e=localStorage.getItem("sSportUser"),t=localStorage.getItem("sSportToken"),a=localStorage.getItem("sSportRole"),n=localStorage.getItem("sSportGroup"),i=(new Date).toISOString().slice(0,10),l=localStorage.getItem("sSportSessionDay")||"",r=parseInt(localStorage.getItem("sSportLoginAt")||"0",10);if(e&&t){const t=!l||l!==i,s=!r||Date.now()-r>432e5;if(t||s){try{logout()}catch(e){localStorage.removeItem("sSportUser"),localStorage.removeItem("sSportToken"),localStorage.removeItem("sSportRole"),localStorage.removeItem("sSportGroup"),localStorage.removeItem("sSportSessionDay"),localStorage.removeItem("sSportLoginAt")}return}currentUser=e,document.getElementById("login-screen").style.display="none",document.getElementById("user-display").innerText=currentUser,setHomeWelcomeUser(currentUser),checkAdmin(a);try{if(n){const e=document.getElementById("t-side-role");e&&(e.textContent=n);const t=document.getElementById("tech-side-role");t&&(t.textContent=n)}}catch(e){}startSessionTimer();try{loadMenuPermissions()}catch(e){}try{loadHomeBlocks()}catch(e){}if(document.getElementById("main-app").style.display="block",loadContentData(),loadWizardData(),loadTechWizardData(),"qusers"===a){const e=document.getElementById("cardGrid");e&&(e.style.display="none");const t=document.querySelector(".control-wrapper");t&&(t.style.display="none");const a=document.querySelector(".news-ticker-box");a&&(a.style.display="none"),openQualityArea()}}}function enterBas(e){"Enter"===e.key&&girisYap()}function girisYap(){const e=document.getElementById("usernameInput").value.trim(),t=document.getElementById("passInput").value.trim(),a=document.getElementById("loading-msg"),n=document.getElementById("error-msg");if(!e||!t)return n.innerText="L√ºtfen bilgileri giriniz.",void(n.style.display="block");a.style.display="block",a.innerText="Doƒürulanƒ±yor...",n.style.display="none",document.querySelector(".login-btn").disabled=!0;const i=CryptoJS.SHA256(t).toString();fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"login",username:e,password:i})}).then(e=>e.json()).then(e=>{if(a.style.display="none",document.querySelector(".login-btn").disabled=!1,"success"===e.result){currentUser=e.username,localStorage.setItem("sSportUser",currentUser),localStorage.setItem("sSportToken",e.token),localStorage.setItem("sSportRole",e.role),e.group&&localStorage.setItem("sSportGroup",e.group),localStorage.setItem("sSportSessionDay",(new Date).toISOString().slice(0,10)),localStorage.setItem("sSportLoginAt",String(Date.now()));const t=e.role;if(!0===e.forceChange)Swal.fire({icon:"warning",title:" ‚ö†Ô∏è  G√ºvenlik Uyarƒ±sƒ±",text:"ƒ∞lk giri≈üiniz. L√ºtfen ≈üifrenizi deƒüi≈ütirin.",allowOutsideClick:!1,allowEscapeKey:!1,confirmButtonText:"≈ûifremi Deƒüi≈ütir"}).then(()=>{changePasswordPopup(!0)});else{document.getElementById("login-screen").style.display="none",document.getElementById("user-display").innerText=currentUser,setHomeWelcomeUser(currentUser);e.group||localStorage.getItem("sSportGroup");checkAdmin(t),startSessionTimer();try{loadMenuPermissions()}catch(e){}try{loadHomeBlocks()}catch(e){}if(document.getElementById("main-app").style.display="block",loadContentData(),loadWizardData(),loadTechWizardData(),"qusers"===t){const e=document.getElementById("cardGrid");e&&(e.style.display="none");const t=document.querySelector(".control-wrapper");t&&(t.style.display="none");const a=document.querySelector(".news-ticker-box");a&&(a.style.display="none"),openQualityArea()}}}else n.innerText=e.message||"Hatalƒ± giri≈ü!",n.style.display="block"}).catch(e=>{a.style.display="none",document.querySelector(".login-btn").disabled=!1,n.innerText="Sunucu hatasƒ±! L√ºtfen sayfayƒ± yenileyin.",n.style.display="block"})}function checkAdmin(e){const t=document.getElementById("dropdownAddCard"),a=document.getElementById("dropdownQuickEdit");isAdminMode="admin"===e||"locadmin"===e,isLocAdmin="locadmin"===e,isEditingActive=!1,document.body.classList.remove("editing");const n="qusers"===e,i=document.querySelectorAll(".filter-btn:not(.btn-fav)");if(n){i.forEach(e=>{-1===e.innerText.indexOf("Kalite")?(e.style.opacity="0.5",e.style.pointerEvents="none",e.style.filter="grayscale(100%)"):e.style.filter="none"});const e=document.getElementById("searchInput");e&&(e.disabled=!0,e.placeholder="Arama devre dƒ±≈üƒ± (Kalite Modu)",e.style.opacity="0.6")}else{i.forEach(e=>{e.style.opacity="1",e.style.pointerEvents="auto",e.style.filter="none"});const e=document.getElementById("searchInput");e&&(e.disabled=!1,e.placeholder="ƒ∞√ßeriklerde hƒ±zlƒ± ara...",e.style.opacity="1")}if(isAdminMode){if(t&&(t.style.display="flex"),a){a.style.display="flex";const e=document.getElementById("dropdownPerms");e&&(e.style.display=isLocAdmin?"flex":"none"),a.innerHTML='<i class="fas fa-pen" style="color:var(--secondary);"></i> D√ºzenlemeyi A√ß',a.classList.remove("active")}}else{t&&(t.style.display="none"),a&&(a.style.display="none");const e=document.getElementById("dropdownPerms");e&&(e.style.display="none")}}function logout(){currentUser="",isAdminMode=!1,isEditingActive=!1;try{document.getElementById("user-display").innerText="Misafir"}catch(e){}setHomeWelcomeUser("Misafir"),document.body.classList.remove("editing"),localStorage.removeItem("sSportUser"),localStorage.removeItem("sSportToken"),localStorage.removeItem("sSportRole"),localStorage.removeItem("sSportGroup"),localStorage.removeItem("sSportSessionDay"),localStorage.removeItem("sSportLoginAt"),sessionTimeout&&clearTimeout(sessionTimeout),document.getElementById("main-app").style.display="none",document.getElementById("login-screen").style.display="flex",document.getElementById("passInput").value="",document.getElementById("usernameInput").value="",document.getElementById("error-msg").style.display="none",document.getElementById("quality-fullscreen").style.display="none";try{document.getElementById("tech-fullscreen").style.display="none"}catch(e){}try{document.getElementById("telesales-fullscreen").style.display="none"}catch(e){}}function startSessionTimer(){sessionTimeout&&clearTimeout(sessionTimeout),sessionTimeout=setTimeout(()=>{Swal.fire({icon:"warning",title:"Oturum S√ºresi Doldu",text:"G√ºvenlik nedeniyle otomatik √ßƒ±kƒ±≈ü yapƒ±ldƒ±.",confirmButtonText:"Tamam"}).then(()=>{logout()})},288e5)}function openUserMenu(){toggleUserDropdown()}async function changePasswordPopup(e=!1){const{value:t}=await Swal.fire({title:e?"Yeni ≈ûifre Belirleyin":"≈ûifre Deƒüi≈ütir",html:(e?'<p style="font-size:0.9rem; color:#d32f2f;">ƒ∞lk giri≈ü ≈üifrenizi deƒüi≈ütirmeden devam edemezsiniz.</p>':"")+'<input id="swal-old-pass" type="password" class="swal2-input" placeholder="Eski ≈ûifre (Mevcut)"><input id="swal-new-pass" type="password" class="swal2-input" placeholder="Yeni ≈ûifre">',focusConfirm:!1,showCancelButton:!e,allowOutsideClick:!e,allowEscapeKey:!e,confirmButtonText:"Deƒüi≈ütir",cancelButtonText:"ƒ∞ptal",preConfirm:()=>{const e=document.getElementById("swal-old-pass").value,t=document.getElementById("swal-new-pass").value;return e&&t||Swal.showValidationMessage("Alanlar bo≈ü bƒ±rakƒ±lamaz"),[e,t]}});t?(Swal.fire({title:"ƒ∞≈üleniyor...",didOpen:()=>{Swal.showLoading()}}),fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"changePassword",username:currentUser,oldPass:CryptoJS.SHA256(t[0]).toString(),newPass:CryptoJS.SHA256(t[1]).toString(),token:getToken()})}).then(e=>e.json()).then(t=>{"success"===t.result?Swal.fire("Ba≈üarƒ±lƒ±!","≈ûifreniz g√ºncellendi. Yeniden giri≈ü yapƒ±nƒ±z.","success").then(()=>{logout()}):Swal.fire("Hata",t.message||"ƒ∞≈ülem ba≈üarƒ±sƒ±z.","error").then(()=>{e&&changePasswordPopup(!0)})}).catch(t=>{Swal.fire("Hata","Sunucu hatasƒ±.","error"),e&&changePasswordPopup(!0)})):e&&changePasswordPopup(!0)}function loadContentData(){document.getElementById("loading").style.display="block",fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"fetchData"})}).then(e=>e.json()).then(e=>{if(document.getElementById("loading").style.display="none","success"===e.result){const t=e.data;database=t.filter(e=>["card","bilgi","teknik","kampanya","ikna"].includes(e.Type.toLowerCase())).map(e=>({title:e.Title,category:e.Category,text:e.Text,script:e.Script,code:e.Code,link:e.Link,date:formatDateToDDMMYYYY(e.Date)})),database.sort((e,t)=>parseDateTRToTS(t.date)-parseDateTRToTS(e.date)),newsData=t.filter(e=>"news"===e.Type.toLowerCase()).map(e=>({date:formatDateToDDMMYYYY(e.Date),title:e.Title,desc:e.Text,type:e.Category,status:e.Status})),sportsData=t.filter(e=>"sport"===e.Type.toLowerCase()).map(e=>({title:e.Title,icon:e.Icon,desc:e.Text,tip:e.Tip,detail:e.Detail,pronunciation:e.Pronunciation}));try{applySportsRights()}catch(e){}salesScripts=t.filter(e=>"sales"===e.Type.toLowerCase()).map(e=>({title:e.Title,text:e.Text})),quizQuestions=t.filter(e=>"quiz"===e.Type.toLowerCase()).map(e=>({q:e.Text,opts:e.QuizOptions?e.QuizOptions.split(",").map(e=>e.trim()):[],a:parseInt(e.QuizAnswer)})),quickDecisionQuestions=t.filter(e=>"quickdecision"===(e.Type||"").toLowerCase()).map(e=>{const t=String(e.QuizOptions||"").split("|").map(e=>e.trim()).filter(Boolean);let a=parseInt(e.QuizAnswer,10);isNaN(a)&&(a=0),a<0&&(a=0),t.length&&a>=t.length&&(a=t.length-1);const n=(e.Detail||"").toString().trim();return{q:(e.Text||"").toString().trim(),opts:t,a:a,exp:n}}).filter(e=>e.q&&Array.isArray(e.opts)&&e.opts.length>=2),"fav"===currentCategory?filterCategory(document.querySelector(".btn-fav"),"fav"):(activeCards=database,"home"===currentCategory?showHomeScreen():(hideHomeScreen(),renderCards(database))),startTicker();try{updateSearchResultCount(activeCards.length||database.length,database.length)}catch(e){}}else document.getElementById("loading").innerHTML=`Veriler alƒ±namadƒ±: ${e.message||"Bilinmeyen Hata"}`}).catch(e=>{document.getElementById("loading").innerHTML="Baƒülantƒ± Hatasƒ±! Sunucuya ula≈üƒ±lamƒ±yor."}).finally(()=>{try{__dataLoadedResolve&&__dataLoadedResolve()}catch(e){}}),cardsData=database}function loadWizardData(){return new Promise((e,t)=>{fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"getWizardData"})}).then(e=>e.json()).then(a=>{"success"===a.result&&a.steps?(wizardStepsData=a.steps,e()):(wizardStepsData={},t(new Error("Wizard verisi y√ºklenemedi.")))}).catch(e=>{wizardStepsData={},t(e)})})}function loadTechWizardData(){return new Promise((e,t)=>{fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"getTechWizardData"})}).then(e=>e.json()).then(t=>{"success"===t.result&&t.steps?(techWizardData=t.steps,e()):techWizardData={}}).catch(e=>{techWizardData={}})})}function renderCards(e){activeCards=e;const t=document.getElementById("cardGrid");t.innerHTML="",0!==e.length?e.forEach((e,a)=>{const n=escapeForJsString(e.title),i=isFav(e.title)?"fas fa-star active":"far fa-star",l=isNew(e.date)?'<span class="new-badge">YENƒ∞</span>':"",r=isAdminMode&&isEditingActive?`<i class="fas fa-pencil-alt edit-icon" onclick="editContent(${a})" style="display:block;"></i>`:"";let s=(e.text||"").replace(/\n/g,"<br>").replace(/\*(.*?)\*/g,"<b>$1</b>");t.innerHTML+=`<div class="card ${e.category}">${l}\n            <div class="icon-wrapper">${r}<i class="${i} fav-icon" onclick="toggleFavorite('${n}')"></i></div>\n            <div class="card-header"><h3 class="card-title">${highlightText(e.title)}</h3><span class="badge">${e.category}</span></div>\n            <div class="card-content" onclick="showCardDetail('${n}', '${escapeForJsString(e.text)}')">\n                <div class="card-text-truncate">${highlightText(s)}</div>\n                <div style="font-size:0.8rem; color:#999; margin-top:5px; text-align:right;">(Tamamƒ±nƒ± oku)</div>\n            </div>\n            <div class="script-box">${highlightText(e.script)}</div>\n            <div class="card-actions">\n                <button class="btn btn-copy" onclick="copyText('${escapeForJsString(e.script)}')"><i class="fas fa-copy"></i> Kopyala</button>\n                ${e.code?`<button class="btn btn-copy" style="background:var(--secondary); color:#333;" onclick="copyText('${escapeForJsString(e.code)}')">Kod</button>`:""}\n                ${e.link?`<a href="${e.link}" target="_blank" class="btn btn-link"><i class="fas fa-external-link-alt"></i> Link</a>`:""}\n            </div>\n        </div>`}):t.innerHTML='<div style="grid-column:1/-1; text-align:center; padding:20px; color:#777;">Kayƒ±t bulunamadƒ±.</div>'}function highlightText(e){if(!e)return"";const t=document.getElementById("searchInput").value.toLocaleLowerCase("tr-TR").trim();if(!t)return e;try{const a=new RegExp(`(${t})`,"gi");return e.toString().replace(a,'<span class="highlight">$1</span>')}catch(t){return e}}function updateSearchResultCount(e,t){const a=document.getElementById("searchResultCount");if(!a)return;if(!(!!(document.getElementById("searchInput")?.value||"").trim()||currentCategory&&"all"!==currentCategory))return a.style.display="none",void(a.innerText="");a.style.display="block",a.innerText=`üîé ${e} sonu√ß${null!=t?" / "+t:""}`}function filterCategory(e,t){if("home"===t)return currentCategory="home",setActiveFilterButton(e),void showHomeScreen();const a=String(t||"").toLowerCase();return a.includes("teknik")?(hideHomeScreen(),void openTechArea("broadcast")):a.includes("telesat")?(hideHomeScreen(),void openTelesalesArea()):(a.includes("kalite")&&hideHomeScreen(),currentCategory=t,hideHomeScreen(),document.querySelectorAll(".filter-btn").forEach(e=>e.classList.remove("active")),e.classList.add("active"),void filterContent())}function filterContent(){const e=document.getElementById("searchInput").value.toLocaleLowerCase("tr-TR").trim();if("home"===currentCategory){if(!e)return updateSearchResultCount(database.length,database.length),void showHomeScreen();hideHomeScreen()}let t=database;"fav"===currentCategory?t=t.filter(e=>isFav(e.title)):"all"!==currentCategory&&"home"!==currentCategory&&(t=t.filter(e=>e.category===currentCategory)),e&&(t=t.filter(t=>{const a=(t.title||"").toString().toLocaleLowerCase("tr-TR"),n=(t.text||"").toString().toLocaleLowerCase("tr-TR"),i=(t.script||"").toString().toLocaleLowerCase("tr-TR"),l=(t.code||"").toString().toLocaleLowerCase("tr-TR");return a.includes(e)||n.includes(e)||i.includes(e)||l.includes(e)})),activeCards=t,updateSearchResultCount(t.length,database.length),renderCards(t)}function showCardDetail(e,t){if(e&&"object"==typeof e){const t=e,a=t.title||t.name||"Detay",n=(t.text||t.desc||"").toString(),i=(t.script||"").toString(),l=(t.alert||"").toString(),r=(t.link||"").toString(),s=`\n          <div style="text-align:left; font-size:1rem; line-height:1.6; white-space:pre-line;">\n            ${escapeHtml(n).replace(/\n/g,"<br>")}\n            ${r?`<div style="margin-top:12px"><a href="${escapeHtml(r)}" target="_blank" rel="noreferrer" style="font-weight:800;color:var(--info);text-decoration:none"><i class="fas fa-link"></i> Link</a></div>`:""}\n            ${i?`<div class="tech-script-box" style="margin-top:12px">\n                <span class="tech-script-label">M√º≈üteriye iletilecek:</span>${escapeHtml(i).replace(/\n/g,"<br>")}\n              </div>`:""}\n            ${l?`<div class="tech-alert" style="margin-top:12px">${escapeHtml(l).replace(/\n/g,"<br>")}</div>`:""}\n          </div>`;return void Swal.fire({title:a,html:s,showCloseButton:!0,showConfirmButton:!1,width:"820px",background:"#f8f9fa"})}const a=(t??"").toString();Swal.fire({title:e,html:`<div style="text-align:left; font-size:1rem; line-height:1.6;">${escapeHtml(a).replace(/\n/g,"<br>")}</div>`,showCloseButton:!0,showConfirmButton:!1,width:"600px",background:"#f8f9fa"})}function toggleEditMode(){if(!isAdminMode)return;isEditingActive=!isEditingActive,document.body.classList.toggle("editing",isEditingActive);const e=document.getElementById("dropdownQuickEdit");isEditingActive?(e.classList.add("active"),e.innerHTML='<i class="fas fa-times" style="color:var(--accent);"></i> D√ºzenlemeyi Kapat',Swal.fire({icon:"success",title:"D√ºzenleme Modu A√áIK",text:"Kalem ikonlarƒ±na tƒ±klayarak i√ßerikleri d√ºzenleyebilirsiniz.",timer:1500,showConfirmButton:!1})):(e.classList.remove("active"),e.innerHTML='<i class="fas fa-pen" style="color:var(--secondary);"></i> D√ºzenlemeyi A√ß'),filterContent();try{"home"===currentCategory&&renderHomePanels()}catch(e){}"flex"===document.getElementById("guide-modal").style.display&&openGuide(),"flex"===document.getElementById("sales-modal").style.display&&openSales(),"flex"===document.getElementById("news-modal").style.display&&openNews()}function sendUpdate(e,t,a,n="card"){Swal.isVisible()||Swal.fire({title:"Kaydediliyor...",didOpen:()=>{Swal.showLoading()}}),fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"updateContent",title:e,column:t,value:a,type:n,originalText:e,username:currentUser,token:getToken()})}).then(e=>e.json()).then(e=>{"success"===e.result?(Swal.fire({icon:"success",title:"Ba≈üarƒ±lƒ±",timer:1500,showConfirmButton:!1}),setTimeout(loadContentData,1600)):Swal.fire("Hata","Kaydedilemedi: "+(e.message||"Bilinmeyen Hata"),"error")}).catch(e=>Swal.fire("Hata","Sunucu hatasƒ±.","error"))}async function addNewCardPopup(){const e=getCategorySelectHtml("Bilgi","swal-new-cat"),{value:t}=await Swal.fire({title:"Yeni ƒ∞√ßerik Ekle",html:`\n        <div style="margin-bottom:15px; text-align:left;">\n            <label style="font-weight:bold; font-size:0.9rem;">Ne Ekleyeceksin?</label>\n            <select id="swal-type-select" class="swal2-input" style="width:100%; margin-top:5px; height:35px; font-size:0.9rem;" onchange="toggleAddFields()">\n                <option value="card"> üìå  Bilgi Kartƒ±</option>\n                <option value="news"> üì¢  Duyuru</option>\n                <option value="sales"> üìû  Telesatƒ±≈ü Scripti</option>\n                <option value="sport"> üèÜ  Spor ƒ∞√ßeriƒüi</option>\n                <option value="quiz"> ‚ùì  Quiz Sorusu</option>\n            </select>\n        </div>\n        <div id="preview-card" class="card Bilgi" style="text-align:left; box-shadow:none; border:1px solid #e0e0e0; margin-top:10px;">\n            <div class="card-header" style="align-items: center; gap: 10px;">\n                <input id="swal-new-title" class="swal2-input" style="margin:0; height:40px; flex-grow:1; border:none; border-bottom:2px solid #eee; padding:0 5px; font-weight:bold; color:#0e1b42;" placeholder="Ba≈ülƒ±k Giriniz...">\n                <div id="cat-container" style="width: 110px;">${e}</div>\n            </div>\n            <div class="card-content" style="margin-bottom:10px;">\n                <textarea id="swal-new-text" class="swal2-textarea" style="margin:0; width:100%; box-sizing:border-box; border:none; resize:none; font-family:inherit; min-height:100px; padding:10px; background:#f9f9f9;" placeholder="ƒ∞√ßerik metni..."></textarea>\n            </div>\n            <div id="script-container" class="script-box" style="padding:0; border:1px solid #f0e68c;">\n                <textarea id="swal-new-script" class="swal2-textarea" style="margin:0; width:100%; box-sizing:border-box; border:none; background:transparent; font-style:italic; min-height:80px; font-size:0.9rem;" placeholder="Script metni (ƒ∞steƒüe baƒülƒ±)..."></textarea>\n            </div>\n            <div id="extra-container" class="card-actions" style="margin-top:15px; display:grid; grid-template-columns: 1fr 1fr; gap:10px;">\n                <div style="position:relative;"><i class="fas fa-code" style="position:absolute; left:10px; top:10px; color:#aaa;"></i><input id="swal-new-code" class="swal2-input" style="margin:0; height:35px; font-size:0.85rem; padding-left:30px;" placeholder="Kod"></div>\n                <div style="position:relative;"><i class="fas fa-link" style="position:absolute; left:10px; top:10px; color:#aaa;"></i><input id="swal-new-link" class="swal2-input" style="margin:0; height:35px; font-size:0.85rem; padding-left:30px;" placeholder="Link"></div>\n            </div>\n            <div id="sport-extra" style="display:none; padding:10px;">\n                <label style="font-weight:bold;">Kƒ±sa A√ßƒ±klama (Desc)</label><input id="swal-sport-tip" class="swal2-input" placeholder="Kƒ±sa ƒ∞pucu/Tip">\n                <label style="font-weight:bold;">Detaylƒ± Metin (Detail)</label><input id="swal-sport-detail" class="swal2-input" placeholder="Detaylƒ± A√ßƒ±klama (Alt Metin)">\n                <label style="font-weight:bold;">Okunu≈üu (Pronunciation)</label><input id="swal-sport-pron" class="swal2-input" placeholder="Okunu≈üu">\n                <label style="font-weight:bold;">ƒ∞kon Sƒ±nƒ±fƒ± (Icon)</label><input id="swal-sport-icon" class="swal2-input" placeholder="FontAwesome ƒ∞kon Sƒ±nƒ±fƒ± (e.g., fa-futbol)">\n            </div>\n            <div id="news-extra" style="display:none; padding:10px;">\n                <label style="font-weight:bold;">Duyuru Tipi</label><select id="swal-news-type" class="swal2-input"><option value="info">Bilgi</option><option value="update">Deƒüi≈üiklik</option><option value="fix">√á√∂z√ºld√º</option></select>\n                <label style="font-weight:bold;">Durum</label><select id="swal-news-status" class="swal2-input"><option value="Aktif">Aktif</option><option value="Pasif">Pasif (Gizle)</option></select>\n            </div>\n            <div id="quiz-extra" style="display:none; padding:10px;">\n                <label style="font-weight:bold;">Soru Metni (Text)</label><textarea id="swal-quiz-q" class="swal2-textarea" placeholder="Quiz sorusu..."></textarea>\n                <label style="font-weight:bold;">Se√ßenekler (Virg√ºlle Ayƒ±rƒ±n)</label><input id="swal-quiz-opts" class="swal2-input" placeholder="√ñrn: ≈üƒ±k A,≈üƒ±k B,≈üƒ±k C,≈üƒ±k D">\n                <label style="font-weight:bold;">Doƒüru Cevap ƒ∞ndeksi</label><input id="swal-quiz-ans" type="number" class="swal2-input" placeholder="0 (A), 1 (B), 2 (C) veya 3 (D)" min="0" max="3">\n            </div>\n        </div>`,width:"700px",showCancelButton:!0,confirmButtonText:'<i class="fas fa-plus"></i> Ekle',cancelButtonText:"ƒ∞ptal",focusConfirm:!1,didOpen:()=>{const e=document.getElementById("swal-new-cat"),t=document.getElementById("preview-card");e.style.margin="0",e.style.height="30px",e.style.fontSize="0.8rem",e.style.padding="0 5px",e.addEventListener("change",function(){t.className="card "+this.value}),window.toggleAddFields=function(){const e=document.getElementById("swal-type-select").value,t=document.getElementById("cat-container"),a=document.getElementById("script-container"),n=document.getElementById("extra-container"),i=document.getElementById("sport-extra"),l=document.getElementById("news-extra"),r=document.getElementById("quiz-extra"),s=document.getElementById("preview-card");t.style.display="none",a.style.display="none",n.style.display="none",i.style.display="none",l.style.display="none",r.style.display="none",document.getElementById("swal-new-title").value="",document.getElementById("swal-new-text").value="",s.style.borderLeft="5px solid var(--info)",s.className="card Bilgi","card"===e?(t.style.display="block",a.style.display="block",n.style.display="grid",s.className="card "+document.getElementById("swal-new-cat").value,document.getElementById("swal-new-title").placeholder="Ba≈ülƒ±k Giriniz...",document.getElementById("swal-new-text").placeholder="ƒ∞√ßerik metni..."):"sales"===e?(a.style.display="block",document.getElementById("swal-new-script").placeholder="Satƒ±≈ü Metni...",s.style.borderLeft="5px solid var(--sales)",document.getElementById("swal-new-title").placeholder="Script Ba≈ülƒ±ƒüƒ±...",document.getElementById("swal-new-text").placeholder="Sadece buraya metin girilecek."):"sport"===e?(i.style.display="block",s.style.borderLeft="5px solid var(--primary)",document.getElementById("swal-new-title").placeholder="Spor Terimi Ba≈ülƒ±ƒüƒ±...",document.getElementById("swal-new-text").placeholder="Kƒ±sa A√ßƒ±klama (Desc)..."):"news"===e?(l.style.display="block",s.style.borderLeft="5px solid var(--secondary)",document.getElementById("swal-new-title").placeholder="Duyuru Ba≈ülƒ±ƒüƒ±...",document.getElementById("swal-new-text").placeholder="Duyuru Metni (Desc)..."):"quiz"===e&&(r.style.display="block",document.getElementById("swal-new-title").placeholder="Quiz Ba≈ülƒ±ƒüƒ± (√ñrn: Soru 1)",document.getElementById("swal-new-text").placeholder="Bu alan bo≈ü bƒ±rakƒ±lacak.",s.style.borderLeft="5px solid var(--quiz)")}},preConfirm:()=>{const e=document.getElementById("swal-type-select").value,t=new Date,a=t.getDate()+"."+(t.getMonth()+1)+"."+t.getFullYear(),n="quiz"===e?document.getElementById("swal-quiz-opts").value:"",i="quiz"===e?document.getElementById("swal-quiz-ans").value:"",l="quiz"===e?document.getElementById("swal-quiz-q").value:"";return"quiz"!==e||l&&n&&""!==i?{cardType:e,category:"card"===e?document.getElementById("swal-new-cat").value:"news"===e?document.getElementById("swal-news-type").value:"",title:document.getElementById("swal-new-title").value,text:"quiz"===e?l:document.getElementById("swal-new-text").value,script:"card"===e||"sales"===e?document.getElementById("swal-new-script").value:"",code:"card"===e?document.getElementById("swal-new-code").value:"",status:"news"===e?document.getElementById("swal-news-status").value:"",link:"card"===e?document.getElementById("swal-new-link").value:"",tip:"sport"===e?document.getElementById("swal-sport-tip").value:"",detail:"sport"===e?document.getElementById("swal-sport-detail").value:"",pronunciation:"sport"===e?document.getElementById("swal-sport-pron").value:"",icon:"sport"===e?document.getElementById("swal-sport-icon").value:"",date:a,quizOptions:n,quizAnswer:i}:(Swal.showValidationMessage("Quiz sorusu i√ßin t√ºm alanlar zorunludur."),!1)}});if(t){if(!t.title)return void Swal.fire("Hata","Ba≈ülƒ±k zorunlu!","error");Swal.fire({title:"Ekleniyor...",didOpen:()=>{Swal.showLoading()}}),fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"addCard",username:currentUser,token:getToken(),...t})}).then(e=>e.json()).then(e=>{"success"===e.result?(Swal.fire({icon:"success",title:"Ba≈üarƒ±lƒ±",text:"ƒ∞√ßerik eklendi.",timer:2e3,showConfirmButton:!1}),setTimeout(loadContentData,3500)):Swal.fire("Hata",e.message||"Eklenemedi.","error")}).catch(e=>Swal.fire("Hata","Sunucu hatasƒ±: "+e,"error"))}}async function editContent(e){const t=activeCards[e],a=getCategorySelectHtml(t.category,"swal-cat"),{value:n}=await Swal.fire({title:"Kartƒ± D√ºzenle",html:`\n        <div id="preview-card-edit" class="card ${t.category}" style="text-align:left; box-shadow:none; border:1px solid #e0e0e0; margin-top:10px;">\n            <div class="card-header" style="align-items: center; gap: 10px;">\n                <input id="swal-title" class="swal2-input" style="margin:0; height:40px; flex-grow:1; border:none; border-bottom:2px solid #eee; padding:0 5px; font-weight:bold; color:#0e1b42;" value="${t.title}" placeholder="Ba≈ülƒ±k">\n                <div style="width: 110px;">${a}</div>\n            </div>\n            <div class="card-content" style="margin-bottom:10px;">\n                <textarea id="swal-text" class="swal2-textarea" style="margin:0; width:100%; box-sizing:border-box; border:none; resize:none; font-family:inherit; min-height:120px; padding:10px; background:#f9f9f9;" placeholder="ƒ∞√ßerik metni...">${(t.text||"").toString().replace(/<br>/g,"\n")}</textarea>\n            </div>\n            <div class="script-box" style="padding:0; border:1px solid #f0e68c;">\n                <textarea id="swal-script" class="swal2-textarea" style="margin:0; width:100%; box-sizing:border-box; border:none; background:transparent; font-style:italic; min-height:80px; font-size:0.9rem;" placeholder="Script metni...">${(t.script||"").toString().replace(/<br>/g,"\n")}</textarea>\n            </div>\n            <div class="card-actions" style="margin-top:15px; display:grid; grid-template-columns: 1fr 1fr; gap:10px;">\n                <div style="position:relative;"><i class="fas fa-code" style="position:absolute; left:10px; top:10px; color:#aaa;"></i><input id="swal-code" class="swal2-input" style="margin:0; height:35px; font-size:0.85rem; padding-left:30px;" value="${t.code||""}" placeholder="Kod"></div>\n                <div style="position:relative;"><i class="fas fa-link" style="position:absolute; left:10px; top:10px; color:#aaa;"></i><input id="swal-link" class="swal2-input" style="margin:0; height:35px; font-size:0.85rem; padding-left:30px;" value="${t.link||""}" placeholder="Link"></div>\n            </div>\n        </div>`,width:"700px",showCancelButton:!0,confirmButtonText:'<i class="fas fa-save"></i> Kaydet',cancelButtonText:"ƒ∞ptal",focusConfirm:!1,didOpen:()=>{const e=document.getElementById("swal-cat"),t=document.getElementById("preview-card-edit");e.style.margin="0",e.style.height="30px",e.style.fontSize="0.8rem",e.style.padding="0 5px",e.addEventListener("change",function(){t.className="card "+this.value})},preConfirm:()=>({cat:document.getElementById("swal-cat").value,title:document.getElementById("swal-title").value,text:document.getElementById("swal-text").value,script:document.getElementById("swal-script").value,code:document.getElementById("swal-code").value,link:document.getElementById("swal-link").value})});n&&(n.cat!==t.category&&sendUpdate(t.title,"Category",n.cat,"card"),n.text!==(t.text||"").replace(/<br>/g,"\n")&&setTimeout(()=>sendUpdate(t.title,"Text",n.text,"card"),500),n.script!==(t.script||"").replace(/<br>/g,"\n")&&setTimeout(()=>sendUpdate(t.title,"Script",n.script,"card"),1e3),n.code!==(t.code||"")&&setTimeout(()=>sendUpdate(t.title,"Code",n.code,"card"),1500),n.link!==(t.link||"")&&setTimeout(()=>sendUpdate(t.title,"Link",n.link,"card"),2e3),n.title!==t.title&&setTimeout(()=>sendUpdate(t.title,"Title",n.title,"card"),2500))}async function editSport(e){event.stopPropagation();const t=sportsData.find(t=>t.title===e);if(!t)return Swal.fire("Hata","ƒ∞√ßerik bulunamadƒ±.","error");const{value:a}=await Swal.fire({title:"Spor ƒ∞√ßeriƒüini D√ºzenle",html:`\n        <div class="card" style="text-align:left; border-left: 5px solid var(--primary); padding:15px; background:#f8f9fa;">\n            <label style="font-weight:bold;">Ba≈ülƒ±k</label><input id="swal-title" class="swal2-input" style="width:100%; margin-bottom:10px;" value="${t.title}">\n            <label style="font-weight:bold;">A√ßƒ±klama (Kƒ±sa)</label><textarea id="swal-desc" class="swal2-textarea" style="margin-bottom:10px;">${t.desc||""}</textarea>\n            <label style="font-weight:bold;">ƒ∞pucu (Tip)</label><input id="swal-tip" class="swal2-input" style="width:100%; margin-bottom:10px;" value="${t.tip||""}">\n            <label style="font-weight:bold;">Detay (Alt Metin)</label><textarea id="swal-detail" class="swal2-textarea" style="margin-bottom:10px;">${t.detail||""}</textarea>\n            <label style="font-weight:bold;">Okunu≈üu</label><input id="swal-pron" class="swal2-input" style="width:100%; margin-bottom:10px;" value="${t.pronunciation||""}">\n            <label style="font-weight:bold;">ƒ∞kon Sƒ±nƒ±fƒ±</label><input id="swal-icon" class="swal2-input" style="width:100%;" value="${t.icon||""}">\n        </div>`,width:"700px",showCancelButton:!0,confirmButtonText:"Kaydet",preConfirm:()=>[document.getElementById("swal-title").value,document.getElementById("swal-desc").value,document.getElementById("swal-tip").value,document.getElementById("swal-detail").value,document.getElementById("swal-pron").value,document.getElementById("swal-icon").value]});if(a){const e=t.title;a[1]!==t.desc&&sendUpdate(e,"Text",a[1],"sport"),a[2]!==t.tip&&setTimeout(()=>sendUpdate(e,"Tip",a[2],"sport"),500),a[3]!==t.detail&&setTimeout(()=>sendUpdate(e,"Detail",a[3],"sport"),1e3),a[4]!==t.pronunciation&&setTimeout(()=>sendUpdate(e,"Pronunciation",a[4],"sport"),1500),a[5]!==t.icon&&setTimeout(()=>sendUpdate(e,"Icon",a[5],"sport"),2e3),a[0]!==e&&setTimeout(()=>sendUpdate(e,"Title",a[0],"sport"),2500)}}async function editSales(e){event.stopPropagation();const t=salesScripts.find(t=>t.title===e);if(!t)return Swal.fire("Hata","ƒ∞√ßerik bulunamadƒ±.","error");const{value:a}=await Swal.fire({title:"Satƒ±≈ü Metnini D√ºzenle",html:`<div class="card" style="text-align:left; border-left: 5px solid var(--sales); padding:15px; background:#ecfdf5;"><label style="font-weight:bold;">Ba≈ülƒ±k</label><input id="swal-title" class="swal2-input" style="width:100%; margin-bottom:10px;"\n        value="${t.title}"><label style="font-weight:bold;">Metin</label><textarea id="swal-text" class="swal2-textarea" style="min-height:150px;">${t.text||""}</textarea></div>`,width:"700px",showCancelButton:!0,confirmButtonText:"Kaydet",preConfirm:()=>[document.getElementById("swal-title").value,document.getElementById("swal-text").value]});if(a){const e=t.title;a[1]!==t.text&&sendUpdate(e,"Text",a[1],"sales"),a[0]!==e&&setTimeout(()=>sendUpdate(e,"Title",a[0],"sales"),500)}}async function editNews(e){const t=newsData[e];let a=`<option value="Aktif" ${"Pasif"!==t.status?"selected":""}>Aktif</option><option value="Pasif" ${"Pasif"===t.status?"selected":""}>Pasif</option>`,n=`<option value="info" ${"info"===t.type?"selected":""}>Bilgi</option><option value="update" ${"update"===t.type?"selected":""}>Deƒüi≈üiklik</option><option value="fix" ${"fix"===t.type?"selected":""}>√á√∂z√ºld√º</option>`;const{value:i}=await Swal.fire({title:"Duyuruyu D√ºzenle",html:`<div class="card" style="text-align:left; border-left: 5px solid var(--secondary); padding:15px; background:#fff8e1;"><label style="font-weight:bold;">Ba≈ülƒ±k</label><input id="swal-title" class="swal2-input" style="width:100%; margin-bottom:10px;"\n        value="${t.title||""}"><div style="display:flex; gap:10px; margin-bottom:10px;"><div style="flex:1;"><label style="font-weight:bold;">Tarih</label><input id="swal-date" class="swal2-input" style="width:100%;"\n        value="${t.date||""}"></div><div style="flex:1;"><label style="font-weight:bold;">T√ºr</label><select id="swal-type" class="swal2-input" style="width:100%;">${n}</select></div></div><label style="font-weight:bold;">Metin</label><textarea id="swal-desc" class="swal2-textarea" style="margin-bottom:10px;">${t.desc||""}</textarea><label style="font-weight:bold;">Durum</label><select id="swal-status" class="swal2-input" style="width:100%;">${a}</select></div>`,width:"600px",showCancelButton:!0,confirmButtonText:"Kaydet",preConfirm:()=>[document.getElementById("swal-title").value,document.getElementById("swal-date").value,document.getElementById("swal-desc").value,document.getElementById("swal-type").value,document.getElementById("swal-status").value]});if(i){const e=t.title;i[1]!==t.date&&sendUpdate(e,"Date",i[1],"news"),i[2]!==t.desc&&setTimeout(()=>sendUpdate(e,"Text",i[2],"news"),500),i[3]!==t.type&&setTimeout(()=>sendUpdate(e,"Category",i[3],"news"),1e3),i[4]!==t.status&&setTimeout(()=>sendUpdate(e,"Status",i[4],"news"),1500),i[0]!==e&&setTimeout(()=>sendUpdate(e,"Title",i[0],"news"),2e3)}}function closeModal(e){document.getElementById(e).style.display="none"}function startTicker(){const e=document.getElementById("ticker-content"),t=newsData.filter(e=>"Pasif"!==e.status);if(0===t.length)return e.innerHTML="G√ºncel duyuru yok.",void(e.style.animation="none");let a=t.map(e=>`<span style="color:#fabb00; font-weight:bold;">[${e.date}]</span> <span style="color:#fff;">${e.title}:</span> <span style="color:#ddd;">${e.desc}</span>`).join(" &nbsp;&nbsp;&nbsp;&nbsp; ‚Ä¢ &nbsp;&nbsp;&nbsp;&nbsp; ");e.innerHTML=a+" &nbsp;&nbsp;&nbsp;&nbsp; ‚Ä¢ &nbsp;&nbsp;&nbsp;&nbsp; "+a,e.style.animation="ticker-scroll 190s linear infinite"}function openNews(){document.getElementById("news-modal").style.display="flex";const e=document.getElementById("news-container");e.innerHTML="",newsData.forEach((t,a)=>{let n="fix"===t.type?"tag-fix":"update"===t.type?"tag-update":"tag-info",i="fix"===t.type?"√á√∂z√ºld√º":"update"===t.type?"Deƒüi≈üiklik":"Bilgi",l="Pasif"===t.status?"opacity:0.5; background:#eee;":"",r="Pasif"===t.status?'<span class="news-tag" style="background:#555; color:white;">PASƒ∞F</span>':"",s=isAdminMode&&isEditingActive?`<i class="fas fa-pencil-alt edit-icon" style="top:0; right:0; font-size:0.9rem; padding:4px;" onclick="event.stopPropagation(); editNews(${a})"></i>`:"";e.innerHTML+=`<div class="news-item" style="${l}">${s}<span class="news-date">${t.date}</span><span class="news-title">${t.title} ${r}</span><div class="news-desc">${t.desc}</div><span class="news-tag ${n}">${i}</span></div>`})}async function fetchBroadcastFlow(){const e=await fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"getBroadcastFlow",username:void 0!==currentUser?currentUser:"",token:"function"==typeof getToken?getToken():""})}),t=await e.json();if(!t||"success"!==t.result)throw new Error(t&&t.message?t.message:"Yayƒ±n akƒ±≈üƒ± alƒ±namadƒ±.");return t.items||[]}async function openBroadcastFlow(){Swal.fire({title:"Yayƒ±n Akƒ±≈üƒ±",didOpen:()=>Swal.showLoading(),showConfirmButton:!1});try{const e=await fetchBroadcastFlow();if(!e||!e.length)return void Swal.fire("Yayƒ±n Akƒ±≈üƒ±","Kayƒ±t bulunamadƒ±.","info");const t=[...e].sort((e,t)=>{const a=Number(e?.startEpoch||0),n=Number(t?.startEpoch||0);if(a&&n)return a-n;const i=String(e?.dateISO||e?.date||"")+" "+String(e?.time||""),l=String(t?.dateISO||t?.date||"")+" "+String(t?.time||"");return i.localeCompare(l)}),a=Date.now(),n={},i={};t.forEach(e=>{const t=String(e?.dateISO||e?.date||"Tarih Yok");n[t]||(n[t]=[]),n[t].push(e),i[t]||(i[t]=String(e?.dateLabelTr||""))});let l=`${"\n      <style>\n        .ba-wrap{ text-align:left; max-height:62vh; overflow:auto; padding-right:6px; }\n        .ba-day{ margin:14px 0 8px; font-weight:900; color:#0e1b42; display:flex; align-items:center; gap:10px; }\n\n        .ba-section{ margin:16px 0 8px; font-weight:900; color:#0e1b42; font-size:1rem; }\n        .ba-divider{ margin:14px 0; height:1px; background:#e9e9e9; }\n        .ba-empty{ padding:10px 12px; border:1px dashed #ddd; border-radius:12px; background:#fafafa; color:#666; margin:10px 0; font-weight:700; }\n        .ba-badge{ font-size:.75rem; padding:4px 8px; border-radius:999px; border:1px solid #e9e9e9; background:#f8f8f8; color:#444; }\n        .ba-grid{ display:grid; gap:8px; }\n        .ba-row{\n          border:1px solid #eee;\n          border-left:4px solid var(--secondary);\n          border-radius:12px;\n          padding:10px 12px;\n          background:#fff;\n        }\n        .ba-row.past{\n          border-left-color:#d9534f;\n          background:#fff5f5;\n        }\n        .ba-top{ display:flex; justify-content:space-between; gap:12px; align-items:flex-start; }\n        .ba-title{ font-weight:900; color:#222; line-height:1.25; }\n        .ba-time{ font-weight:900; color:#0e1b42; white-space:nowrap; }\n        .ba-sub{ margin-top:6px; font-size:.86rem; color:#666; display:flex; gap:14px; flex-wrap:wrap; }\n        .ba-legend{ display:flex; gap:10px; flex-wrap:wrap; margin:6px 0 10px; }\n        .ba-dot{ display:inline-flex; align-items:center; gap:6px; font-size:.8rem; color:#444; }\n        .ba-dot i{ width:10px; height:10px; border-radius:50%; display:inline-block; }\n        .ba-dot .up{ background:var(--secondary); }\n        .ba-dot .pa{ background:#d9534f; }\n      </style>\n    "}<div class="ba-wrap">`;l+='\n      <div class="ba-legend">\n        <span class="ba-dot"><i class="up"></i> Yakla≈üan / Gelecek</span>\n        <span class="ba-dot"><i class="pa"></i> Tarihi Ge√ßmi≈ü</span>\n      </div>\n    ';const r={},s={},o=Object.keys(n);o.forEach(e=>{(n[e]||[]).forEach(t=>{const n=Number(t?.startEpoch||0),i=!!n&&n<a?s:r;i[e]||(i[e]=[]),i[e].push(t)})});const d=(e,t,n)=>{const r=o.filter(e=>t[e]&&t[e].length);r.length?(l+=`<div class="ba-section">${escapeHtml(e)}</div>`,r.forEach(e=>{const n=i[e]||_formatBroadcastDateTr({dateISO:e});l+=`<div class="ba-day">${escapeHtml(n)}</div>`,l+='<div class="ba-grid">',t[e].forEach(e=>{const t=Number(e?.startEpoch||0),n=!!t&&t<a,i=String(e?.time||"").trim(),r=String(e?.event||"").trim(),s=String(e?.announcer||"").trim();l+=`\n            <div class="ba-row ${n?"past":""}">\n              <div class="ba-top">\n                <div class="ba-title">${escapeHtml(r||"-")}</div>\n                <div class="ba-time">${escapeHtml(i||"")}</div>\n              </div>\n              <div class="ba-sub">\n                <span><i class="fas fa-microphone"></i> ${escapeHtml(s||"-")}</span>\n              </div>\n            </div>`}),l+="</div>"})):l+=`<div class="ba-empty">${escapeHtml(n)}</div>`};d("Yakla≈üan / Gelecek",r,"Yakla≈üan yayƒ±n bulunamadƒ±."),l+='<div class="ba-divider"></div>',d("Ge√ßmi≈ü",s,"Ge√ßmi≈ü yayƒ±n bulunamadƒ±."),l+="</div>",Swal.fire({title:"Yayƒ±n Akƒ±≈üƒ±",html:l,width:980,confirmButtonText:"Kapat"})}catch(e){Swal.fire("Hata",e?.message||"Yayƒ±n akƒ±≈üƒ± alƒ±namadƒ±.","error")}}function _formatBroadcastDateTr(e){if(e&&e.dateLabelTr)return String(e.dateLabelTr);const t=String(e?.dateISO||e?.date||"").trim();if(!t)return"Tarih Yok";const a=t.match(/^(\d{4})-(\d{1,2})-(\d{1,2})/);if(a){const e=new Date(Number(a[1]),Number(a[2])-1,Number(a[3]));return new Intl.DateTimeFormat("tr-TR",{day:"2-digit",month:"long",year:"numeric",weekday:"long"}).format(e)}const n=t.match(/^(\d{1,2})[\./-](\d{1,2})[\./-](\d{4})/);if(n){const e=new Date(Number(n[3]),Number(n[2])-1,Number(n[1]));return new Intl.DateTimeFormat("tr-TR",{day:"2-digit",month:"long",year:"numeric",weekday:"long"}).format(e)}return t}function escapeHtml(e){return String(e??"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function openGuide(){document.getElementById("guide-modal").style.display="flex";const e=document.getElementById("guide-grid");e.innerHTML="",sportsData.forEach((t,a)=>{let n=t.pronunciation?`<div class="pronunciation-badge"> üó£Ô∏è  ${t.pronunciation}</div>`:"",i=isAdminMode&&isEditingActive?`<i class="fas fa-pencil-alt edit-icon" style="top:5px; right:5px; z-index:50;" onclick="event.stopPropagation(); editSport('${escapeForJsString(t.title)}')"></i>`:"";e.innerHTML+=`<div class="guide-item" onclick="showSportDetail(${a})">${i}<i class="fas ${t.icon} guide-icon"></i><span class="guide-title">${t.title}</span>${n}<div class="guide-desc">${t.desc}</div><div class="guide-tip"><i class="fas fa-lightbulb"></i> ${t.tip}</div><div style="font-size:0.8rem; color:#999; margin-top:5px;">(Detay i√ßin tƒ±kla)</div></div>`})}function showSportDetail(e){const t=sportsData[e],a=t.detail?t.detail.replace(/\n/g,"<br>"):"Bu i√ßerik i√ßin hen√ºz detay eklenmemi≈ü.",n=t.pronunciation?`<div style="color:#e65100; font-weight:bold; margin-bottom:15px;"> üó£Ô∏è  Okunu≈üu: ${t.pronunciation}</div>`:"";Swal.fire({title:`<i class="fas ${t.icon}" style="color:#0e1b42;"></i> ${t.title}`,html:`${n}<div style="text-align:left; font-size:1rem; line-height:1.6;">${a}</div>`,showCloseButton:!0,showConfirmButton:!1,width:"600px",background:"#f8f9fa"})}function openSales(){openTelesalesArea()}function toggleSales(e){const t=document.getElementById(`sales-${e}`),a=document.getElementById(`icon-${e}`);t.classList.toggle("active"),t.classList.contains("active")?a.classList.replace("fa-chevron-down","fa-chevron-up"):a.classList.replace("fa-chevron-up","fa-chevron-down")}window.setButtonScore=function(e,t,a){const n=document.getElementById(`row-${e}`),i=document.getElementById(`badge-${e}`),l=document.getElementById(`note-${e}`);n.querySelectorAll(".eval-button").forEach(e=>e.classList.remove("active"));const r=n.querySelector('.eval-button[data-score="'+t+'"]');r&&r.classList.add("active"),i.innerText=t,t<a?(l.style.display="block",i.style.background="#d32f2f",n.style.borderColor="#ffcdd2",n.style.background="#fff5f5"):(l.style.display="none",l.value="",i.style.background="#2e7d32",n.style.borderColor="#eee",n.style.background="#fff"),window.recalcTotalScore()},window.recalcTotalScore=function(){let e=0,t=0;document.querySelectorAll(".score-badge").forEach(t=>{e+=parseInt(t.innerText)||0});document.querySelectorAll(".criteria-row").forEach(e=>{t+=parseInt(e.getAttribute("data-max-score"))||0});const a=document.getElementById("live-score"),n=document.getElementById("score-ring");if(a&&(a.innerText=e),n){let a="#2e7d32",i=t>0?e/t*100:0;i<50?a="#d32f2f":i<85?a="#ed6c02":i<95&&(a="#fabb00"),n.style.background=`conic-gradient(${a} ${i}%, #444 ${i}%)`}},window.updateRowSliderScore=function(e,t){const a=document.getElementById(`slider-${e}`),n=document.getElementById(`badge-${e}`),i=document.getElementById(`note-${e}`),l=document.getElementById(`row-${e}`);if(!a)return;const r=parseInt(a.value);n.innerText=r,r<t?(i.style.display="block",n.style.background="#d32f2f",l.style.borderColor="#ffcdd2",l.style.background="#fff5f5"):(i.style.display="none",i.value="",n.style.background="#2e7d32",l.style.borderColor="#eee",l.style.background="#fff"),window.recalcTotalSliderScore()},window.recalcTotalSliderScore=function(){let e=0,t=0;document.querySelectorAll(".slider-input").forEach(a=>{e+=parseInt(a.value)||0,t+=parseInt(a.getAttribute("max"))||0});const a=document.getElementById("live-score"),n=document.getElementById("score-ring");if(a&&(a.innerText=e),n){let a="#2e7d32",i=t>0?e/t*100:0;i<50?a="#d32f2f":i<85?a="#ed6c02":i<95&&(a="#fabb00"),n.style.background=`conic-gradient(${a} ${i}%, #444 ${i}%)`}},document.addEventListener("contextmenu",e=>e.preventDefault()),document.onkeydown=function(e){if(123==e.keyCode)return!1},document.addEventListener("DOMContentLoaded",()=>{checkSession()});let pScore=0,pBalls=10,pCurrentQ=null,pQuestionQueue=[],pAskedCount=0,pCorrectCount=0,pWrongCount=0;function setDoubleIndicator(e){const t=document.getElementById("double-indicator");t&&(t.style.display=e?"inline-flex":"none")}function updateJokerButtons(){const e=document.getElementById("joker-call"),t=document.getElementById("joker-half"),a=document.getElementById("joker-double");e&&(e.disabled=0===jokers.call),t&&(t.disabled=0===jokers.half),a&&(a.disabled=0===jokers.double||-1!==firstAnswerIndex),-1!==firstAnswerIndex&&(e&&(e.disabled=!0),t&&(t.disabled=!0),a&&(a.disabled=!0))}function useJoker(e){if(!pCurrentQ)return;if(0===jokers[e])return;if(-1!==firstAnswerIndex&&"double"!==e)return;jokers[e]=0,updateJokerButtons();const t=pCurrentQ,a=t.a,n=document.querySelectorAll(".penalty-btn");if("call"===e){const e=["Umut Bey","Doƒüu≈ü Bey","Deniz Bey","Esra Hanƒ±m"],n=e[Math.floor(Math.random()*e.length)];let i=a;if(Math.random()>.8&&t.opts.length>1){const e=t.opts.map((e,t)=>t).filter(e=>e!==a);i=e[Math.floor(Math.random()*e.length)]??a}Swal.fire({icon:"info",title:" üìû Telefon Jokeri",html:`${n} soruyu cevaplƒ±yor...<br><br>"Benim tahminim **${String.fromCharCode(65+i)}** ≈üƒ±kkƒ±. Bundan ${Math.random()<.8?"√ßok eminim":"emin deƒüilim"}."`,confirmButtonText:"Kapat"})}else if("half"===e){const e=Array.isArray(t.opts)?t.opts.length:0;if(e<=2)return void Swal.fire({icon:"info",title:"‚úÇÔ∏è 50:50",text:"Bu soruda 50:50 uygulanamaz.",toast:!0,position:"top",showConfirmButton:!1,timer:1800});const i=e>=4?2:1;t.opts.map((e,t)=>t).filter(e=>e!==a).sort(()=>Math.random()-.5).slice(0,i).forEach(e=>{const t=n[e];t&&(t.disabled=!0,t.style.textDecoration="line-through",t.style.opacity="0.4")}),Swal.fire({icon:"success",title:" ‚úÇÔ∏è 50:50",text:2===i?"ƒ∞ki yanlƒ±≈ü ≈üƒ±k elendi!":"Bir yanlƒ±≈ü ≈üƒ±k elendi!",toast:!0,position:"top",showConfirmButton:!1,timer:1400})}else"double"===e&&(doubleChanceUsed=!0,setDoubleIndicator(!0),Swal.fire({icon:"warning",title:"2Ô∏è ‚É£ √áift Cevap",text:"Bir kez yanlƒ±≈ü cevap hakkƒ±n var.",toast:!0,position:"top",showConfirmButton:!1,timer:2200}))}function openGameHub(){document.getElementById("game-hub-modal").style.display="flex"}function openQuickDecisionGame(){try{closeModal("game-hub-modal")}catch(e){}document.getElementById("quick-modal").style.display="flex";const e=document.getElementById("qd-lobby"),t=document.getElementById("qd-game");e&&(e.style.display="block"),t&&(t.style.display="none");const a=document.getElementById("qd-time");a&&(a.innerText="30");const n=document.getElementById("qd-score");n&&(n.innerText="0");const i=document.getElementById("qd-step");i&&(i.innerText="0")}let qdTimer=null,qdTimeLeft=30,qdScore=0,qdStep=0,qdQueue=[];const QUICK_DECISION_BANK=[{q:'M√º≈üteri: "Fiyat pahalƒ±, iptal edeceƒüim." ƒ∞lk yakla≈üƒ±mƒ±n ne olmalƒ±?',opts:["Hemen iptal i≈ülemini ba≈ülatalƒ±m.","Haklƒ±sƒ±nƒ±z, sizi anlƒ±yorum. Paket/avantajlara g√∂re alternatif sunayƒ±m mƒ±?","Kampanya yok, yapacak bir ≈üey yok."],a:1,exp:"Empati + ihtiya√ß analizi itirazƒ± yumu≈üatƒ±r ve iknayƒ± artƒ±rƒ±r."},{q:'M√º≈üteri: "Uygulama a√ßƒ±lmƒ±yor." En hƒ±zlƒ± ilk kontrol ne?',opts:["≈ûifreyi sƒ±fƒ±rlat.","ƒ∞nternet baƒülantƒ±sƒ± / VPN / DNS kontrol√º yaptƒ±r.","Hemen cihazƒ± fabrika ayarlarƒ±na d√∂nd√ºr."],a:1,exp:"√ñnce k√∂k nedeni daralt: baƒülantƒ± mƒ± uygulama mƒ±? B√ºy√ºk adƒ±mlarƒ± sona bƒ±rak."},{q:'M√º≈üteri: "Yayƒ±n donuyor." Teknikte doƒüru soru hangisi?',opts:["Hangi cihazda (TV/telefon) ve hangi aƒüda (Wi‚ÄëFi/kablo) oluyor?","Ka√ß g√ºnd√ºr b√∂yle?","≈ûimdi kapatƒ±p a√ßƒ±n."],a:0,exp:"Cihaz + aƒü bilgisi, sorunu hƒ±zlƒ± izole etmeyi saƒülar."},{q:'M√º≈üteri: "ƒ∞ade istiyorum." En doƒüru y√∂nlendirme?',opts:["Hemen kapatalƒ±m.","ƒ∞ade ko≈üullarƒ± ve adƒ±mlarƒ± net anlat, doƒüru kanala y√∂nlendir (asistan/rehber).","Tekrar arayƒ±n."],a:1,exp:"Net s√ºre√ß + doƒüru kanal = memnuniyet + tekrar aramayƒ± azaltƒ±r."},{q:'M√º≈üteri: "Kampanyadan yararlanamƒ±yorum." ƒ∞lk adƒ±m?',opts:["Kampanya ko≈üullarƒ± (tarih/paket/cihaz) uygun mu kontrol et.","Direkt kampanyayƒ± tanƒ±mla.","Sorun yok deyip kapat."],a:0,exp:"Uygunluk kontrol√º yapƒ±lmadan i≈ülem yapmak hataya s√ºr√ºkler."},{q:'M√º≈üteri sinirli: "Kimse √ß√∂zmedi!" Ne yaparsƒ±n?',opts:["Sakinle≈ütirici bir c√ºmle + √∂zet + net aksiyon planƒ±.","Sƒ±raya alalƒ±m.","Ses y√ºkselt."],a:0,exp:"Kontrol√º geri almak i√ßin empati + √∂zet + plan √º√ßl√ºs√º √ßalƒ±≈üƒ±r."}];function resetQuickDecision(){qdTimer&&(clearInterval(qdTimer),qdTimer=null),qdTimeLeft=30,qdScore=0,qdStep=0,qdQueue=[],openQuickDecisionGame()}function startQuickDecision(){const e=Array.isArray(quickDecisionQuestions)?quickDecisionQuestions:[];if(!e.length)return void Swal.fire("Bilgi","Sorular hen√ºz y√ºklenmedi. L√ºtfen admin panelden sorularƒ± ekleyin ve sayfayƒ± yenileyin.","info");const t=Math.min(5,e.length),a=Array.from({length:e.length},(e,t)=>t).sort(()=>Math.random()-.5).slice(0,t);qdQueue=a.map(t=>e[t]),qdTimeLeft=30,qdScore=0,qdStep=0;const n=document.getElementById("qd-lobby"),i=document.getElementById("qd-game");n&&(n.style.display="none"),i&&(i.style.display="block"),updateQuickHud(),renderQuickQuestion(),qdTimer&&clearInterval(qdTimer),qdTimer=setInterval(()=>{qdTimeLeft-=1,updateQuickHud(),qdTimeLeft<=0&&finishQuickDecision(!0)},1e3)}function updateQuickHud(){const e=document.getElementById("qd-time");e&&(e.innerText=String(Math.max(0,qdTimeLeft)));const t=document.getElementById("qd-score");t&&(t.innerText=String(qdScore));const a=document.getElementById("qd-step");a&&(a.innerText=String(qdStep))}function renderQuickQuestion(){const e=qdQueue[qdStep],t=document.getElementById("qd-question"),a=document.getElementById("qd-options");t&&a&&e&&(t.innerText=e.q,a.innerHTML="",e.opts.forEach((e,t)=>{const n=document.createElement("button");n.className="quick-opt",n.innerText=e,n.onclick=()=>answerQuick(t),a.appendChild(n)}))}function answerQuick(e){const t=qdQueue[qdStep],a=document.getElementById("qd-options");if(!t||!a)return;const n=Array.from(a.querySelectorAll("button"));n.forEach(e=>e.disabled=!0);const i=e===t.a;n[e]&&n[e].classList.add(i?"good":"bad"),!i&&n[t.a]&&n[t.a].classList.add("good"),qdScore+=i?2:-1,qdScore<0&&(qdScore=0),updateQuickHud(),Swal.fire({toast:!0,position:"top",icon:i?"success":"warning",title:i?"Doƒüru se√ßim!":"Yanlƒ±≈ü se√ßim",text:t.exp,showConfirmButton:!1,timer:1800}),setTimeout(()=>{qdStep+=1,updateQuickHud(),qdStep>=qdQueue.length?finishQuickDecision(!1):renderQuickQuestion()},650)}function finishQuickDecision(e){qdTimer&&(clearInterval(qdTimer),qdTimer=null);const t=e?"S√ºre bitti!":"Bitti!";Swal.fire({icon:"info",title:`üß† Hƒ±zlƒ± Karar ${t}`,html:`<div style="text-align:center;">\n                <div style="font-size:1.0rem; margin-bottom:8px;">Skorun: <b>${qdScore}</b></div>\n                <div style="color:#666; font-size:0.9rem;">ƒ∞stersen yeniden ba≈ülatƒ±p rekor deneyebilirsin.</div>\n              </div>`,confirmButtonText:"Tamam"});const a=document.getElementById("qd-lobby"),n=document.getElementById("qd-game");a&&(a.style.display="block"),n&&(n.style.display="none");const i=document.getElementById("qd-time");i&&(i.innerText="30");const l=document.getElementById("qd-step");l&&(l.innerText="0")}function openPenaltyGame(){try{closeModal("game-hub-modal")}catch(e){}document.getElementById("penalty-modal").style.display="flex",showLobby()}function showLobby(){document.getElementById("penalty-lobby").style.display="flex",document.getElementById("penalty-game-area").style.display="none",fetchLeaderboard()}function startGameFromLobby(){document.getElementById("penalty-lobby").style.display="none",document.getElementById("penalty-game-area").style.display="block",startPenaltySession()}function fetchLeaderboard(){const e=document.getElementById("leaderboard-body"),t=document.getElementById("leaderboard-loader"),a=document.getElementById("leaderboard-table");e&&t&&a&&(e.innerHTML="",t.style.display="block",a.style.display="none",fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"getLeaderboard"})}).then(e=>e.json()).then(n=>{if(t.style.display="none","success"!==n.result)return t.innerText="Y√ºklenemedi.",void(t.style.display="block");a.style.display="table";let i="";n.leaderboard&&0!==n.leaderboard.length?n.leaderboard.forEach((e,t)=>{const a=0===t?"ü•á":1===t?"ü•à":2===t?"ü•â":`<span class="rank-badge">${t+1}</span>`,n=e.username===currentUser?"background:rgba(250, 187, 0, 0.1);":"";i+=`<tr style="${n}"><td>${a}</td><td>${e.username}</td><td>${e.games}</td><td>${e.average}</td></tr>`}):i='<tr><td colspan="4" style="text-align:center;">Hen√ºz ma√ß yapƒ±lmadƒ±.</td></tr>',e.innerHTML=i}).catch(()=>{t.style.display="none",t.innerText="Baƒülantƒ± hatasƒ±.",t.style.display="block"}))}function buildQuestionQueue(){const e=quizQuestions.length,t=Array.from({length:e},(e,t)=>t);return t.sort(()=>Math.random()-.5),t}function startPenaltySession(){pScore=0,pBalls=10,pAskedCount=0,pCorrectCount=0,pWrongCount=0,jokers={call:1,half:1,double:1},doubleChanceUsed=!1,firstAnswerIndex=-1,setDoubleIndicator(!1),pQuestionQueue=buildQuestionQueue(),updateJokerButtons(),document.getElementById("p-score").innerText=pScore,document.getElementById("p-balls").innerText=pBalls;const e=document.getElementById("p-restart-btn"),t=document.getElementById("p-options");e&&(e.style.display="none"),t&&(t.style.display="grid"),resetField(),loadPenaltyQuestion()}function pickNextQuestion(){if(0===quizQuestions.length)return null;if(pQuestionQueue.length>0){const e=pQuestionQueue.shift();return quizQuestions[e]}return quizQuestions[Math.floor(Math.random()*quizQuestions.length)]}function loadPenaltyQuestion(){if(pBalls<=0)return void finishPenaltyGame();if(!Array.isArray(quizQuestions)||0===quizQuestions.length)return void Swal.fire("Hata","Soru yok!","warning");if(pCurrentQ=pickNextQuestion(),(!pCurrentQ||!pCurrentQ.opts||pCurrentQ.opts.length<2)&&(Swal.fire("Hata","Bu soru hatalƒ± formatta (≈üƒ±k yok).","error"),pCurrentQ=pickNextQuestion(),!pCurrentQ))return;pAskedCount++,doubleChanceUsed=!1,firstAnswerIndex=-1,setDoubleIndicator(!1),updateJokerButtons();const e=document.getElementById("p-question-text");e&&(e.innerText=pCurrentQ.q||"Soru");let t="";pCurrentQ.opts.forEach((e,a)=>{const n=String.fromCharCode(65+a);t+=`<button class="penalty-btn" onclick="shootBall(${a})">${n}: ${e}</button>`});const a=document.getElementById("p-options");a&&(a.innerHTML=t)}function shootBall(e){const t=document.querySelectorAll(".penalty-btn"),a=e===pCurrentQ.a;if(!a&&doubleChanceUsed&&-1===firstAnswerIndex)return firstAnswerIndex=e,t[e]&&(t[e].classList.add("wrong-first-try"),t[e].disabled=!0),Swal.fire({toast:!0,position:"top",icon:"info",title:"ƒ∞lk Hata! Kalan Hakkƒ±n: 1",showConfirmButton:!1,timer:1400,background:"#ffc107"}),void updateJokerButtons();t.forEach(e=>e.disabled=!0);const n=document.getElementById("ball-wrap"),i=document.getElementById("keeper-wrap"),l=document.getElementById("shooter-wrap"),r=document.getElementById("goal-msg"),s=Math.floor(4*Math.random());l&&l.classList.add("shooter-run"),setTimeout(()=>{if(i&&(a?0===s||2===s?i.classList.add("keeper-dive-right"):i.classList.add("keeper-dive-left"):0===s||2===s?i.classList.add("keeper-dive-left"):i.classList.add("keeper-dive-right")),a)n&&(0===s?n.classList.add("ball-shoot-left-top"):1===s?n.classList.add("ball-shoot-right-top"):2===s?n.classList.add("ball-shoot-left-low"):n.classList.add("ball-shoot-right-low")),setTimeout(()=>{r&&(r.innerText="GOL!!!",r.style.color="#fabb00",r.classList.add("show")),pScore++,pCorrectCount++,document.getElementById("p-score").innerText=pScore,Swal.fire({toast:!0,position:"top",icon:"success",title:"M√ºkemmel ≈ûut!",showConfirmButton:!1,timer:900,background:"#a5d6a7"})},450);else{pWrongCount++;const e=()=>{r&&(r.style.color="#ef5350",r.classList.add("show")),Swal.fire({icon:"error",title:"Ka√ßƒ±rdƒ±n!",text:`Doƒüru: ${String.fromCharCode(65+pCurrentQ.a)}`,showConfirmButton:!0,timer:2400,background:"#ef9a9a"})};Math.random()>.5?(n&&(n.style.bottom="160px",n.style.left=0===s||2===s?"40%":"60%",n.style.transform="scale(0.6)"),setTimeout(()=>{r&&(r.innerText="KURTARDI!"),e()},450)):(n&&n.classList.add(Math.random()>.5?"ball-miss-left":"ball-miss-right"),setTimeout(()=>{r&&(r.innerText="DI≈ûARI!"),e()},450))}},300),pBalls--,document.getElementById("p-balls").innerText=pBalls,setTimeout(()=>{resetField(),loadPenaltyQuestion()},2400)}function resetField(){const e=document.getElementById("ball-wrap"),t=document.getElementById("keeper-wrap"),a=document.getElementById("shooter-wrap"),n=document.getElementById("goal-msg");e&&(e.className="ball-wrapper",e.style=""),t&&(t.className="keeper-wrapper"),a&&(a.className="shooter-wrapper"),n&&n.classList.remove("show"),document.querySelectorAll(".penalty-btn").forEach(e=>{e.classList.remove("wrong-first-try"),e.style.textDecoration="",e.style.opacity="",e.style.background="#fabb00",e.style.color="#0e1b42",e.style.borderColor="#f0b500",e.disabled=!1})}function finishPenaltyGame(){const e=pScore>=8?"EFSANE! üèÜ":pScore>=5?"ƒ∞yi Ma√ßtƒ±! üëè":"Antrenman Lazƒ±m ü§ï",t=Math.round(pCorrectCount/Math.max(1,pCorrectCount+pWrongCount)*100),a=document.getElementById("p-question-text");a&&(a.innerHTML=`\n            <div style="font-size:1.5rem; color:#fabb00; font-weight:800;">MA√á Bƒ∞TTƒ∞!</div>\n            <div style="margin-top:4px; font-size:1.1rem; color:#fff;">${e}</div>\n            <div style="margin-top:8px; font-size:1rem; color:#ddd;">\n                <b>Skor:</b> ${pScore}/10 &nbsp; ‚Ä¢ &nbsp;\n                <b>Doƒüruluk:</b> ${t}%\n            </div>\n            <div style="margin-top:6px; font-size:0.9rem; color:#bbb;">\n                Doƒüru: ${pCorrectCount} &nbsp; | &nbsp; Yanlƒ±≈ü: ${pWrongCount}\n            </div>\n            <div style="margin-top:10px; font-size:0.85rem; color:#aaa;">\n                Yeniden oynamak i√ßin a≈üaƒüƒ±dan ba≈ülatabilirsin.\n            </div>\n        `);const n=document.getElementById("p-options"),i=document.getElementById("p-restart-btn");n&&(n.style.display="none"),i&&(i.style.display="block"),fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"logQuiz",username:currentUser,token:getToken(),score:10*pScore,total:100})}).finally(()=>{setTimeout(fetchLeaderboard,600)})}function openWizard(){document.getElementById("wizard-modal").style.display="flex",0===Object.keys(wizardStepsData).length?(Swal.fire({title:"ƒ∞ade Asistanƒ± Verisi Y√ºkleniyor...",didOpen:()=>Swal.showLoading()}),loadWizardData().then(()=>{Swal.close(),wizardStepsData.start?renderStep("start"):document.getElementById("wizard-body").innerHTML='<h2 style="color:red;">Asistan verisi eksik.</h2>'}).catch(()=>{Swal.close(),document.getElementById("wizard-body").innerHTML='<h2 style="color:red;">Veri √ßekme hatasƒ±.</h2>'})):renderStep("start")}function renderStep(e){const t=wizardStepsData[e];if(!t)return void(document.getElementById("wizard-body").innerHTML=`<h2 style="color:red;">HATA: Adƒ±m ID (${e}) yok.</h2>`);const a=document.getElementById("wizard-body");let n=`<h2 style="color:var(--primary);">${t.title||""}</h2>`;if(t.result){let e="red"===t.result?" üõë ":"green"===t.result?" ‚úÖ ":" ‚ö†Ô∏è ",a="red"===t.result?"res-red":"green"===t.result?"res-green":"res-yellow";n+=`<div class="result-box ${a}"><div style="font-size:3rem;margin-bottom:10px;">${e}</div><h3>${t.title}</h3><p>${t.text}</p>${t.script?`<div class="script-box">${t.script}</div>`:""}</div><button class="restart-btn" onclick="renderStep('start')"><i class="fas fa-redo"></i> Ba≈üa D√∂n</button>`}else n+=`<p>${t.text}</p><div class="wizard-options">`,t.options.forEach(e=>{n+=`<button class="option-btn" onclick="renderStep('${e.next}')"><i class="fas fa-chevron-right"></i> ${e.text}</button>`}),n+="</div>","start"!==e&&(n+='<button class="restart-btn" onclick="renderStep(\'start\')" style="background:#eee;color:#333;margin-top:15px;">Ba≈üa D√∂n</button>');a.innerHTML=n}const twState={currentStep:"start",history:[]};function openTechWizard(){openTechArea("wizard")}function twRenderStep(){const e=document.getElementById("tech-wizard-content"),t=document.getElementById("tw-btn-back"),a=techWizardData[twState.currentStep];if(twState.history.length>0?t.style.display="block":t.style.display="none",!a)return void(e.innerHTML=`<div class="alert" style="color:red;">Hata: Adƒ±m bulunamadƒ± (${twState.currentStep}).</div>`);let n=`<div class="tech-step-title">${a.title||""}</div>`;if(a.text&&(n+=`<p style="font-size:1rem; margin-bottom:15px;">${a.text}</p>`),a.script){const e=encodeURIComponent(a.script);n+=`<div class="tech-script-box"><span class="tech-script-label">M√º≈üteriye iletilecek:</span>"${a.script}"<div style="margin-top:10px; text-align:right;"><button class="btn btn-copy" style="font-size:0.8rem; padding:5px 10px;" onclick="copyScriptContent('${e}')"><i class="fas fa-copy"></i> Kopyala</button></div></div>`}a.alert&&(n+=`<div class="tech-alert">${a.alert}</div>`),a.buttons&&a.buttons.length>0&&(n+='<div class="tech-buttons-area">',a.buttons.forEach(e=>{let t="option"===e.style?"tech-btn-option":"tech-btn-primary";n+=`<button class="tech-btn ${t}" onclick="twChangeStep('${e.next}')">${e.text}</button>`}),n+="</div>"),e.innerHTML=n}function twChangeStep(e){twState.history.push(twState.currentStep),twState.currentStep=e,twRenderStep()}function twGoBack(){twState.history.length>0&&(twState.currentStep=twState.history.pop(),twRenderStep())}function twResetWizard(){twState.currentStep="start",twState.history=[],twRenderStep()}function openQualityArea(){const e=document.getElementById("quality-modal");e&&(e.style.display="none");document.getElementById("quality-fullscreen").style.display="flex",document.getElementById("q-side-name").innerText=currentUser,document.getElementById("q-side-role").innerText=isAdminMode?"Y√∂netici":"Temsilci",document.getElementById("q-side-avatar").innerText=currentUser.charAt(0).toUpperCase(),populateMonthFilterFull();const t=document.getElementById("admin-filters"),a=document.getElementById("assign-training-btn"),n=document.getElementById("manual-feedback-admin-btn");if(isAdminMode)t&&(t.style.display="flex"),a&&(a.style.display="block"),n&&(n.style.display="flex"),0===adminUserList.length?fetchUserListForAdmin().then(e=>{const t=document.getElementById("q-admin-group");if(t){const a=[...new Set(e.map(e=>e.group))].sort();t.innerHTML='<option value="all">T√ºm Gruplar</option>'+a.map(e=>`<option value="${e}">${e}</option>`).join(""),updateAgentListBasedOnGroup()}populateDashboardFilters()}):populateDashboardFilters();else{t&&(t.style.display="none"),a&&(a.style.display="none"),n&&(n.style.display="none");const e=document.querySelector("#view-dashboard .q-view-header > div");e&&"none"!==e.style.display&&populateDashboardFilters()}const i=document.querySelector(".q-nav-item.active");i&&switchQualityTab("dashboard",i)}function closeFullQuality(){document.getElementById("quality-fullscreen").style.display="none","qusers"===localStorage.getItem("sSportRole")&&logout()}function switchQualityTab(e,t){document.querySelectorAll(".q-nav-item").forEach(e=>e.classList.remove("active")),t?t.classList.add("active"):document.querySelector(`.q-nav-item[onclick*="${e}"]`).classList.add("active"),document.querySelectorAll(".q-view-section").forEach(e=>e.classList.remove("active")),document.getElementById(`view-${e}`).classList.add("active"),"dashboard"===e?loadQualityDashboard():"evaluations"===e?fetchEvaluationsForAgent():"feedback"===e?(populateFeedbackFilters(),refreshFeedbackData()):"training"===e&&loadTrainingData()}function populateMonthFilterFull(){const e=new Date,t=e.getMonth(),a=e.getFullYear();["q-dash-month"].forEach(e=>{const n=document.getElementById(e);if(n){n.innerHTML="";for(let e=0;e<6;e++){let i=(t-e+12)%12,l=a-(t-e<0?1:0);const r=`${String(i+1).padStart(2,"0")}.${l}`,s=`${MONTH_NAMES[i]} ${l}`,o=document.createElement("option");o.value=r,o.textContent=s,0===e&&(o.selected=!0),n.appendChild(o)}}})}function populateDashboardFilters(){const e=document.getElementById("q-dash-group"),t=document.getElementById("q-dash-agent");if(!isAdminMode)return e&&(e.style.display="none"),void(t&&(t.style.display="none"));if(e&&(e.style.display="block"),t&&(t.style.display="block"),!e)return;const a=[...new Set(adminUserList.map(e=>e.group).filter(e=>e))].sort();e.innerHTML='<option value="all">T√ºm Gruplar</option>',a.forEach(t=>{const a=document.createElement("option");a.value=t,a.innerText=t,e.appendChild(a)}),updateDashAgentList()}function updateDashAgentList(){const e=document.getElementById("q-dash-group"),t=document.getElementById("q-dash-agent");if(!t)return;const a=e.value;t.innerHTML='<option value="all">T√ºm Temsilciler</option>';let n=adminUserList;"all"!==a&&(n=adminUserList.filter(e=>e.group===a)),n.forEach(e=>{const a=document.createElement("option");a.value=e.name,a.innerText=e.name,t.appendChild(a)}),updateDashRingTitle(),refreshQualityData()}function updateDashRingTitle(){document.getElementById("q-dash-ring-title")||document.getElementById("q-dash-ring-title".replace("title","title"));const e=document.getElementById("q-dash-ring-title");if(!e)return;if(!isAdminMode)return void(e.textContent="Puan Durumu");const t=document.getElementById("q-dash-group"),a=document.getElementById("q-dash-agent"),n=t?t.value:"all",i=a?a.value:"all";e.textContent=i&&"all"!==i?`${i} Puan Durumu`:n&&"all"!==n?`${n} Takƒ±m Ortalamasƒ±`:"Genel Puan Ortalamasƒ±"}function renderDashAgentScores(e){const t=document.getElementById("q-dash-agent-scores");if(!t)return;if(!isAdminMode)return void(t.style.display="none");const a=document.getElementById("q-dash-group"),n=document.getElementById("q-dash-agent"),i=a?a.value:"all",l=n?n.value:"all";if(l&&"all"!==l)return void(t.style.display="none");const r={};(e||[]).forEach(e=>{const t=e.agent||"N/A",a=e.group||"",n=parseFloat(e.score)||0;r[t]||(r[t]={total:0,count:0,group:a}),r[t].total+=n,r[t].count+=1,!r[t].group&&a&&(r[t].group=a)});const s=Object.keys(r).map(e=>{const t=r[e];return{name:e,group:t.group||("all"!==i?i:""),avg:t.count?t.total/t.count:0,count:t.count}}),o=i&&"all"!==i?s.filter(e=>(e.group||"")===i):s;if(o.sort((e,t)=>e.avg-t.avg),0===o.length)return void(t.style.display="none");const d=o.slice(0,8);t.innerHTML=d.map(e=>`\n        <div class="das-item">\n            <div class="das-left">\n                <span class="das-name">${escapeHtml(e.name)}</span>\n                ${e.group?`<span class="das-group">${escapeHtml(e.group)}</span>`:""}\n            </div>\n            <div class="das-score">${(e.avg||0).toFixed(1)}</div>\n        </div>\n    `).join(""),t.style.display="grid"}function safeParseDetails(e){if(!e)return null;if(Array.isArray(e))return e;if("object"==typeof e)return e;if("string"==typeof e){const t=e.trim();if(!t)return null;const a=[t,t.replace(/\"/g,'"'),t.replace(/'/g,'"')];for(const e of a)try{const t=JSON.parse(e);if(Array.isArray(t))return t}catch(e){}}return null}function populateFeedbackFilters(){const e=document.getElementById("q-feedback-group"),t=document.getElementById("q-feedback-agent");if(!e||!t)return;if(!isAdminMode)return e.style.display="none",void(t.style.display="none");e.style.display="block",t.style.display="block";const a=[...new Set(adminUserList.map(e=>e.group).filter(e=>e))].sort();e.innerHTML='<option value="all">T√ºm Gruplar</option>',a.forEach(t=>{const a=document.createElement("option");a.value=t,a.textContent=t,e.appendChild(a)}),updateFeedbackAgentList(!1)}function updateFeedbackAgentList(e=!0){const t=document.getElementById("q-feedback-group"),a=document.getElementById("q-feedback-agent");if(!t||!a)return;const n=t.value,i=adminUserList.filter(e=>!(!e||!e.username)&&("all"===n||e.group===n)).map(e=>e.username).filter(e=>e).sort((e,t)=>e.localeCompare(t,"tr"));a.innerHTML='<option value="all">T√ºm Temsilciler</option>',i.forEach(e=>{const t=document.createElement("option");t.value=e,t.textContent=e,a.appendChild(t)}),e&&refreshFeedbackData()}async function fetchEvaluationsForFeedback(){const e=document.getElementById("q-feedback-group"),t=document.getElementById("q-feedback-agent");let a=currentUser,n="all";isAdminMode&&(a=t?t.value:"all",n=e?e.value:"all");try{const e=await fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"fetchEvaluations",targetAgent:a,targetGroup:n,username:currentUser,token:getToken()})}),t=await e.json();allEvaluationsData="success"===t.result?(t.evaluations||[]).reverse():[]}catch(e){allEvaluationsData=[]}}async function refreshFeedbackData(){await fetchEvaluationsForFeedback(),await fetchFeedbackLogs(),loadFeedbackList()}function refreshQualityData(){loadQualityDashboard()}async function fetchEvaluationsForDashboard(){const e=document.getElementById("q-dash-group"),t=document.getElementById("q-dash-agent");let a=currentUser,n="all";isAdminMode&&(a=t?t.value:"all",n=e?e.value:"all");try{const e=await fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"fetchEvaluations",targetAgent:a,targetGroup:n,username:currentUser,token:getToken()})}),t=await e.json();allEvaluationsData="success"===t.result?(t.evaluations||[]).reverse():[]}catch(e){allEvaluationsData=[]}}function loadQualityDashboard(){fetchEvaluationsForDashboard().then(()=>{const e=document.getElementById("q-dash-month"),t=document.getElementById("q-dash-group"),a=document.getElementById("q-dash-agent"),n=e?e.value:"",i=t?t.value:"all",l=a?a.value:"all";let r=allEvaluationsData.filter(e=>{const t=e.date.substring(3)===n;let a=!0,r=!0;if(isAdminMode){if("all"!==i)if(e.group)a=e.group===i;else{const t=adminUserList.find(t=>t.name===e.agent);a=t&&t.group===i}"all"!==l&&e.agent!==l&&(r=!1)}else e.agent!==currentUser&&(r=!1);const s=e.callId&&String(e.callId).toUpperCase().startsWith("MANUEL-");return t&&a&&r&&!s});const s=r.reduce((e,t)=>e+(parseInt(t.score)||0),0),o=r.length,d=o>0?(s/o).toFixed(1):0,c=r.filter(e=>e.score>=90).length,u=o>0?Math.round(c/o*100):0;document.getElementById("q-dash-score").innerText=d,document.getElementById("q-dash-count").innerText=o,document.getElementById("q-dash-target").innerText=`%${u}`;const m=document.getElementById("q-dash-ring");let p="#2e7d32";d<70?p="#d32f2f":d<85&&(p="#ed6c02");const y=d/100*100;m&&(m.style.background=`conic-gradient(${p} ${y}%, #eee ${y}%)`),document.getElementById("q-dash-ring-text")&&(document.getElementById("q-dash-ring-text").innerText=Math.round(d)),updateDashRingTitle(),renderDashAgentScores(r),renderDashboardChart(r)})}function renderDashboardChart(e){const t=document.getElementById("q-breakdown-chart");if(!t)return;dashboardChart&&dashboardChart.destroy();let a={};e.length>0&&e.forEach(e=>{try{let t=safeParseDetails(e.details);Array.isArray(t)&&t.forEach(e=>{let t=e.q,n=t.length>25?t.substring(0,25)+"...":t;a[n]||(a[n]={earned:0,max:0,fullText:t}),a[n].earned+=parseInt(e.score||0),a[n].max+=parseInt(e.max||0)})}catch(e){console.log("Detay verisi i≈ülenemedi",e)}});let n=Object.keys(a).map(e=>{let t=a[e],n=t.max>0?t.earned/t.max*100:0;return{label:e,fullLabel:t.fullText,value:n}});if(n.sort((e,t)=>e.value-t.value),0===n.length){const a={};e.forEach(e=>{const t=e.agent||"N/A",n=parseFloat(e.score)||0;a[t]||(a[t]={total:0,count:0}),a[t].total+=n,a[t].count+=1});const n=Object.keys(a).map(e=>({label:e.length>25?e.substring(0,25)+"...":e,fullLabel:e,value:a[e].count?a[e].total/a[e].count:0}));n.sort((e,t)=>e.value-t.value);let i=n.slice(0,6),l=i.map(e=>e.label),r=i.map(e=>e.value.toFixed(1));return void(dashboardChart=new Chart(t,{type:"bar",data:{labels:l,datasets:[{label:"Ortalama Puan",data:r,backgroundColor:r.map(e=>e<70?"rgba(211, 47, 47, 0.7)":e<85?"rgba(237, 108, 2, 0.7)":"rgba(46, 125, 50, 0.7)"),borderColor:r.map(e=>e<70?"#b71c1c":e<85?"#e65100":"#1b5e20"),borderWidth:1,borderRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,indexAxis:"y",scales:{x:{beginAtZero:!0,max:100,grid:{color:"#f0f0f0"}},y:{grid:{display:!1}}},plugins:{legend:{display:!1},tooltip:{callbacks:{title:function(e){return e.length>0?i[e[0].dataIndex].fullLabel:""},label:function(e){return e.parsed.x+" Ortalama"}}}}}}))}let i=n.slice(0,6),l=i.map(e=>e.label),r=i.map(e=>e.value.toFixed(1));dashboardChart=new Chart(t,{type:"bar",data:{labels:l,datasets:[{label:"Ba≈üarƒ± Oranƒ± (%)",data:r,backgroundColor:r.map(e=>e<70?"rgba(211, 47, 47, 0.7)":e<90?"rgba(237, 108, 2, 0.7)":"rgba(46, 125, 50, 0.7)"),borderColor:r.map(e=>e<70?"#b71c1c":e<90?"#e65100":"#1b5e20"),borderWidth:1,borderRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,indexAxis:"y",scales:{x:{beginAtZero:!0,max:100,grid:{color:"#f0f0f0"}},y:{grid:{display:!1}}},plugins:{legend:{display:!1},tooltip:{callbacks:{title:function(e){if(e.length>0){const t=e[0].dataIndex;return i[t].fullLabel}return""},label:function(e){return e.parsed.x+"% Ba≈üarƒ±"}}}}}})}function loadTrainingData(){const e=document.getElementById("training-list");e.innerHTML='<div style="grid-column:1/-1; text-align:center;">Y√ºkleniyor...</div>',fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"getTrainings",username:currentUser,token:getToken()})}).then(e=>e.json()).then(t=>{e.innerHTML="","success"===t.result&&t.trainings.length>0?t.trainings.forEach(t=>{let a=t.isCompleted?'<button class="t-btn t-btn-done"><i class="fas fa-check"></i> Tamamlandƒ±</button>':`<button class="t-btn t-btn-start" onclick="openTrainingLink('${t.id}', '${t.link}')">Eƒüitime Git</button>`,n=t.docLink&&"N/A"!==t.docLink?`<a href="${t.docLink}" target="_blank" class="t-doc-link"><i class="fas fa-file-download"></i> D√∂k√ºmanƒ± ƒ∞ndir</a>`:"";e.innerHTML+=`\n                <div class="t-card">\n                    <div class="t-card-header">\n                        <span>${t.title}</span>\n                        <span class="t-status-badge">Atanma: ${t.date}</span>\n                    </div>\n                    <div class="t-card-body">\n                        ${t.desc}\n                        ${n}\n                        <div style="margin-top:10px; display:flex; justify-content:space-between; font-size:0.8rem; color:#666; padding-top:10px; border-top:1px dashed #eee;">\n                            <div><strong>S√ºre:</strong> ${t.duration||"Belirtilmedi"}</div>\n                            <div><strong>Ba≈ülangƒ±√ß:</strong> ${t.startDate||"N/A"} - <strong>Biti≈ü:</strong> ${t.endDate||"N/A"}</div>\n                        </div>\n                        <div style="font-size:0.8rem; color:#999; margin-top:5px;">Atayan: ${t.creator}</div>\n                    </div>\n                    <div class="t-card-footer">\n                        ${a}\n                    </div>\n                </div>`}):e.innerHTML='<div style="grid-column:1/-1; text-align:center; padding:20px; color:#888;">Atanmƒ±≈ü eƒüitim bulunmuyor.</div>'})}function openTrainingLink(e,t){t&&"N/A"!==t?window.open(t,"_blank"):Swal.fire("Uyarƒ±","Bu eƒüitim i√ßin ge√ßerli bir link bulunmamaktadƒ±r.","warning"),Swal.fire({title:"Eƒüitimi Tamamladƒ±n mƒ±?",text:"Eƒüitim i√ßeriƒüini inceleyip anladƒ±ysan onayla.",icon:"question",showCancelButton:!0,confirmButtonText:"Evet, Tamamladƒ±m",cancelButtonText:"Daha Sonra"}).then(t=>{t.isConfirmed&&completeTraining(e)})}function completeTraining(e){fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"completeTraining",trainingId:e,username:currentUser,token:getToken()})}).then(e=>e.json()).then(e=>{"success"===e.result?(Swal.fire("Harika!","Eƒüitim tamamlandƒ± olarak i≈üaretlendi.","success"),loadTrainingData()):Swal.fire("Hata",e.message,"error")})}async function assignTrainingPopup(){const{value:e}=await Swal.fire({title:"Yeni Eƒüitim & D√∂k√ºman Ata",html:`\n            <div class="t-modal-grid">\n                <input id="swal-t-title" class="swal2-input" placeholder="Eƒüitim Ba≈ülƒ±ƒüƒ±" style="grid-column: 1 / 4;">\n                <textarea id="swal-t-desc" class="swal2-textarea" style="height:100px; grid-column: 1 / 4;" placeholder="Eƒüitim a√ßƒ±klamasƒ± veya talimatlar..."></textarea>\n                <input id="swal-t-link" class="swal2-input" placeholder="Video/Eƒüitim Linki (URL)" style="grid-column: 1 / 4;">\n                <input id="swal-t-doc" class="swal2-input" placeholder="D√∂k√ºman Linki (Drive/PDF URL) (ƒ∞steƒüe Baƒülƒ±)" style="grid-column: 1 / 4;">\n                <input type="date" id="swal-t-start" class="swal2-input" value="${(new Date).toISOString().substring(0,10)}">\n                <input type="date" id="swal-t-end" class="swal2-input">\n                <input id="swal-t-duration" class="swal2-input" placeholder="S√ºre (√ñrn: 20dk)">\n            </div>\n            <select id="swal-t-target" class="swal2-input" onchange="updateTrainingTarget(this.value)" style="margin-top:10px;">\n                <option value="Genel">Herkese (T√ºm Ekip)</option>\n                <option value="Telesatƒ±≈ü">Telesatƒ±≈ü Ekibi</option>\n                <option value="Chat">Chat Ekibi</option>\n                <option value="Individual">Ki≈üiye √ñzel</option>\n            </select>\n            <select id="swal-t-agent" class="swal2-input" style="display:none; width:100%;"></select>\n        `,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"Ata",didOpen:()=>{window.updateTrainingTarget=function(e){const t=document.getElementById("swal-t-agent");t.style.display="Individual"===e?"block":"none","Individual"===e&&(t.innerHTML=adminUserList.map(e=>`<option value="${e.name}">${e.name}</option>`).join(""))},updateTrainingTarget("Genel")},preConfirm:()=>{const e=document.getElementById("swal-t-target").value,t="Individual"===e?document.getElementById("swal-t-agent").value:"";return document.getElementById("swal-t-title").value&&(e||t)?{title:document.getElementById("swal-t-title").value,desc:document.getElementById("swal-t-desc").value,link:document.getElementById("swal-t-link").value,docLink:document.getElementById("swal-t-doc").value||"N/A",target:e,targetAgent:t,creator:currentUser,startDate:formatDateToDDMMYYYY(document.getElementById("swal-t-start").value),endDate:formatDateToDDMMYYYY(document.getElementById("swal-t-end").value),duration:document.getElementById("swal-t-duration").value}:(Swal.showValidationMessage("Ba≈ülƒ±k ve Atama Alanƒ± bo≈ü bƒ±rakƒ±lamaz"),!1)}});e&&(Swal.fire({title:"Atanƒ±yor...",didOpen:()=>Swal.showLoading()}),fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"assignTraining",username:currentUser,token:getToken(),...e})}).then(e=>e.json()).then(e=>{Swal.fire("Ba≈üarƒ±lƒ±","Eƒüitim atandƒ±.","success"),loadTrainingData()}))}async function fetchFeedbackLogs(){try{const e=await fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"fetchFeedbackLogs",username:currentUser,token:getToken()})}),t=await e.json();feedbackLogsData="success"===t.result&&t.feedbackLogs||[]}catch(e){console.error("Feedback Logs √ßekilirken hata olu≈ütu:",e),feedbackLogsData=[]}}function formatPeriod(e){if(!e||"N/A"===e)return"N/A";if(e.match(/^\d{2}\.\d{4}$/))return e;try{const t=new Date(e);if(!isNaN(t.getTime())){const e=String(t.getMonth()+1).padStart(2,"0");return`${e}.${t.getFullYear()}`}}catch(e){console.error("D√∂nem formatlama hatasƒ±:",e)}return e}function loadFeedbackList(){const e=document.getElementById("feedback-list");e.innerHTML="";const t=document.getElementById("manual-feedback-admin-btn");t&&(t.style.display=isAdminMode?"flex":"none");const a=allEvaluationsData.filter(e=>{const t=e.feedbackType&&"mail"===e.feedbackType.toLowerCase(),a=e.callId&&String(e.callId).toUpperCase().startsWith("MANUEL-");return t||a});0!==a.length?a.forEach(t=>{const a="S√∂zl√º"===t.feedbackType?"#2196f3":"Mail"===t.feedbackType?"#e65100":"Bilgilendirme"===t.feedbackType?"#0288d1":"Feedback"===t.feedbackType?"#2e7d32":"#10b981",n=String(t.callId).toUpperCase().startsWith("MANUEL-")?String(t.callId).substring(7):t.callId,i=String(t.details).startsWith("[")?"Deƒüerlendirme Konusu":t.details||"Belirtilmemi≈ü",l=String(t.callId).toUpperCase().startsWith("MANUEL-");let r=t.period||t.date.substring(3),s=t.channel&&String(t.channel).trim()?String(t.channel).trim():"Yok";const o=t.feedbackType||"Yok";if(l){const e=feedbackLogsData.find(e=>String(e.callId)===String(n));e&&(r=formatPeriod(e.period)||r,s=e.channel&&"N/A"!==e.channel?e.channel:"Yok")}e.innerHTML+=`\n            <div class="feedback-card" style="border-left-color: ${a};">\n                <div class="feedback-header">\n                    <div style="font-weight:bold; color:#0e1b42; font-size:1.1rem;">${t.agent}</div>\n                    <div class="feedback-info-right">\n                        <span><i class="fas fa-user-check"></i> Deƒüerleyen: ${t.evaluator}</span>\n                        <span><i class="fas fa-id-badge"></i> √áaƒürƒ± ID: ${n}</span>\n                        <span><i class="fas fa-calendar-alt"></i> Tarih: ${t.callDate}</span>\n                    </div>\n                </div>\n                <div class="feedback-body">\n                    <div style="font-weight:bold; color:#333; margin-bottom:5px;">Konu/A√ßƒ±klama: ${i}</div>\n                    <div style="color:#555; line-height:1.5; font-size:0.95rem;">${t.feedback}</div>\n                </div>\n                <div class="feedback-footer">\n                     <div style="display:flex; gap:10px; font-size:0.7rem; color:#666; font-weight:600; margin-right:10px;">\n                        <span><i class="fas fa-calendar-week"></i> D√∂nem: ${r}</span>\n                        <span><i class="fas fa-comment-alt"></i> Kanal: ${s}</span>\n                        <span><i class="fas fa-tag"></i> Tip: ${o}</span>\n                     </div>\n                     \n            </div>`}):e.innerHTML='<div style="padding:20px; text-align:center; color:#888;">G√∂r√ºnt√ºlenecek filtrelenmi≈ü geri bildirim yok (Sadece Mail veya Manuel).</div>'}async function addManualFeedbackPopup(){if(!isAdminMode)return;0===adminUserList.length&&(Swal.fire({title:"Kullanƒ±cƒ± Listesi Y√ºkleniyor...",didOpen:()=>Swal.showLoading()}),await fetchUserListForAdmin(),Swal.close());const e=new Date,t=e.getMonth(),a=e.getFullYear();let n="";for(let e=0;e<6;e++){let i=(t-e+12)%12,l=a-(t-e<0?1:0);const r=`${MONTH_NAMES[i]} ${l}`;n+=`<option value="${`${String(i+1).padStart(2,"0")}.${l}`}" ${0===e?"selected":""}>${r}</option>`}const i=`\n        <div class="manual-feedback-form">\n            <div class="form-group">\n                <label for="manual-q-agent">Temsilci Adƒ± <span class="required">*</span></label>\n                <select id="manual-q-agent" class="swal2-input"></select>\n            </div>\n            <div class="form-group">\n                <label for="manual-q-topic">Konu / Ba≈ülƒ±k <span class="required">*</span></label>\n                <input id="manual-q-topic" class="swal2-input" placeholder="Geri bildirim konusu (√ñrn: Yeni Kampanya Bilgilendirmesi)">\n            </div>\n            \n            <div class="grid-2-cols">\n                <div class="form-group">\n                    <label for="manual-q-callid">√áaƒürƒ±/Etkile≈üim ID <span class="required">*</span></label>\n                    <input id="manual-q-callid" class="swal2-input" placeholder="ID (√ñrn: 123456)">\n                </div>\n                <div class="form-group">\n                    <label for="manual-q-date">Tarih <span class="required">*</span></label>\n                    <input type="date" id="manual-q-date" class="swal2-input" value="${(new Date).toISOString().substring(0,10)}">\n                </div>\n            </div>\n            <div class="grid-3-cols">\n                <div class="form-group">\n                    <label for="manual-q-channel">Kanal</label>\n                    <select id="manual-q-channel" class="swal2-input">\n                        <option value="Telefon">Telefon</option>\n                        <option value="Canlƒ± Destek">Canlƒ± Destek</option>\n                        <option value="E-posta">E-posta</option>\n                        <option value="Sosyal Medya">Sosyal Medya</option>\n                        <option value="Yok">Yok/Diƒüer</option>\n                    </select>\n                </div>\n                <div class="form-group">\n                    <label for="manual-q-period">D√∂nem</label>\n                    <select id="manual-q-period" class="swal2-input">${n}</select>\n                </div>\n                <div class="form-group">\n                    <label for="manual-q-type">Tip</label>\n                    <select id="manual-q-type" class="swal2-input">\n                        <option value="Feedback">Feedback</option>\n                        <option value="Bilgilendirme">Bilgilendirme</option>\n                        <option value="S√∂zl√º">S√∂zl√º</option>\n                        <option value="Mail">Mail</option>\n                        <option value="√ñzel">√ñzel Konu</option>\n                    </select>\n                </div>\n            </div>\n            \n            <div class="form-group">\n                <label for="manual-q-feedback">Geri Bildirim Detaylarƒ± <span class="required">*</span></label>\n                <textarea id="manual-q-feedback" class="swal2-textarea" placeholder="Buraya geri bildirimin detaylƒ± metnini giriniz..."></textarea>\n            </div>\n        </div>\n        <style>\n            /* Manuel Geri Bildirim Formu Stil ƒ∞yile≈ütirmeleri */\n            .manual-feedback-form {\n                text-align: left;\n                padding: 10px;\n                background: #fcfcfc;\n                border-radius: 8px;\n                border: 1px solid #eee;\n            }\n            .form-group {\n                margin-bottom: 12px;\n            }\n            .form-group label {\n                font-size: 0.85rem;\n                font-weight: 600;\n                color: var(--primary);\n                display: block;\n                margin-bottom: 4px;\n            }\n            .grid-2-cols {\n                display: grid;\n                grid-template-columns: 1fr 1fr;\n                gap: 15px;\n            }\n            .grid-3-cols {\n                display: grid;\n                grid-template-columns: 1fr 1fr 1fr;\n                gap: 15px;\n            }\n            .required {\n                color: var(--accent);\n                font-size: 0.9rem;\n            }\n            /* Input/Select/Textarea stillerini genel swal2-input stilinden devraldƒ±k */\n            .manual-feedback-form .swal2-input, .manual-feedback-form .swal2-textarea {\n                width: 100% !important;\n                box-sizing: border-box !important;\n                margin: 0 !important;\n                padding: 10px 12px !important;\n                border: 1px solid #dcdcdc !important;\n                border-radius: 6px !important;\n                font-size: 0.95rem !important;\n                transition: border-color 0.2s, box-shadow 0.2s;\n            }\n            .manual-feedback-form .swal2-input:focus, .manual-feedback-form .swal2-textarea:focus {\n                border-color: var(--secondary) !important;\n                box-shadow: 0 0 0 2px rgba(250, 187, 0, 0.2) !important;\n            }\n            .manual-feedback-form .swal2-textarea {\n                min-height: 100px;\n                resize: vertical;\n            }\n        </style>\n    `,{value:l}=await Swal.fire({title:"Manuel Geri Bildirim Yaz",html:i,width:"600px",showCancelButton:!0,confirmButtonText:'<i class="fas fa-save"></i> Kaydet',didOpen:()=>{const e=document.getElementById("manual-q-agent");adminUserList.forEach(t=>e.innerHTML+=`<option value="${t.name}">${t.name}</option>`)},preConfirm:()=>{const e=document.getElementById("manual-q-agent").value,t=document.getElementById("manual-q-topic").value,a=document.getElementById("manual-q-feedback").value,n=document.getElementById("manual-q-type").value,i=document.getElementById("manual-q-channel").value,l=document.getElementById("manual-q-period").value,r=document.getElementById("manual-q-callid").value.trim(),s=document.getElementById("manual-q-date").value,o=formatDateToDDMMYYYY(s);return e&&a&&r&&s&&t?{agentName:e,callId:"MANUEL-"+r,callDate:o,score:100,details:t,feedback:a,feedbackType:n,agentGroup:"Genel",channel:i,period:l}:(Swal.showValidationMessage("T√ºm (*) i≈üaretli alanlar zorunludur!"),!1)}});if(l){try{const e=String(l.agentName||"").trim().toLowerCase(),t=String(l.callId||"").trim();if(Array.isArray(allEvaluationsData)&&allEvaluationsData.some(a=>String(a.agent||a.agentName||"").trim().toLowerCase()===e&&String(a.callId||"").trim()===t)){if(!(await Swal.fire({icon:"warning",title:"M√ºkerrer Dinleme",html:`<div style="text-align:left; line-height:1.4;">\n                            <b>${l.agentName}</b> i√ßin <b>Call ID: ${escapeHtml(l.callId)}</b> daha √∂nce kaydedilmi≈ü g√∂r√ºn√ºyor.<br>\n                            <span style="color:#666; font-size:0.9rem;">Yine de yeni kayƒ±t olu≈üturmak istiyor musun?</span>\n                           </div>`,showCancelButton:!0,confirmButtonText:"Evet, kaydet",cancelButtonText:"Vazge√ß",reverseButtons:!0})).isConfirmed)return}}catch(e){console.warn("Duplicate check failed",e)}Swal.fire({title:"Kaydediliyor...",didOpen:()=>Swal.showLoading()}),fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"logEvaluation",username:currentUser,token:getToken(),...l})}).then(e=>e.json()).then(async e=>{if("success"===e.result)Swal.fire({icon:"success",title:"Kaydedildi",timer:1500,showConfirmButton:!1}),fetchEvaluationsForAgent(l.agentName),fetchFeedbackLogs().then(()=>{loadFeedbackList()});else if("duplicate"===e.result){(await Swal.fire({icon:"warning",title:"M√ºkerrer Dinleme",html:`<div style="text-align:left; line-height:1.4;">\n                            <b>${l.agentName}</b> i√ßin <b>Call ID: ${escapeHtml(l.callId)}</b> zaten var.<br>\n                            <span style="color:#666; font-size:0.9rem;">Yine de yeni kayƒ±t olu≈üturulsun mu?</span>\n                           </div>`,showCancelButton:!0,confirmButtonText:"Evet, zorla kaydet",cancelButtonText:"Vazge√ß",reverseButtons:!0})).isConfirmed&&(Swal.fire({title:"Kaydediliyor...",didOpen:()=>Swal.showLoading()}),fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"logEvaluation",username:currentUser,token:getToken(),force:!0,...l})}).then(e=>e.json()).then(e=>{"success"===e.result?(Swal.fire({icon:"success",title:"Kaydedildi",timer:1500,showConfirmButton:!1}),fetchEvaluationsForAgent(l.agentName),fetchFeedbackLogs().then(()=>{loadFeedbackList()})):Swal.fire("Hata",e.message,"error")}))}else Swal.fire("Hata",e.message,"error")})}}async function fetchEvaluationsForAgent(e,t=!1){const a=document.getElementById("evaluations-list");t||(a.innerHTML="Y√ºkleniyor...");const n=document.getElementById("q-admin-group"),i=document.getElementById("q-admin-agent");let l=e||currentUser,r="all";isAdminMode&&i&&(l=e||i.value,r=n?n.value:"all");try{const e=await fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"fetchEvaluations",targetAgent:l,targetGroup:r,username:currentUser,token:getToken()})}),n=await e.json();if("success"===n.result){if(allEvaluationsData=n.evaluations.reverse(),t)return;a.innerHTML="";const e=allEvaluationsData.filter(e=>!String(e.callId).toUpperCase().startsWith("MANUEL-"));if(0===e.length)return void(a.innerHTML='<p style="text-align:center; color:#666;">Kayƒ±t yok.</p>');e.forEach((e,t)=>{const n=e.score>=90?"#2e7d32":e.score>=70?"#ed6c02":"#d32f2f";let i=isAdminMode?`<i class="fas fa-pen" style="font-size:1rem; color:#fabb00; cursor:pointer; margin-right:5px;" onclick="event.stopPropagation(); editEvaluation('${e.callId}')"></i>`:"",s="all"===l||l===r?`<span style="font-size:0.8rem; font-weight:bold; color:#555; background:#eee; padding:2px 6px; border-radius:4px; margin-left:10px;">${e.agent}</span>`:"",o="";try{const t=JSON.parse(e.details);o='<table style="width:100%; font-size:0.85rem; border-collapse:collapse; margin-top:10px;">',Array.isArray(t)?t.forEach(e=>{let t=e.score<e.max?"#ffebee":"#f9f9f9",a=e.note?`<br><em style="color: #d32f2f; font-size:0.8rem;">(Not: ${e.note})</em>`:"";o+=`<tr style="background:${t}; border-bottom:1px solid #fff;">\n                                <td style="padding:8px; border-radius:4px;">${e.q}${a}</td>\n                                <td style="padding:8px; font-weight:bold; text-align:right;">${e.score}/${e.max}</td>\n                            </tr>`}):o=`<p style="white-space:pre-wrap; margin:0; font-size:0.9rem; background:#fff8e1; padding:10px; border-radius:4px;">${e.details}</p>`,o+="</table>"}catch(t){o=`<p style="white-space:pre-wrap; margin:0; font-size:0.9rem; background:#fff8e1; padding:10px; border-radius:4px;">${e.details}</p>`}const d=e.callDate&&"N/A"!==e.callDate?e.callDate:"N/A",c=e.date||"N/A";a.innerHTML+=`\n                <div class="evaluation-summary" id="eval-summary-${t}" style="border-left:4px solid ${n}; padding:15px; margin-bottom:10px; border-radius:8px; background:#fff; cursor:pointer;" onclick="toggleEvaluationDetail(${t})">\n                    <div style="display:flex; justify-content:space-between; align-items:center;">\n                        <div>\n                            <div style="font-weight:700; color:#2c3e50;">${e.agent} ${s}</div>\n                            \x3c!-- Geli≈ütirme: √áaƒürƒ± Tarihi ve Dinlenme Tarihi --\x3e\n                            <div class="eval-date-info">\n                                <span><i class="fas fa-phone"></i> √áaƒürƒ±: ${d}</span>\n                                <span><i class="fas fa-headphones"></i> Dinlenme: ${c}</span>\n                            </div>\n                            <div style="font-size:0.75rem; color:#999; margin-top:2px;">ID: ${e.callId}</div>\n                        </div>\n                        <div style="text-align:right;">\n                             ${i} <span style="font-weight:800; font-size:1.6rem; color:${n};">${e.score}</span>\n                        </div>\n                    </div>\n                    <div class="evaluation-details-content" id="eval-details-${t}">\n                        ${o}\n                        <div style="margin-top:10px; background:#f8f9fa; padding:10px; border-radius:4px;">\n                            <strong>Feedback:</strong> ${e.feedback||"-"}\n                        </div>\n                    </div>\n                </div>`})}}catch(e){t||(a.innerHTML='<p style="color:red; text-align:center;">Hata olu≈ütu.</p>')}}function updateAgentListBasedOnGroup(){const e=document.getElementById("q-admin-group"),t=document.getElementById("q-admin-agent");if(!e||!t)return;const a=e.value;t.innerHTML="";let n=adminUserList;"all"!==a?(n=adminUserList.filter(e=>e.group===a),t.innerHTML=`<option value="all">-- T√ºm ${a} Ekibi --</option>`):t.innerHTML='<option value="all">-- T√ºm Temsilciler --</option>',n.forEach(e=>{t.innerHTML+=`<option value="${e.name}">${e.name}</option>`}),fetchEvaluationsForAgent()}function fetchUserListForAdmin(){return new Promise(e=>{fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"getUserList",username:currentUser,token:getToken()})}).then(e=>e.json()).then(t=>{"success"===t.result?(adminUserList=t.users.filter(e=>"Y√∂netim"!==e.group),e(adminUserList)):e([])}).catch(t=>e([]))})}function fetchCriteria(e){return new Promise(t=>{fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"getCriteria",group:e,username:currentUser,token:getToken()})}).then(e=>e.json()).then(e=>{"success"===e.result?t(e.criteria||[]):t([])}).catch(e=>t([]))})}function toggleEvaluationDetail(e){const t=document.getElementById(`eval-details-${e}`);t.style.maxHeight&&"0px"!==t.style.maxHeight?(t.style.maxHeight="0px",t.style.marginTop="0"):(t.style.maxHeight=t.scrollHeight+500+"px",t.style.marginTop="10px")}async function exportEvaluations(){if(!isAdminMode)return;const{isConfirmed:e}=await Swal.fire({icon:"question",title:"Rapor ƒ∞ndirilsin mi?",showCancelButton:!0,confirmButtonText:"ƒ∞ndir"});if(!e)return;Swal.fire({title:"Hazƒ±rlanƒ±yor...",didOpen:()=>Swal.showLoading()});const t=document.getElementById("q-admin-group"),a=document.getElementById("q-admin-agent");fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"exportEvaluations",targetAgent:a?a.value:"all",targetGroup:t?t.value:"all",username:currentUser,token:getToken()})}).then(e=>e.json()).then(e=>{if("success"===e.result&&e.csvData){const t=new Blob(["\ufeff"+e.csvData],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),n=URL.createObjectURL(t);a.setAttribute("href",n),a.setAttribute("download",e.fileName),document.body.appendChild(a),a.click(),document.body.removeChild(a),Swal.fire("Ba≈üarƒ±lƒ±","Rapor indirildi.","success")}else Swal.fire("Hata",e.message||"Veri alƒ±namadƒ±.","error")})}async function logEvaluationPopup(){const e=document.getElementById("q-admin-agent"),t=e?e.value:"";if(!t||"all"===t)return void Swal.fire("Uyarƒ±","L√ºtfen listeden bir temsilci se√ßiniz.","warning");let a="Genel";const n=adminUserList.find(e=>e.name.toLowerCase()===t.toLowerCase());n&&n.group&&(a=n.group);const i=a.indexOf("Chat")>-1,l=a.indexOf("Telesatƒ±≈ü")>-1;i&&(a="Chat"),Swal.fire({title:"Hazƒ±rlanƒ±yor...",didOpen:()=>Swal.showLoading()});let r=[];a&&"Genel"!==a&&(r=await fetchCriteria(a)),Swal.close();const s=r.length>0;let o="";s&&(o+='<div class="criteria-container">',r.forEach((e,t)=>{let a=parseInt(e.points)||0;if(0===a)return;const n=escapeForJsString(e.text);if(i){let i=parseInt(e.mediumScore)||0,l=parseInt(e.badScore)||0;o+=`<div class="criteria-row" id="row-${t}" data-max-score="${a}"><div class="criteria-header"><span title="${n}">${t+1}. ${e.text}</span><span style="font-size:0.8rem;">Max: ${a}</span></div><div class="criteria-controls"><div class="eval-button-group"><button class="eval-button eval-good active" data-score="${a}" onclick="setButtonScore(${t}, ${a}, ${a})">ƒ∞yi (${a})</button>${i>0?`<button class="eval-button eval-medium" data-score="${i}" onclick="setButtonScore(${t}, ${i}, ${a})">Orta (${i})</button>`:""}${l>0?`<button class="eval-button eval-bad" data-score="${l}" onclick="setButtonScore(${t}, ${l}, ${a})">K√∂t√º (${l})</button>`:""}</div><span class="score-badge" id="badge-${t}" style="margin-top:8px; display:block; background:#2e7d32;">${a}</span></div><input type="text" id="note-${t}" class="note-input" placeholder="Not..." style="display:none;"></div>`}else l&&(o+=`<div class="criteria-row" id="row-${t}" data-max-score="${a}"><div class="criteria-header"><span title="${n}">${t+1}. ${e.text}</span><span>Max: ${a}</span></div><div class="criteria-controls" style="display:flex; align-items:center; gap:15px; background:#f9f9f9;"><input type="range" class="custom-range slider-input" id="slider-${t}" min="0" max="${a}" value="${a}" data-index="${t}" oninput="updateRowSliderScore(${t}, ${a})" style="flex-grow:1;"><span class="score-badge" id="badge-${t}" style="background:#2e7d32;">${a}</span></div><input type="text" id="note-${t}" class="note-input" placeholder="Not..." style="display:none;"></div>`)}),o+="</div>");const d=`\n        <div class="eval-modal-wrapper">\n            <div class="score-dashboard"><div><div style="font-size:0.9rem;">Deƒüerlendirilen</div><div style="font-size:1.2rem; font-weight:bold; color:#fabb00;">${t}</div></div><div class="score-circle-outer" id="score-ring"><div class="score-circle-inner" id="live-score">100</div></div></div>\n            <div class="eval-header-card"><div><label>Call ID <span style="color:red;">*</span></label><input id="eval-callid" class="swal2-input" style="height:35px; margin:0; width:100%;" placeholder="Call ID"></div><div><label>Tarih</label><input type="date" id="eval-calldate" class="swal2-input" style="height:35px; margin:0; width:100%;" value="${(new Date).toISOString().substring(0,10)}"></div></div>\n            ${s?o:'<div style="padding:15px; border:1px dashed #ccc; text-align:center;"><label>Manuel Puan</label><br><input id="eval-manual-score" type="number" class="swal2-input" value="100" min="0" max="100" style="width:100px; text-align:center;"></div><textarea id="eval-details" class="swal2-textarea" placeholder="Detaylar..."></textarea>'}\n            <div style="margin-top:15px; padding:10px; background:#fafafa; border:1px solid #eee;"><label>Geri Bildirim Tipi</label><select id="feedback-type" class="swal2-input" style="width:100%; height:40px; margin:0;"><option value="Yok" selected>Yok</option><option value="S√∂zl√º">S√∂zl√º</option><option value="Mail">Mail</option></select></div>\n            <div style="margin-top:15px;"><label>Genel Geri Bildirim</label><textarea id="eval-feedback" class="swal2-textarea" style="margin-top:5px; height:80px;"></textarea></div>\n        </div>`,{value:c}=await Swal.fire({html:d,width:"600px",showCancelButton:!0,confirmButtonText:" üíæ  Kaydet",allowOutsideClick:!1,allowEscapeKey:!1,didOpen:()=>{l?window.recalcTotalSliderScore():i&&window.recalcTotalScore()},preConfirm:()=>{const e=document.getElementById("eval-callid").value.trim();if(!e)return Swal.showValidationMessage("Call ID alanƒ± bo≈ü bƒ±rakƒ±lamaz!"),!1;const n=document.getElementById("eval-calldate").value,o=n.split("-"),d=3===o.length?`${o[2]}.${o[1]}.${o[0]}`:n;if(s){let n=0,s=[];for(let e=0;e<r.length;e++){const t=r[e];if(0===parseInt(t.points))continue;let a=0,o=document.getElementById(`note-${e}`).value;i?a=parseInt(document.getElementById(`badge-${e}`).innerText)||0:l&&(a=parseInt(document.getElementById(`slider-${e}`).value)||0),n+=a,s.push({q:t.text,max:parseInt(t.points),score:a,note:o})}return{agentName:t,agentGroup:a,callId:e,callDate:d,score:n,details:JSON.stringify(s),feedback:document.getElementById("eval-feedback").value,feedbackType:document.getElementById("feedback-type").value}}return{agentName:t,agentGroup:a,callId:e,callDate:d,score:parseInt(document.getElementById("eval-manual-score").value),details:document.getElementById("eval-details").value,feedback:document.getElementById("feedback-type").value}}});c&&(Swal.fire({title:"Kaydediliyor...",didOpen:()=>Swal.showLoading()}),fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"logEvaluation",username:currentUser,token:getToken(),...c})}).then(e=>e.json()).then(e=>{"success"===e.result?(Swal.fire({icon:"success",title:"Kaydedildi",timer:1500,showConfirmButton:!1}),fetchEvaluationsForAgent(c.agentName),fetchFeedbackLogs().then(()=>{loadFeedbackList()})):Swal.fire("Hata",e.message,"error")}))}async function editEvaluation(e){const t=allEvaluationsData.find(t=>String(t.callId).trim()===String(e).trim());if(!t)return void Swal.fire("Hata","Kayƒ±t bulunamadƒ±.","error");const a=t.agent,n=t.group||"Genel",i=n.indexOf("Chat")>-1,l=n.indexOf("Telesatƒ±≈ü")>-1;let r=i?"Chat":l?"Telesatƒ±≈ü":"Genel";Swal.fire({title:"ƒ∞nceleniyor...",didOpen:()=>Swal.showLoading()});let s=[];r&&"Genel"!==r&&(s=await fetchCriteria(r)),Swal.close();const o=s.length>0;let d=[];try{d=JSON.parse(t.details||"[]")}catch(e){d=[]}let c=`<div class="eval-modal-wrapper" style="border-top:5px solid #1976d2;"><div class="score-dashboard"><div><div style="font-size:0.9rem;">D√úZENLENEN</div><div style="font-size:1.2rem; font-weight:bold; color:#1976d2;">${a}</div></div><div class="score-circle-outer" id="score-ring"><div class="score-circle-inner" id="live-score">${t.score}</div></div></div><div class="eval-header-card"><div><label>Call ID</label><input id="eval-callid" class="swal2-input" value="${t.callId}" readonly style="background:#eee; height:35px; width:100%;"></div></div>`;o?(c+='<div class="criteria-container">',s.forEach((e,t)=>{let a=parseInt(e.points)||0;if(0===a)return;let n=parseInt(e.mediumScore)||0,r=parseInt(e.badScore)||0,s=d.find(t=>t.q===e.text)||(d[t]?d[t]:{score:a,note:""}),o=parseInt(s.score),u=s.note||"";const m=escapeForJsString(e.text);if(i){let i=o===a?"active":"",l=o===n&&0!==n?"active":"",s=o===r&&0!==r?"active":"";0===o&&0===r?s="active":0===o&&r>0&&(i="",l="",s=""),c+=`<div class="criteria-row" id="row-${t}" data-max-score="${a}"><div class="criteria-header"><span title="${m}">${t+1}. ${e.text}</span><span>Max: ${a}</span></div><div class="criteria-controls"><div class="eval-button-group"><button class="eval-button eval-good ${i}" data-score="${a}" onclick="setButtonScore(${t}, ${a}, ${a})">ƒ∞yi</button>${n>0?`<button class="eval-button eval-medium ${l}" data-score="${n}" onclick="setButtonScore(${t}, ${n}, ${a})">Orta</button>`:""}${r>0?`<button class="eval-button eval-bad ${s}" data-score="${r}" onclick="setButtonScore(${t}, ${r}, ${a})">K√∂t√º</button>`:""}</div><span class="score-badge" id="badge-${t}">${o}</span></div><input type="text" id="note-${t}" class="note-input" value="${u}" style="display:${o<a?"block":"none"}"></div>`}else l&&(c+=`<div class="criteria-row" id="row-${t}" data-max-score="${a}"><div class="criteria-header"><span title="${m}">${t+1}. ${e.text}</span><span>Max: ${a}</span></div><div class="criteria-controls" style="display:flex; background:#f9f9f9;"><input type="range" class="custom-range slider-input" id="slider-${t}" min="0" max="${a}" value="${o}" data-index="${t}" oninput="updateRowSliderScore(${t}, ${a})" style="flex-grow:1;"><span class="score-badge" id="badge-${t}">${o}</span></div><input type="text" id="note-${t}" class="note-input" value="${u}" style="display:${o<a?"block":"none"}"></div>`)}),c+="</div>"):c+=`<div style="padding:15px; border:1px dashed #ccc; text-align:center;"><label>Manuel Puan</label><br><input id="eval-manual-score" type="number" class="swal2-input" value="${t.score}" min="0" max="100" style="width:100px;"></div><textarea id="eval-details" class="swal2-textarea">${"string"==typeof t.details?t.details:""}</textarea>`,c+=`<div><label>Revize Feedback</label><textarea id="eval-feedback" class="swal2-textarea">${t.feedback||""}</textarea></div></div>`;const{value:u}=await Swal.fire({html:c,width:"600px",showCancelButton:!0,confirmButtonText:" üíæ  G√ºncelle",allowOutsideClick:!1,allowEscapeKey:!1,didOpen:()=>{l?window.recalcTotalSliderScore():i&&window.recalcTotalScore()},preConfirm:()=>{const e=document.getElementById("eval-callid").value,t=document.getElementById("eval-feedback").value;if(o){let n=0,r=[];for(let e=0;e<s.length;e++){const t=s[e];if(0===parseInt(t.points))continue;let a=0,o=document.getElementById(`note-${e}`).value;a=i?parseInt(document.getElementById(`badge-${e}`).innerText)||0:l?parseInt(document.getElementById(`slider-${e}`).value)||0:parseInt(t.points),n+=a,r.push({q:t.text,max:parseInt(t.points),score:a,note:o})}return{agentName:a,callId:e,score:n,details:JSON.stringify(r),feedback:t}}return{agentName:a,callId:e,score:parseInt(document.getElementById("eval-manual-score").value),details:document.getElementById("eval-details").value,feedback:t}}});u&&(Swal.fire({title:"G√ºncelleniyor...",didOpen:()=>Swal.showLoading()}),fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"updateEvaluation",username:currentUser,token:getToken(),...u})}).then(e=>e.json()).then(e=>{"success"===e.result?(Swal.fire({icon:"success",title:"G√ºncellendi",timer:1500,showConfirmButton:!1}),fetchEvaluationsForAgent(a),fetchFeedbackLogs().then(()=>{loadFeedbackList()})):Swal.fire("Hata",e.message,"error")}))}const TELESales_OFFERS_FALLBACK=[{offer:"YILLIK - 1299 TL",segment:"Wƒ∞NBACK",description:"Kullanƒ±cƒ± daha √∂nce aylƒ±k ya da yƒ±llƒ±k herhangi bir paket kullanmƒ±≈ü, ardƒ±ndan paket sonlanmƒ±≈ü ve ≈üu anda aktif paketi olmayan kullanƒ±cƒ±larƒ± aradƒ±ƒüƒ±mƒ±z bir data",note:"Kullanƒ±cƒ±nƒ±n izleme ge√ßmi≈üi olabilir."},{offer:"AYLIK  - 6 AY 109 TL",segment:"Wƒ∞NBACK",description:"Kullanƒ±cƒ± daha √∂nce aylƒ±k ya da yƒ±llƒ±k herhangi bir paket kullanmƒ±≈ü, ardƒ±ndan paket sonlanmƒ±≈ü ve ≈üu anda aktif paketi olmayan kullanƒ±cƒ±larƒ± aradƒ±ƒüƒ±mƒ±z bir data",note:"Kullanƒ±cƒ±nƒ±n izleme ge√ßmi≈üi olabilir."},{offer:"YILLIK - 1399 TL",segment:"CANCELLƒ∞NG",description:"Aboneliƒüinde iptal talebinde bulunmu≈ü, paket s√ºresi bitimine kadar eri≈üime devam eden, geri kazanƒ±m i√ßin aradƒ±ƒüƒ±mƒ±z bir data",note:"Kullanƒ±cƒ±nƒ±n izleme ge√ßmi≈üi olabilir. ƒ∞ndirim oranƒ± y√ºksek + Kullanƒ±cƒ±nƒ±n bir iptal nedeni olabilir"},{offer:"AYLIK  - 6 AY 119 TL",segment:"CANCELLƒ∞NG",description:"Aboneliƒüinde iptal talebinde bulunmu≈ü, paket s√ºresi bitimine kadar eri≈üime devam eden, geri kazanƒ±m i√ßin aradƒ±ƒüƒ±mƒ±z bir data",note:"Kullanƒ±cƒ±nƒ±n izleme ge√ßmi≈üi olabilir. ƒ∞ndirim oranƒ± y√ºksek + Kullanƒ±cƒ±nƒ±n bir iptal nedeni olabilir"},{offer:"YILLIK - 1499 TL",segment:"ACTƒ∞VE GRACE",description:"Paket yenileme s√ºrecine giren fakat √ºcret alƒ±namadƒ±ƒüƒ± i√ßin paketi yenilenemeyen kullanƒ±cƒ±larƒ± aradƒ±ƒüƒ±mƒ±z bir data",note:"Paket yenileme s√ºrecinden bir √∂deme sorunu olu≈ütuƒüunu bu nedenle aboneliƒüinin yenilenmediƒüini, kullanƒ±cƒ±ya hem bu sorunu √ß√∂zmek hem de indirimli fiyatlar √ºzerinden yardƒ±mcƒ± olmak +ƒ∞√ßerik"},{offer:"AYLIK  - 6 AY 109 TL",segment:"ACTƒ∞VE GRACE",description:"Paket yenileme s√ºrecine giren fakat √ºcret alƒ±namadƒ±ƒüƒ± i√ßin paketi yenilenemeyen kullanƒ±cƒ±larƒ± aradƒ±ƒüƒ±mƒ±z bir data",note:"Paket yenileme s√ºrecinden bir √∂deme sorunu olu≈ütuƒüunu bu nedenle aboneliƒüinin yenilenmediƒüini, kullanƒ±cƒ±ya hem bu sorunu √ß√∂zmek hem de indirimli fiyatlar √ºzerinden yardƒ±mcƒ± olmak +ƒ∞√ßerik"},{offer:"YILLIK - 1499 TL",segment:"INBOUND",description:"Inbound √ºzerinden gelen satƒ±n alma talepleri ya da satƒ±≈üa ikna edilen kullanƒ±cƒ±lar i√ßin sunulan teklif",note:""},{offer:"AYLIK - 6 AY 139,5 TL",segment:"INBOUND",description:"Inbound √ºzerinden gelen satƒ±n alma talepleri ya da satƒ±≈üa ikna edilen kullanƒ±cƒ±lar i√ßin sunulan teklif",note:""}],SPORTS_RIGHTS_FALLBACK=[{item:"Euroleague ma√ßlarƒ± ve st√ºdyo programlarƒ±",period:"2025-2026 / 2026- 2027 / 2027-2028 / 2028-2029",note:""},{item:"Bundesliga",period:"2025-2026 / 2026- 2027 / 2027-2028 / 2028-2029",note:""},{item:"Bundesliga 2",period:"2025-2026 / 2026- 2027 / 2027-2028 / 2028-2029",note:""},{item:"ƒ∞spanya LaLiga √∂nemli ma√ßlarƒ±",period:"2025 - 2026 / 2026 - 2027",note:""},{item:"LaLiga 2 √∂nemli ma√ßlarƒ±",period:"2025 - 2026 / 2026 - 2027",note:""},{item:"ƒ∞talya Serie A √∂nemli ma√ßlarƒ±",period:"2025 - 2026 / 2026 - 2027",note:""},{item:"Portekiz Liga Portugal √∂nemli ma√ßlarƒ±",period:"2025 - 2026",note:""},{item:"Suudi Arabistan Pro Lig √∂nemli ma√ßlarƒ±",period:"2025-2026 / 2026- 2027 / 2027-2028 / 2028-2029",note:""},{item:"Hollanda Ligi",period:"2025-2026 / 2026- 2027 / 2027-2028 / 2028-2029",note:""},{item:"ƒ∞sko√ßya Premiership √∂nemli ma√ßlarƒ±",period:"2025 - 2026 / 2026 - 2027",note:""},{item:"NCAA Amerikan Futbol",period:"2025 - 2026 / 2026 - 2027",note:""},{item:"NCAA Basketbol",period:"2025 - 2026 / 2026 - 2027",note:""},{item:"NFL",period:"2025 - 2026",note:""},{item:"NBA",period:"2025-2026 / 2026- 2027 / 2027-2028 / 2028-2029",note:""},{item:"EuroCup",period:"2025-2026 / 2026- 2027 / 2027-2028 / 2028-2029",note:""},{item:"Yunanistan Basketbol Ligi √∂nemli ma√ßlarƒ±",period:"2025 - 2026 Sezon belirsiz",note:""},{item:"NCAA",period:"2025 - 2026 / 2026 - 2027",note:""},{item:"Libertadores Kupasƒ±",period:"2027, 2028, 2029, 2030 (4 seasons)",note:""},{item:"Copa Sudamericana",period:"2027, 2028, 2029, 2030 (4 seasons)",note:""},{item:"WRC",period:"2025",note:"2026 da alƒ±nabilir net deƒüil"},{item:"Nascar",period:"2025 - 2026 - 2027 - 2028 ve 2029",note:""},{item:"IndyCar",period:"2025 - 2026 - 2027",note:""},{item:"MotoGP - Moto2 - Moto3",period:"2025 - 2026 - 2027",note:""},{item:"ATP Tenis Turnuvalarƒ± √∂nemli ma√ßlar",period:"2025 - 2026 - 2027 and 2028",note:""},{item:"Wimbledon Tenis √∂nemli ma√ßlar",period:"2025 - 2026 - 2027",note:""},{item:"UFC D√∂v√º≈ü Gecesi yayƒ±nlarƒ±",period:"2027 sonuna kadar bizde",note:""},{item:"Oktagon",period:"2025",note:""},{item:"PFL MMA",period:"2025",note:""},{item:"Cage Warriors Boks Ma√ßlarƒ±",period:"2025",note:""},{item:"BKFC",period:"Kaldƒ±rƒ±ldƒ±",note:""}];function setActiveFilterButton(e){try{document.querySelectorAll(".filter-btn").forEach(e=>e.classList.remove("active")),e&&e.classList.add("active")}catch(e){}}function showHomeScreen(){const e=document.getElementById("home-screen"),t=document.getElementById("cardGrid"),a=document.getElementById("emptyMessage");e&&(e.style.display="block"),t&&(t.style.display="none"),a&&(a.style.display="none"),renderHomePanels()}function hideHomeScreen(){const e=document.getElementById("home-screen");e&&(e.style.display="none");const t=document.getElementById("cardGrid");t&&(t.style.display="grid")}function renderHomePanels(){const e=document.getElementById("home-today");e&&(e.innerHTML='<div class="home-mini-item">Yayƒ±n akƒ±≈üƒ± y√ºkleniyor...</div>',(async()=>{try{const t=await fetchBroadcastFlow(),a=new Date,n=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`,i=e=>{const t=String(e||"").trim();if(!t)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(t))return t;const a=t.match(/^(\d{2})\.(\d{2})\.(\d{4})$/);return a?`${a[3]}-${a[2]}-${a[1]}`:""},l=(t||[]).filter(e=>{if(i(e.dateISO||e.date)!==n)return!1;const t=Date.now(),a=Number(e.startEpoch||0);if(a)return a>t;const l=String(e.time||"").trim().match(/^(\d{2}):(\d{2})(?::(\d{2}))?$/);if(!l)return!0;const r=parseInt(l[1],10),s=parseInt(l[2],10),o=parseInt(l[3]||"0",10),d=new Date;return d.setHours(r,s,o,0),d.getTime()>t});if(l.length){const t=l.slice(0,4);e.innerHTML=t.map(e=>{const t=escapeHtml(e.time||""),a=escapeHtml(e.match||e.title||e.event||""),n=escapeHtml(e.channel||e.platform||""),i=escapeHtml(e.league||e.category||""),l=escapeHtml(e.spiker||e.spikers||e.commentator||e.commentators||"");return`\n                          <div class="home-mini-item">\n                            <div class="home-mini-date">${t}${i?` ‚Ä¢ ${i}`:""}${n?` ‚Ä¢ ${n}`:""}</div>\n                            <div class="home-mini-title">${a||"Ma√ß"}</div>\n                            ${l?`<div class="home-mini-desc" style="margin-top:4px;color:#555">üéô ${l}</div>`:""}\n                          </div>\n                        `}).join("")+(l.length>t.length?`<div style="color:#666;font-size:.9rem;margin-top:6px">+${l.length-t.length} ma√ß daha‚Ä¶</div>`:"")}else e.innerHTML='<div class="home-mini-item">Bug√ºn i√ßin yayƒ±n akƒ±≈üƒ± kaydƒ± bulunamadƒ±.</div>';const r=e.closest(".home-card");r&&(r.classList.add("clickable"),r.onclick=()=>openBroadcastFlow())}catch(t){e.innerHTML='<div class="home-mini-item">Yayƒ±n akƒ±≈üƒ± alƒ±namadƒ±.</div>'}})());const t=document.getElementById("home-ann");if(t){const e=(newsData||[]).slice(0,3);0===e.length?t.innerHTML='<div class="home-mini-item">Hen√ºz duyuru yok.</div>':t.innerHTML=e.map(e=>`\n                <div class="home-mini-item">\n                  <div class="home-mini-date">${escapeHtml(e.date||"")}</div>\n                  <div class="home-mini-title">${escapeHtml(e.title||"")}</div>\n                  <div class="home-mini-desc">${escapeHtml(String(e.desc||"")).slice(0,160)}${(e.desc||"").length>160?"...":""}</div>\n                </div>\n            `).join("");const a=t.closest(".home-card");a&&(a.classList.add("clickable"),a.onclick=()=>openNews())}const a=document.getElementById("home-quote");if(a){const e=String(homeBlocks&&homeBlocks.quote&&homeBlocks.quote.content?homeBlocks.quote.content:localStorage.getItem("homeQuote")||"").trim();a.innerHTML=e?escapeHtml(e):'<span style="color:#999">Bug√ºn i√ßin bir s√∂z eklenmemi≈ü.</span>'}try{const e=document.getElementById("home-edit-today"),t=document.getElementById("home-edit-ann"),a=document.getElementById("home-edit-quote");e&&(e.style.display="none"),t&&(t.style.display="none"),a&&(a.style.display=isAdminMode&&isEditingActive?"inline-flex":"none")}catch(e){}}function editHomeBlock(e){if(!isAdminMode)return void Swal.fire("Yetkisiz","Bu i≈ülem i√ßin admin yetkisi gerekli.","warning");if(!isEditingActive)return void Swal.fire("Kapalƒ±","D√ºzenleme modu kapalƒ±. √ñnce 'D√ºzenlemeyi A√ß' demelisin.","info");if("quote"!==e)return void Swal.fire("Bilgi","Bu alan artƒ±k otomatik g√ºncelleniyor.","info");const t=String(homeBlocks&&homeBlocks.quote&&homeBlocks.quote.content?homeBlocks.quote.content:localStorage.getItem("homeQuote")||"").trim();Swal.fire({title:"G√ºn√ºn S√∂z√º",input:"textarea",inputValue:t,inputPlaceholder:"Bug√ºn√ºn s√∂z√ºn√º yaz‚Ä¶",showCancelButton:!0,confirmButtonText:"Kaydet",cancelButtonText:"Vazge√ß",preConfirm:e=>(e||"").trim()}).then(e=>{if(!e.isConfirmed)return;const t=e.value||"";try{localStorage.setItem("homeQuote",t)}catch(e){}apiCall("updateHomeBlock",{key:"quote",title:"G√ºn√ºn S√∂z√º",content:t,visibleGroups:""}).then(()=>{homeBlocks=homeBlocks||{},homeBlocks.quote={key:"quote",title:"G√ºn√ºn S√∂z√º",content:t,visibleGroups:""};try{localStorage.setItem("homeBlocksCache",JSON.stringify(homeBlocks||{}))}catch(e){}renderHomePanels(),Swal.fire("Kaydedildi","G√ºn√ºn s√∂z√º g√ºncellendi.","success")}).catch(()=>{renderHomePanels(),Swal.fire("Kaydedildi","G√ºn√ºn s√∂z√º g√ºncellendi (yerel).","success")})})}function openCardDetail(e){const t=(cardsData||[]).find(t=>String(t.id)===String(e));t?showCardDetail(t):Swal.fire("Hata","Kart bulunamadƒ±.","error")}let telesalesOffers=[];function safeGetToken(){try{return"function"==typeof getToken?getToken():""}catch(e){return""}}async function fetchSheetObjects(e){const t={action:e,username:currentUser||"",token:safeGetToken()},a=await fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify(t)}),n=await a.json();if(!n||"success"!==n.result)throw new Error(n&&n.message?n.message:"Veri alƒ±namadƒ±.");return n.data||n.items||[]}async function openTelesalesArea(){try{const e=void 0!==menuPermissions&&menuPermissions?menuPermissions.telesales:null;if(e&&!isAllowedByPerm(e))return void Swal.fire("Yetkisiz","TeleSatƒ±≈ü ekranƒ±na eri≈üimin yok.","warning")}catch(e){}const e=document.getElementById("telesales-fullscreen");if(!e)return;e.style.display="flex",document.body.classList.add("fs-open"),document.body.style.overflow="hidden";const t=document.getElementById("t-side-avatar"),a=document.getElementById("t-side-name"),n=document.getElementById("t-side-role");if(t&&(t.innerText=(currentUser||"U").trim().slice(0,1).toUpperCase()),a&&(a.innerText=currentUser||"Kullanƒ±cƒ±"),n&&(n.innerText=isAdminMode?"Admin":"Temsilci"),0===telesalesOffers.length){let e=[];try{e=await fetchSheetObjects("getTelesalesOffers")}catch(e){}telesalesOffers=Array.isArray(e)&&e.length?e.map(e=>({segment:e.segment||e.Segment||e.SEGMENT||"",title:e.title||e.Ba≈ülƒ±k||e.Baslik||e.Teklif||e["Teklif Adƒ±"]||e["Teklif Adi"]||"",desc:e.desc||e.A√ßƒ±klama||e.Aciklama||e.Detay||e["Detay/Not"]||e.Not||"",example:e.example||e.√ñrnek||e.Ornek||"",tips:e.tips||e.ƒ∞pucu||e.Ipucu||"",objection:e.objection||e.Itiraz||"",reply:e.reply||e.Cevap||""})):Array.isArray(window.telesalesOffersFromSheet)&&window.telesalesOffersFromSheet.length?window.telesalesOffersFromSheet:TELESales_OFFERS_FALLBACK}renderTelesalesDataOffers(),renderTelesalesScripts(),switchTelesalesTab("data")}function closeFullTelesales(){const e=document.getElementById("telesales-fullscreen");e&&(e.style.display="none"),document.body.classList.remove("fs-open"),document.body.style.overflow=""}function switchTelesalesTab(e){document.querySelectorAll("#telesales-fullscreen .q-nav-item").forEach(e=>e.classList.remove("active")),document.querySelectorAll("#telesales-fullscreen .q-nav-item").forEach(t=>{(t.getAttribute("onclick")||"").includes(`"${e}"`)&&t.classList.add("active")}),document.querySelectorAll("#telesales-fullscreen .q-view-section").forEach(e=>e.classList.remove("active"));const t=document.getElementById(`t-view-${e}`);t&&t.classList.add("active")}function hydrateTelesalesSegmentFilter(){const e=document.getElementById("t-data-seg");if(!e)return;const t=Array.from(new Set((telesalesOffers||[]).map(e=>e.segment).filter(Boolean))).sort();e.innerHTML='<option value="all">T√ºm Segmentler</option>'+t.map(e=>`<option value="${escapeHtml(e)}">${escapeHtml(e)}</option>`).join("")}function renderTelesalesDataOffers(){const e=document.getElementById("t-data-grid");if(!e)return;const t=(document.getElementById("t-data-search")?.value||"").toLowerCase(),a=(telesalesOffers||[]).filter(e=>{const a=`${e.title||""} ${e.desc||""} ${e.segment||""} ${e.tag||""}`.toLowerCase();return!t||a.includes(t)}),n=isAdminMode&&isEditingActive?'\n        <div style="grid-column:1/-1;display:flex;gap:10px;align-items:center;margin:6px 0 12px;">\n          <button class="x-btn x-btn-admin" onclick="addTelesalesOffer()"><i class="fas fa-plus"></i> Teklif Ekle</button>\n        </div>\n    ':"";if(0===a.length){e.innerHTML=n+'<div style="opacity:.7;padding:20px;grid-column:1/-1">Sonu√ß bulunamadƒ±.</div>';const t=document.getElementById("t-data-count");return void(t&&(t.innerText="0 kayƒ±t"))}const i=document.getElementById("t-data-count");i&&(i.innerText=`${a.length} kayƒ±t`),e.innerHTML=n+a.map((e,t)=>`\n        <div class="q-training-card" onclick="showTelesalesOfferDetail(${t})" style="cursor:pointer">\n          <div class="t-training-head">\n            <div style="min-width:0">\n              <div class="q-item-title" style="font-size:1.02rem">${escapeHtml(e.title||"Teklif")}</div>\n            </div>\n            <div class="t-training-badge">${escapeHtml(e.segment||e.tag||"")}</div>\n          </div>\n          <div class="t-training-desc">${escapeHtml((e.desc||"").slice(0,140))}${(e.desc||"").length>140?"...":""}</div>\n          <div style="margin-top:10px;color:#999;font-size:.8rem">(Detay i√ßin tƒ±kla)</div>\n          ${isAdminMode&&isEditingActive?`\n            <div style="margin-top:12px;display:flex;gap:10px">\n              <button class="x-btn x-btn-admin" onclick="event.stopPropagation(); editTelesalesOffer(${t});"><i class="fas fa-pen"></i> D√ºzenle</button>\n              <button class="x-btn x-btn-admin" onclick="event.stopPropagation(); deleteTelesalesOffer(${t});"><i class="fas fa-trash"></i> Sil</button>\n            </div>\n          `:""}\n        </div>\n    `).join("")}function addTelesalesOffer(){Swal.fire({title:"TeleSatƒ±≈ü Teklifi Ekle",html:'\n          <input id="to-title" class="swal2-input" placeholder="Ba≈ülƒ±k">\n          <input id="to-seg" class="swal2-input" placeholder="Segment / Etiket (opsiyonel)">\n          <textarea id="to-desc" class="swal2-textarea" placeholder="A√ßƒ±klama"></textarea>\n          <textarea id="to-detail" class="swal2-textarea" placeholder="Detay (opsiyonel)"></textarea>\n        ',showCancelButton:!0,confirmButtonText:"Ekle",cancelButtonText:"Vazge√ß",preConfirm:()=>{const e=(document.getElementById("to-title").value||"").trim();return e?{id:"local_"+Date.now(),title:e,segment:(document.getElementById("to-seg").value||"").trim(),desc:(document.getElementById("to-desc").value||"").trim(),detail:(document.getElementById("to-detail").value||"").trim()}:Swal.showValidationMessage("Ba≈ülƒ±k zorunlu")}}).then(async e=>{if(!e.isConfirmed)return;const t=e.value;Swal.fire({title:"Ekleniyor...",didOpen:()=>Swal.showLoading(),showConfirmButton:!1});try{const e=await fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"upsertTelesalesOffer",username:currentUser,token:getToken(),keyTitle:"",keySegment:"",...t})}),a=await e.json();"success"===a.result?(Swal.fire({icon:"success",title:"Eklendi",timer:1200,showConfirmButton:!1}),await fetchSheetObjects(),renderTelesalesDataOffers()):Swal.fire("Hata",a.message||"Eklenemedi","error")}catch(e){Swal.fire("Hata","Sunucu hatasƒ±.","error")}})}async function editTelesalesOffer(e){const t=(telesalesOffers||[])[e];if(!t)return;const{value:a}=await Swal.fire({title:"Teklifi D√ºzenle",html:`\n          <input id="to-title" class="swal2-input" placeholder="Ba≈ülƒ±k" value="${escapeHtml(t.title||"")}">\n          <input id="to-seg" class="swal2-input" placeholder="Segment / Etiket" value="${escapeHtml(t.segment||"")}">\n          <textarea id="to-desc" class="swal2-textarea" placeholder="A√ßƒ±klama">${escapeHtml(t.desc||"")}</textarea>\n          <textarea id="to-detail" class="swal2-textarea" placeholder="Detay">${escapeHtml(t.detail||"")}</textarea>\n        `,showCancelButton:!0,confirmButtonText:"Kaydet",cancelButtonText:"Vazge√ß",preConfirm:()=>{const e=(document.getElementById("to-title").value||"").trim();return e?{title:e,segment:(document.getElementById("to-seg").value||"").trim(),desc:(document.getElementById("to-desc").value||"").trim(),detail:(document.getElementById("to-detail").value||"").trim()}:Swal.showValidationMessage("Ba≈ülƒ±k zorunlu")}});if(a){Swal.fire({title:"Kaydediliyor...",didOpen:()=>Swal.showLoading(),showConfirmButton:!1});try{const e=await fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"upsertTelesalesOffer",username:currentUser,token:getToken(),keyTitle:t.title,keySegment:t.segment,...a})}),n=await e.json();"success"===n.result?(Swal.fire({icon:"success",title:"Kaydedildi",timer:1200,showConfirmButton:!1}),await fetchSheetObjects(),renderTelesalesDataOffers()):Swal.fire("Hata",n.message||"Kaydedilemedi","error")}catch(e){Swal.fire("Hata","Sunucu hatasƒ±.","error")}}}function deleteTelesalesOffer(e){const t=(telesalesOffers||[])[e];t&&Swal.fire({title:"Silinsin mi?",text:"Teklif pasife alƒ±nacak.",icon:"warning",showCancelButton:!0,confirmButtonText:"Sil",cancelButtonText:"Vazge√ß"}).then(async e=>{if(e.isConfirmed)try{const e=await fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"deleteTelesalesOffer",username:currentUser,token:getToken(),keyTitle:t.title,keySegment:t.segment})}),a=await e.json();"success"===a.result?(await fetchSheetObjects(),renderTelesalesDataOffers(),Swal.fire({icon:"success",title:"Silindi",timer:1e3,showConfirmButton:!1})):Swal.fire("Hata",a.message||"Silinemedi","error")}catch(e){Swal.fire("Hata","Sunucu hatasƒ±.","error")}})}function showTelesalesOfferDetail(e){const t=(telesalesOffers||[])[e];t&&Swal.fire({title:`<i class="fas fa-database" style="color:#0e1b42"></i> ${escapeHtml(t.title||"")}`,html:`<div style="text-align:left;line-height:1.6">\n                <div style="margin-bottom:10px"><b>Segment:</b> ${escapeHtml(t.segment||"-")}</div>\n                <div>${escapeHtml(t.desc||"Detay yok.").replace(/\n/g,"<br>")}</div>\n              </div>`,showCloseButton:!0,showConfirmButton:!1,width:"720px",background:"#f8f9fa"})}function renderTelesalesScripts(){const e=document.getElementById("t-scripts-grid");if(!e)return;let t=salesScripts||[];try{const e=JSON.parse(localStorage.getItem("telesalesScriptsOverride")||"[]");Array.isArray(e)&&e.length&&(t=e)}catch(e){}const a=isAdminMode&&isEditingActive?'\n        <div style="display:flex;gap:10px;align-items:center;margin:6px 0 12px;">\n          <button class="x-btn x-btn-admin" onclick="addTelesalesScript()"><i class="fas fa-plus"></i> Script Ekle</button>\n        </div>\n    ':"";0!==t.length?e.innerHTML=a+t.map((e,t)=>`\n      <div class="news-item" style="border-left-color:#10b981;cursor:pointer" onclick="copyText('${escapeForJsString(e.text||"")}')">\n        <span class="news-title">${escapeHtml(e.title||"Script")}</span>\n        <div class="news-desc" style="white-space:pre-line">${escapeHtml(e.text||"")}</div>\n        <div style="display:flex;gap:10px;align-items:center;justify-content:space-between;margin-top:10px">\n          <div class="news-tag" style="background:rgba(16,185,129,.08);color:#10b981;border:1px solid rgba(16,185,129,.25)">Tƒ±kla & Kopyala</div>\n          ${isAdminMode&&isEditingActive?`\n            <div style="display:flex;gap:8px">\n              <button class="x-btn x-btn-admin" onclick="event.stopPropagation(); editTelesalesScript(${t});"><i class="fas fa-pen"></i></button>\n              <button class="x-btn x-btn-admin" onclick="event.stopPropagation(); deleteTelesalesScript(${t});"><i class="fas fa-trash"></i></button>\n            </div>\n          `:""}\n        </div>\n      </div>\n    `).join(""):e.innerHTML=a+'<div style="padding:16px;opacity:.7">Script bulunamadƒ±.</div>'}function getTelesalesScriptsStore(){try{const e=JSON.parse(localStorage.getItem("telesalesScriptsOverride")||"[]");if(Array.isArray(e)&&e.length)return e}catch(e){}return salesScripts||[]}function saveTelesalesScriptsStore(e){localStorage.setItem("telesalesScriptsOverride",JSON.stringify(e||[]))}function addTelesalesScript(){Swal.fire({title:"Script Ekle",html:'\n          <input id="ts-title" class="swal2-input" placeholder="Ba≈ülƒ±k">\n          <textarea id="ts-text" class="swal2-textarea" placeholder="Script metni"></textarea>\n        ',showCancelButton:!0,confirmButtonText:"Ekle",cancelButtonText:"Vazge√ß",preConfirm:()=>{const e=(document.getElementById("ts-title").value||"").trim(),t=(document.getElementById("ts-text").value||"").trim();return t?{id:"local_"+Date.now(),title:e||"Script",text:t}:Swal.showValidationMessage("Script metni zorunlu")}}).then(e=>{if(!e.isConfirmed)return;const t=getTelesalesScriptsStore();t.unshift(e.value),saveTelesalesScriptsStore(t),renderTelesalesScripts()})}function editTelesalesScript(e){const t=getTelesalesScriptsStore(),a=t[e];a&&Swal.fire({title:"Script D√ºzenle",html:`\n          <input id="ts-title" class="swal2-input" placeholder="Ba≈ülƒ±k" value="${escapeHtml(a.title||"")}">\n          <textarea id="ts-text" class="swal2-textarea" placeholder="Script metni">${escapeHtml(a.text||"")}</textarea>\n        `,showCancelButton:!0,confirmButtonText:"Kaydet",cancelButtonText:"Vazge√ß",preConfirm:()=>{const e=(document.getElementById("ts-title").value||"").trim(),t=(document.getElementById("ts-text").value||"").trim();return t?{...a,title:e||"Script",text:t}:Swal.showValidationMessage("Script metni zorunlu")}}).then(a=>{a.isConfirmed&&(t[e]=a.value,saveTelesalesScriptsStore(t),renderTelesalesScripts())})}function deleteTelesalesScript(e){Swal.fire({title:"Silinsin mi?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sil",cancelButtonText:"Vazge√ß"}).then(t=>{if(!t.isConfirmed)return;saveTelesalesScriptsStore(getTelesalesScriptsStore().filter((t,a)=>a!==e)),renderTelesalesScripts()})}function renderTelesalesDocs(){const e=document.getElementById("t-docs");if(!e)return;const t=(trainingData||[]).filter(e=>"Telesatƒ±≈ü"===(e.target||"")||(e.title||"").toLowerCase().includes("telesatƒ±≈ü"));0!==t.length?e.innerHTML=t.map(e=>`\n      <div class="news-item" style="border-left-color:var(--secondary)">\n        <span class="news-date">${escapeHtml((e.startDate||"")+(e.endDate?" ‚Üí "+e.endDate:""))}</span>\n        <span class="news-title">${escapeHtml(e.title||"")}</span>\n        <div class="news-desc">${escapeHtml(e.desc||"")}</div>\n        ${e.link&&"N/A"!==e.link?`<a class="btn btn-link" href="${escapeHtml(e.link)}" target="_blank">Link</a>`:""}\n        ${e.docLink&&"N/A"!==e.docLink?`<a class="btn btn-link" href="${escapeHtml(e.docLink)}" target="_blank">D√∂k√ºman</a>`:""}\n      </div>\n    `).join(""):e.innerHTML='<div style="opacity:.7;padding:10px">Bu ekibe atanmƒ±≈ü d√∂k√ºman/eƒüitim g√∂r√ºnm√ºyor.</div>'}async function openTechArea(e){const t=document.getElementById("tech-fullscreen");if(!t)return;t.style.display="flex",document.body.classList.add("fs-open"),document.body.style.overflow="hidden";const a=document.getElementById("x-side-avatar"),n=document.getElementById("x-side-name"),i=document.getElementById("x-side-role");a&&(a.innerText=(currentUser||"U").trim().slice(0,1).toUpperCase()),n&&(n.innerText=currentUser||"Kullanƒ±cƒ±"),i&&(i.innerText=isAdminMode?"Admin":"Temsilci");try{if((!database||0===database.length)&&window.__dataLoadedPromise){["x-broadcast-list","x-access-list","x-app-list","x-activation-list","x-cards"].forEach(e=>{const t=document.getElementById(e);t&&(t.innerHTML='<div class="home-mini-item">Y√ºkleniyor...</div>')}),await window.__dataLoadedPromise}}catch(e){}switchTechTab(e||"broadcast")}function closeFullTech(){const e=document.getElementById("tech-fullscreen");e&&(e.style.display="none"),document.body.classList.remove("fs-open"),document.body.style.overflow=""}function switchTechTab(e){document.querySelectorAll("#tech-fullscreen .q-nav-item").forEach(e=>e.classList.remove("active")),document.querySelectorAll("#tech-fullscreen .q-nav-item").forEach(t=>{(t.getAttribute("onclick")||"").includes(`"${e}"`)&&t.classList.add("active")}),document.querySelectorAll("#tech-fullscreen .q-view-section").forEach(e=>e.classList.remove("active"));const t=document.getElementById(`x-view-${e}`);t&&t.classList.add("active")}const TECH_DOC_CONTENT={broadcast:[{title:"Smart TV ‚Äì Canlƒ± Yayƒ±nda Donma Problemi Ya≈üƒ±yorum",body:"M√º≈üterinin sorun ya≈üadƒ±ƒüƒ± yayƒ±n ya da yayƒ±nlarda genel bir sorun var mƒ± kontrol edilir? Genel bir sorun var ise teknik ekibin incelediƒüi y√∂n√ºnde bilgi verilir.\nM√º≈üterinin kullandƒ±ƒüƒ± cihaz TVmanager ‚Äòda loglardan kontrol edilir. Ar√ßelik/Beko/Grundig/Altus marka Android TV olmayan Smart TV‚Äôlerden ise genel sorun hakkƒ±nda bilgi verilir.\nYukarƒ±daki durumlar dƒ±≈üƒ±nda ya≈üanan bir sorun ise TV ve modemin elektrik baƒülantƒ±sƒ±nƒ± kesilip tekrar verilmesi istenir. ¬´ Ya≈üadƒ±ƒüƒ±nƒ±z sorunu kontrol ederken TV ve modeminizin elektrik baƒülantƒ±sƒ±nƒ± kesip 10 sn sonra yeniden a√ßabilir misiniz? Ardƒ±ndan yeniden yayƒ±nƒ± a√ßƒ±p kontrol edebilir misiniz? (Ayrƒ±ca √∂neri olarak modemi kapatƒ±p tekrar a√ßtƒ±ktan sonra, sadece izleme yaptƒ±ƒüƒ± cihaz modeme baƒülƒ± olursa daha iyi bir baƒülantƒ± olacaƒüƒ± bilgisi verilebilir)\nSorun devam eder ise Smart TV tarayƒ±cƒ±sƒ±ndan https://www.hiztesti.com.tr/ bir hƒ±z testi yapmasƒ± sonucu bizimle payla≈ümasƒ± istenir.\nHƒ±z testi sonucu 8 Mbps altƒ±nda ise internet baƒülantƒ± hƒ±zƒ±nƒ±n d√º≈ü√ºk olduƒüunu internet servis saƒülayƒ±cƒ±sƒ± ileti≈üime ge√ßmesi istenir.\n8 Mbps √ºzerinde ise m√º≈üteriden sorunu g√∂steren kƒ±sa bir video talep edilir.\nVideo kaydƒ± ve hƒ±z testinin sonu√ßlarƒ± g√∂steren bilgiler alƒ±ndƒ±ktan sonra m√º≈üteriye incelenmesi i√ßin teknik ekibimize iletildiƒüi inceleme tamamlandƒ±ƒüƒ±nda eposta ile bilgi verileceƒüi y√∂n√ºnde bilgi verilir.\nSorun aynƒ± g√ºn i√ßinde benzer cihazlarda farklƒ± m√º≈üterilerde ya≈üƒ±yor ise t√ºm bilgilerle Erlab‚Äôa arƒ±za kaydƒ± a√ßƒ±lƒ±r. Sorun birka√ß m√º≈üteri ile sƒ±nƒ±rlƒ± ise 17:00 ‚Äì 01:00 vardiyasƒ±ndaki ekip arkada≈üƒ±nda sistemsel bir sorun olmadƒ±ƒüƒ±na dair eposta g√∂nderilmesi i√ßin bilgileri payla≈üƒ±lƒ±r."},{title:"Mobil Uygulama ‚Äì Canlƒ± Yayƒ±nda Donma Sorunu Ya≈üƒ±yorum",body:"M√º≈üterinin sorun ya≈üadƒ±ƒüƒ± yayƒ±n ya da yayƒ±nlarda genel bir sorun var mƒ± kontrol edilir? Genel bir sorun var ise teknik ekibin incelediƒüi y√∂n√ºnde bilgi verilir.(M√º≈üteri ƒ∞OS veya Android i≈ületim sistemli hangi cihazdan izliyorsa, m√ºmk√ºnse aynƒ± i≈ületim sistemli mobil cihazdan kontrol edilebilir, gerekirse ekip arkada≈ülarƒ±ndan kontrol etmeleri istenebilir)\nGenel bir sorun yok ise, www.hiztesti.com.tr link √ºzerinden hƒ±z testi yapmasƒ± sonucu bizimle payla≈ümasƒ± istenir.\nHƒ±z testi sonucu 8 mbps altƒ±nda ise internet baƒülantƒ± hƒ±zƒ±nƒ±n d√º≈ü√ºk olduƒüu internet servisi saƒülayƒ±cƒ±sƒ± ile ileti≈üime ge√ßmesi istenir. (√ñneri olarak modemi kapatƒ±p tekrar a√ßtƒ±ktan sonra sadece izleme yaptƒ±ƒüƒ± cihaz modeme baƒülƒ± olursa daha iyi bir baƒülantƒ± olacaƒüƒ± bilgisi verilebilir)\n8 mbps √ºzerinde ise, uygulama verilerin temizlenmesi veya uygulamanƒ±n silip tekrar y√ºklenmesi istenilir, sorun devam etmesi durumunda sorunu g√∂steren video kaydƒ± istenir.\n 4. Hƒ±z testi, cihaz marka model ve s√ºr√ºm bilgileri alƒ±ndƒ±ktan sonra, incelenmesi i√ßin teknik ekibe iletildiƒüi, inceleme tamamlandƒ±ƒüƒ±nda e-posta  ile bilgi verileceƒüi y√∂n√ºnde bilgi verilir.\n 5. Sorun aynƒ± g√ºn i√ßerinde benzer cihazlarda farklƒ± m√º≈üterilerde ya≈üƒ±yor ise t√ºm bilgilerle Erlab‚Äôa arƒ±za kaydƒ± a√ßƒ±lƒ±r. Sorun birka√ß m√º≈üteri ile sƒ±nƒ±rlƒ±  ise 17:00 ‚Äì 01:00 vardiyasƒ±ndaki ekip arkada≈üƒ±nda sistemsel bir sorun olmadƒ±ƒüƒ±na dair eposta g√∂nderilmesi i√ßin bilgileri payla≈üƒ±lƒ±r."},{title:"Bilgisayar ‚Äì Canlƒ± Yayƒ±nda Donma Sorunu Ya≈üƒ±yorum",body:"M√º≈üterinin sorun ya≈üadƒ±ƒüƒ± yayƒ±n ya da yayƒ±nlarda genel bir sorun var mƒ± kontrol edilir? Genel bir sorun var ise teknik ekibin incelediƒüi y√∂n√ºnde bilgi verilir.\nGenel bir sorun deƒüilse, √∂ncelikle https://www.hiztesti.com.tr/ bir hƒ±z testi yapmasƒ± sonucu bizimle payla≈ümasƒ± istenir.\nHƒ±z testi sonucu 8 mbps altƒ±nda ise internet baƒülantƒ± hƒ±zƒ±nƒ±n d√º≈ü√ºk olduƒüunu internet servis saƒülayƒ±cƒ±sƒ± ileti≈üime ge√ßmesi istenir.\n8 mbps √ºzerinde ise m√º≈üteriden a≈üaƒüƒ±daki adƒ±mlarƒ± uygulamasƒ± istenir.\n3. Bilgisayarƒ±n i≈ületim sitemi √∂ƒürenilip, g√∂r√º≈üme √ºzerinden ‚Äò‚ÄôpingWindows7‚Äô‚Äô veya ‚Äò‚Äôpingwindows10‚Äô‚Äô kƒ±sayollarƒ±ndan m√º≈üteri sunucularƒ± kontrol edilir.\n(Windows 10 √ºzeri i≈ületim sistemi cihazlara pingwindows10 kƒ±sayolu g√∂nderilebilir.)\n4. Sunucu kontrol ekranƒ±nda kontrol edilmesi gereken, ok ile g√∂sterilen yerden, sunucu ile kayƒ±p olup olmadƒ±ƒüƒ± ve kƒ±rmƒ±zƒ± alan i√ßerisinde sunucu ile web sitemize ka√ß saniyede i≈ülem saƒüladƒ±ƒüƒ± kontrol edilir.\n5. 1 ‚Äì 35 arasƒ± normal sayƒ±labilir, bu saniye aralƒ±ƒüƒ±nda sorun ya≈üanƒ±yorsa, web sitemize daha hƒ±zlƒ± tepsi s√ºresi veren ve genellikle sorunsuz bir ≈üekilde izleme saƒülanabilen 193.192.103.249, 185.11.14.27 veya 195.175.178.8 sunucularƒ± kontrol edilmelidir.\n6. Uygun sunucuyu tespit ettikten sonra canlƒ± destek ekranƒ±nda ‚Äò‚ÄôHost‚Äô‚Äô ‚Äò‚Äôhost2‚Äô‚Äô kƒ±sa yollarƒ± kullanarak, kƒ±sa yoldaki adƒ±mlar ile m√º≈üterinin sadece bizim sitemize baƒülandƒ±ƒüƒ± sunucusunu, en uygun sunucu ile deƒüi≈ütirip tarayƒ±cƒ± a√ßƒ±p kapattƒ±rdƒ±ktan sonra tekrar yayƒ±nƒ± kontrol etmesini iletebiliriz. (Ayrƒ±ca m√º≈üteri yayƒ±nlarƒ± auto deƒüil, manuel olarak 720 veya 1080p se√ßip kontrol edilmesi √∂nerilir)\n7. Sorun aynƒ± g√ºn i√ßerinde benzer i≈ületim sistemi veya sunucuda farklƒ± m√º≈üterilerde ya≈üƒ±yor ise t√ºm bilgilerle Erlab‚Äôa arƒ±za kaydƒ± a√ßƒ±lƒ±r. Sorun birka√ß m√º≈üteri ile sƒ±nƒ±rlƒ± ise 17:00 ‚Äì 01:00 vardiyasƒ±ndaki ekip arkada≈üƒ±nda sistemsel bir sorun olmadƒ±ƒüƒ±na dair eposta g√∂nderilmesi i√ßin bilgileri payla≈üƒ±lƒ±r"},{title:"YAYIN SORUNLARI",body:"35 sn arasƒ± normal sayƒ±labilir, bu saniye aralƒ±ƒüƒ±nda sorun ya≈üanƒ±yorsa, web sitemize daha hƒ±zlƒ± tepsi s√ºresi veren ve genellikle sorunsuz bir ≈üekilde izleme saƒülanabilen 193.192.103.249, 185.11.14.27 veya 195.175.178.8 sunucularƒ± kontrol edilmelidir."},{title:"MacOS ‚Äì Canlƒ± Yayƒ±nda Donma Sorunu Ya≈üƒ±yorum",body:"M√º≈üterinin sorun ya≈üadƒ±ƒüƒ± yayƒ±n ya da yayƒ±nlarda genel bir sorun var mƒ± kontrol edilir? Genel bir sorun var ise teknik ekibin incelediƒüi y√∂n√ºnde bilgi verilir.\nGenel bir sorun deƒüilse, √∂ncelikle https://www.hiztesti.com.tr/ bir hƒ±z testi yapmasƒ± sonucu bizimle payla≈ümasƒ± istenir.\nHƒ±z testi sonucu 8 mbps altƒ±nda ise internet baƒülantƒ± hƒ±zƒ±nƒ±n d√º≈ü√ºk olduƒüunu internet servis saƒülayƒ±cƒ±sƒ± ileti≈üime ge√ßmesi istenir.\n8 mbps √ºzerinde ise m√º≈üteriden a≈üaƒüƒ±daki adƒ±mlarƒ± uygulamasƒ± istenir.\nMindbehind √ºzerinden ‚Äò‚ÄôpingmacOS‚Äô‚Äô kƒ±sayolundan m√º≈üteri sunucularƒ± kontrol edilir.\nSunucu kontrol ekranƒ±nda kontrol edilmesi gereken, ‚Äò‚Äôpacket loss‚Äô‚Äô kƒ±smƒ±nda kayƒ±p olup olmadƒ±ƒüƒ±,  alan i√ßerisinde sunucu ile web sitemize ka√ß saniyede i≈ülem saƒüladƒ±ƒüƒ± kontrol edilir.\n1 ‚Äì 35 arasƒ± normal sayƒ±labilir, bu saniye aralƒ±ƒüƒ±nda sorun ya≈üanƒ±yorsa, web sitemize daha hƒ±zlƒ± tepsi s√ºresi veren ve genellikle sorunsuz bir ≈üekilde izleme saƒülanabilen 193.192.103.249, 185.11.14.27 veya 195.175.178.8 sunucularƒ± kontrol edilmelidir.\nUygun sunucuyu tespit ettikten sonra canlƒ± destek ekranƒ±nda ‚Äò‚ÄômacOShost‚Äô‚Äô kƒ±sa yolunu kullanarak, kƒ±sa yoldaki adƒ±mlar ile m√º≈üterinin sadece bizim sitemize baƒülandƒ±ƒüƒ± sunucuyu, en uygun sunucu ile deƒüi≈ütirip tarayƒ±cƒ± a√ßƒ±p kapattƒ±rdƒ±ktan sonra tekrar yayƒ±nƒ± kontrol etmesini iletebiliriz. (Ayrƒ±ca m√º≈üteri yayƒ±nlarƒ± auto deƒüil, manuel olarak 720 veya 1080p se√ßip kontrol edilmesi √∂nerilir)\nSorun aynƒ± g√ºn i√ßerinde benzer i≈ületim sistemi veya sunucuda farklƒ± m√º≈üterilerde ya≈üƒ±yor ise t√ºm bilgilerle Erlab‚Äôa arƒ±za kaydƒ± a√ßƒ±lƒ±r. Sorun birka√ß m√º≈üteri ile sƒ±nƒ±rlƒ± ise 17:00 ‚Äì 01:00 vardiyasƒ±ndaki ekip arkada≈üƒ±nda sistemsel bir sorun olmadƒ±ƒüƒ±na dair eposta g√∂nderilmesi i√ßin bilgileri payla≈üƒ±lƒ±r."},{title:"‚Äò‚ÄôYayƒ±nda beklenmedik bir kesinti olu≈ütu‚Äô‚Äô Uyarƒ±sƒ±",body:"Bu uyarƒ± genel bir yayƒ±n sorunu olduƒüunda ya da kullanƒ±cƒ± T√ºrkiye sƒ±nƒ±rlarƒ± dƒ±≈üƒ±nda bir yerden eri≈üim saƒüladƒ±ƒüƒ±nda kar≈üƒ±mƒ±za √ßƒ±kmaktadƒ±r.\nKullanƒ±cƒ±nƒ±n sorun ya≈üadƒ±ƒüƒ± yayƒ±n kontrol edilir ve genel bir yayƒ±n sorunu olup olmadƒ±ƒüƒ± teyit edilir.\nTvmanager‚Äôda SubscriberLog ekranƒ±ndan ip adresi alƒ±nƒ±r ve yurtdƒ±≈üƒ± bir konum olup olmadƒ±ƒüƒ± teyit edilir.\nKullanƒ±cƒ± yurtdƒ±≈üƒ±nda ise eri≈üim saƒülayamayacaƒüƒ± bilgisi verilir, VPN kullanƒ±yor ise kapatmasƒ± istenir.\nTVmanager Devices kƒ±smƒ±nda oturumlar sonlandƒ±rƒ±lƒ±r ve kullanƒ±cƒ±dan tekrar giri≈ü yaparak kontrol etmesi rica edilir.\nMobil veri veya farklƒ± bir aƒüda bu hata mesajƒ±nƒ±n alƒ±nƒ±p alƒ±nmadƒ±ƒüƒ± teyit edilir.\nCihaz ve modem kapama ve a√ßma i≈ülemi uygulanƒ±r.\nSorun devam eder ise inceleme i√ßin cihaz ve diƒüer bilgilerle teknik ekibimize bilgi verileceƒüi iletilir. Excel de kullanƒ±cƒ±dan alƒ±nan bilgiler not edilir."}],access:[{title:"ERƒ∞≈ûƒ∞M SORUNLARI",body:"‚Äò‚ÄôLisans haklarƒ± sebebiyle T√ºrkiye sƒ±nƒ±rlarƒ± dƒ±≈üƒ±nda hizmet verilememektedir.‚Äô‚Äô Uyarƒ±sƒ±\nAlƒ±nan hata m√º≈üterinin yurt dƒ±≈üƒ±nda olmasƒ± ve yurt i√ßinde ise VPN ya da benzeri bir uygulamanƒ±n cihazƒ±nda aktif olmasƒ±ndan kaynaklanmaktadƒ±r.\n\nM√º≈üteriye yurt dƒ±≈üƒ±nda olup olmadƒ±ƒüƒ± sorulur, yurt dƒ±≈üƒ±nda ise ‚Äò‚Äôlisans haklarƒ± sebebiyle yayƒ±nlarƒ±n yurt dƒ±≈üƒ±ndan izlenemediƒüi‚Äô‚Äô y√∂n√ºnde bilgi verilir.\nYurt i√ßinde ise VPN ya da benzeri bir uygulamanƒ±n cihazƒ±nda aktif olup ya da olmadƒ±ƒüƒ± sorulur. Aktif ise devre dƒ±≈üƒ± bƒ±rakƒ±lƒ±p tekrar denemesi √∂nerilir.\nVPN ya da benzeri bir uygulama kullanmƒ±yor ise m√º≈üterinin ip adresi √∂ƒürenilir ve https://tr.wizcase.com/tools/whats-my-ip/ ip adresi kontrol edilir.  Aynƒ± zamanda adresin vpn √ºzerinden alƒ±nƒ±p alƒ±nmadƒ±ƒüƒ±nƒ±n kontrol√º i√ßin https://vpnapi.io adresine girilip kontrol edilir.\nIp adresi yurt dƒ±≈üƒ± ya da ISP bilgisi bilinen bir servis saƒülayƒ±cƒ±sƒ± deƒüilse m√º≈üteriye bulunduƒüu lokasyonun otel, yurt vb. bir yer olup olmadƒ±ƒüƒ± ya da cihazƒ±nƒ±n ≈üirket cihazƒ± olup olmadƒ±ƒüƒ± sorulur."},{title:"‚Äò‚ÄôIP Karantina‚Äô‚Äô Uyarƒ±sƒ±",body:"ƒ∞p Karantina sorunu genel bir sorun yok ise, eposta veya ≈üifre bir √ßok defa hatalƒ± girilmesinden dolayƒ± alƒ±nƒ±r.\nKullanƒ±cƒ±nƒ±n ip adresi karantina da olup ya da olmadƒ±ƒüƒ±, TVmanager ‚Äì CMS ‚Äì Admission Gate men√ºs√º √ºzerinden kontrol edilerek √ßƒ±karƒ±labilir. ƒ∞kinci bir se√ßenek olarak modem kapama ve a√ßma i≈ülemi yaptƒ±rƒ±labilir."}],app:[{title:"Teknik Sorun Analizi Nasƒ±l Yapƒ±lƒ±r?",body:"App Kaynaklƒ± Nedenler\nCihaz Kaynaklƒ± Nedenler\nApp hatalarƒ± ba≈ülƒ±ƒüƒ±nda uygulamanƒ±n a√ßƒ±lmamasƒ± ya da kendi kendine kapanmasƒ± ≈üeklinde teknik sorunlar ile kar≈üƒ±la≈üabiliriz. Bu tip sorunlar, kullanƒ±cƒ± deneyimini doƒürudan etkileyerek uygulamaya eri≈üilememesine neden olur.\nUygulamanƒ±n eski s√ºr√ºm√º\n√ñnbellek sorunlarƒ±\nUyumsuz cihazlar\nDolu RAM/Arka planda √ßalƒ±≈üan fazla uygulama\nCihazƒ±n g√ºncel olmamasƒ± (Eski sistemi s√ºr√ºmleri)\nKullanƒ±cƒ±ya Sorulabilecek Sorular:\nUygulama a√ßƒ±lƒ±yor mu, yoksa a√ßƒ±lmadan kapanƒ±yor mu?\nUygulama s√ºr√ºm√º, cihaz i≈ületim sistemi s√ºr√ºm√º nedir? (TVmanager kontrol√º)\nCihazda yeterli depolama alanƒ± var mƒ±?"}],activation:[{title:"‚Äò‚ÄôPromosyon Kodu Bulunamadƒ±‚Äô‚Äô Uyarƒ±sƒ±",body:"G√∂rselde ki √∂rnekte doƒürusu ‚Äò‚ÄôYILLIKLOCA‚Äô‚Äô olan kampanya kodu, k√º√ß√ºk harf ile yazƒ±ldƒ±ƒüƒ±nda ‚Äò‚ÄôPromosyon Kodu Bulunamadƒ±‚Äô‚Äô hatasƒ± alƒ±nmƒ±≈ütƒ±r. Bu hata ile kar≈üƒ±la≈üƒ±ldƒ±ƒüƒ±nda kampanya kodunun yanlƒ±≈ü, eksik, k√º√ß√ºk harf ya da bo≈üluk bƒ±rakƒ±larak yazƒ±ldƒ±ƒüƒ±nƒ± tespitle, kullanƒ±cƒ±yƒ± bu doƒürultuda doƒüru yazƒ±m i√ßin y√∂nlendirmemiz gerekir."},{title:"‚Äò‚ÄôKampanya Kodu Aktif Edilemedi‚Äô‚Äô Uyarƒ±sƒ±",body:"G√∂rseldeki √∂rnekteki gibi eski bir promosyon kodu yazƒ±ldƒ±ƒüƒ±nda ‚Äò‚ÄôKampanya Kodu Aktif Edilemedi‚Äô‚Äô uyarƒ±sƒ± alƒ±nƒ±r."},{title:"‚Äò‚ÄôGe√ßersiz Kampanya Kodu‚Äô‚Äô Uyarƒ±sƒ±",body:"G√∂rseldeki √∂rnekteki gibi daha √∂nce kullanƒ±lmƒ±≈ü bir promosyon kodu yazƒ±ldƒ±ƒüƒ±nda ‚Äò‚ÄôGe√ßersiz Kampanya Kodu‚Äô‚Äô hatasƒ± alƒ±nƒ±r.\nPromosyon kodunun hangi hesapta kullanƒ±ldƒ±ƒüƒ±nƒ± a≈üaƒüƒ±daki g√∂rseldeki gibi Campaign alanƒ±nda arama yaparak g√∂r√ºnt√ºleyebiliriz."},{title:"Playstore Uygulama Aktivasyon Sorunu",body:"Bazƒ± durumlarda, kullanƒ±cƒ±lar Google Play Store √ºzerinden S Sport Plus uygulamasƒ±nda abonelik satƒ±n aldƒ±klarƒ±nda veya yenileme ger√ßekle≈ütiƒüinde, √ºyelikleri otomatik olarak aktifle≈ümeyebiliyor.  Bu durumda, kullanƒ±cƒ±nƒ±n uygulama √ºzerinden manuel olarak paket aktivasyonu yapmasƒ± gerekmektedir.\n\nAktivasyon i≈üleminin ba≈üarƒ±lƒ± olabilmesi i√ßin:\n Google Play Store √ºzerinden satƒ±n alma i≈ülemi yapƒ±lƒ±rken kullanƒ±lan Gmail hesabƒ±, aktivasyon anƒ±nda cihazda a√ßƒ±k olmalƒ±dƒ±r.\n Aktivasyon i≈ülemi uygulama i√ßerisinden yapƒ±lmalƒ±dƒ±r.\nDestek ekibi tarafƒ±ndan Mindbehind √ºzerinden ‚Äúpaketgoogle‚Äù kƒ±sayolu kullanƒ±larak y√∂nlendirme saƒülanabilir.  Kullanƒ±cƒ± ba≈üarƒ±lƒ± bir ≈üekilde paket aktivasyonu yaptƒ±ktan sonra, paket atamasƒ± sistemde ger√ßekle≈üir ve log kayƒ±tlarƒ±nda ilgili i≈ülem a≈üaƒüƒ±daki gibi g√∂r√ºn√ºr (ekli g√∂rsellerdeki gibi).  Bu i≈ülem, paketin doƒüru ≈üekilde tanƒ±mlanmasƒ± i√ßin √∂nemlidir."},{title:"App Store Uygulama Aktivasyon Sorunu",body:"M√º≈üteriler App Store √ºzerinden uygulamamƒ±zdan abonelik satƒ±n aldƒ±ƒüƒ± veya yenileme olduƒüu zaman bazen √ºyelik aktif olmuyor.\n√úyelikleri aktif olabilmeleri i√ßin, uygulama √ºzerinden paket aktivasyon yapmalarƒ± gerekiyor. Paket aktivasyon yaparken, satƒ±n alma yaparken hangi Apple kimliƒüi hesabƒ± a√ßƒ±k ise, o hesap a√ßƒ±kken aktivasyon denemesi gerekiyor.\nMindbehind √ºzerinden ‚Äò‚Äôpaketapple‚Äô‚Äô kƒ±sayolu kullanƒ±lƒ±r.\nM√º≈üteri paket aktivasyonu yaptƒ±ktan sonra √ºyelik atamasƒ± ve loglarda nasƒ±l g√∂z√ºkt√ºƒü√º g√∂rsellerdeki gibidir.\nPaket aktivasyon butonu √∂rnek g√∂r√ºnt√ºs√º yandaki gibidir."},{title:"AKTƒ∞VASYON SORUNLARI",body:"ƒ∞OS Uygulama Paket Aktivasyon ‚Äò‚ÄôAbonelik Ba≈ükasƒ±na Aittir‚Äô‚Äô Sorunu\n\nƒ∞os uygulamamƒ±zda m√º≈üteri paket aktivasyon i≈ülemi yaptƒ±ƒüƒ±nda ‚Äò‚ÄôAbonelik Ba≈ükasƒ±na Aittir‚Äô‚Äô hatasƒ± geliyor ise, cihazda a√ßƒ±k olan Apple kimliƒüi ile satƒ±n alƒ±nmƒ±≈ü, ancak aktivasyon yaptƒ±ƒüƒ± eposta adresi farklƒ± bir eposta adresidir.\n\nFarklƒ± eposta adresi ile paket aktivasyon yaptƒ±ƒüƒ±nda ‚Äò‚ÄôSubscriberlog‚Äô‚Äô kƒ±smƒ±nda √∂rnek ekran g√∂r√ºnt√ºs√ºnde kƒ±rmƒ±zƒ± alana alƒ±nan ‚Äò‚ÄôpackageValidation‚Äô‚Äô  kƒ±smƒ± √ßƒ±kar, ok ile g√∂sterilen ID kƒ±smƒ±ndan doƒüru √ºyeliƒüi ID aramasƒ± ile bulabiliriz."},{title:"AKTƒ∞VASYON SORUNLARI",body:"Android ‚Äò‚ÄôPaket Ba≈üka Bir Kullanƒ±cƒ±ya Ait Olduƒüu ƒ∞√ßin Paket Atama ƒ∞≈ülemi Ba≈üarƒ±sƒ±z Oldu‚Äô‚Äô Sorunu\n\nAndroid uygulamamƒ±zda m√º≈üteri paket aktivasyon i≈ülemi yaptƒ±ƒüƒ±nda ‚Äò‚ÄôPaket Ba≈üka Bir Kullanƒ±cƒ±ya Ait Olduƒüu ƒ∞√ßin Paket Atama ƒ∞≈ülemi Ba≈üarƒ±sƒ±z Oldu‚Äô‚Äô hatasƒ± geliyor ise, cihazda a√ßƒ±k olan Play Store gmail hesabƒ± ile satƒ±n alƒ±nmƒ±≈ü, ancak aktivasyon yaptƒ±ƒüƒ± eposta adresi farklƒ± bir eposta adresidir.\n\nFarklƒ± eposta adresi ile paket aktivasyon yaptƒ±ƒüƒ±nda ‚Äò‚ÄôSubscriberlog‚Äô‚Äô kƒ±smƒ±nda √∂rnek ekran g√∂r√ºnt√ºs√ºnde kƒ±rmƒ±zƒ± alana alƒ±nan ‚Äò‚ÄôValidate Google Package‚Äô‚Äô  kƒ±smƒ± √ßƒ±kar, ok ile g√∂sterilen ID kƒ±smƒ±ndan doƒüru √ºyeliƒüi ID aramasƒ± ile bulabiliriz."},{title:"AKTƒ∞VASYON SORUNLARI",body:"Android Uygulama Paket Aktivasyon ƒ∞≈ülem Tamamlanamadƒ± veya √úyelik Bulunamama Sorunu\nAndroid uygulamamƒ±zda m√º≈üteri √∂deme yapmƒ±≈ü olmasƒ±na raƒümen paket aktivasyonu yaptƒ±ƒüƒ±nda ‚Äò‚Äôƒ∞≈ülem tamamlandƒ±, ƒ∞≈ülem Tamamlanamadƒ± veya Abone bulunamadƒ±‚Äô‚Äô hatasƒ± geliyor ve √ºyelik aktif olmuyor ise, m√º≈üteriden GPA kodunu payla≈üƒ±lmasƒ± istenir.\nGPA kodu, Google tarafƒ±ndan √∂deme yapƒ±ldƒ±ƒüƒ±na dair m√º≈üteriye g√∂nderilen √∂deme faturasƒ± (makbuz) i√ßerisinde yer almaktadƒ±r.\nBu GPA kodu ile √ºyeliƒüi Tvmanager √ºzerinden a≈üaƒüƒ±daki g√∂rseldeki gibi Reporting > General > Payments kƒ±smƒ±nda tarihi aralƒ±ƒüƒ± ayarlanƒ±p ‚Äò‚ÄôTransaction Identifer‚Äô‚Äô kƒ±smƒ±ndan arama yapƒ±lƒ±p, √ºyelik ID‚Äôsine ‚Äò‚ÄôSubscriber ID‚Äô‚Äô √ºzerinden ula≈üƒ±labilir."},{title:"AKTƒ∞VASYON SORUNLARI",body:"T√ºrksat Abone Bulunamadƒ± veya Abone Active Deƒüil Sorunu\nBu hata, Hizmet ID veya Ge√ßici Kod hatalƒ± yazƒ±lmasƒ±ndan dolayƒ± alƒ±nƒ±r.  M√º≈üteriler genellikle bazƒ± b√ºy√ºk k√º√ß√ºk harfleri karƒ±≈ütƒ±rabiliyor veya sistemden dolayƒ± bazen bu sorun alƒ±nabiliyor.\n√á√∂z√ºm olarak harf hatasƒ± olmamasƒ± i√ßin Tvmanager>Reporting>General>Thirtdparty Provisions kƒ±smƒ±ndan tarih aralƒ±ƒüƒ± belirleyip, Hizmet ID numarasƒ±nƒ± ‚Äò‚ÄôExtrenal ID‚Äô‚Äô kƒ±smƒ±ndan aratƒ±p, kullanƒ±cƒ± T√ºrksat bilgilerini bulup ‚Äò‚ÄôUniqueID‚Äô‚Äô kƒ±smƒ±ndan ge√ßici kodu bulup, kullanƒ±cƒ±ya payla≈ütƒ±ƒüƒ±mƒ±zda, ID ve Ge√ßici kodu kopyala yapƒ±≈ütƒ±rƒ±r ≈üeklinde ilerlemesini iletebiliriz.\nAynƒ± sorun devam eder ise, kullanƒ±cƒ±dan onay alƒ±p, ID ve ge√ßici kod ile kullanƒ±cƒ±nƒ±n √ºyeliƒüini kendimiz yapabiliriz. M√º≈üterinin √ºyeliƒüini biz tarafƒ±ndan yapƒ±ldƒ± ise, m√º≈üteriye ≈üifresini nasƒ±l g√ºncelleyebileceƒüi ile ilgili bilgi verilir."}]};function renderTechSections(){const e=(database||[]).filter(e=>"teknik"===String(e.category||"").toLowerCase());let t=[];try{t=JSON.parse(localStorage.getItem("techCardsOverride")||"[]")}catch(e){t=[]}const a=Array.isArray(t)&&t.length?t:e,n={broadcast:[],access:[],app:[],activation:[],cards:[]};a.forEach(e=>{const t=`${e.title||""} ${e.text||""} ${e.script||""}`.toLowerCase();t.includes("yayƒ±n")||t.includes("don")||t.includes("buffer")||t.includes("akƒ±≈ü")||t.includes("tv")?n.broadcast.push(e):t.includes("eri≈üim")||t.includes("vpn")||t.includes("proxy")||t.includes("login")||t.includes("giri≈ü")||t.includes("yurtdƒ±≈üƒ±")?n.access.push(e):t.includes("app")||t.includes("uygulama")||t.includes("hata")||t.includes("crash")||t.includes("versiyon")?n.app.push(e):t.includes("aktivasyon")||t.includes("satƒ±n")||t.includes("satƒ±nalma")||t.includes("store")||t.includes("√∂deme")||t.includes("google")||t.includes("apple")?n.activation.push(e):n.broadcast.push(e),n.cards.push(e)}),window.__techBuckets=n;const i=(e,t,a)=>{const n=document.getElementById(e);n&&(n.oninput=()=>renderTechList(t,n.value||"",a))};i("x-search-broadcast","broadcast","x-broadcast-list"),i("x-search-access","access","x-access-list"),i("x-search-app","app","x-app-list"),i("x-search-activation","activation","x-activation-list"),i("x-search-cards","cards","x-cards-list"),renderTechList("broadcast","","x-broadcast-list"),renderTechList("access","","x-access-list"),renderTechList("app","","x-app-list"),renderTechList("activation","","x-activation-list"),renderTechList("cards","","x-cards-list")}let techEditMode=!1;function renderTechList(e,t,a){const n=document.getElementById(a);if(!n)return;const i=window.__techBuckets&&window.__techBuckets[e]?window.__techBuckets[e]:[],l=String(t||"").trim().toLowerCase(),r=l?i.filter(e=>`${e.title||""} ${e.text||""} ${e.script||""} ${e.link||""}`.toLowerCase().includes(l)):i,s=isAdminMode?`\n        <div style="display:flex;gap:10px;align-items:center;margin:10px 0 14px;">\n          <button class="x-btn x-btn-admin" onclick="toggleTechEdit()"><i class="fas fa-pen"></i> ${techEditMode?"D√ºzenlemeyi Kapat":"D√ºzenlemeyi A√ß"}</button>\n          ${techEditMode?`<button class="x-btn x-btn-admin" onclick="addTechCard('${e}')"><i class="fas fa-plus"></i> Kart Ekle</button>`:""}\n          <span style="color:#888;font-weight:800;font-size:.9rem">Bu d√ºzenlemeler tarayƒ±cƒ±da saklanƒ±r (local).</span>\n        </div>\n    `:"";r.length?n.innerHTML=s+`\n      <div class="x-card-grid">\n        ${r.map((e,t)=>techCardHtml(e,t)).join("")}\n      </div>\n    `:n.innerHTML=s+'<div class="home-mini-item">Kayƒ±t bulunamadƒ±.</div>'}function techCardKey(e,t){return e&&(e.id||e.code)?String(e.id||e.code):`${(e.title||"").slice(0,40)}__${t}`}function techCardHtml(e,t){const a=escapeHtml(e.title||""),n=escapeHtml(e.code||e.category||"TEKNƒ∞K"),i=(e.text||"").toString(),l=escapeHtml(i),r=(e.link||"").trim(),s=(e.script||"").trim(),o=techCardKey(e,t),d=i&&i.length>180||s&&s.length>120||!!r;return`\n      <div class="x-card" data-key="${escapeHtml(o)}">\n        <div class="x-card-head">\n          <div class="x-card-title">${a}</div>\n          <div class="x-card-badge">${n}</div>\n        </div>\n        <div class="x-card-body">\n          ${l?`<div class="x-card-text x-card-text-truncate">${l}</div>`:""}\n          ${d?`<button class="x-readmore" onclick="openTechCardDetail(${JSON.stringify(o)})">Devam oku</button>`:""}\n        </div>\n        <div class="x-card-actions">\n          ${s?`<button class="x-btn x-btn-copy" onclick="copyText(${JSON.stringify(s)})"><i class="fas fa-copy"></i> Kopyala</button>`:""}\n          ${isAdminMode&&techEditMode?`\n            <button class="x-btn x-btn-admin" onclick="editTechCard(${JSON.stringify(o)})"><i class="fas fa-pen"></i> D√ºzenle</button>\n            <button class="x-btn x-btn-admin" onclick="deleteTechCard(${JSON.stringify(o)})"><i class="fas fa-trash"></i> Sil</button>\n          `:""}\n        </div>\n      </div>\n    `}function openTechCardDetail(e){try{const t=__getTechCardsForUi();let a=null;if(String(e||"").startsWith("idx:")){const n=parseInt(String(e).split(":")[1],10);Number.isNaN(n)||(a=t[n])}else a=t.find((t,a)=>techCardKey(t,a)===e)||null;if(!a)return void Swal.fire({icon:"warning",title:"Kayƒ±t bulunamadƒ±",timer:1200,showConfirmButton:!1});showCardDetail({title:a.title||"Detay",text:a.text||"",script:a.script||"",alert:a.alert||"",link:a.link||""})}catch(e){Swal.fire("Hata","Detay a√ßƒ±lamadƒ±.","error")}}function toggleTechEdit(){techEditMode=!techEditMode;try{filterTechCards()}catch(e){}}function getTechOverride(){try{const e=JSON.parse(localStorage.getItem("techCardsOverride")||"[]");if(Array.isArray(e))return e}catch(e){}return[]}function saveTechOverride(e){localStorage.setItem("techCardsOverride",JSON.stringify(e||[]))}function addTechCard(e){Swal.fire({title:"Teknik Kart Ekle",html:'\n          <input id="tc-title" class="swal2-input" placeholder="Ba≈ülƒ±k">\n          <input id="tc-badge" class="swal2-input" placeholder="Etiket (√∂r: TEKNƒ∞K)">\n          <input id="tc-link" class="swal2-input" placeholder="Link (opsiyonel)">\n          <textarea id="tc-text" class="swal2-textarea" placeholder="A√ßƒ±klama"></textarea>\n          <textarea id="tc-script" class="swal2-textarea" placeholder="Script (opsiyonel)"></textarea>\n        ',showCancelButton:!0,confirmButtonText:"Ekle",cancelButtonText:"Vazge√ß",preConfirm:()=>{const e=(document.getElementById("tc-title").value||"").trim();return e?{id:"local_"+Date.now(),title:e,code:(document.getElementById("tc-badge").value||"TEKNƒ∞K").trim(),link:(document.getElementById("tc-link").value||"").trim(),text:(document.getElementById("tc-text").value||"").trim(),script:(document.getElementById("tc-script").value||"").trim(),category:"teknik"}:Swal.showValidationMessage("Ba≈ülƒ±k zorunlu")}}).then(e=>{if(!e.isConfirmed)return;const t=getTechOverride(),a=(database||[]).filter(e=>"teknik"===String(e.category||"").toLowerCase()),n=t.length?t:a;n.unshift(e.value),saveTechOverride(n);try{filterTechCards()}catch(e){}})}function editTechCard(e){const t=getTechOverride(),a=(database||[]).filter(e=>"teknik"===String(e.category||"").toLowerCase()),n=t.length?t:a,i=n.findIndex((t,a)=>techCardKey(t,a)===e);if(i<0)return;const l=n[i]||{};Swal.fire({title:"Kartƒ± D√ºzenle",html:`\n          <input id="tc-title" class="swal2-input" placeholder="Ba≈ülƒ±k" value="${escapeHtml(l.title||"")}">\n          <input id="tc-badge" class="swal2-input" placeholder="Etiket" value="${escapeHtml(l.code||l.category||"TEKNƒ∞K")}">\n          <input id="tc-link" class="swal2-input" placeholder="Link" value="${escapeHtml(l.link||"")}">\n          <textarea id="tc-text" class="swal2-textarea" placeholder="A√ßƒ±klama">${escapeHtml(l.text||"")}</textarea>\n          <textarea id="tc-script" class="swal2-textarea" placeholder="Script">${escapeHtml(l.script||"")}</textarea>\n        `,showCancelButton:!0,confirmButtonText:"Kaydet",cancelButtonText:"Vazge√ß",preConfirm:()=>{const e=(document.getElementById("tc-title").value||"").trim();return e?{...l,title:e,code:(document.getElementById("tc-badge").value||"TEKNƒ∞K").trim(),link:(document.getElementById("tc-link").value||"").trim(),text:(document.getElementById("tc-text").value||"").trim(),script:(document.getElementById("tc-script").value||"").trim(),category:"teknik"}:Swal.showValidationMessage("Ba≈ülƒ±k zorunlu")}}).then(e=>{if(e.isConfirmed){n[i]=e.value,saveTechOverride(n);try{filterTechCards()}catch(e){}}})}function deleteTechCard(e){Swal.fire({title:"Silinsin mi?",text:"Bu kart local veriden silinecek.",icon:"warning",showCancelButton:!0,confirmButtonText:"Sil",cancelButtonText:"Vazge√ß"}).then(t=>{if(!t.isConfirmed)return;const a=getTechOverride(),n=(database||[]).filter(e=>"teknik"===String(e.category||"").toLowerCase());saveTechOverride((a.length?a:n).filter((t,a)=>techCardKey(t,a)!==e));try{filterTechCards()}catch(e){}})}function renderTechList(e,t,a=!1){const n=document.getElementById(e);n&&(t&&0!==t.length?n.innerHTML=t.map(e=>`\n      <div class="news-item" style="cursor:pointer" onclick="showCardDetail(${JSON.stringify(e).replace(/</g,"<")})">\n        <span class="news-title">${escapeHtml(e.title||"")}</span>\n        ${a?`<span class="news-tag" style="background:#eef2ff;color:#2b3a8a;border:1px solid #dde3ff">${escapeHtml(e.category||"")}</span>`:""}\n        <div class="news-desc" style="white-space:pre-line">${escapeHtml(e.text||"")}</div>\n        ${e.script?`<div class="script-box" style="margin-top:10px"><b>Script:</b><div style="margin-top:6px;white-space:pre-line">${escapeHtml(e.script||"")}</div><div style="text-align:right;margin-top:10px"><button class="btn btn-copy" onclick="event.stopPropagation(); copyText('${escapeForJsString(e.script||"")}')">Kopyala</button></div></div>`:""}\n      </div>\n    `).join(""):n.innerHTML='<div style="padding:16px;opacity:.7">Bu ba≈ülƒ±k altƒ±nda i√ßerik yok.</div>')}function renderTechDocs(){const e={broadcast:"x-broadcast-docs",access:"x-access-docs",app:"x-app-docs",activation:"x-activation-docs"};Object.keys(e).forEach(t=>{const a=document.getElementById(e[t]);if(a)try{const e=TECH_DOC_CONTENT&&TECH_DOC_CONTENT[t]?TECH_DOC_CONTENT[t]:[];if(!Array.isArray(e)||0===e.length)return void(a.innerHTML='<div style="padding:12px 2px;opacity:.7">Bu ba≈ülƒ±k altƒ±nda teknik d√∂k√ºman bulunamadƒ±.</div>');a.innerHTML=e.map((e,t)=>`\n                <div class="doc-card">\n                  <button type="button" class="doc-head" onclick="toggleDocAccordion(this)">\n                    <span class="doc-title">${escapeHtml(e.title||"ƒ∞√ßerik "+(t+1))}</span>\n                    <i class="fas fa-chevron-down"></i>\n                  </button>\n                  <div class="doc-body" style="display:none; white-space:pre-line">${escapeHtml(e.body||"")}</div>\n                </div>\n            `).join("")}catch(e){console.error("renderTechDocs error",e),a.innerHTML='<div style="padding:12px 2px;opacity:.7">D√∂k√ºmanlar y√ºklenemedi. (Konsolu kontrol edin)</div>'}})}function toggleDocAccordion(e){try{const t=e.closest(".doc-card");if(!t)return;const a=t.querySelector(".doc-body");if(!a)return;const n="none"!==a.style.display;a.style.display=n?"none":"block",t.classList.toggle("open",!n)}catch(e){}}function renderTechWizardInto(e){const t=document.getElementById(e);if(t){if(window.embeddedTwState=window.embeddedTwState||{currentStep:"start",history:[]},!techWizardData||0===Object.keys(techWizardData).length)return t.innerHTML='<div style="padding:16px;opacity:.7">Sihirbaz y√ºkleniyor...</div>',void loadTechWizardData().then(()=>renderTechWizardInto(e));embeddedTwRender(e)}}function embeddedTwRender(e){const t=document.getElementById(e);if(!t)return;const a=window.embeddedTwState||{currentStep:"start",history:[]},n=techWizardData[a.currentStep];if(!n)return void(t.innerHTML=`<div class="tech-alert">Hata: Adƒ±m bulunamadƒ± (${escapeHtml(String(a.currentStep))}).</div>`);let i=`\n      <div style="display:flex; gap:8px; align-items:center; justify-content:space-between; margin-bottom:12px; flex-wrap:wrap">\n        <div style="display:flex; gap:8px; align-items:center">\n          ${a.history&&a.history.length>0?`<button type="button" class="tech-btn tech-btn-option" onclick="embeddedTwBack('${e}')">‚¨Ö Geri</button>`:""}\n          <button type="button" class="tech-btn tech-btn-option" onclick="embeddedTwReset('${e}')">‚Üª Sƒ±fƒ±rla</button>\n        </div>\n        <div style="opacity:.7; font-size:.9rem">Adƒ±m: ${escapeHtml(n.title||"")}</div>\n      </div>\n\n      <div class="tech-step-title">${escapeHtml(n.title||"")}</div>\n    `;n.text&&(i+=`<div style="font-size:1rem; margin:10px 0; white-space:pre-line">${escapeHtml(n.text)}</div>`),n.script&&(i+=`<div class="tech-script-box"><span class="tech-script-label">M√º≈üteriye iletilecek:</span>${escapeHtml(n.script)}</div>`),n.alert&&(i+=`<div class="tech-alert">${escapeHtml(n.alert)}</div>`),Array.isArray(n.buttons)&&n.buttons.length&&(i+='<div class="tech-buttons-area">',n.buttons.forEach(t=>{const a="option"===t.style?"tech-btn-option":"tech-btn-primary";i+=`<button type="button" class="tech-btn ${a}" onclick="embeddedTwChangeStep('${e}','${escapeForJsString(t.next||"start")}')">${escapeHtml(t.text||"")}</button>`}),i+="</div>"),t.innerHTML=i}function embeddedTwChangeStep(e,t){window.embeddedTwState=window.embeddedTwState||{currentStep:"start",history:[]},window.embeddedTwState.history.push(window.embeddedTwState.currentStep),window.embeddedTwState.currentStep=t,embeddedTwRender(e)}function embeddedTwBack(e){window.embeddedTwState=window.embeddedTwState||{currentStep:"start",history:[]},window.embeddedTwState.history.length&&(window.embeddedTwState.currentStep=window.embeddedTwState.history.pop(),embeddedTwRender(e))}function embeddedTwReset(e){window.embeddedTwState={currentStep:"start",history:[]},embeddedTwRender(e)}function __getTechCardsForUi(){return(database||[]).map((e,t)=>({...e,__dbIndex:t})).filter(e=>"teknik"===String(e.category||"").toLowerCase()&&"pasif"!==String(e.status||"").toLowerCase())}async function addTechCardSheet(){if(!isAdminMode)return;const{value:e}=await Swal.fire({title:"Teknik Kart Ekle",html:'\n        <input id="tc-title" class="swal2-input" placeholder="Ba≈ülƒ±k">\n        <textarea id="tc-text" class="swal2-textarea" placeholder="A√ßƒ±klama"></textarea>\n        <textarea id="tc-script" class="swal2-textarea" placeholder="Script (opsiyonel)"></textarea>\n        <input id="tc-link" class="swal2-input" placeholder="Link (opsiyonel)">\n      ',showCancelButton:!0,confirmButtonText:"Ekle",cancelButtonText:"Vazge√ß",preConfirm:()=>{const e=(document.getElementById("tc-title").value||"").trim();if(!e)return Swal.showValidationMessage("Ba≈ülƒ±k zorunlu");const t=new Date,a=t.getDate()+"."+(t.getMonth()+1)+"."+t.getFullYear();return{cardType:"card",category:"Teknik",title:e,text:(document.getElementById("tc-text").value||"").trim(),script:(document.getElementById("tc-script").value||"").trim(),code:"",link:(document.getElementById("tc-link").value||"").trim(),status:"Aktif",date:a}}});if(e){Swal.fire({title:"Ekleniyor...",didOpen:()=>Swal.showLoading(),showConfirmButton:!1});try{const t=await fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"addCard",username:currentUser,token:getToken(),...e})}),a=await t.json();"success"===a.result?(Swal.fire({icon:"success",title:"Eklendi",timer:1200,showConfirmButton:!1}),await loadContentData(),filterTechCards()):Swal.fire("Hata",a.message||"Eklenemedi","error")}catch(e){Swal.fire("Hata","Sunucu hatasƒ±.","error")}}}async function editTechCardSheet(e){if(!isAdminMode)return;const t=(database||[])[e];if(!t)return;const{value:a}=await Swal.fire({title:"Teknik Kartƒ± D√ºzenle",html:`\n        <input id="tc-title" class="swal2-input" placeholder="Ba≈ülƒ±k" value="${escapeHtml(t.title||"")}">\n        <textarea id="tc-text" class="swal2-textarea" placeholder="A√ßƒ±klama">${escapeHtml(t.text||"")}</textarea>\n        <textarea id="tc-script" class="swal2-textarea" placeholder="Script">${escapeHtml(t.script||"")}</textarea>\n        <input id="tc-link" class="swal2-input" placeholder="Link" value="${escapeHtml(t.link||"")}">\n      `,showCancelButton:!0,confirmButtonText:"Kaydet",cancelButtonText:"Vazge√ß",preConfirm:()=>{const e=(document.getElementById("tc-title").value||"").trim();return e?{title:e,text:(document.getElementById("tc-text").value||"").trim(),script:(document.getElementById("tc-script").value||"").trim(),link:(document.getElementById("tc-link").value||"").trim()}:Swal.showValidationMessage("Ba≈ülƒ±k zorunlu")}});if(!a)return;const n=t.title;a.text!==(t.text||"")&&sendUpdate(n,"Text",a.text,"card"),setTimeout(()=>{a.script!==(t.script||"")&&sendUpdate(n,"Script",a.script,"card")},350),setTimeout(()=>{a.link!==(t.link||"")&&sendUpdate(n,"Link",a.link,"card")},700),setTimeout(()=>{a.title!==n&&sendUpdate(n,"Title",a.title,"card")},1100)}function deleteTechCardSheet(e){if(!isAdminMode)return;const t=(database||[])[e];t&&Swal.fire({title:"Silinsin mi?",text:"Kart pasife alƒ±nacak.",icon:"warning",showCancelButton:!0,confirmButtonText:"Sil",cancelButtonText:"Vazge√ß"}).then(e=>{e.isConfirmed&&sendUpdate(t.title,"Status","Pasif","card")})}function renderTechCardsTab(e=""){const t=document.getElementById("x-cards");if(!t)return;const a=String(e||"").trim().toLowerCase(),n=__getTechCardsForUi(),i=a?n.filter(e=>`${e.title||""} ${e.text||""} ${e.script||""} ${e.link||""}`.toLowerCase().includes(a)):n,l=isAdminMode&&isEditingActive?'<div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-bottom:10px">\n           <button class="x-btn x-btn-admin" onclick="addTechCardSheet()"><i class="fas fa-plus"></i> Kart Ekle</button>\n         </div>':"";i.length?t.innerHTML=l+i.map(e=>{const t=isAdminMode&&isEditingActive?`<div style="display:flex;gap:8px;margin-top:10px">\n             <button class="x-btn x-btn-admin" onclick="editTechCardSheet(${e.__dbIndex})"><i class="fas fa-pen"></i> D√ºzenle</button>\n             <button class="x-btn x-btn-admin" onclick="deleteTechCardSheet(${e.__dbIndex})"><i class="fas fa-trash"></i> Sil</button>\n           </div>`:"";return`\n        <div class="news-item" style="cursor:pointer" onclick="showCardDetail(${JSON.stringify({title:e.title,text:e.text||"",script:e.script||"",link:e.link||""}).replace(/</g,"\\u003c")})">\n          <span class="news-title">${escapeHtml(e.title||"")}</span>\n          <div class="news-desc" style="white-space:pre-line">${escapeHtml((e.text||"").slice(0,220))}${(e.text||"").length>220?"...":""}</div>\n          ${e.script?`<div class="script-box" style="margin-top:10px"><b>Script:</b><div style="margin-top:6px;white-space:pre-line">${escapeHtml((e.script||"").slice(0,220))}${(e.script||"").length>220?"...":""}</div><div style="text-align:right;margin-top:10px"><button class="btn btn-copy" onclick="event.stopPropagation(); copyText('${escapeForJsString(e.script||"")}')">Kopyala</button></div></div>`:""}\n          ${t}\n        </div>\n      `}).join(""):t.innerHTML=l+'<div style="opacity:.7;padding:16px">Kayƒ±t bulunamadƒ±.</div>'}function filterTechCards(){const e=document.getElementById("x-cards-search");renderTechCardsTab(e?e.value:"")}function applySportsRights(){if(!Array.isArray(sportsData)||0===sportsData.length)return;const e=window.sportRightsFromSheet&&window.sportRightsFromSheet.length?window.sportRightsFromSheet:SPORTS_RIGHTS_FALLBACK;sportsData.forEach(t=>{const a=`${t.title||""} ${t.desc||""} ${t.detail||""}`.toLowerCase(),n=e.find(e=>a.includes(String(e.name||"").toLowerCase().replaceAll("*","").trim().split(" ")[0]));if(n){const e=`Yayƒ±n hakkƒ± biti≈ü: ${n.end||n.duration}`;t.tip&&!t.tip.includes("Yayƒ±n hakkƒ±")?t.tip=`${t.tip} ‚Ä¢ ${e}`:t.tip||(t.tip=e),t.detail&&!t.detail.includes("Yayƒ±n hakkƒ±")?t.detail=`${t.detail}\n\n${e}`:t.detail||(t.detail=e)}})}const _orig_afterDataLoaded=window.afterDataLoaded;window.afterDataLoaded=function(){try{"function"==typeof _orig_afterDataLoaded&&_orig_afterDataLoaded()}catch(e){}try{applySportsRights()}catch(e){}};let __techDocsCache=null,__techDocsLoadedAt=0,__techCatsCache=null,__techCatsLoadedAt=0;const TECH_TAB_LABELS={broadcast:"Yayƒ±n",access:"Eri≈üim Sorunlarƒ±",app:"App Hatalarƒ±",activation:"Aktivasyon",info:"Bilgi",payment:"√ñdeme Sorunlarƒ±"};function __normalizeTechTab(e){return e}function __normalizeTechCategory(e){const t=(e||"").toString().trim().toLowerCase();return t.startsWith("yay")?"broadcast":t.startsWith("eri")?"access":t.startsWith("app")?"app":t.startsWith("akt")?"activation":t.startsWith("bil")?"info":t.startsWith("√∂de")||t.startsWith("ode")||t.includes("√∂deme")||t.includes("odeme")?"payment":""}async function __fetchTechDocs(){if(!SCRIPT_URL)throw"function"==typeof showGlobalError&&showGlobalError("SCRIPT_URL ayarlƒ± deƒüil. Saƒü alttan ayarlayabilirsin."),new Error("SCRIPT_URL missing");const e=await fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"getTechDocs"})}),t=await e.json();if("success"!==t.result)throw new Error(t.message||"getTechDocs failed");return(Array.isArray(t.data)?t.data:[]).filter(e=>"pasif"!==(e.Durum||"").toString().trim().toLowerCase()).map(e=>({categoryKey:__normalizeTechCategory(e.Kategori),kategori:(e.Kategori||"").trim(),baslik:(e.Ba≈ülƒ±k||e.Baslik||e.Title||e["Ba≈ülƒ±k"]||"").toString().trim(),icerik:(e.ƒ∞√ßerik||e.Icerik||e.Content||e["ƒ∞√ßerik"]||"").toString(),adim:(e.Adƒ±m||e.Adim||e.Step||e["Adƒ±m"]||"").toString(),not:(e.Not||"").toString(),link:(e.Link||"").toString(),durum:(e.Durum||"").toString()})).filter(e=>e.categoryKey&&e.baslik)}async function __fetchTechDocCategories(){if(!SCRIPT_URL)return[];try{const e=await fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"getTechDocCategories"})}),t=await e.json();return t&&"success"===t.result&&Array.isArray(t.categories)?t.categories:[]}catch(e){return[]}}async function getTechDocCategoryOptions(e=!1){const t=Date.now();if(!e&&__techCatsCache&&t-__techCatsLoadedAt<3e5)return __techCatsCache;const a=await __fetchTechDocCategories();return __techCatsCache=a,__techCatsLoadedAt=t,a}function __escapeHtml(e){return(e||"").toString().replace(/[&<>"']/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[e]))}function __renderTechList(e,t){const a=document.getElementById("broadcast"===e?"x-broadcast-list":"access"===e?"x-access-list":"app"===e?"x-app-list":"activation"===e?"x-activation-list":"info"===e?"x-info-list":"payment"===e?"x-payment-list":"");if(!a)return;if(!t||0===t.length)return void(a.innerHTML='<div style="padding:16px;opacity:.75">Bu ba≈ülƒ±k altƒ±nda hen√ºz i√ßerik yok. (Sheet: Teknik_Dokumanlar)</div>');const n=isAdminMode&&isEditingActive?`<div style="display:flex;gap:10px;align-items:center;margin:0 0 12px;">\n         <button class="x-btn x-btn-admin" onclick="addTechDoc('${e}')"><i class="fas fa-plus"></i> Yeni Konu Ekle</button>\n       </div>`:"";var i;i=t,a.innerHTML=n+i.map((t,a)=>{const n=[t.icerik?`<div class="q-doc-body">${t.icerik}</div>`:"",t.adim?`<div class="q-doc-meta"><b>Adƒ±m:</b> ${__escapeHtml(t.adim)}</div>`:"",t.not?`<div class="q-doc-meta"><b>Not:</b> ${__escapeHtml(t.not)}</div>`:"",t.link?`<div class="q-doc-meta"><b>Link:</b> <a href="${__escapeHtml(t.link)}" target="_blank">${__escapeHtml(t.link)}</a></div>`:""].join(""),i=isAdminMode&&isEditingActive?`<span style="float:right;display:inline-flex;gap:8px" onclick="event.stopPropagation();event.preventDefault();">\n             <button class="x-btn x-btn-admin" style="padding:6px 10px" onclick="editTechDoc('${e}','${escapeForJsString(t.baslik)}')"><i class="fas fa-pen"></i></button>\n             <button class="x-btn x-btn-admin" style="padding:6px 10px" onclick="deleteTechDoc('${e}','${escapeForJsString(t.baslik)}')"><i class="fas fa-trash"></i></button>\n           </span>`:"";return`\n        <details class="q-accordion" style="margin-bottom:10px;background:#fff;border-radius:12px;border:1px solid rgba(0,0,0,.08);padding:10px 12px">\n          <summary style="cursor:pointer;font-weight:800">${__escapeHtml(t.baslik)}${i}</summary>\n          <div style="padding:10px 2px 2px 2px">${n}</div>\n        </details>\n      `}).join("")}async function loadTechDocsIfNeeded(e=!1){const t=Date.now();if(!e&&__techDocsCache&&t-__techDocsLoadedAt<12e4)return __techDocsCache;try{const e=await __fetchTechDocs();return __techDocsCache=e,__techDocsLoadedAt=t,e}catch(e){return console.error("[TECH DOCS]",e),[]}}async function filterTechDocList(e){try{const t=document.getElementById(`x-${e}-search`),a=(t?t.value:"").toLowerCase().trim(),n=(await loadTechDocsIfNeeded(!1)).filter(t=>t.categoryKey===e),i=a?n.filter(e=>(e.baslik||"").toLowerCase().includes(a)||(e.icerik||"").toLowerCase().includes(a)||(e.adim||"").toLowerCase().includes(a)||(e.not||"").toLowerCase().includes(a)):n;__renderTechList(e,i)}catch(e){console.error(e)}}let __techCategoryOptions=null;async function loadTechCategoryOptions(){if(__techCategoryOptions)return __techCategoryOptions;try{const e=await fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"getTechDocCategories"})}),t=await e.json();if(t&&"success"===t.result&&Array.isArray(t.categories))return __techCategoryOptions=t.categories.filter(Boolean),__techCategoryOptions}catch(e){console.error("[TECH CATS]",e)}return __techCategoryOptions=[],__techCategoryOptions}function techTabLabel(e){return{broadcast:"Yayƒ±n",access:"Eri≈üim Sorunlarƒ±",app:"App Hatalarƒ±",activation:"Aktivasyon",info:"Bilgi",payment:"√ñdeme Sorunlarƒ±"}[e]||"Yayƒ±n"}async function addTechDoc(e){if(!isAdminMode)return;const t=await getTechDocCategoryOptions(!1),a=TECH_TAB_LABELS[e]||"",n=(t&&t.length?t:Object.values(TECH_TAB_LABELS)).map(e=>String(e||"").trim()).filter(Boolean),i=Array.from(new Set(n.map(e=>e.toLowerCase()))).map(e=>n.find(t=>t.toLowerCase()===e)).map(e=>`<option value="${__escapeHtml(e)}" ${e===a?"selected":""}>${__escapeHtml(e)}</option>`).join(""),{value:l}=await Swal.fire({title:"Teknik Konu Ekle",html:`\n      <select id="td-cat" class="swal2-select" style="width:100%;max-width:420px">\n        ${i}\n      </select>\n      <input id="td-title" class="swal2-input" placeholder="Ba≈ülƒ±k">\n      <textarea id="td-content" class="swal2-textarea" placeholder="ƒ∞√ßerik"></textarea>\n      <input id="td-step" class="swal2-input" placeholder="Adƒ±m (opsiyonel)">\n      <input id="td-note" class="swal2-input" placeholder="Not (opsiyonel)">\n      <input id="td-link" class="swal2-input" placeholder="Link (opsiyonel)">\n    `,showCancelButton:!0,confirmButtonText:"Ekle",cancelButtonText:"Vazge√ß",preConfirm:()=>{const e=(document.getElementById("td-cat")?.value||a||"").trim();if(!e)return Swal.showValidationMessage("Kategori zorunlu");const t=(document.getElementById("td-title").value||"").trim();return t?{kategori:e,baslik:t,icerik:(document.getElementById("td-content").value||"").trim(),adim:(document.getElementById("td-step").value||"").trim(),not:(document.getElementById("td-note").value||"").trim(),link:(document.getElementById("td-link").value||"").trim(),durum:"Aktif"}:Swal.showValidationMessage("Ba≈ülƒ±k zorunlu")}});if(l){Swal.fire({title:"Ekleniyor...",didOpen:()=>Swal.showLoading(),showConfirmButton:!1});try{const t=await fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"upsertTechDoc",username:currentUser,token:getToken(),keyKategori:"",keyBaslik:"",...l})}),a=await t.json();"success"===a.result?(Swal.fire({icon:"success",title:"Eklendi",timer:1200,showConfirmButton:!1}),await loadTechDocsIfNeeded(!0),filterTechDocList(e)):Swal.fire("Hata",a.message||"Eklenemedi","error")}catch(e){Swal.fire("Hata","Sunucu hatasƒ±.","error")}}}async function editTechDoc(e,t){if(!isAdminMode)return;const a=(await loadTechDocsIfNeeded(!1)).find(a=>a.categoryKey===e&&(a.baslik||"")===t);if(!a)return;const n=await getTechDocCategoryOptions(!1),i=(n&&n.length?n:Object.values(TECH_TAB_LABELS)).map(e=>String(e||"").trim()).filter(Boolean),l=Array.from(new Set(i.map(e=>e.toLowerCase()))).map(e=>i.find(t=>t.toLowerCase()===e)).map(e=>`<option value="${__escapeHtml(e)}" ${e===a.kategori?"selected":""}>${__escapeHtml(e)}</option>`).join(""),{value:r}=await Swal.fire({title:"Teknik Konuyu D√ºzenle",html:`\n      <select id="td-cat" class="swal2-select" style="width:100%;max-width:420px">\n        ${l}\n      </select>\n      <input id="td-title" class="swal2-input" placeholder="Ba≈ülƒ±k" value="${__escapeHtml(a.baslik||"")}">\n      <textarea id="td-content" class="swal2-textarea" placeholder="ƒ∞√ßerik">${__escapeHtml(a.icerik||"")}</textarea>\n      <input id="td-step" class="swal2-input" placeholder="Adƒ±m" value="${__escapeHtml(a.adim||"")}">\n      <input id="td-note" class="swal2-input" placeholder="Not" value="${__escapeHtml(a.not||"")}">\n      <input id="td-link" class="swal2-input" placeholder="Link" value="${__escapeHtml(a.link||"")}">\n    `,showCancelButton:!0,confirmButtonText:"Kaydet",cancelButtonText:"Vazge√ß",preConfirm:()=>{const e=(document.getElementById("td-cat")?.value||a.kategori||"").trim();if(!e)return Swal.showValidationMessage("Kategori zorunlu");const t=(document.getElementById("td-title").value||"").trim();return t?{kategori:e,baslik:t,icerik:(document.getElementById("td-content").value||"").trim(),adim:(document.getElementById("td-step").value||"").trim(),not:(document.getElementById("td-note").value||"").trim(),link:(document.getElementById("td-link").value||"").trim(),durum:"Aktif"}:Swal.showValidationMessage("Ba≈ülƒ±k zorunlu")}});if(r){Swal.fire({title:"Kaydediliyor...",didOpen:()=>Swal.showLoading(),showConfirmButton:!1});try{const t=await fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"upsertTechDoc",username:currentUser,token:getToken(),keyKategori:a.kategori,keyBaslik:a.baslik,...r})}),n=await t.json();"success"===n.result?(Swal.fire({icon:"success",title:"Kaydedildi",timer:1200,showConfirmButton:!1}),await loadTechDocsIfNeeded(!0),filterTechDocList(e)):Swal.fire("Hata",n.message||"Kaydedilemedi","error")}catch(e){Swal.fire("Hata","Sunucu hatasƒ±.","error")}}}function deleteTechDoc(e,t){isAdminMode&&Swal.fire({title:"Silinsin mi?",text:"Konu pasife alƒ±nacak.",icon:"warning",showCancelButton:!0,confirmButtonText:"Sil",cancelButtonText:"Vazge√ß"}).then(async a=>{if(a.isConfirmed)try{const a=(await loadTechDocsIfNeeded(!1)).find(a=>a.categoryKey===e&&(a.baslik||"")===t),n=a?a.kategori:e,i=await fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"deleteTechDoc",username:currentUser,token:getToken(),keyKategori:n,keyBaslik:t})}),l=await i.json();"success"===l.result?(await loadTechDocsIfNeeded(!0),filterTechDocList(e),Swal.fire({icon:"success",title:"Silindi",timer:1e3,showConfirmButton:!1})):Swal.fire("Hata",l.message||"Silinemedi","error")}catch(e){Swal.fire("Hata","Sunucu hatasƒ±.","error")}})}window.switchTechTab=async function(e){try{document.querySelectorAll("#tech-fullscreen .q-nav-item").forEach(e=>e.classList.remove("active"));const t={broadcast:"x-view-broadcast",access:"x-view-access",app:"x-view-app",activation:"x-view-activation",info:"x-view-info",payment:"x-view-payment",wizard:"x-view-wizard",cards:"x-view-cards"}[e],a=Array.from(document.querySelectorAll("#tech-fullscreen .q-nav-menu .q-nav-item")),n=["broadcast","access","app","activation","payment","info","wizard","cards"].indexOf(e);n>=0&&a[n]&&a[n].classList.add("active"),document.querySelectorAll("#tech-fullscreen .q-view-section").forEach(e=>e.classList.remove("active"));const i=document.getElementById(t);if(i&&i.classList.add("active"),["broadcast","access","app","activation","payment","info"].includes(e)){const t=(await loadTechDocsIfNeeded(!1)).filter(t=>t.categoryKey===e);__renderTechList(e,t)}if("wizard"===e)try{renderTechWizardInto("x-wizard")}catch(e){console.error(e)}if("cards"===e)try{filterTechCards()}catch(e){console.error(e)}}catch(e){console.error(e)}};try{window.openMenuPermissions=openMenuPermissions}catch(e){}
