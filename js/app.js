// obfuscated build (utf-8 safe)
(()=>{
 const _b="Y29uc3QgQkFLSU1fTU9EVSA9IGZhbHNlOwovLyBBcHBzIFNjcmlwdCBVUkwnc2kKY29uc3QgU0NSSVBUX1VSTCA9ICJodHRwczovL3NjcmlwdC5nb29nbGUuY29tL21hY3Jvcy9zL0FLZnljYnkza2QwNGsydTlYZFZERDEtdmRiUVFBc0hOVzZXTEluOGJOWXhUbFZDTDNVMWEwV3FabzZvUHA5emZCV0lwd0pFaW5RL2V4ZWMiOwovLyBPeXVuIERlxJ9pxZ9rZW5sZXJpCmxldCBqb2tlcnMgPSB7IGNhbGw6IDEsIGhhbGY6IDEsIGRvdWJsZTogMSB9OwpsZXQgZG91YmxlQ2hhbmNlVXNlZCA9IGZhbHNlOwpsZXQgZmlyc3RBbnN3ZXJJbmRleCA9IC0xOwpjb25zdCBWQUxJRF9DQVRFR09SSUVTID0gWydUZWtuaWsnLCAnxLBrbmEnLCAnS2FtcGFueWEnLCAnQmlsZ2knXTsKY29uc3QgTU9OVEhfTkFNRVMgPSBbIk9jYWsiLCAixZ51YmF0IiwgIk1hcnQiLCAiTmlzYW4iLCAiTWF5xLFzIiwgIkhhemlyYW4iLCAiVGVtbXV6IiwgIkHEn3VzdG9zIiwgIkV5bMO8bCIsICJFa2ltIiwgIkthc8SxbSIsICJBcmFsxLFrIl07Ci8vIC0tLSBHTE9CQUwgREXEnsSwxZ5LRU5MRVIgLS0tCmxldCBkYXRhYmFzZSA9IFtdLCBuZXdzRGF0YSA9IFtdLCBzcG9ydHNEYXRhID0gW10sIHNhbGVzU2NyaXB0cyA9IFtdLCBxdWl6UXVlc3Rpb25zID0gW10sIHF1aWNrRGVjaXNpb25RdWVzdGlvbnMgPSBbXTsKbGV0IHRlY2hXaXphcmREYXRhID0ge307IC8vIFRla25payBTaWhpcmJheiBWZXJpc2kKbGV0IGN1cnJlbnRVc2VyID0gIiI7CmxldCBpc0FkbWluTW9kZSA9IGZhbHNlOyAgICAKbGV0IGlzRWRpdGluZ0FjdGl2ZSA9IGZhbHNlOwpsZXQgc2Vzc2lvblRpbWVvdXQ7CmxldCBhY3RpdmVDYXJkcyA9IFtdOwpsZXQgY3VycmVudENhdGVnb3J5ID0gJ2FsbCc7CmxldCBhZG1pblVzZXJMaXN0ID0gW107CmxldCBhbGxFdmFsdWF0aW9uc0RhdGEgPSBbXTsKbGV0IHdpemFyZFN0ZXBzRGF0YSA9IHt9OwpsZXQgdHJhaW5pbmdEYXRhID0gW107Ci8vIFlFTsSwOiBDaGFydCBpbnN0YW5jZSfEsSB0dXRtYWsgacOnaW4KbGV0IGRhc2hib2FyZENoYXJ0ID0gbnVsbDsKLy8gWUVOxLA6IEZlZWRiYWNrIExvZyBWZXJpc2kgKE1hbnVlbCBrYXnEsXQgZGV0YXlsYXLEsSBpw6dpbikKbGV0IGZlZWRiYWNrTG9nc0RhdGEgPSBbXTsKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyAtLS0gS0FMxLBURSBQVUFOTEFNQSBMT0fEsMSexLA6IENIQVQgKEJVVE9OIFRBQkFOTEkpIC0tLQovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CndpbmRvdy5zZXRCdXR0b25TY29yZSA9IGZ1bmN0aW9uKGluZGV4LCBzY29yZSwgbWF4KSB7CiAgICBjb25zdCByb3cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgcm93LSR7aW5kZXh9YCk7CiAgICBjb25zdCBiYWRnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBiYWRnZS0ke2luZGV4fWApOwogICAgY29uc3Qgbm90ZUlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYG5vdGUtJHtpbmRleH1gKTsKICAgIGNvbnN0IGJ1dHRvbnMgPSByb3cucXVlcnlTZWxlY3RvckFsbCgnLmV2YWwtYnV0dG9uJyk7CiAgICAKICAgIGJ1dHRvbnMuZm9yRWFjaChiID0+IGIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykpOwogICAgCiAgICBjb25zdCBhY3RpdmVCdG4gPSByb3cucXVlcnlTZWxlY3RvcignLmV2YWwtYnV0dG9uW2RhdGEtc2NvcmU9IicgKyBzY29yZSArICciXScpOwogICAgaWYgKGFjdGl2ZUJ0bikgYWN0aXZlQnRuLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgCiAgICBiYWRnZS5pbm5lclRleHQgPSBzY29yZTsKICAgIAogICAgaWYgKHNjb3JlIDwgbWF4KSB7CiAgICAgICAgbm90ZUlucHV0LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgIGJhZGdlLnN0eWxlLmJhY2tncm91bmQgPSAnI2QzMmYyZic7IAogICAgICAgIHJvdy5zdHlsZS5ib3JkZXJDb2xvciA9ICcjZmZjZGQyJzsKICAgICAgICByb3cuc3R5bGUuYmFja2dyb3VuZCA9ICcjZmZmNWY1JzsKICAgIH0gZWxzZSB7CiAgICAgICAgbm90ZUlucHV0LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgbm90ZUlucHV0LnZhbHVlID0gJyc7IAogICAgICAgIGJhZGdlLnN0eWxlLmJhY2tncm91bmQgPSAnIzJlN2QzMic7IAogICAgICAgIHJvdy5zdHlsZS5ib3JkZXJDb2xvciA9ICcjZWVlJzsKICAgICAgICByb3cuc3R5bGUuYmFja2dyb3VuZCA9ICcjZmZmJzsKICAgIH0KICAgIHdpbmRvdy5yZWNhbGNUb3RhbFNjb3JlKCk7Cn07CndpbmRvdy5yZWNhbGNUb3RhbFNjb3JlID0gZnVuY3Rpb24oKSB7CiAgICBsZXQgY3VycmVudFRvdGFsID0gMDsKICAgIGxldCBtYXhUb3RhbCA9IDA7CiAgICAKICAgIGNvbnN0IHNjb3JlQmFkZ2VzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNjb3JlLWJhZGdlJyk7CiAgICBzY29yZUJhZGdlcy5mb3JFYWNoKGIgPT4geyBjdXJyZW50VG90YWwgKz0gcGFyc2VJbnQoYi5pbm5lclRleHQpIHx8IDA7IH0pOwogICAgCiAgICBjb25zdCBtYXhTY29yZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY3JpdGVyaWEtcm93Jyk7CiAgICBtYXhTY29yZXMuZm9yRWFjaChyb3cgPT4geyBtYXhUb3RhbCArPSBwYXJzZUludChyb3cuZ2V0QXR0cmlidXRlKCdkYXRhLW1heC1zY29yZScpKSB8fCAwOyB9KTsKICAgIAogICAgY29uc3QgbGl2ZVNjb3JlRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGl2ZS1zY29yZScpOwogICAgY29uc3QgcmluZ0VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Njb3JlLXJpbmcnKTsKICAgIAogICAgaWYobGl2ZVNjb3JlRWwpIGxpdmVTY29yZUVsLmlubmVyVGV4dCA9IGN1cnJlbnRUb3RhbDsKICAgIGlmKHJpbmdFbCkgewogICAgICAgIGxldCBjb2xvciA9ICcjMmU3ZDMyJzsKICAgICAgICBsZXQgcmF0aW8gPSBtYXhUb3RhbCA+IDAgPyAoY3VycmVudFRvdGFsIC8gbWF4VG90YWwpICogMTAwIDogMDsKICAgICAgICBpZihyYXRpbyA8IDUwKSBjb2xvciA9ICcjZDMyZjJmJzsKICAgICAgICBlbHNlIGlmKHJhdGlvIDwgODUpIGNvbG9yID0gJyNlZDZjMDInOwogICAgICAgIGVsc2UgaWYocmF0aW8gPCA5NSkgY29sb3IgPSAnI2ZhYmIwMCc7CiAgICAgICAgcmluZ0VsLnN0eWxlLmJhY2tncm91bmQgPSBgY29uaWMtZ3JhZGllbnQoJHtjb2xvcn0gJHtyYXRpb30lLCAjNDQ0ICR7cmF0aW99JSlgOwogICAgfQp9OwovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIC0tLSBLQUzEsFRFIFBVQU5MQU1BIExPR8SwxJ7EsDogVEVMRSBTQVRJxZ4gKFNMSURFUiBUQUJBTkxJKSAtLS0KLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQp3aW5kb3cudXBkYXRlUm93U2xpZGVyU2NvcmUgPSBmdW5jdGlvbihpbmRleCwgbWF4KSB7CiAgICBjb25zdCBzbGlkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgc2xpZGVyLSR7aW5kZXh9YCk7CiAgICBjb25zdCBiYWRnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBiYWRnZS0ke2luZGV4fWApOwogICAgY29uc3Qgbm90ZUlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYG5vdGUtJHtpbmRleH1gKTsKICAgIGNvbnN0IHJvdyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGByb3ctJHtpbmRleH1gKTsKICAgIGlmKCFzbGlkZXIpIHJldHVybjsKICAgIGNvbnN0IHZhbCA9IHBhcnNlSW50KHNsaWRlci52YWx1ZSk7CiAgICBiYWRnZS5pbm5lclRleHQgPSB2YWw7CiAgICAKICAgIGlmICh2YWwgPCBtYXgpIHsKICAgICAgICBub3RlSW5wdXQuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgYmFkZ2Uuc3R5bGUuYmFja2dyb3VuZCA9ICcjZDMyZjJmJzsKICAgICAgICByb3cuc3R5bGUuYm9yZGVyQ29sb3IgPSAnI2ZmY2RkMic7CiAgICAgICAgcm93LnN0eWxlLmJhY2tncm91bmQgPSAnI2ZmZjVmNSc7CiAgICB9IGVsc2UgewogICAgICAgIG5vdGVJbnB1dC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgIG5vdGVJbnB1dC52YWx1ZSA9ICcnOwogICAgICAgIGJhZGdlLnN0eWxlLmJhY2tncm91bmQgPSAnIzJlN2QzMic7CiAgICAgICAgcm93LnN0eWxlLmJvcmRlckNvbG9yID0gJyNlZWUnOwogICAgICAgIHJvdy5zdHlsZS5iYWNrZ3JvdW5kID0gJyNmZmYnOwogICAgfQogICAgd2luZG93LnJlY2FsY1RvdGFsU2xpZGVyU2NvcmUoKTsKfTsKd2luZG93LnJlY2FsY1RvdGFsU2xpZGVyU2NvcmUgPSBmdW5jdGlvbigpIHsKICAgIGxldCBjdXJyZW50VG90YWwgPSAwOwogICAgbGV0IG1heFRvdGFsID0gMDsKICAgIGNvbnN0IHNsaWRlcnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2xpZGVyLWlucHV0Jyk7CiAgICAKICAgIHNsaWRlcnMuZm9yRWFjaChzID0+IHsKICAgICAgICBjdXJyZW50VG90YWwgKz0gcGFyc2VJbnQocy52YWx1ZSkgfHwgMDsKICAgICAgICBtYXhUb3RhbCArPSBwYXJzZUludChzLmdldEF0dHJpYnV0ZSgnbWF4JykpIHx8IDA7CiAgICB9KTsKICAgIGNvbnN0IGxpdmVTY29yZUVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xpdmUtc2NvcmUnKTsKICAgIGNvbnN0IHJpbmdFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY29yZS1yaW5nJyk7CiAgICAKICAgIGlmKGxpdmVTY29yZUVsKSBsaXZlU2NvcmVFbC5pbm5lclRleHQgPSBjdXJyZW50VG90YWw7CiAgICBpZihyaW5nRWwpIHsKICAgICAgICBsZXQgY29sb3IgPSAnIzJlN2QzMic7CiAgICAgICAgbGV0IHJhdGlvID0gbWF4VG90YWwgPiAwID8gKGN1cnJlbnRUb3RhbCAvIG1heFRvdGFsKSAqIDEwMCA6IDA7CiAgICAgICAgaWYocmF0aW8gPCA1MCkgY29sb3IgPSAnI2QzMmYyZic7CiAgICAgICAgZWxzZSBpZihyYXRpbyA8IDg1KSBjb2xvciA9ICcjZWQ2YzAyJzsKICAgICAgICBlbHNlIGlmKHJhdGlvIDwgOTUpIGNvbG9yID0gJyNmYWJiMDAnOwogICAgICAgIHJpbmdFbC5zdHlsZS5iYWNrZ3JvdW5kID0gYGNvbmljLWdyYWRpZW50KCR7Y29sb3J9ICR7cmF0aW99JSwgIzQ0NCAke3JhdGlvfSUpYDsKICAgIH0KfTsKLy8gLS0tIFlBUkRJTUNJIEZPTktTxLBZT05MQVIgLS0tCmZ1bmN0aW9uIGdldFRva2VuKCkgeyByZXR1cm4gbG9jYWxTdG9yYWdlLmdldEl0ZW0oInNTcG9ydFRva2VuIik7IH0KZnVuY3Rpb24gZ2V0RmF2cygpIHsgcmV0dXJuIEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3NTcG9ydEZhdnMnKSB8fCAnW10nKTsgfQpmdW5jdGlvbiB0b2dnbGVGYXZvcml0ZSh0aXRsZSkgewogICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICBsZXQgZmF2cyA9IGdldEZhdnMoKTsKICAgIGlmIChmYXZzLmluY2x1ZGVzKHRpdGxlKSkgeyBmYXZzID0gZmF2cy5maWx0ZXIodCA9PiB0ICE9PSB0aXRsZSk7IH0gCiAgICBlbHNlIHsgZmF2cy5wdXNoKHRpdGxlKTsgfQogICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3NTcG9ydEZhdnMnLCBKU09OLnN0cmluZ2lmeShmYXZzKSk7CiAgICB0cnkgewogICAgICAgIGNvbnN0IGFkZGVkID0gZmF2cy5pbmNsdWRlcyh0aXRsZSk7CiAgICAgICAgU3dhbC5maXJlKHt0b2FzdDp0cnVlLCBwb3NpdGlvbjondG9wLWVuZCcsIGljb246IGFkZGVkID8gJ3N1Y2Nlc3MnIDogJ2luZm8nLCB0aXRsZTogYWRkZWQgPyAnRmF2b3JpbGVyZSBla2xlbmRpJyA6ICdGYXZvcmlsZXJkZW4ga2FsZMSxcsSxbGTEsScsIHNob3dDb25maXJtQnV0dG9uOmZhbHNlLCB0aW1lcjoxMjAwfSk7CiAgICB9IGNhdGNoKGUpIHt9CgogICAgaWYgKGN1cnJlbnRDYXRlZ29yeSA9PT0gJ2ZhdicpIHsgZmlsdGVyQ2F0ZWdvcnkoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJ0bi1mYXYnKSwgJ2ZhdicpOyB9IAogICAgZWxzZSB7IHJlbmRlckNhcmRzKGFjdGl2ZUNhcmRzKTsgfQogICAgdHJ5IHsgdXBkYXRlU2VhcmNoUmVzdWx0Q291bnQoYWN0aXZlQ2FyZHMubGVuZ3RoIHx8IDAsIGRhdGFiYXNlLmxlbmd0aCk7IH0gY2F0Y2goZSkge30KfQpmdW5jdGlvbiBpc0Zhdih0aXRsZSkgeyByZXR1cm4gZ2V0RmF2cygpLmluY2x1ZGVzKHRpdGxlKTsgfQpmdW5jdGlvbiBmb3JtYXREYXRlVG9ERE1NWVlZWShkYXRlU3RyaW5nKSB7CiAgICBpZiAoIWRhdGVTdHJpbmcpIHJldHVybiAnTi9BJzsKICAgIC8vIEXEn2VyIGZvcm1hdCBkZC5NTS55eXl5IG9sYXJhayBnZWxpeW9yc2EgZGlyZWt0IGTDtm4KICAgIGlmIChkYXRlU3RyaW5nLm1hdGNoKC9eXGR7Mn1cLlxkezJ9XC5cZHs0fS8pKSB7IHJldHVybiBkYXRlU3RyaW5nLnNwbGl0KCcgJylbMF07IH0KICAgIHRyeSB7CiAgICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKGRhdGVTdHJpbmcpOwogICAgICAgIGlmIChpc05hTihkYXRlLmdldFRpbWUoKSkpIHsgcmV0dXJuIGRhdGVTdHJpbmc7IH0KICAgICAgICBjb25zdCBkYXkgPSBTdHJpbmcoZGF0ZS5nZXREYXRlKCkpLnBhZFN0YXJ0KDIsICcwJyk7CiAgICAgICAgY29uc3QgbW9udGggPSBTdHJpbmcoZGF0ZS5nZXRNb250aCgpICsgMSkucGFkU3RhcnQoMiwgJzAnKTsKICAgICAgICBjb25zdCB5ZWFyID0gZGF0ZS5nZXRGdWxsWWVhcigpOwogICAgICAgIHJldHVybiBgJHtkYXl9LiR7bW9udGh9LiR7eWVhcn1gOwogICAgfSBjYXRjaCAoZSkgeyByZXR1cm4gZGF0ZVN0cmluZzsgfQp9CgpmdW5jdGlvbiBwYXJzZURhdGVUUlRvVFMocyl7CiAgICB0cnl7CiAgICAgICAgaWYoIXMpIHJldHVybiAwOwogICAgICAgIGNvbnN0IGNsZWFuID0gU3RyaW5nKHMpLnNwbGl0KCcgJylbMF07CiAgICAgICAgaWYoY2xlYW4uaW5jbHVkZXMoJy4nKSl7CiAgICAgICAgICAgIGNvbnN0IHBhcnRzID0gY2xlYW4uc3BsaXQoJy4nKTsKICAgICAgICAgICAgaWYocGFydHMubGVuZ3RoID49IDMpewogICAgICAgICAgICAgICAgY29uc3QgZGQgPSBwYXJzZUludChwYXJ0c1swXSwxMCk7CiAgICAgICAgICAgICAgICBjb25zdCBtbSA9IHBhcnNlSW50KHBhcnRzWzFdLDEwKTsKICAgICAgICAgICAgICAgIGNvbnN0IHl5ID0gcGFyc2VJbnQocGFydHNbMl0sMTApOwogICAgICAgICAgICAgICAgY29uc3QgZCA9IG5ldyBEYXRlKHl5LCBtbS0xLCBkZCk7CiAgICAgICAgICAgICAgICByZXR1cm4gZC5nZXRUaW1lKCkgfHwgMDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjb25zdCBkID0gbmV3IERhdGUocyk7CiAgICAgICAgcmV0dXJuIGQuZ2V0VGltZSgpIHx8IDA7CiAgICB9Y2F0Y2goZSl7IHJldHVybiAwOyB9Cn0KCmZ1bmN0aW9uIGlzTmV3KGRhdGVTdHIpIHsKICAgIGlmICghZGF0ZVN0cikgcmV0dXJuIGZhbHNlOwogICAgbGV0IGRhdGU7CiAgICBpZiAoZGF0ZVN0ci5pbmRleE9mKCcuJykgPiAtMSkgewogICAgICAgIGNvbnN0IGNsZWFuRGF0ZSA9IGRhdGVTdHIuc3BsaXQoJyAnKVswXTsKICAgICAgICBjb25zdCBwYXJ0cyA9IGNsZWFuRGF0ZS5zcGxpdCgnLicpOwogICAgICAgIC8vIEdHLkFBLllZWVkgLT4gWVlZWS1BQS1HRyBmb3JtYXTEsW5hIMOnZXZpcgogICAgICAgIGRhdGUgPSBuZXcgRGF0ZShwYXJ0c1syXSwgcGFydHNbMV0gLSAxLCBwYXJ0c1swXSk7CiAgICB9IGVsc2UgewogICAgICAgIGRhdGUgPSBuZXcgRGF0ZShkYXRlU3RyKTsKICAgIH0KICAgIGlmIChpc05hTihkYXRlLmdldFRpbWUoKSkpIHJldHVybiBmYWxzZTsKICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7CiAgICBjb25zdCBkaWZmVGltZSA9IE1hdGguYWJzKG5vdyAtIGRhdGUpOwogICAgY29uc3QgZGlmZkRheXMgPSBNYXRoLmNlaWwoZGlmZlRpbWUgLyAoMTAwMCAqIDYwICogNjAgKiAyNCkpOwogICAgcmV0dXJuIGRpZmZEYXlzIDw9IDM7Cn0KZnVuY3Rpb24gZ2V0Q2F0ZWdvcnlTZWxlY3RIdG1sKGN1cnJlbnRDYXRlZ29yeSwgaWQpIHsKICAgIGxldCBvcHRpb25zID0gVkFMSURfQ0FURUdPUklFUy5tYXAoY2F0ID0+IGA8b3B0aW9uIHZhbHVlPSIke2NhdH0iICR7Y2F0ID09PSBjdXJyZW50Q2F0ZWdvcnkgPyAnc2VsZWN0ZWQnIDogJyd9PiR7Y2F0fTwvb3B0aW9uPmApLmpvaW4oJycpOwogICAgaWYgKGN1cnJlbnRDYXRlZ29yeSAmJiAhVkFMSURfQ0FURUdPUklFUy5pbmNsdWRlcyhjdXJyZW50Q2F0ZWdvcnkpKSB7CiAgICAgICAgb3B0aW9ucyA9IGA8b3B0aW9uIHZhbHVlPSIke2N1cnJlbnRDYXRlZ29yeX0iIHNlbGVjdGVkPiR7Y3VycmVudENhdGVnb3J5fSAoSGF0YSk8L29wdGlvbj5gICsgb3B0aW9uczsKICAgIH0KICAgIHJldHVybiBgPHNlbGVjdCBpZD0iJHtpZH0iIGNsYXNzPSJzd2FsMi1pbnB1dCIgc3R5bGU9IndpZHRoOjEwMCU7IG1hcmdpbi10b3A6NXB4OyI+JHtvcHRpb25zfTwvc2VsZWN0PmA7Cn0KZnVuY3Rpb24gZXNjYXBlRm9ySnNTdHJpbmcodGV4dCkgewogICAgaWYgKCF0ZXh0KSByZXR1cm4gIiI7CiAgICByZXR1cm4gdGV4dC50b1N0cmluZygpLnJlcGxhY2UoL1xcL2csICdcXFxcJykucmVwbGFjZSgvJy9nLCAnXFxcJycpLnJlcGxhY2UoLyIvZywgJ1xcIicpLnJlcGxhY2UoL1xuL2csICdcXG4nKS5yZXBsYWNlKC9cci9nLCAnJyk7Cn0KZnVuY3Rpb24gY29weVNjcmlwdENvbnRlbnQoZW5jb2RlZFRleHQpIHsKICAgIGNvbnN0IHRleHQgPSBkZWNvZGVVUklDb21wb25lbnQoZW5jb2RlZFRleHQpOwogICAgY29weVRleHQodGV4dCk7Cn0KZnVuY3Rpb24gY29weVRleHQodCkgewogICAgLy8gbmF2aWdhdG9yLmNsaXBib2FyZC53cml0ZVRleHQgeWVyaW5lIGV4ZWNDb21tYW5kIGt1bGxhbsSxbGTEsSAoaUZyYW1lIHV5dW1sdWx1xJ91IGnDp2luKQogICAgY29uc3QgdGV4dGFyZWEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZXh0YXJlYScpOwogICAgdGV4dGFyZWEudmFsdWUgPSB0LnJlcGxhY2UoL1xcbi9nLCAnXG4nKTsKICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGV4dGFyZWEpOwogICAgdGV4dGFyZWEuc2VsZWN0KCk7CiAgICB0cnkgewogICAgICAgIGRvY3VtZW50LmV4ZWNDb21tYW5kKCdjb3B5Jyk7CiAgICAgICAgU3dhbC5maXJlKHtpY29uOidzdWNjZXNzJywgdGl0bGU6J0tvcHlhbGFuZMSxJywgdG9hc3Q6dHJ1ZSwgcG9zaXRpb246J3RvcC1lbmQnLCBzaG93Q29uZmlybUJ1dHRvbjpmYWxzZSwgdGltZXI6MTUwMH0pOwogICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgU3dhbC5maXJlKHtpY29uOidlcnJvcicsIHRpdGxlOidLb3B5YWxhbmFtYWTEsScsIHRleHQ6J0zDvHRmZW4gbWFudWVsIGtvcHlhbGF5xLFuLicsIHRvYXN0OnRydWUsIHBvc2l0aW9uOid0b3AtZW5kJywgc2hvd0NvbmZpcm1CdXR0b246ZmFsc2UsIHRpbWVyOjI1MDB9KTsKICAgIH0KICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQodGV4dGFyZWEpOwp9CmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NvbnRleHRtZW51JywgZXZlbnQgPT4gZXZlbnQucHJldmVudERlZmF1bHQoKSk7CmRvY3VtZW50Lm9ua2V5ZG93biA9IGZ1bmN0aW9uKGUpIHsgaWYoZS5rZXlDb2RlID09IDEyMykgcmV0dXJuIGZhbHNlOyB9CmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoKSA9PiB7IGNoZWNrU2Vzc2lvbigpOyB9KTsKLy8gLS0tIFNFU1NJT04gJiBMT0dJTiAtLS0KZnVuY3Rpb24gY2hlY2tTZXNzaW9uKCkgewogICAgY29uc3Qgc2F2ZWRVc2VyID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oInNTcG9ydFVzZXIiKTsKICAgIGNvbnN0IHNhdmVkVG9rZW4gPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgic1Nwb3J0VG9rZW4iKTsKICAgIGNvbnN0IHNhdmVkUm9sZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJzU3BvcnRSb2xlIik7CiAgICBpZiAoc2F2ZWRVc2VyICYmIHNhdmVkVG9rZW4pIHsKICAgICAgICBjdXJyZW50VXNlciA9IHNhdmVkVXNlcjsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibG9naW4tc2NyZWVuIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidXNlci1kaXNwbGF5IikuaW5uZXJUZXh0ID0gY3VycmVudFVzZXI7CiAgICAgICAgY2hlY2tBZG1pbihzYXZlZFJvbGUpOwogICAgICAgIHN0YXJ0U2Vzc2lvblRpbWVyKCk7CiAgICAgICAgCiAgICAgICAgaWYgKEJBS0lNX01PRFUpIHsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1haW50ZW5hbmNlLXNjcmVlbiIpLnN0eWxlLmRpc3BsYXkgPSAiZmxleCI7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1haW4tYXBwIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CiAgICAgICAgICAgIGxvYWRDb250ZW50RGF0YSgpOwogICAgICAgICAgICBsb2FkV2l6YXJkRGF0YSgpOwogICAgICAgICAgICBsb2FkVGVjaFdpemFyZERhdGEoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEXEn2VyIHF1c2VycyByb2zDvG5kZXlzZSwgYW5hIGnDp2VyacSfaSBnaXpsZSB2ZSBrYWxpdGUgbW9kw7xsw7xuw7wgYcOnCiAgICAgICAgICAgIGlmIChzYXZlZFJvbGUgPT09ICdxdXNlcnMnKSB7CiAgICAgICAgICAgICAgICBjb25zdCBncmlkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhcmRHcmlkJyk7IGlmIChncmlkKSBncmlkLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgICAgICBjb25zdCBjb250cm9scyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jb250cm9sLXdyYXBwZXInKTsgaWYgKGNvbnRyb2xzKSBjb250cm9scy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgY29uc3QgdGlja2VyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm5ld3MtdGlja2VyLWJveCcpOyBpZiAodGlja2VyKSB0aWNrZXIuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgb3BlblF1YWxpdHlBcmVhKCk7IC8vIFllbmkgRnVsbCBTY3JlZW4gTW9kw7xsCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KZnVuY3Rpb24gZW50ZXJCYXMoZSkgeyBpZiAoZS5rZXkgPT09ICJFbnRlciIpIGdpcmlzWWFwKCk7IH0KZnVuY3Rpb24gZ2lyaXNZYXAoKSB7CiAgICBjb25zdCB1TmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1c2VybmFtZUlucHV0IikudmFsdWUudHJpbSgpOwogICAgY29uc3QgdVBhc3MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicGFzc0lucHV0IikudmFsdWUudHJpbSgpOwogICAgY29uc3QgbG9hZGluZ01zZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsb2FkaW5nLW1zZyIpOwogICAgY29uc3QgZXJyb3JNc2cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZXJyb3ItbXNnIik7CiAgICBpZighdU5hbWUgfHwgIXVQYXNzKSB7IGVycm9yTXNnLmlubmVyVGV4dCA9ICJMw7x0ZmVuIGJpbGdpbGVyaSBnaXJpbml6LiI7IGVycm9yTXNnLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOyByZXR1cm47IH0KICAgIAogICAgbG9hZGluZ01zZy5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKICAgIGxvYWRpbmdNc2cuaW5uZXJUZXh0ID0gIkRvxJ9ydWxhbsSxeW9yLi4uIjsKICAgIGVycm9yTXNnLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubG9naW4tYnRuJykuZGlzYWJsZWQgPSB0cnVlOwogICAgCiAgICBjb25zdCBoYXNoZWRQYXNzID0gQ3J5cHRvSlMuU0hBMjU2KHVQYXNzKS50b1N0cmluZygpOwogICAgZmV0Y2goU0NSSVBUX1VSTCwgewogICAgICAgIG1ldGhvZDogJ1BPU1QnLAogICAgICAgIGhlYWRlcnM6IHsgIkNvbnRlbnQtVHlwZSI6ICJ0ZXh0L3BsYWluO2NoYXJzZXQ9dXRmLTgiIH0sCiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBhY3Rpb246ICJsb2dpbiIsIHVzZXJuYW1lOiB1TmFtZSwgcGFzc3dvcmQ6IGhhc2hlZFBhc3MgfSkKICAgIH0pLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuanNvbigpKQogICAgLnRoZW4oZGF0YSA9PiB7CiAgICAgICAgbG9hZGluZ01zZy5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5sb2dpbi1idG4nKS5kaXNhYmxlZCA9IGZhbHNlOwogICAgICAgIAogICAgICAgIGlmIChkYXRhLnJlc3VsdCA9PT0gInN1Y2Nlc3MiKSB7CiAgICAgICAgICAgIGN1cnJlbnRVc2VyID0gZGF0YS51c2VybmFtZTsKICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oInNTcG9ydFVzZXIiLCBjdXJyZW50VXNlcik7CiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJzU3BvcnRUb2tlbiIsIGRhdGEudG9rZW4pOwogICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgic1Nwb3J0Um9sZSIsIGRhdGEucm9sZSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBzYXZlZFJvbGUgPSBkYXRhLnJvbGU7CiAgICAgICAgICAgIGlmIChkYXRhLmZvcmNlQ2hhbmdlID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgICBTd2FsLmZpcmUoewogICAgICAgICAgICAgICAgICAgIGljb246ICd3YXJuaW5nJywgdGl0bGU6ICcg4pqg77iPICBHw7x2ZW5saWsgVXlhcsSxc8SxJywKICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnxLBsayBnaXJpxZ9pbml6LiBMw7x0ZmVuIMWfaWZyZW5pemkgZGXEn2nFn3RpcmluLicsCiAgICAgICAgICAgICAgICAgICAgYWxsb3dPdXRzaWRlQ2xpY2s6IGZhbHNlLCBhbGxvd0VzY2FwZUtleTogZmFsc2UsIGNvbmZpcm1CdXR0b25UZXh0OiAnxZ5pZnJlbWkgRGXEn2nFn3RpcicKICAgICAgICAgICAgICAgIH0pLnRoZW4oKCkgPT4geyBjaGFuZ2VQYXNzd29yZFBvcHVwKHRydWUpOyB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsb2dpbi1zY3JlZW4iKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVzZXItZGlzcGxheSIpLmlubmVyVGV4dCA9IGN1cnJlbnRVc2VyOwogICAgICAgICAgICAgICAgY2hlY2tBZG1pbihzYXZlZFJvbGUpOwogICAgICAgICAgICAgICAgc3RhcnRTZXNzaW9uVGltZXIoKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKEJBS0lNX01PRFUpIHsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibWFpbnRlbmFuY2Utc2NyZWVuIikuc3R5bGUuZGlzcGxheSA9ICJmbGV4IjsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1haW4tYXBwIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CiAgICAgICAgICAgICAgICAgICAgbG9hZENvbnRlbnREYXRhKCk7CiAgICAgICAgICAgICAgICAgICAgbG9hZFdpemFyZERhdGEoKTsKICAgICAgICAgICAgICAgICAgICBsb2FkVGVjaFdpemFyZERhdGEoKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiAoc2F2ZWRSb2xlID09PSAncXVzZXJzJykgeyAKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZ3JpZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYXJkR3JpZCcpOyBpZiAoZ3JpZCkgZ3JpZC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjb250cm9scyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jb250cm9sLXdyYXBwZXInKTsgaWYgKGNvbnRyb2xzKSBjb250cm9scy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0aWNrZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubmV3cy10aWNrZXItYm94Jyk7IGlmICh0aWNrZXIpIHRpY2tlci5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgICAgICAgICBvcGVuUXVhbGl0eUFyZWEoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBlcnJvck1zZy5pbm5lclRleHQgPSBkYXRhLm1lc3NhZ2UgfHwgIkhhdGFsxLEgZ2lyacWfISI7CiAgICAgICAgICAgIGVycm9yTXNnLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwogICAgICAgIH0KICAgIH0pLmNhdGNoKGVycm9yID0+IHsKICAgICAgICBsb2FkaW5nTXNnLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmxvZ2luLWJ0bicpLmRpc2FibGVkID0gZmFsc2U7CiAgICAgICAgZXJyb3JNc2cuaW5uZXJUZXh0ID0gIlN1bnVjdSBoYXRhc8SxISBMw7x0ZmVuIHNheWZhecSxIHllbmlsZXlpbi4iOwogICAgICAgIGVycm9yTXNnLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwogICAgfSk7Cn0KZnVuY3Rpb24gY2hlY2tBZG1pbihyb2xlKSB7CiAgICBjb25zdCBhZGRDYXJkRHJvcGRvd24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHJvcGRvd25BZGRDYXJkJyk7CiAgICBjb25zdCBxdWlja0VkaXREcm9wZG93biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkcm9wZG93blF1aWNrRWRpdCcpOwogICAgCiAgICBpc0FkbWluTW9kZSA9IChyb2xlID09PSAiYWRtaW4iKTsKICAgIGlzRWRpdGluZ0FjdGl2ZSA9IGZhbHNlOwogICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QucmVtb3ZlKCdlZGl0aW5nJyk7CiAgICAKICAgIGNvbnN0IGlzUXVhbGl0eVVzZXIgPSAocm9sZSA9PT0gJ3F1c2VycycpOwogICAgY29uc3QgZmlsdGVyQnV0dG9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5maWx0ZXItYnRuOm5vdCguYnRuLWZhdiknKTsgCiAgICAKICAgIGlmIChpc1F1YWxpdHlVc2VyKSB7CiAgICAgICAgZmlsdGVyQnV0dG9ucy5mb3JFYWNoKGJ0biA9PiB7CiAgICAgICAgICAgIGlmIChidG4uaW5uZXJUZXh0LmluZGV4T2YoJ0thbGl0ZScpID09PSAtMSkgewogICAgICAgICAgICAgICAgYnRuLnN0eWxlLm9wYWNpdHkgPSAnMC41JzsKICAgICAgICAgICAgICAgIGJ0bi5zdHlsZS5wb2ludGVyRXZlbnRzID0gJ25vbmUnOwogICAgICAgICAgICAgICAgYnRuLnN0eWxlLmZpbHRlciA9ICdncmF5c2NhbGUoMTAwJSknOwogICAgICAgICAgICB9IGVsc2UgeyBidG4uc3R5bGUuZmlsdGVyID0gJ25vbmUnOyB9CiAgICAgICAgfSk7CiAgICAgICAgY29uc3Qgc2VhcmNoSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VhcmNoSW5wdXQnKTsKICAgICAgICBpZiAoc2VhcmNoSW5wdXQpIHsgc2VhcmNoSW5wdXQuZGlzYWJsZWQgPSB0cnVlOyBzZWFyY2hJbnB1dC5wbGFjZWhvbGRlciA9ICJBcmFtYSBkZXZyZSBkxLHFn8SxIChLYWxpdGUgTW9kdSkiOyBzZWFyY2hJbnB1dC5zdHlsZS5vcGFjaXR5ID0gJzAuNic7IH0KICAgIH0gZWxzZSB7CiAgICAgICAgZmlsdGVyQnV0dG9ucy5mb3JFYWNoKGJ0biA9PiB7CiAgICAgICAgICAgIGJ0bi5zdHlsZS5vcGFjaXR5ID0gJzEnOwogICAgICAgICAgICBidG4uc3R5bGUucG9pbnRlckV2ZW50cyA9ICdhdXRvJzsKICAgICAgICAgICAgYnRuLnN0eWxlLmZpbHRlciA9ICdub25lJzsKICAgICAgICB9KTsKICAgICAgICBjb25zdCBzZWFyY2hJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZWFyY2hJbnB1dCcpOwogICAgICAgIGlmIChzZWFyY2hJbnB1dCkgeyBzZWFyY2hJbnB1dC5kaXNhYmxlZCA9IGZhbHNlOyBzZWFyY2hJbnB1dC5wbGFjZWhvbGRlciA9ICLEsMOnZXJpa2xlcmRlIGjEsXpsxLEgYXJhLi4uIjsgc2VhcmNoSW5wdXQuc3R5bGUub3BhY2l0eSA9ICcxJzsgfQogICAgfQogICAgCiAgICBpZihpc0FkbWluTW9kZSkgewogICAgICAgIGlmKGFkZENhcmREcm9wZG93bikgYWRkQ2FyZERyb3Bkb3duLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7CiAgICAgICAgaWYocXVpY2tFZGl0RHJvcGRvd24pIHsKICAgICAgICAgICAgcXVpY2tFZGl0RHJvcGRvd24uc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKICAgICAgICAgICAgcXVpY2tFZGl0RHJvcGRvd24uaW5uZXJIVE1MID0gJzxpIGNsYXNzPSJmYXMgZmEtcGVuIiBzdHlsZT0iY29sb3I6dmFyKC0tc2Vjb25kYXJ5KTsiPjwvaT4gRMO8emVubGVtZXlpIEHDpyc7CiAgICAgICAgICAgIHF1aWNrRWRpdERyb3Bkb3duLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgICAgaWYoYWRkQ2FyZERyb3Bkb3duKSBhZGRDYXJkRHJvcGRvd24uc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICBpZihxdWlja0VkaXREcm9wZG93bikgcXVpY2tFZGl0RHJvcGRvd24uc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgIH0KfQpmdW5jdGlvbiBsb2dvdXQoKSB7CiAgICBjdXJyZW50VXNlciA9ICIiOyBpc0FkbWluTW9kZSA9IGZhbHNlOyBpc0VkaXRpbmdBY3RpdmUgPSBmYWxzZTsKICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnJlbW92ZSgnZWRpdGluZycpOwogICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oInNTcG9ydFVzZXIiKTsgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oInNTcG9ydFRva2VuIik7IGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCJzU3BvcnRSb2xlIik7CiAgICBpZiAoc2Vzc2lvblRpbWVvdXQpIGNsZWFyVGltZW91dChzZXNzaW9uVGltZW91dCk7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibWFpbi1hcHAiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxvZ2luLXNjcmVlbiIpLnN0eWxlLmRpc3BsYXkgPSAiZmxleCI7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicGFzc0lucHV0IikudmFsdWUgPSAiIjsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1c2VybmFtZUlucHV0IikudmFsdWUgPSAiIjsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlcnJvci1tc2ciKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgCiAgICAvLyBGdWxsc2NyZWVuJ2kga2FwYXQKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWFsaXR5LWZ1bGxzY3JlZW4nKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwp9CmZ1bmN0aW9uIHN0YXJ0U2Vzc2lvblRpbWVyKCkgewogICAgaWYgKHNlc3Npb25UaW1lb3V0KSBjbGVhclRpbWVvdXQoc2Vzc2lvblRpbWVvdXQpOwogICAgLy8gOCBzYWF0ICgyODgwMDAwMCBtcykKICAgIHNlc3Npb25UaW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgU3dhbC5maXJlKHsgaWNvbjogJ3dhcm5pbmcnLCB0aXRsZTogJ090dXJ1bSBTw7xyZXNpIERvbGR1JywgdGV4dDogJ0fDvHZlbmxpayBuZWRlbml5bGUgb3RvbWF0aWsgw6fEsWvEscWfIHlhcMSxbGTEsS4nLCBjb25maXJtQnV0dG9uVGV4dDogJ1RhbWFtJyB9KS50aGVuKCgpID0+IHsgbG9nb3V0KCk7IH0pOwogICAgfSwgIDI4ODAwMDAwKTsgCn0KZnVuY3Rpb24gb3BlblVzZXJNZW51KCkgeyB0b2dnbGVVc2VyRHJvcGRvd24oKTsgfQphc3luYyBmdW5jdGlvbiBjaGFuZ2VQYXNzd29yZFBvcHVwKGlzTWFuZGF0b3J5ID0gZmFsc2UpIHsKICAgIGNvbnN0IHsgdmFsdWU6IGZvcm1WYWx1ZXMgfSA9IGF3YWl0IFN3YWwuZmlyZSh7CiAgICAgICAgdGl0bGU6IGlzTWFuZGF0b3J5ID8gJ1llbmkgxZ5pZnJlIEJlbGlybGV5aW4nIDogJ8WeaWZyZSBEZcSfacWfdGlyJywKICAgICAgICBodG1sOiBgJHtpc01hbmRhdG9yeSA/ICc8cCBzdHlsZT0iZm9udC1zaXplOjAuOXJlbTsgY29sb3I6I2QzMmYyZjsiPsSwbGsgZ2lyacWfIMWfaWZyZW5pemkgZGXEn2nFn3Rpcm1lZGVuIGRldmFtIGVkZW1lenNpbml6LjwvcD4nIDogJyd9PGlucHV0IGlkPSJzd2FsLW9sZC1wYXNzIiB0eXBlPSJwYXNzd29yZCIgY2xhc3M9InN3YWwyLWlucHV0IiBwbGFjZWhvbGRlcj0iRXNraSDFnmlmcmUgKE1ldmN1dCkiPjxpbnB1dCBpZD0ic3dhbC1uZXctcGFzcyIgdHlwZT0icGFzc3dvcmQiIGNsYXNzPSJzd2FsMi1pbnB1dCIgcGxhY2Vob2xkZXI9IlllbmkgxZ5pZnJlIj5gLAogICAgICAgIGZvY3VzQ29uZmlybTogZmFsc2UsIHNob3dDYW5jZWxCdXR0b246ICFpc01hbmRhdG9yeSwgYWxsb3dPdXRzaWRlQ2xpY2s6ICFpc01hbmRhdG9yeSwgYWxsb3dFc2NhcGVLZXk6ICFpc01hbmRhdG9yeSwKICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogJ0RlxJ9pxZ90aXInLCBjYW5jZWxCdXR0b25UZXh0OiAnxLBwdGFsJywKICAgICAgICBwcmVDb25maXJtOiAoKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IG8gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC1vbGQtcGFzcycpLnZhbHVlOwogICAgICAgICAgICBjb25zdCBuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N3YWwtbmV3LXBhc3MnKS52YWx1ZTsKICAgICAgICAgICAgaWYoIW8gfHwgIW4pIHsgU3dhbC5zaG93VmFsaWRhdGlvbk1lc3NhZ2UoJ0FsYW5sYXIgYm/FnyBixLFyYWvEsWxhbWF6Jyk7IH0KICAgICAgICAgICAgcmV0dXJuIFsgbywgbiBdCiAgICAgICAgfQogICAgfSk7CiAgICBpZiAoZm9ybVZhbHVlcykgewogICAgICAgIFN3YWwuZmlyZSh7IHRpdGxlOiAnxLDFn2xlbml5b3IuLi4nLCBkaWRPcGVuOiAoKSA9PiB7IFN3YWwuc2hvd0xvYWRpbmcoKSB9IH0pOwogICAgICAgIGZldGNoKFNDUklQVF9VUkwsIHsKICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsCiAgICAgICAgICAgIGhlYWRlcnM6IHsgIkNvbnRlbnQtVHlwZSI6ICJ0ZXh0L3BsYWluO2NoYXJzZXQ9dXRmLTgiIH0sCiAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsKICAgICAgICAgICAgICAgIGFjdGlvbjogImNoYW5nZVBhc3N3b3JkIiwgdXNlcm5hbWU6IGN1cnJlbnRVc2VyLAogICAgICAgICAgICAgICAgb2xkUGFzczogQ3J5cHRvSlMuU0hBMjU2KGZvcm1WYWx1ZXNbMF0pLnRvU3RyaW5nKCksCiAgICAgICAgICAgICAgICBuZXdQYXNzOiBDcnlwdG9KUy5TSEEyNTYoZm9ybVZhbHVlc1sxXSkudG9TdHJpbmcoKSwKICAgICAgICAgICAgICAgIHRva2VuOiBnZXRUb2tlbigpCiAgICAgICAgICAgIH0pCiAgICAgICAgfSkudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpLnRoZW4oZGF0YSA9PiB7CiAgICAgICAgICAgIGlmKGRhdGEucmVzdWx0ID09PSAic3VjY2VzcyIpIHsKICAgICAgICAgICAgICAgIFN3YWwuZmlyZSgnQmHFn2FyxLFsxLEhJywgJ8WeaWZyZW5peiBnw7xuY2VsbGVuZGkuIFllbmlkZW4gZ2lyacWfIHlhcMSxbsSxei4nLCAnc3VjY2VzcycpLnRoZW4oKCkgPT4geyBsb2dvdXQoKTsgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBTd2FsLmZpcmUoJ0hhdGEnLCBkYXRhLm1lc3NhZ2UgfHwgJ8SwxZ9sZW0gYmHFn2FyxLFzxLF6LicsICdlcnJvcicpLnRoZW4oKCkgPT4geyBpZihpc01hbmRhdG9yeSkgY2hhbmdlUGFzc3dvcmRQb3B1cCh0cnVlKTsgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KS5jYXRjaChlcnIgPT4geyBTd2FsLmZpcmUoJ0hhdGEnLCAnU3VudWN1IGhhdGFzxLEuJywgJ2Vycm9yJyk7IGlmKGlzTWFuZGF0b3J5KSBjaGFuZ2VQYXNzd29yZFBvcHVwKHRydWUpOyB9KTsKICAgIH0gZWxzZSBpZiAoaXNNYW5kYXRvcnkpIHsgY2hhbmdlUGFzc3dvcmRQb3B1cCh0cnVlKTsgfQp9Ci8vIC0tLSBEQVRBIEZFVENISU5HIC0tLQpmdW5jdGlvbiBsb2FkQ29udGVudERhdGEoKSB7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZycpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgZmV0Y2goU0NSSVBUX1VSTCwgewogICAgICAgIG1ldGhvZDogJ1BPU1QnLAogICAgICAgIGhlYWRlcnM6IHsgIkNvbnRlbnQtVHlwZSI6ICJ0ZXh0L3BsYWluO2NoYXJzZXQ9dXRmLTgiIH0sCiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBhY3Rpb246ICJmZXRjaERhdGEiIH0pCiAgICB9KS50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLmpzb24oKSkudGhlbihkYXRhID0+IHsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZycpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgaWYgKGRhdGEucmVzdWx0ID09PSAic3VjY2VzcyIpIHsKICAgICAgICAgICAgY29uc3QgcmF3RGF0YSA9IGRhdGEuZGF0YTsKICAgICAgICAgICAgZGF0YWJhc2UgPSByYXdEYXRhLmZpbHRlcihpID0+IFsnY2FyZCcsJ2JpbGdpJywndGVrbmlrJywna2FtcGFueWEnLCdpa25hJ10uaW5jbHVkZXMoaS5UeXBlLnRvTG93ZXJDYXNlKCkpKS5tYXAoaSA9PiAoewogICAgICAgICAgICAgICAgdGl0bGU6IGkuVGl0bGUsIGNhdGVnb3J5OiBpLkNhdGVnb3J5LCB0ZXh0OiBpLlRleHQsIHNjcmlwdDogaS5TY3JpcHQsIGNvZGU6IGkuQ29kZSwgbGluazogaS5MaW5rLCBkYXRlOiBmb3JtYXREYXRlVG9ERE1NWVlZWShpLkRhdGUpCiAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgLy8gWWVuaSBla2xlbmVubGVyaSDDvHN0dGUgZ8O2c3Rlcm1layBpw6dpbiB0YXJpaGUgZ8O2cmUgKGF6YWxhbikgc8SxcmFsYQogICAgICAgICAgICBkYXRhYmFzZS5zb3J0KChhLGIpID0+IHBhcnNlRGF0ZVRSVG9UUyhiLmRhdGUpIC0gcGFyc2VEYXRlVFJUb1RTKGEuZGF0ZSkpOwogICAgICAgICAgICBuZXdzRGF0YSA9IHJhd0RhdGEuZmlsdGVyKGkgPT4gaS5UeXBlLnRvTG93ZXJDYXNlKCkgPT09ICduZXdzJykubWFwKGkgPT4gKHsKICAgICAgICAgICAgICAgIGRhdGU6IGZvcm1hdERhdGVUb0RETU1ZWVlZKGkuRGF0ZSksIHRpdGxlOiBpLlRpdGxlLCBkZXNjOiBpLlRleHQsIHR5cGU6IGkuQ2F0ZWdvcnksIHN0YXR1czogaS5TdGF0dXMKICAgICAgICAgICAgfSkpOwogICAgICAgICAgICBzcG9ydHNEYXRhID0gcmF3RGF0YS5maWx0ZXIoaSA9PiBpLlR5cGUudG9Mb3dlckNhc2UoKSA9PT0gJ3Nwb3J0JykubWFwKGkgPT4gKHsKICAgICAgICAgICAgICAgIHRpdGxlOiBpLlRpdGxlLCBpY29uOiBpLkljb24sIGRlc2M6IGkuVGV4dCwgdGlwOiBpLlRpcCwgZGV0YWlsOiBpLkRldGFpbCwgcHJvbnVuY2lhdGlvbjogaS5Qcm9udW5jaWF0aW9uCiAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgc2FsZXNTY3JpcHRzID0gcmF3RGF0YS5maWx0ZXIoaSA9PiBpLlR5cGUudG9Mb3dlckNhc2UoKSA9PT0gJ3NhbGVzJykubWFwKGkgPT4gKHsgdGl0bGU6IGkuVGl0bGUsIHRleHQ6IGkuVGV4dCB9KSk7CiAgICAgICAgICAgIHF1aXpRdWVzdGlvbnMgPSByYXdEYXRhLmZpbHRlcihpID0+IGkuVHlwZS50b0xvd2VyQ2FzZSgpID09PSAncXVpeicpLm1hcChpID0+ICh7CiAgICAgICAgICAgICAgICBxOiBpLlRleHQsIG9wdHM6IGkuUXVpek9wdGlvbnMgPyBpLlF1aXpPcHRpb25zLnNwbGl0KCcsJykubWFwKG8gPT4gby50cmltKCkpIDogW10sIGE6IHBhcnNlSW50KGkuUXVpekFuc3dlcikKICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAvLyBIxLF6bMSxIEthcmFyIHNvcnVsYXLEsSAoR29vZ2xlIFNoZWV0J3Rlbik6IFR5cGUgPSBxdWlja2RlY2lzaW9uCiAgICAgICAgICAgIC8vIEJla2xlbmVuOiBUZXh0IHwgUXVpek9wdGlvbnMgKHwgaWxlIGF5csSxbG3EscWfKSB8IFF1aXpBbnN3ZXIgKDAtYmFzZWQgaW5kZXgpIHwgRGV0YWlsIChvcHNpeW9uZWwpCiAgICAgICAgICAgIHF1aWNrRGVjaXNpb25RdWVzdGlvbnMgPSByYXdEYXRhCiAgICAgICAgICAgICAgICAuZmlsdGVyKGkgPT4gKGkuVHlwZSB8fCAnJykudG9Mb3dlckNhc2UoKSA9PT0gJ3F1aWNrZGVjaXNpb24nKQogICAgICAgICAgICAgICAgLm1hcChpID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBvcHRzID0gU3RyaW5nKGkuUXVpek9wdGlvbnMgfHwgJycpLnNwbGl0KCd8JykubWFwKHggPT4geC50cmltKCkpLmZpbHRlcihCb29sZWFuKTsKICAgICAgICAgICAgICAgICAgICBsZXQgYSA9IHBhcnNlSW50KGkuUXVpekFuc3dlciwgMTApOwogICAgICAgICAgICAgICAgICAgIGlmIChpc05hTihhKSkgYSA9IDA7CiAgICAgICAgICAgICAgICAgICAgaWYgKGEgPCAwKSBhID0gMDsKICAgICAgICAgICAgICAgICAgICBpZiAob3B0cy5sZW5ndGggJiYgYSA+PSBvcHRzLmxlbmd0aCkgYSA9IG9wdHMubGVuZ3RoIC0gMTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBleHAgPSAoaS5EZXRhaWwgfHwgJycpLnRvU3RyaW5nKCkudHJpbSgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB7IHE6IChpLlRleHQgfHwgJycpLnRvU3RyaW5nKCkudHJpbSgpLCBvcHRzLCBhLCBleHAgfTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAuZmlsdGVyKHggPT4geC5xICYmIEFycmF5LmlzQXJyYXkoeC5vcHRzKSAmJiB4Lm9wdHMubGVuZ3RoID49IDIpOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmKGN1cnJlbnRDYXRlZ29yeSA9PT0gJ2ZhdicpIHsgZmlsdGVyQ2F0ZWdvcnkoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJ0bi1mYXYnKSwgJ2ZhdicpOyB9IAogICAgICAgICAgICBlbHNlIHsgYWN0aXZlQ2FyZHMgPSBkYXRhYmFzZTsgcmVuZGVyQ2FyZHMoZGF0YWJhc2UpOyB9CiAgICAgICAgICAgIHN0YXJ0VGlja2VyKCk7CiAgICAgICAgICAgIHRyeSB7IHVwZGF0ZVNlYXJjaFJlc3VsdENvdW50KGFjdGl2ZUNhcmRzLmxlbmd0aCB8fCBkYXRhYmFzZS5sZW5ndGgsIGRhdGFiYXNlLmxlbmd0aCk7IH0gY2F0Y2goZSkge30KICAgICAgICB9IGVsc2UgeyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZycpLmlubmVySFRNTCA9IGBWZXJpbGVyIGFsxLFuYW1hZMSxOiAke2RhdGEubWVzc2FnZSB8fCAnQmlsaW5tZXllbiBIYXRhJ31gOyB9CiAgICB9KS5jYXRjaChlcnJvciA9PiB7IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nJykuaW5uZXJIVE1MID0gJ0JhxJ9sYW50xLEgSGF0YXPEsSEgU3VudWN1eWEgdWxhxZ/EsWxhbcSxeW9yLic7IH0pOwp9CmZ1bmN0aW9uIGxvYWRXaXphcmREYXRhKCkgewogICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgICBmZXRjaChTQ1JJUFRfVVJMLCB7CiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLCBoZWFkZXJzOiB7ICJDb250ZW50LVR5cGUiOiAidGV4dC9wbGFpbjtjaGFyc2V0PXV0Zi04IiB9LAogICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGFjdGlvbjogImdldFdpemFyZERhdGEiIH0pCiAgICAgICAgfSkudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpLnRoZW4oZGF0YSA9PiB7CiAgICAgICAgICAgIGlmIChkYXRhLnJlc3VsdCA9PT0gInN1Y2Nlc3MiICYmIGRhdGEuc3RlcHMpIHsgd2l6YXJkU3RlcHNEYXRhID0gZGF0YS5zdGVwczsgcmVzb2x2ZSgpOyB9IAogICAgICAgICAgICBlbHNlIHsgd2l6YXJkU3RlcHNEYXRhID0ge307IHJlamVjdChuZXcgRXJyb3IoIldpemFyZCB2ZXJpc2kgecO8a2xlbmVtZWRpLiIpKTsgfQogICAgICAgIH0pLmNhdGNoKGVycm9yID0+IHsgd2l6YXJkU3RlcHNEYXRhID0ge307IHJlamVjdChlcnJvcik7IH0pOwogICAgfSk7Cn0KZnVuY3Rpb24gbG9hZFRlY2hXaXphcmREYXRhKCkgewogICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgICBmZXRjaChTQ1JJUFRfVVJMLCB7CiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLCBoZWFkZXJzOiB7ICJDb250ZW50LVR5cGUiOiAidGV4dC9wbGFpbjtjaGFyc2V0PXV0Zi04IiB9LAogICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGFjdGlvbjogImdldFRlY2hXaXphcmREYXRhIiB9KQogICAgICAgIH0pLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuanNvbigpKS50aGVuKGRhdGEgPT4gewogICAgICAgICAgICBpZiAoZGF0YS5yZXN1bHQgPT09ICJzdWNjZXNzIiAmJiBkYXRhLnN0ZXBzKSB7IHRlY2hXaXphcmREYXRhID0gZGF0YS5zdGVwczsgcmVzb2x2ZSgpOyB9IAogICAgICAgICAgICBlbHNlIHsgdGVjaFdpemFyZERhdGEgPSB7fTsgfQogICAgICAgIH0pLmNhdGNoKGVycm9yID0+IHsgdGVjaFdpemFyZERhdGEgPSB7fTsgfSk7CiAgICB9KTsKfQovLyAtLS0gUkVOREVSICYgRklMVEVSSU5HIC0tLQpmdW5jdGlvbiByZW5kZXJDYXJkcyhkYXRhKSB7CiAgICBhY3RpdmVDYXJkcyA9IGRhdGE7CiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FyZEdyaWQnKTsKICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSAnJzsKICAgIAogICAgaWYgKGRhdGEubGVuZ3RoID09PSAwKSB7IGNvbnRhaW5lci5pbm5lckhUTUwgPSAnPGRpdiBzdHlsZT0iZ3JpZC1jb2x1bW46MS8tMTsgdGV4dC1hbGlnbjpjZW50ZXI7IHBhZGRpbmc6MjBweDsgY29sb3I6Izc3NzsiPkthecSxdCBidWx1bmFtYWTEsS48L2Rpdj4nOyByZXR1cm47IH0KICAgIGRhdGEuZm9yRWFjaCgoaXRlbSwgaW5kZXgpID0+IHsKICAgICAgICBjb25zdCBzYWZlVGl0bGUgPSBlc2NhcGVGb3JKc1N0cmluZyhpdGVtLnRpdGxlKTsKICAgICAgICBjb25zdCBpc0Zhdm9yaXRlID0gaXNGYXYoaXRlbS50aXRsZSk7CiAgICAgICAgY29uc3QgZmF2Q2xhc3MgPSBpc0Zhdm9yaXRlID8gJ2ZhcyBmYS1zdGFyIGFjdGl2ZScgOiAnZmFyIGZhLXN0YXInOwogICAgICAgIGNvbnN0IG5ld0JhZGdlID0gaXNOZXcoaXRlbS5kYXRlKSA/ICc8c3BhbiBjbGFzcz0ibmV3LWJhZGdlIj5ZRU7EsDwvc3Bhbj4nIDogJyc7CiAgICAgICAgY29uc3QgZWRpdEljb25IdG1sID0gKGlzQWRtaW5Nb2RlICYmIGlzRWRpdGluZ0FjdGl2ZSkgPyBgPGkgY2xhc3M9ImZhcyBmYS1wZW5jaWwtYWx0IGVkaXQtaWNvbiIgb25jbGljaz0iZWRpdENvbnRlbnQoJHtpbmRleH0pIiBzdHlsZT0iZGlzcGxheTpibG9jazsiPjwvaT5gIDogJyc7CiAgICAgICAgbGV0IGZvcm1hdHRlZFRleHQgPSAoaXRlbS50ZXh0IHx8ICIiKS5yZXBsYWNlKC9cbi9nLCAnPGJyPicpLnJlcGxhY2UoL1wqKC4qPylcKi9nLCAnPGI+JDE8L2I+Jyk7CiAgICAgICAgCiAgICAgICAgY29udGFpbmVyLmlubmVySFRNTCArPSBgPGRpdiBjbGFzcz0iY2FyZCAke2l0ZW0uY2F0ZWdvcnl9Ij4ke25ld0JhZGdlfQogICAgICAgICAgICA8ZGl2IGNsYXNzPSJpY29uLXdyYXBwZXIiPiR7ZWRpdEljb25IdG1sfTxpIGNsYXNzPSIke2ZhdkNsYXNzfSBmYXYtaWNvbiIgb25jbGljaz0idG9nZ2xlRmF2b3JpdGUoJyR7c2FmZVRpdGxlfScpIj48L2k+PC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNhcmQtaGVhZGVyIj48aDMgY2xhc3M9ImNhcmQtdGl0bGUiPiR7aGlnaGxpZ2h0VGV4dChpdGVtLnRpdGxlKX08L2gzPjxzcGFuIGNsYXNzPSJiYWRnZSI+JHtpdGVtLmNhdGVnb3J5fTwvc3Bhbj48L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2FyZC1jb250ZW50IiBvbmNsaWNrPSJzaG93Q2FyZERldGFpbCgnJHtzYWZlVGl0bGV9JywgJyR7ZXNjYXBlRm9ySnNTdHJpbmcoaXRlbS50ZXh0KX0nKSI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjYXJkLXRleHQtdHJ1bmNhdGUiPiR7aGlnaGxpZ2h0VGV4dChmb3JtYXR0ZWRUZXh0KX08L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjhyZW07IGNvbG9yOiM5OTk7IG1hcmdpbi10b3A6NXB4OyB0ZXh0LWFsaWduOnJpZ2h0OyI+KFRhbWFtxLFuxLEgb2t1KTwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2NyaXB0LWJveCI+JHtoaWdobGlnaHRUZXh0KGl0ZW0uc2NyaXB0KX08L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2FyZC1hY3Rpb25zIj4KICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJ0biBidG4tY29weSIgb25jbGljaz0iY29weVRleHQoJyR7ZXNjYXBlRm9ySnNTdHJpbmcoaXRlbS5zY3JpcHQpfScpIj48aSBjbGFzcz0iZmFzIGZhLWNvcHkiPjwvaT4gS29weWFsYTwvYnV0dG9uPgogICAgICAgICAgICAgICAgJHtpdGVtLmNvZGUgPyBgPGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1jb3B5IiBzdHlsZT0iYmFja2dyb3VuZDp2YXIoLS1zZWNvbmRhcnkpOyBjb2xvcjojMzMzOyIgb25jbGljaz0iY29weVRleHQoJyR7ZXNjYXBlRm9ySnNTdHJpbmcoaXRlbS5jb2RlKX0nKSI+S29kPC9idXR0b24+YCA6ICcnfQogICAgICAgICAgICAgICAgJHtpdGVtLmxpbmsgPyBgPGEgaHJlZj0iJHtpdGVtLmxpbmt9IiB0YXJnZXQ9Il9ibGFuayIgY2xhc3M9ImJ0biBidG4tbGluayI+PGkgY2xhc3M9ImZhcyBmYS1leHRlcm5hbC1saW5rLWFsdCI+PC9pPiBMaW5rPC9hPmAgOiAnJ30KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+YDsKICAgIH0pOwp9CmZ1bmN0aW9uIGhpZ2hsaWdodFRleHQoaHRtbENvbnRlbnQpIHsKICAgIGlmICghaHRtbENvbnRlbnQpIHJldHVybiAiIjsKICAgIGNvbnN0IHNlYXJjaFRlcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VhcmNoSW5wdXQnKS52YWx1ZS50b0xvY2FsZUxvd2VyQ2FzZSgndHItVFInKS50cmltKCk7CiAgICBpZiAoIXNlYXJjaFRlcm0pIHJldHVybiBodG1sQ29udGVudDsKICAgIHRyeSB7IGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChgKCR7c2VhcmNoVGVybX0pYCwgImdpIik7IHJldHVybiBodG1sQ29udGVudC50b1N0cmluZygpLnJlcGxhY2UocmVnZXgsICc8c3BhbiBjbGFzcz0iaGlnaGxpZ2h0Ij4kMTwvc3Bhbj4nKTsgfSBjYXRjaChlKSB7IHJldHVybiBodG1sQ29udGVudDsgfQp9CgpmdW5jdGlvbiB1cGRhdGVTZWFyY2hSZXN1bHRDb3VudChjb3VudCwgdG90YWwpIHsKICAgIGNvbnN0IGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlYXJjaFJlc3VsdENvdW50Jyk7CiAgICBpZighZWwpIHJldHVybjsKICAgIC8vIHNhZGVjZSBhcmFtYSB5YXrEsWxkxLHEn8SxbmRhIHZleWEgZmlsdHJlIGZhdi90ZWtpbCBzZcOnaWxkacSfaW5kZSBnw7ZzdGVyCiAgICBjb25zdCBzZWFyY2ggPSAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlYXJjaElucHV0Jyk/LnZhbHVlIHx8ICcnKS50cmltKCk7CiAgICBjb25zdCBzaG93ID0gISFzZWFyY2ggfHwgKGN1cnJlbnRDYXRlZ29yeSAmJiBjdXJyZW50Q2F0ZWdvcnkgIT09ICdhbGwnKTsKICAgIGlmKCFzaG93KSB7IGVsLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7IGVsLmlubmVyVGV4dCA9ICcnOyByZXR1cm47IH0KICAgIGVsLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgZWwuaW5uZXJUZXh0ID0gYPCflI4gJHtjb3VudH0gc29udcOnJHt0b3RhbCAhPSBudWxsID8gJyAvICcgKyB0b3RhbCA6ICcnfWA7Cn0KCgoKZnVuY3Rpb24gZmlsdGVyQ2F0ZWdvcnkoYnRuLCBjYXQpIHsKICAgIGN1cnJlbnRDYXRlZ29yeSA9IGNhdDsKICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5maWx0ZXItYnRuJykuZm9yRWFjaChiID0+IGIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykpOwogICAgYnRuLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgZmlsdGVyQ29udGVudCgpOwp9CmZ1bmN0aW9uIGZpbHRlckNvbnRlbnQoKSB7CiAgICBjb25zdCBzZWFyY2ggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VhcmNoSW5wdXQnKS52YWx1ZS50b0xvY2FsZUxvd2VyQ2FzZSgndHItVFInKS50cmltKCk7CiAgICBsZXQgZmlsdGVyZWQgPSBkYXRhYmFzZTsKICAgIGlmIChjdXJyZW50Q2F0ZWdvcnkgPT09ICdmYXYnKSB7IGZpbHRlcmVkID0gZmlsdGVyZWQuZmlsdGVyKGkgPT4gaXNGYXYoaS50aXRsZSkpOyB9IAogICAgZWxzZSBpZiAoY3VycmVudENhdGVnb3J5ICE9PSAnYWxsJykgeyBmaWx0ZXJlZCA9IGZpbHRlcmVkLmZpbHRlcihpID0+IGkuY2F0ZWdvcnkgPT09IGN1cnJlbnRDYXRlZ29yeSk7IH0KICAgIAogICAgaWYgKHNlYXJjaCkgewogICAgICAgIGZpbHRlcmVkID0gZmlsdGVyZWQuZmlsdGVyKGl0ZW0gPT4gewogICAgICAgICAgICBjb25zdCB0aXRsZSA9IChpdGVtLnRpdGxlIHx8ICIiKS50b1N0cmluZygpLnRvTG9jYWxlTG93ZXJDYXNlKCd0ci1UUicpOwogICAgICAgICAgICBjb25zdCB0ZXh0ID0gKGl0ZW0udGV4dCB8fCAiIikudG9TdHJpbmcoKS50b0xvY2FsZUxvd2VyQ2FzZSgndHItVFInKTsKICAgICAgICAgICAgY29uc3Qgc2NyaXB0ID0gKGl0ZW0uc2NyaXB0IHx8ICIiKS50b1N0cmluZygpLnRvTG9jYWxlTG93ZXJDYXNlKCd0ci1UUicpOwogICAgICAgICAgICBjb25zdCBjb2RlID0gKGl0ZW0uY29kZSB8fCAiIikudG9TdHJpbmcoKS50b0xvY2FsZUxvd2VyQ2FzZSgndHItVFInKTsKICAgICAgICAgICAgcmV0dXJuIHRpdGxlLmluY2x1ZGVzKHNlYXJjaCkgfHwgdGV4dC5pbmNsdWRlcyhzZWFyY2gpIHx8IHNjcmlwdC5pbmNsdWRlcyhzZWFyY2gpIHx8IGNvZGUuaW5jbHVkZXMoc2VhcmNoKTsKICAgICAgICB9KTsKICAgIH0KICAgIGFjdGl2ZUNhcmRzID0gZmlsdGVyZWQ7CiAgICB1cGRhdGVTZWFyY2hSZXN1bHRDb3VudChmaWx0ZXJlZC5sZW5ndGgsIGRhdGFiYXNlLmxlbmd0aCk7CiAgICByZW5kZXJDYXJkcyhmaWx0ZXJlZCk7Cn0KZnVuY3Rpb24gc2hvd0NhcmREZXRhaWwodGl0bGUsIHRleHQpIHsKICAgIFN3YWwuZmlyZSh7CiAgICAgICAgdGl0bGU6IHRpdGxlLCBodG1sOiBgPGRpdiBzdHlsZT0idGV4dC1hbGlnbjpsZWZ0OyBmb250LXNpemU6MXJlbTsgbGluZS1oZWlnaHQ6MS42OyI+JHt0ZXh0LnJlcGxhY2UoL1xcbi9nLCc8YnI+Jyl9PC9kaXY+YCwKICAgICAgICBzaG93Q2xvc2VCdXR0b246IHRydWUsIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwgd2lkdGg6ICc2MDBweCcsIGJhY2tncm91bmQ6ICcjZjhmOWZhJwogICAgfSk7Cn0KZnVuY3Rpb24gdG9nZ2xlRWRpdE1vZGUoKSB7CiAgICBpZiAoIWlzQWRtaW5Nb2RlKSByZXR1cm47CiAgICBpc0VkaXRpbmdBY3RpdmUgPSAhaXNFZGl0aW5nQWN0aXZlOwogICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QudG9nZ2xlKCdlZGl0aW5nJywgaXNFZGl0aW5nQWN0aXZlKTsKICAgIAogICAgY29uc3QgYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Ryb3Bkb3duUXVpY2tFZGl0Jyk7CiAgICBpZihpc0VkaXRpbmdBY3RpdmUpIHsKICAgICAgICBidG4uY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICAgICAgYnRuLmlubmVySFRNTCA9ICc8aSBjbGFzcz0iZmFzIGZhLXRpbWVzIiBzdHlsZT0iY29sb3I6dmFyKC0tYWNjZW50KTsiPjwvaT4gRMO8emVubGVtZXlpIEthcGF0JzsKICAgICAgICBTd2FsLmZpcmUoeyBpY29uOiAnc3VjY2VzcycsIHRpdGxlOiAnRMO8emVubGVtZSBNb2R1IEHDh0lLJywgdGV4dDogJ0thbGVtIGlrb25sYXLEsW5hIHTEsWtsYXlhcmFrIGnDp2VyaWtsZXJpIGTDvHplbmxleWViaWxpcnNpbml6LicsIHRpbWVyOiAxNTAwLCBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UgfSk7CiAgICB9IGVsc2UgewogICAgICAgIGJ0bi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICBidG4uaW5uZXJIVE1MID0gJzxpIGNsYXNzPSJmYXMgZmEtcGVuIiBzdHlsZT0iY29sb3I6dmFyKC0tc2Vjb25kYXJ5KTsiPjwvaT4gRMO8emVubGVtZXlpIEHDpyc7CiAgICB9CiAgICBmaWx0ZXJDb250ZW50KCk7CiAgICBpZihkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3VpZGUtbW9kYWwnKS5zdHlsZS5kaXNwbGF5ID09PSAnZmxleCcpIG9wZW5HdWlkZSgpOwogICAgaWYoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NhbGVzLW1vZGFsJykuc3R5bGUuZGlzcGxheSA9PT0gJ2ZsZXgnKSBvcGVuU2FsZXMoKTsKICAgIGlmKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZXdzLW1vZGFsJykuc3R5bGUuZGlzcGxheSA9PT0gJ2ZsZXgnKSBvcGVuTmV3cygpOwp9CmZ1bmN0aW9uIHNlbmRVcGRhdGUobywgYywgdiwgdD0nY2FyZCcpIHsKICAgIGlmICghU3dhbC5pc1Zpc2libGUoKSkgU3dhbC5maXJlKHsgdGl0bGU6ICdLYXlkZWRpbGl5b3IuLi4nLCBkaWRPcGVuOiAoKSA9PiB7IFN3YWwuc2hvd0xvYWRpbmcoKSB9IH0pOwogICAgZmV0Y2goU0NSSVBUX1VSTCwgewogICAgICAgIG1ldGhvZDogJ1BPU1QnLCBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAndGV4dC9wbGFpbjtjaGFyc2V0PXV0Zi04JyB9LAogICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgYWN0aW9uOiAidXBkYXRlQ29udGVudCIsIHRpdGxlOiBvLCBjb2x1bW46IGMsIHZhbHVlOiB2LCB0eXBlOiB0LCBvcmlnaW5hbFRleHQ6IG8sIHVzZXJuYW1lOiBjdXJyZW50VXNlciwgdG9rZW46IGdldFRva2VuKCkgfSkKICAgIH0pLnRoZW4ociA9PiByLmpzb24oKSkudGhlbihkYXRhID0+IHsKICAgICAgICBpZiAoZGF0YS5yZXN1bHQgPT09ICJzdWNjZXNzIikgewogICAgICAgICAgICBTd2FsLmZpcmUoe2ljb246ICdzdWNjZXNzJywgdGl0bGU6ICdCYcWfYXLEsWzEsScsIHRpbWVyOiAxNTAwLCBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2V9KTsKICAgICAgICAgICAgc2V0VGltZW91dChsb2FkQ29udGVudERhdGEsIDE2MDApOwogICAgICAgIH0gZWxzZSB7IFN3YWwuZmlyZSgnSGF0YScsICdLYXlkZWRpbGVtZWRpOiAnICsgKGRhdGEubWVzc2FnZSB8fCAnQmlsaW5tZXllbiBIYXRhJyksICdlcnJvcicpOyB9CiAgICB9KS5jYXRjaChlcnIgPT4gU3dhbC5maXJlKCdIYXRhJywgJ1N1bnVjdSBoYXRhc8SxLicsICdlcnJvcicpKTsKfQovLyAtLS0gQ1JVRCBPUEVSQVNZT05MQVJJIChBRE1JTikgLS0tCmFzeW5jIGZ1bmN0aW9uIGFkZE5ld0NhcmRQb3B1cCgpIHsKICAgIGNvbnN0IGNhdFNlbGVjdEhUTUwgPSBnZXRDYXRlZ29yeVNlbGVjdEh0bWwoJ0JpbGdpJywgJ3N3YWwtbmV3LWNhdCcpOwogICAgY29uc3QgeyB2YWx1ZTogZm9ybVZhbHVlcyB9ID0gYXdhaXQgU3dhbC5maXJlKHsKICAgICAgICB0aXRsZTogJ1llbmkgxLDDp2VyaWsgRWtsZScsCiAgICAgICAgaHRtbDogYAogICAgICAgIDxkaXYgc3R5bGU9Im1hcmdpbi1ib3R0b206MTVweDsgdGV4dC1hbGlnbjpsZWZ0OyI+CiAgICAgICAgICAgIDxsYWJlbCBzdHlsZT0iZm9udC13ZWlnaHQ6Ym9sZDsgZm9udC1zaXplOjAuOXJlbTsiPk5lIEVrbGV5ZWNla3Npbj88L2xhYmVsPgogICAgICAgICAgICA8c2VsZWN0IGlkPSJzd2FsLXR5cGUtc2VsZWN0IiBjbGFzcz0ic3dhbDItaW5wdXQiIHN0eWxlPSJ3aWR0aDoxMDAlOyBtYXJnaW4tdG9wOjVweDsgaGVpZ2h0OjM1cHg7IGZvbnQtc2l6ZTowLjlyZW07IiBvbmNoYW5nZT0idG9nZ2xlQWRkRmllbGRzKCkiPgogICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iY2FyZCI+IPCfk4wgIEJpbGdpIEthcnTEsTwvb3B0aW9uPgogICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0ibmV3cyI+IPCfk6IgIER1eXVydTwvb3B0aW9uPgogICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0ic2FsZXMiPiDwn5OeICBUZWxlc2F0xLHFnyBTY3JpcHRpPC9vcHRpb24+CiAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJzcG9ydCI+IPCfj4YgIFNwb3IgxLDDp2VyacSfaTwvb3B0aW9uPgogICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0icXVpeiI+IOKdkyAgUXVpeiBTb3J1c3U8L29wdGlvbj4KICAgICAgICAgICAgPC9zZWxlY3Q+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBpZD0icHJldmlldy1jYXJkIiBjbGFzcz0iY2FyZCBCaWxnaSIgc3R5bGU9InRleHQtYWxpZ246bGVmdDsgYm94LXNoYWRvdzpub25lOyBib3JkZXI6MXB4IHNvbGlkICNlMGUwZTA7IG1hcmdpbi10b3A6MTBweDsiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJjYXJkLWhlYWRlciIgc3R5bGU9ImFsaWduLWl0ZW1zOiBjZW50ZXI7IGdhcDogMTBweDsiPgogICAgICAgICAgICAgICAgPGlucHV0IGlkPSJzd2FsLW5ldy10aXRsZSIgY2xhc3M9InN3YWwyLWlucHV0IiBzdHlsZT0ibWFyZ2luOjA7IGhlaWdodDo0MHB4OyBmbGV4LWdyb3c6MTsgYm9yZGVyOm5vbmU7IGJvcmRlci1ib3R0b206MnB4IHNvbGlkICNlZWU7IHBhZGRpbmc6MCA1cHg7IGZvbnQtd2VpZ2h0OmJvbGQ7IGNvbG9yOiMwZTFiNDI7IiBwbGFjZWhvbGRlcj0iQmHFn2zEsWsgR2lyaW5pei4uLiI+CiAgICAgICAgICAgICAgICA8ZGl2IGlkPSJjYXQtY29udGFpbmVyIiBzdHlsZT0id2lkdGg6IDExMHB4OyI+JHtjYXRTZWxlY3RIVE1MfTwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2FyZC1jb250ZW50IiBzdHlsZT0ibWFyZ2luLWJvdHRvbToxMHB4OyI+CiAgICAgICAgICAgICAgICA8dGV4dGFyZWEgaWQ9InN3YWwtbmV3LXRleHQiIGNsYXNzPSJzd2FsMi10ZXh0YXJlYSIgc3R5bGU9Im1hcmdpbjowOyB3aWR0aDoxMDAlOyBib3gtc2l6aW5nOmJvcmRlci1ib3g7IGJvcmRlcjpub25lOyByZXNpemU6bm9uZTsgZm9udC1mYW1pbHk6aW5oZXJpdDsgbWluLWhlaWdodDoxMDBweDsgcGFkZGluZzoxMHB4OyBiYWNrZ3JvdW5kOiNmOWY5Zjk7IiBwbGFjZWhvbGRlcj0ixLDDp2VyaWsgbWV0bmkuLi4iPjwvdGV4dGFyZWE+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IGlkPSJzY3JpcHQtY29udGFpbmVyIiBjbGFzcz0ic2NyaXB0LWJveCIgc3R5bGU9InBhZGRpbmc6MDsgYm9yZGVyOjFweCBzb2xpZCAjZjBlNjhjOyI+CiAgICAgICAgICAgICAgICA8dGV4dGFyZWEgaWQ9InN3YWwtbmV3LXNjcmlwdCIgY2xhc3M9InN3YWwyLXRleHRhcmVhIiBzdHlsZT0ibWFyZ2luOjA7IHdpZHRoOjEwMCU7IGJveC1zaXppbmc6Ym9yZGVyLWJveDsgYm9yZGVyOm5vbmU7IGJhY2tncm91bmQ6dHJhbnNwYXJlbnQ7IGZvbnQtc3R5bGU6aXRhbGljOyBtaW4taGVpZ2h0OjgwcHg7IGZvbnQtc2l6ZTowLjlyZW07IiBwbGFjZWhvbGRlcj0iU2NyaXB0IG1ldG5pICjEsHN0ZcSfZSBiYcSfbMSxKS4uLiI+PC90ZXh0YXJlYT4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgaWQ9ImV4dHJhLWNvbnRhaW5lciIgY2xhc3M9ImNhcmQtYWN0aW9ucyIgc3R5bGU9Im1hcmdpbi10b3A6MTVweDsgZGlzcGxheTpncmlkOyBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciAxZnI7IGdhcDoxMHB4OyI+CiAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJwb3NpdGlvbjpyZWxhdGl2ZTsiPjxpIGNsYXNzPSJmYXMgZmEtY29kZSIgc3R5bGU9InBvc2l0aW9uOmFic29sdXRlOyBsZWZ0OjEwcHg7IHRvcDoxMHB4OyBjb2xvcjojYWFhOyI+PC9pPjxpbnB1dCBpZD0ic3dhbC1uZXctY29kZSIgY2xhc3M9InN3YWwyLWlucHV0IiBzdHlsZT0ibWFyZ2luOjA7IGhlaWdodDozNXB4OyBmb250LXNpemU6MC44NXJlbTsgcGFkZGluZy1sZWZ0OjMwcHg7IiBwbGFjZWhvbGRlcj0iS29kIj48L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9InBvc2l0aW9uOnJlbGF0aXZlOyI+PGkgY2xhc3M9ImZhcyBmYS1saW5rIiBzdHlsZT0icG9zaXRpb246YWJzb2x1dGU7IGxlZnQ6MTBweDsgdG9wOjEwcHg7IGNvbG9yOiNhYWE7Ij48L2k+PGlucHV0IGlkPSJzd2FsLW5ldy1saW5rIiBjbGFzcz0ic3dhbDItaW5wdXQiIHN0eWxlPSJtYXJnaW46MDsgaGVpZ2h0OjM1cHg7IGZvbnQtc2l6ZTowLjg1cmVtOyBwYWRkaW5nLWxlZnQ6MzBweDsiIHBsYWNlaG9sZGVyPSJMaW5rIj48L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgaWQ9InNwb3J0LWV4dHJhIiBzdHlsZT0iZGlzcGxheTpub25lOyBwYWRkaW5nOjEwcHg7Ij4KICAgICAgICAgICAgICAgIDxsYWJlbCBzdHlsZT0iZm9udC13ZWlnaHQ6Ym9sZDsiPkvEsXNhIEHDp8Sxa2xhbWEgKERlc2MpPC9sYWJlbD48aW5wdXQgaWQ9InN3YWwtc3BvcnQtdGlwIiBjbGFzcz0ic3dhbDItaW5wdXQiIHBsYWNlaG9sZGVyPSJLxLFzYSDEsHB1Y3UvVGlwIj4KICAgICAgICAgICAgICAgIDxsYWJlbCBzdHlsZT0iZm9udC13ZWlnaHQ6Ym9sZDsiPkRldGF5bMSxIE1ldGluIChEZXRhaWwpPC9sYWJlbD48aW5wdXQgaWQ9InN3YWwtc3BvcnQtZGV0YWlsIiBjbGFzcz0ic3dhbDItaW5wdXQiIHBsYWNlaG9sZGVyPSJEZXRheWzEsSBBw6fEsWtsYW1hIChBbHQgTWV0aW4pIj4KICAgICAgICAgICAgICAgIDxsYWJlbCBzdHlsZT0iZm9udC13ZWlnaHQ6Ym9sZDsiPk9rdW51xZ91IChQcm9udW5jaWF0aW9uKTwvbGFiZWw+PGlucHV0IGlkPSJzd2FsLXNwb3J0LXByb24iIGNsYXNzPSJzd2FsMi1pbnB1dCIgcGxhY2Vob2xkZXI9Ik9rdW51xZ91Ij4KICAgICAgICAgICAgICAgIDxsYWJlbCBzdHlsZT0iZm9udC13ZWlnaHQ6Ym9sZDsiPsSwa29uIFPEsW7EsWbEsSAoSWNvbik8L2xhYmVsPjxpbnB1dCBpZD0ic3dhbC1zcG9ydC1pY29uIiBjbGFzcz0ic3dhbDItaW5wdXQiIHBsYWNlaG9sZGVyPSJGb250QXdlc29tZSDEsGtvbiBTxLFuxLFmxLEgKGUuZy4sIGZhLWZ1dGJvbCkiPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBpZD0ibmV3cy1leHRyYSIgc3R5bGU9ImRpc3BsYXk6bm9uZTsgcGFkZGluZzoxMHB4OyI+CiAgICAgICAgICAgICAgICA8bGFiZWwgc3R5bGU9ImZvbnQtd2VpZ2h0OmJvbGQ7Ij5EdXl1cnUgVGlwaTwvbGFiZWw+PHNlbGVjdCBpZD0ic3dhbC1uZXdzLXR5cGUiIGNsYXNzPSJzd2FsMi1pbnB1dCI+PG9wdGlvbiB2YWx1ZT0iaW5mbyI+QmlsZ2k8L29wdGlvbj48b3B0aW9uIHZhbHVlPSJ1cGRhdGUiPkRlxJ9pxZ9pa2xpazwvb3B0aW9uPjxvcHRpb24gdmFsdWU9ImZpeCI+w4fDtnrDvGxkw7w8L29wdGlvbj48L3NlbGVjdD4KICAgICAgICAgICAgICAgIDxsYWJlbCBzdHlsZT0iZm9udC13ZWlnaHQ6Ym9sZDsiPkR1cnVtPC9sYWJlbD48c2VsZWN0IGlkPSJzd2FsLW5ld3Mtc3RhdHVzIiBjbGFzcz0ic3dhbDItaW5wdXQiPjxvcHRpb24gdmFsdWU9IkFrdGlmIj5Ba3RpZjwvb3B0aW9uPjxvcHRpb24gdmFsdWU9IlBhc2lmIj5QYXNpZiAoR2l6bGUpPC9vcHRpb24+PC9zZWxlY3Q+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IGlkPSJxdWl6LWV4dHJhIiBzdHlsZT0iZGlzcGxheTpub25lOyBwYWRkaW5nOjEwcHg7Ij4KICAgICAgICAgICAgICAgIDxsYWJlbCBzdHlsZT0iZm9udC13ZWlnaHQ6Ym9sZDsiPlNvcnUgTWV0bmkgKFRleHQpPC9sYWJlbD48dGV4dGFyZWEgaWQ9InN3YWwtcXVpei1xIiBjbGFzcz0ic3dhbDItdGV4dGFyZWEiIHBsYWNlaG9sZGVyPSJRdWl6IHNvcnVzdS4uLiI+PC90ZXh0YXJlYT4KICAgICAgICAgICAgICAgIDxsYWJlbCBzdHlsZT0iZm9udC13ZWlnaHQ6Ym9sZDsiPlNlw6dlbmVrbGVyIChWaXJnw7xsbGUgQXnEsXLEsW4pPC9sYWJlbD48aW5wdXQgaWQ9InN3YWwtcXVpei1vcHRzIiBjbGFzcz0ic3dhbDItaW5wdXQiIHBsYWNlaG9sZGVyPSLDlnJuOiDFn8SxayBBLMWfxLFrIEIsxZ/EsWsgQyzFn8SxayBEIj4KICAgICAgICAgICAgICAgIDxsYWJlbCBzdHlsZT0iZm9udC13ZWlnaHQ6Ym9sZDsiPkRvxJ9ydSBDZXZhcCDEsG5kZWtzaTwvbGFiZWw+PGlucHV0IGlkPSJzd2FsLXF1aXotYW5zIiB0eXBlPSJudW1iZXIiIGNsYXNzPSJzd2FsMi1pbnB1dCIgcGxhY2Vob2xkZXI9IjAgKEEpLCAxIChCKSwgMiAoQykgdmV5YSAzIChEKSIgbWluPSIwIiBtYXg9IjMiPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj5gLAogICAgICAgIHdpZHRoOiAnNzAwcHgnLCBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLCBjb25maXJtQnV0dG9uVGV4dDogJzxpIGNsYXNzPSJmYXMgZmEtcGx1cyI+PC9pPiBFa2xlJywgY2FuY2VsQnV0dG9uVGV4dDogJ8SwcHRhbCcsIGZvY3VzQ29uZmlybTogZmFsc2UsCiAgICAgICAgZGlkT3BlbjogKCkgPT4gewogICAgICAgICAgICBjb25zdCBzZWxlY3RFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLW5ldy1jYXQnKTsKICAgICAgICAgICAgY29uc3QgY2FyZEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ByZXZpZXctY2FyZCcpOwogICAgICAgICAgICBzZWxlY3RFbC5zdHlsZS5tYXJnaW4gPSAiMCI7IHNlbGVjdEVsLnN0eWxlLmhlaWdodCA9ICIzMHB4Ijsgc2VsZWN0RWwuc3R5bGUuZm9udFNpemUgPSAiMC44cmVtIjsgc2VsZWN0RWwuc3R5bGUucGFkZGluZyA9ICIwIDVweCI7CiAgICAgICAgICAgIHNlbGVjdEVsLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZ1bmN0aW9uKCkgeyBjYXJkRWwuY2xhc3NOYW1lID0gJ2NhcmQgJyArIHRoaXMudmFsdWU7IH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgd2luZG93LnRvZ2dsZUFkZEZpZWxkcyA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgY29uc3QgdHlwZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLXR5cGUtc2VsZWN0JykudmFsdWU7CiAgICAgICAgICAgICAgICBjb25zdCBjYXRDb250ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhdC1jb250YWluZXInKTsKICAgICAgICAgICAgICAgIGNvbnN0IHNjcmlwdENvbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NyaXB0LWNvbnRhaW5lcicpOwogICAgICAgICAgICAgICAgY29uc3QgZXh0cmFDb250ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V4dHJhLWNvbnRhaW5lcicpOwogICAgICAgICAgICAgICAgY29uc3Qgc3BvcnRFeHRyYSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzcG9ydC1leHRyYScpOwogICAgICAgICAgICAgICAgY29uc3QgbmV3c0V4dHJhID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25ld3MtZXh0cmEnKTsKICAgICAgICAgICAgICAgIGNvbnN0IHF1aXpFeHRyYSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWl6LWV4dHJhJyk7CiAgICAgICAgICAgICAgICBjb25zdCBjYXJkUHJldmlldyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcmV2aWV3LWNhcmQnKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY2F0Q29udC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOyBzY3JpcHRDb250LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7IGV4dHJhQ29udC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgc3BvcnRFeHRyYS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOyBuZXdzRXh0cmEuc3R5bGUuZGlzcGxheSA9ICdub25lJzsgcXVpekV4dHJhLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC1uZXctdGl0bGUnKS52YWx1ZSA9ICcnOyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC1uZXctdGV4dCcpLnZhbHVlID0gJyc7CiAgICAgICAgICAgICAgICBjYXJkUHJldmlldy5zdHlsZS5ib3JkZXJMZWZ0ID0gIjVweCBzb2xpZCB2YXIoLS1pbmZvKSI7IGNhcmRQcmV2aWV3LmNsYXNzTmFtZSA9ICdjYXJkIEJpbGdpJzsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdjYXJkJykgewogICAgICAgICAgICAgICAgICAgIGNhdENvbnQuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7IHNjcmlwdENvbnQuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7IGV4dHJhQ29udC5zdHlsZS5kaXNwbGF5ID0gJ2dyaWQnOwogICAgICAgICAgICAgICAgICAgIGNhcmRQcmV2aWV3LmNsYXNzTmFtZSA9ICdjYXJkICcgKyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC1uZXctY2F0JykudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N3YWwtbmV3LXRpdGxlJykucGxhY2Vob2xkZXIgPSAiQmHFn2zEsWsgR2lyaW5pei4uLiI7IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLW5ldy10ZXh0JykucGxhY2Vob2xkZXIgPSAixLDDp2VyaWsgbWV0bmkuLi4iOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnc2FsZXMnKSB7CiAgICAgICAgICAgICAgICAgICAgc2NyaXB0Q29udC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC1uZXctc2NyaXB0JykucGxhY2Vob2xkZXIgPSAiU2F0xLHFnyBNZXRuaS4uLiI7CiAgICAgICAgICAgICAgICAgICAgY2FyZFByZXZpZXcuc3R5bGUuYm9yZGVyTGVmdCA9ICI1cHggc29saWQgdmFyKC0tc2FsZXMpIjsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC1uZXctdGl0bGUnKS5wbGFjZWhvbGRlciA9ICJTY3JpcHQgQmHFn2zEscSfxLEuLi4iOyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC1uZXctdGV4dCcpLnBsYWNlaG9sZGVyID0gIlNhZGVjZSBidXJheWEgbWV0aW4gZ2lyaWxlY2VrLiI7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdzcG9ydCcpIHsKICAgICAgICAgICAgICAgICAgICBzcG9ydEV4dHJhLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgICAgICAgICAgIGNhcmRQcmV2aWV3LnN0eWxlLmJvcmRlckxlZnQgPSAiNXB4IHNvbGlkIHZhcigtLXByaW1hcnkpIjsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC1uZXctdGl0bGUnKS5wbGFjZWhvbGRlciA9ICJTcG9yIFRlcmltaSBCYcWfbMSxxJ/EsS4uLiI7IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLW5ldy10ZXh0JykucGxhY2Vob2xkZXIgPSAiS8Sxc2EgQcOnxLFrbGFtYSAoRGVzYykuLi4iOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnbmV3cycpIHsKICAgICAgICAgICAgICAgICAgICBuZXdzRXh0cmEuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICAgICAgICAgICAgY2FyZFByZXZpZXcuc3R5bGUuYm9yZGVyTGVmdCA9ICI1cHggc29saWQgdmFyKC0tc2Vjb25kYXJ5KSI7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N3YWwtbmV3LXRpdGxlJykucGxhY2Vob2xkZXIgPSAiRHV5dXJ1IEJhxZ9sxLHEn8SxLi4uIjsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N3YWwtbmV3LXRleHQnKS5wbGFjZWhvbGRlciA9ICJEdXl1cnUgTWV0bmkgKERlc2MpLi4uIjsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ3F1aXonKSB7CiAgICAgICAgICAgICAgICAgICAgcXVpekV4dHJhLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLW5ldy10aXRsZScpLnBsYWNlaG9sZGVyID0gIlF1aXogQmHFn2zEscSfxLEgKMOWcm46IFNvcnUgMSkiOyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC1uZXctdGV4dCcpLnBsYWNlaG9sZGVyID0gIkJ1IGFsYW4gYm/FnyBixLFyYWvEsWxhY2FrLiI7CiAgICAgICAgICAgICAgICAgICAgY2FyZFByZXZpZXcuc3R5bGUuYm9yZGVyTGVmdCA9ICI1cHggc29saWQgdmFyKC0tcXVpeikiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgIH0sCiAgICAgICAgcHJlQ29uZmlybTogKCkgPT4gewogICAgICAgICAgICBjb25zdCB0eXBlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N3YWwtdHlwZS1zZWxlY3QnKS52YWx1ZTsKICAgICAgICAgICAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpOwogICAgICAgICAgICBjb25zdCBkYXRlU3RyID0gdG9kYXkuZ2V0RGF0ZSgpICsgIi4iICsgKHRvZGF5LmdldE1vbnRoKCkrMSkgKyAiLiIgKyB0b2RheS5nZXRGdWxsWWVhcigpOwogICAgICAgICAgICBjb25zdCBxdWl6T3B0cyA9IHR5cGUgPT09ICdxdWl6JyA/IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLXF1aXotb3B0cycpLnZhbHVlIDogJyc7CiAgICAgICAgICAgIGNvbnN0IHF1aXpBbnMgPSB0eXBlID09PSAncXVpeicgPyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC1xdWl6LWFucycpLnZhbHVlIDogJyc7CiAgICAgICAgICAgIGNvbnN0IHF1aXpRID0gdHlwZSA9PT0gJ3F1aXonID8gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N3YWwtcXVpei1xJykudmFsdWUgOiAnJzsKICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdxdWl6JyAmJiAoIXF1aXpRIHx8ICFxdWl6T3B0cyB8fCBxdWl6QW5zID09PSAnJykpIHsgU3dhbC5zaG93VmFsaWRhdGlvbk1lc3NhZ2UoJ1F1aXogc29ydXN1IGnDp2luIHTDvG0gYWxhbmxhciB6b3J1bmx1ZHVyLicpOyByZXR1cm4gZmFsc2U7IH0KICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGNhcmRUeXBlOiB0eXBlLAogICAgICAgICAgICAgICAgY2F0ZWdvcnk6IHR5cGUgPT09ICdjYXJkJyA/IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLW5ldy1jYXQnKS52YWx1ZSA6ICh0eXBlID09PSAnbmV3cycgPyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC1uZXdzLXR5cGUnKS52YWx1ZSA6ICcnKSwKICAgICAgICAgICAgICAgIHRpdGxlOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC1uZXctdGl0bGUnKS52YWx1ZSwKICAgICAgICAgICAgICAgIHRleHQ6IHR5cGUgPT09ICdxdWl6JyA/IHF1aXpRIDogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N3YWwtbmV3LXRleHQnKS52YWx1ZSwKICAgICAgICAgICAgICAgIHNjcmlwdDogKHR5cGUgPT09ICdjYXJkJyB8fCB0eXBlID09PSAnc2FsZXMnKSA/IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLW5ldy1zY3JpcHQnKS52YWx1ZSA6ICcnLAogICAgICAgICAgICAgICAgY29kZTogdHlwZSA9PT0gJ2NhcmQnID8gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N3YWwtbmV3LWNvZGUnKS52YWx1ZSA6ICcnLAogICAgICAgICAgICAgICAgc3RhdHVzOiB0eXBlID09PSAnbmV3cycgPyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC1uZXdzLXN0YXR1cycpLnZhbHVlIDogJycsCiAgICAgICAgICAgICAgICBsaW5rOiB0eXBlID09PSAnY2FyZCcgPyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC1uZXctbGluaycpLnZhbHVlIDogJycsCiAgICAgICAgICAgICAgICB0aXA6IHR5cGUgPT09ICdzcG9ydCcgPyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC1zcG9ydC10aXAnKS52YWx1ZSA6ICcnLAogICAgICAgICAgICAgICAgZGV0YWlsOiB0eXBlID09PSAnc3BvcnQnID8gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N3YWwtc3BvcnQtZGV0YWlsJykudmFsdWUgOiAnJywKICAgICAgICAgICAgICAgIHByb251bmNpYXRpb246IHR5cGUgPT09ICdzcG9ydCcgPyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC1zcG9ydC1wcm9uJykudmFsdWUgOiAnJywKICAgICAgICAgICAgICAgIGljb246IHR5cGUgPT09ICdzcG9ydCcgPyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC1zcG9ydC1pY29uJykudmFsdWUgOiAnJywKICAgICAgICAgICAgICAgIGRhdGU6IGRhdGVTdHIsIHF1aXpPcHRpb25zOiBxdWl6T3B0cywgcXVpekFuc3dlcjogcXVpekFucwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSk7CiAgICBpZiAoZm9ybVZhbHVlcykgewogICAgICAgIGlmKCFmb3JtVmFsdWVzLnRpdGxlKSB7IFN3YWwuZmlyZSgnSGF0YScsICdCYcWfbMSxayB6b3J1bmx1IScsICdlcnJvcicpOyByZXR1cm47IH0KICAgICAgICBTd2FsLmZpcmUoeyB0aXRsZTogJ0VrbGVuaXlvci4uLicsIGRpZE9wZW46ICgpID0+IHsgU3dhbC5zaG93TG9hZGluZygpIH0gfSk7CiAgICAgICAgZmV0Y2goU0NSSVBUX1VSTCwgewogICAgICAgICAgICBtZXRob2Q6ICdQT1NUJywgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ3RleHQvcGxhaW47Y2hhcnNldD11dGYtOCcgfSwKICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBhY3Rpb246ICJhZGRDYXJkIiwgdXNlcm5hbWU6IGN1cnJlbnRVc2VyLCB0b2tlbjogZ2V0VG9rZW4oKSwgLi4uZm9ybVZhbHVlcyB9KQogICAgICAgIH0pLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuanNvbigpKS50aGVuKGRhdGEgPT4gewogICAgICAgICAgICBpZiAoZGF0YS5yZXN1bHQgPT09ICJzdWNjZXNzIikgewogICAgICAgICAgICAgICAgU3dhbC5maXJlKHtpY29uOiAnc3VjY2VzcycsIHRpdGxlOiAnQmHFn2FyxLFsxLEnLCB0ZXh0OiAnxLDDp2VyaWsgZWtsZW5kaS4nLCB0aW1lcjogMjAwMCwgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlfSk7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGxvYWRDb250ZW50RGF0YSwgMzUwMCk7CiAgICAgICAgICAgIH0gZWxzZSB7IFN3YWwuZmlyZSgnSGF0YScsIGRhdGEubWVzc2FnZSB8fCAnRWtsZW5lbWVkaS4nLCAnZXJyb3InKTsgfQogICAgICAgIH0pLmNhdGNoKGVyciA9PiBTd2FsLmZpcmUoJ0hhdGEnLCAnU3VudWN1IGhhdGFzxLE6ICcgKyBlcnIsICdlcnJvcicpKTsKICAgIH0KfQphc3luYyBmdW5jdGlvbiBlZGl0Q29udGVudChpbmRleCkgewogICAgY29uc3QgaXRlbSA9IGFjdGl2ZUNhcmRzW2luZGV4XTsKICAgIGNvbnN0IGNhdFNlbGVjdEhUTUwgPSBnZXRDYXRlZ29yeVNlbGVjdEh0bWwoaXRlbS5jYXRlZ29yeSwgJ3N3YWwtY2F0Jyk7CiAgICBjb25zdCB7IHZhbHVlOiBmb3JtVmFsdWVzIH0gPSBhd2FpdCBTd2FsLmZpcmUoewogICAgICAgIHRpdGxlOiAnS2FydMSxIETDvHplbmxlJywKICAgICAgICBodG1sOiBgCiAgICAgICAgPGRpdiBpZD0icHJldmlldy1jYXJkLWVkaXQiIGNsYXNzPSJjYXJkICR7aXRlbS5jYXRlZ29yeX0iIHN0eWxlPSJ0ZXh0LWFsaWduOmxlZnQ7IGJveC1zaGFkb3c6bm9uZTsgYm9yZGVyOjFweCBzb2xpZCAjZTBlMGUwOyBtYXJnaW4tdG9wOjEwcHg7Ij4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2FyZC1oZWFkZXIiIHN0eWxlPSJhbGlnbi1pdGVtczogY2VudGVyOyBnYXA6IDEwcHg7Ij4KICAgICAgICAgICAgICAgIDxpbnB1dCBpZD0ic3dhbC10aXRsZSIgY2xhc3M9InN3YWwyLWlucHV0IiBzdHlsZT0ibWFyZ2luOjA7IGhlaWdodDo0MHB4OyBmbGV4LWdyb3c6MTsgYm9yZGVyOm5vbmU7IGJvcmRlci1ib3R0b206MnB4IHNvbGlkICNlZWU7IHBhZGRpbmc6MCA1cHg7IGZvbnQtd2VpZ2h0OmJvbGQ7IGNvbG9yOiMwZTFiNDI7IiB2YWx1ZT0iJHtpdGVtLnRpdGxlfSIgcGxhY2Vob2xkZXI9IkJhxZ9sxLFrIj4KICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9IndpZHRoOiAxMTBweDsiPiR7Y2F0U2VsZWN0SFRNTH08L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNhcmQtY29udGVudCIgc3R5bGU9Im1hcmdpbi1ib3R0b206MTBweDsiPgogICAgICAgICAgICAgICAgPHRleHRhcmVhIGlkPSJzd2FsLXRleHQiIGNsYXNzPSJzd2FsMi10ZXh0YXJlYSIgc3R5bGU9Im1hcmdpbjowOyB3aWR0aDoxMDAlOyBib3gtc2l6aW5nOmJvcmRlci1ib3g7IGJvcmRlcjpub25lOyByZXNpemU6bm9uZTsgZm9udC1mYW1pbHk6aW5oZXJpdDsgbWluLWhlaWdodDoxMjBweDsgcGFkZGluZzoxMHB4OyBiYWNrZ3JvdW5kOiNmOWY5Zjk7IiBwbGFjZWhvbGRlcj0ixLDDp2VyaWsgbWV0bmkuLi4iPiR7KGl0ZW0udGV4dCB8fCAnJykudG9TdHJpbmcoKS5yZXBsYWNlKC88YnI+L2csJ1xuJyl9PC90ZXh0YXJlYT4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InNjcmlwdC1ib3giIHN0eWxlPSJwYWRkaW5nOjA7IGJvcmRlcjoxcHggc29saWQgI2YwZTY4YzsiPgogICAgICAgICAgICAgICAgPHRleHRhcmVhIGlkPSJzd2FsLXNjcmlwdCIgY2xhc3M9InN3YWwyLXRleHRhcmVhIiBzdHlsZT0ibWFyZ2luOjA7IHdpZHRoOjEwMCU7IGJveC1zaXppbmc6Ym9yZGVyLWJveDsgYm9yZGVyOm5vbmU7IGJhY2tncm91bmQ6dHJhbnNwYXJlbnQ7IGZvbnQtc3R5bGU6aXRhbGljOyBtaW4taGVpZ2h0OjgwcHg7IGZvbnQtc2l6ZTowLjlyZW07IiBwbGFjZWhvbGRlcj0iU2NyaXB0IG1ldG5pLi4uIj4keyhpdGVtLnNjcmlwdCB8fCAnJykudG9TdHJpbmcoKS5yZXBsYWNlKC88YnI+L2csJ1xuJyl9PC90ZXh0YXJlYT4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNhcmQtYWN0aW9ucyIgc3R5bGU9Im1hcmdpbi10b3A6MTVweDsgZGlzcGxheTpncmlkOyBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciAxZnI7IGdhcDoxMHB4OyI+CiAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJwb3NpdGlvbjpyZWxhdGl2ZTsiPjxpIGNsYXNzPSJmYXMgZmEtY29kZSIgc3R5bGU9InBvc2l0aW9uOmFic29sdXRlOyBsZWZ0OjEwcHg7IHRvcDoxMHB4OyBjb2xvcjojYWFhOyI+PC9pPjxpbnB1dCBpZD0ic3dhbC1jb2RlIiBjbGFzcz0ic3dhbDItaW5wdXQiIHN0eWxlPSJtYXJnaW46MDsgaGVpZ2h0OjM1cHg7IGZvbnQtc2l6ZTowLjg1cmVtOyBwYWRkaW5nLWxlZnQ6MzBweDsiIHZhbHVlPSIke2l0ZW0uY29kZSB8fCAnJ30iIHBsYWNlaG9sZGVyPSJLb2QiPjwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0icG9zaXRpb246cmVsYXRpdmU7Ij48aSBjbGFzcz0iZmFzIGZhLWxpbmsiIHN0eWxlPSJwb3NpdGlvbjphYnNvbHV0ZTsgbGVmdDoxMHB4OyB0b3A6MTBweDsgY29sb3I6I2FhYTsiPjwvaT48aW5wdXQgaWQ9InN3YWwtbGluayIgY2xhc3M9InN3YWwyLWlucHV0IiBzdHlsZT0ibWFyZ2luOjA7IGhlaWdodDozNXB4OyBmb250LXNpemU6MC44NXJlbTsgcGFkZGluZy1sZWZ0OjMwcHg7IiB2YWx1ZT0iJHtpdGVtLmxpbmsgfHwgJyd9IiBwbGFjZWhvbGRlcj0iTGluayI+PC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PmAsCiAgICAgICAgd2lkdGg6ICc3MDBweCcsIHNob3dDYW5jZWxCdXR0b246IHRydWUsIGNvbmZpcm1CdXR0b25UZXh0OiAnPGkgY2xhc3M9ImZhcyBmYS1zYXZlIj48L2k+IEtheWRldCcsIGNhbmNlbEJ1dHRvblRleHQ6ICfEsHB0YWwnLCBmb2N1c0NvbmZpcm06IGZhbHNlLAogICAgICAgIGRpZE9wZW46ICgpID0+IHsKICAgICAgICAgICAgY29uc3Qgc2VsZWN0RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC1jYXQnKTsKICAgICAgICAgICAgY29uc3QgY2FyZEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ByZXZpZXctY2FyZC1lZGl0Jyk7CiAgICAgICAgICAgIHNlbGVjdEVsLnN0eWxlLm1hcmdpbiA9ICIwIjsgc2VsZWN0RWwuc3R5bGUuaGVpZ2h0ID0gIjMwcHgiOyBzZWxlY3RFbC5zdHlsZS5mb250U2l6ZSA9ICIwLjhyZW0iOyBzZWxlY3RFbC5zdHlsZS5wYWRkaW5nID0gIjAgNXB4IjsKICAgICAgICAgICAgc2VsZWN0RWwuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZnVuY3Rpb24oKSB7IGNhcmRFbC5jbGFzc05hbWUgPSAnY2FyZCAnICsgdGhpcy52YWx1ZTsgfSk7CiAgICAgICAgfSwKICAgICAgICBwcmVDb25maXJtOiAoKSA9PiB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBjYXQ6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLWNhdCcpLnZhbHVlLAogICAgICAgICAgICAgICAgdGl0bGU6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLXRpdGxlJykudmFsdWUsCiAgICAgICAgICAgICAgICB0ZXh0OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC10ZXh0JykudmFsdWUsCiAgICAgICAgICAgICAgICBzY3JpcHQ6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLXNjcmlwdCcpLnZhbHVlLAogICAgICAgICAgICAgICAgY29kZTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N3YWwtY29kZScpLnZhbHVlLAogICAgICAgICAgICAgICAgbGluazogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N3YWwtbGluaycpLnZhbHVlCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KTsKICAgIGlmIChmb3JtVmFsdWVzKSB7CiAgICAgICAgaWYoZm9ybVZhbHVlcy5jYXQgIT09IGl0ZW0uY2F0ZWdvcnkpIHNlbmRVcGRhdGUoaXRlbS50aXRsZSwgIkNhdGVnb3J5IiwgZm9ybVZhbHVlcy5jYXQsICdjYXJkJyk7CiAgICAgICAgaWYoZm9ybVZhbHVlcy50ZXh0ICE9PSAoaXRlbS50ZXh0IHx8ICcnKS5yZXBsYWNlKC88YnI+L2csJ1xuJykpIHNldFRpbWVvdXQoKCkgPT4gc2VuZFVwZGF0ZShpdGVtLnRpdGxlLCAiVGV4dCIsIGZvcm1WYWx1ZXMudGV4dCwgJ2NhcmQnKSwgNTAwKTsKICAgICAgICBpZihmb3JtVmFsdWVzLnNjcmlwdCAhPT0gKGl0ZW0uc2NyaXB0IHx8ICcnKS5yZXBsYWNlKC88YnI+L2csJ1xuJykpIHNldFRpbWVvdXQoKCkgPT4gc2VuZFVwZGF0ZShpdGVtLnRpdGxlLCAiU2NyaXB0IiwgZm9ybVZhbHVlcy5zY3JpcHQsICdjYXJkJyksIDEwMDApOwogICAgICAgIGlmKGZvcm1WYWx1ZXMuY29kZSAhPT0gKGl0ZW0uY29kZSB8fCAnJykpIHNldFRpbWVvdXQoKCkgPT4gc2VuZFVwZGF0ZShpdGVtLnRpdGxlLCAiQ29kZSIsIGZvcm1WYWx1ZXMuY29kZSwgJ2NhcmQnKSwgMTUwMCk7CiAgICAgICAgaWYoZm9ybVZhbHVlcy5saW5rICE9PSAoaXRlbS5saW5rIHx8ICcnKSkgc2V0VGltZW91dCgoKSA9PiBzZW5kVXBkYXRlKGl0ZW0udGl0bGUsICJMaW5rIiwgZm9ybVZhbHVlcy5saW5rLCAnY2FyZCcpLCAyMDAwKTsKICAgICAgICBpZihmb3JtVmFsdWVzLnRpdGxlICE9PSBpdGVtLnRpdGxlKSBzZXRUaW1lb3V0KCgpID0+IHNlbmRVcGRhdGUoaXRlbS50aXRsZSwgIlRpdGxlIiwgZm9ybVZhbHVlcy50aXRsZSwgJ2NhcmQnKSwgMjUwMCk7CiAgICB9Cn0KYXN5bmMgZnVuY3Rpb24gZWRpdFNwb3J0KHRpdGxlKSB7CiAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKICAgIGNvbnN0IHMgPSBzcG9ydHNEYXRhLmZpbmQoaXRlbSA9PiBpdGVtLnRpdGxlID09PSB0aXRsZSk7CiAgICBpZiAoIXMpIHJldHVybiBTd2FsLmZpcmUoJ0hhdGEnLCAnxLDDp2VyaWsgYnVsdW5hbWFkxLEuJywgJ2Vycm9yJyk7CiAgICBjb25zdCB7IHZhbHVlOiBmb3JtVmFsdWVzIH0gPSBhd2FpdCBTd2FsLmZpcmUoewogICAgICAgIHRpdGxlOiAnU3BvciDEsMOnZXJpxJ9pbmkgRMO8emVubGUnLAogICAgICAgIGh0bWw6IGAKICAgICAgICA8ZGl2IGNsYXNzPSJjYXJkIiBzdHlsZT0idGV4dC1hbGlnbjpsZWZ0OyBib3JkZXItbGVmdDogNXB4IHNvbGlkIHZhcigtLXByaW1hcnkpOyBwYWRkaW5nOjE1cHg7IGJhY2tncm91bmQ6I2Y4ZjlmYTsiPgogICAgICAgICAgICA8bGFiZWwgc3R5bGU9ImZvbnQtd2VpZ2h0OmJvbGQ7Ij5CYcWfbMSxazwvbGFiZWw+PGlucHV0IGlkPSJzd2FsLXRpdGxlIiBjbGFzcz0ic3dhbDItaW5wdXQiIHN0eWxlPSJ3aWR0aDoxMDAlOyBtYXJnaW4tYm90dG9tOjEwcHg7IiB2YWx1ZT0iJHtzLnRpdGxlfSI+CiAgICAgICAgICAgIDxsYWJlbCBzdHlsZT0iZm9udC13ZWlnaHQ6Ym9sZDsiPkHDp8Sxa2xhbWEgKEvEsXNhKTwvbGFiZWw+PHRleHRhcmVhIGlkPSJzd2FsLWRlc2MiIGNsYXNzPSJzd2FsMi10ZXh0YXJlYSIgc3R5bGU9Im1hcmdpbi1ib3R0b206MTBweDsiPiR7cy5kZXNjIHx8ICcnfTwvdGV4dGFyZWE+CiAgICAgICAgICAgIDxsYWJlbCBzdHlsZT0iZm9udC13ZWlnaHQ6Ym9sZDsiPsSwcHVjdSAoVGlwKTwvbGFiZWw+PGlucHV0IGlkPSJzd2FsLXRpcCIgY2xhc3M9InN3YWwyLWlucHV0IiBzdHlsZT0id2lkdGg6MTAwJTsgbWFyZ2luLWJvdHRvbToxMHB4OyIgdmFsdWU9IiR7cy50aXAgfHwgJyd9Ij4KICAgICAgICAgICAgPGxhYmVsIHN0eWxlPSJmb250LXdlaWdodDpib2xkOyI+RGV0YXkgKEFsdCBNZXRpbik8L2xhYmVsPjx0ZXh0YXJlYSBpZD0ic3dhbC1kZXRhaWwiIGNsYXNzPSJzd2FsMi10ZXh0YXJlYSIgc3R5bGU9Im1hcmdpbi1ib3R0b206MTBweDsiPiR7cy5kZXRhaWwgfHwgJyd9PC90ZXh0YXJlYT4KICAgICAgICAgICAgPGxhYmVsIHN0eWxlPSJmb250LXdlaWdodDpib2xkOyI+T2t1bnXFn3U8L2xhYmVsPjxpbnB1dCBpZD0ic3dhbC1wcm9uIiBjbGFzcz0ic3dhbDItaW5wdXQiIHN0eWxlPSJ3aWR0aDoxMDAlOyBtYXJnaW4tYm90dG9tOjEwcHg7IiB2YWx1ZT0iJHtzLnByb251bmNpYXRpb24gfHwgJyd9Ij4KICAgICAgICAgICAgPGxhYmVsIHN0eWxlPSJmb250LXdlaWdodDpib2xkOyI+xLBrb24gU8SxbsSxZsSxPC9sYWJlbD48aW5wdXQgaWQ9InN3YWwtaWNvbiIgY2xhc3M9InN3YWwyLWlucHV0IiBzdHlsZT0id2lkdGg6MTAwJTsiIHZhbHVlPSIke3MuaWNvbiB8fCAnJ30iPgogICAgICAgIDwvZGl2PmAsCiAgICAgICAgd2lkdGg6ICc3MDBweCcsIHNob3dDYW5jZWxCdXR0b246IHRydWUsIGNvbmZpcm1CdXR0b25UZXh0OiAnS2F5ZGV0JywKICAgICAgICBwcmVDb25maXJtOiAoKSA9PiBbCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLXRpdGxlJykudmFsdWUsIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLWRlc2MnKS52YWx1ZSwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N3YWwtdGlwJykudmFsdWUsCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLWRldGFpbCcpLnZhbHVlLCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC1wcm9uJykudmFsdWUsIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLWljb24nKS52YWx1ZQogICAgICAgIF0KICAgIH0pOwogICAgaWYgKGZvcm1WYWx1ZXMpIHsKICAgICAgICBjb25zdCBvcmlnaW5hbFRpdGxlID0gcy50aXRsZTsKICAgICAgICBpZihmb3JtVmFsdWVzWzFdICE9PSBzLmRlc2MpIHNlbmRVcGRhdGUob3JpZ2luYWxUaXRsZSwgIlRleHQiLCBmb3JtVmFsdWVzWzFdLCAnc3BvcnQnKTsKICAgICAgICBpZihmb3JtVmFsdWVzWzJdICE9PSBzLnRpcCkgc2V0VGltZW91dCgoKSA9PiBzZW5kVXBkYXRlKG9yaWdpbmFsVGl0bGUsICJUaXAiLCBmb3JtVmFsdWVzWzJdLCAnc3BvcnQnKSwgNTAwKTsKICAgICAgICBpZihmb3JtVmFsdWVzWzNdICE9PSBzLmRldGFpbCkgc2V0VGltZW91dCgoKSA9PiBzZW5kVXBkYXRlKG9yaWdpbmFsVGl0bGUsICJEZXRhaWwiLCBmb3JtVmFsdWVzWzNdLCAnc3BvcnQnKSwgMTAwMCk7CiAgICAgICAgaWYoZm9ybVZhbHVlc1s0XSAhPT0gcy5wcm9udW5jaWF0aW9uKSBzZXRUaW1lb3V0KCgpID0+IHNlbmRVcGRhdGUob3JpZ2luYWxUaXRsZSwgIlByb251bmNpYXRpb24iLCBmb3JtVmFsdWVzWzRdLCAnc3BvcnQnKSwgMTUwMCk7CiAgICAgICAgaWYoZm9ybVZhbHVlc1s1XSAhPT0gcy5pY29uKSBzZXRUaW1lb3V0KCgpID0+IHNlbmRVcGRhdGUob3JpZ2luYWxUaXRsZSwgIkljb24iLCBmb3JtVmFsdWVzWzVdLCAnc3BvcnQnKSwgMjAwMCk7CiAgICAgICAgaWYoZm9ybVZhbHVlc1swXSAhPT0gb3JpZ2luYWxUaXRsZSkgc2V0VGltZW91dCgoKSA9PiBzZW5kVXBkYXRlKG9yaWdpbmFsVGl0bGUsICJUaXRsZSIsIGZvcm1WYWx1ZXNbMF0sICdzcG9ydCcpLCAyNTAwKTsKICAgIH0KfQphc3luYyBmdW5jdGlvbiBlZGl0U2FsZXModGl0bGUpIHsKICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwogICAgY29uc3QgcyA9IHNhbGVzU2NyaXB0cy5maW5kKGl0ZW0gPT4gaXRlbS50aXRsZSA9PT0gdGl0bGUpOwogICAgaWYgKCFzKSByZXR1cm4gU3dhbC5maXJlKCdIYXRhJywgJ8Sww6dlcmlrIGJ1bHVuYW1hZMSxLicsICdlcnJvcicpOwogICAgY29uc3QgeyB2YWx1ZTogZm9ybVZhbHVlcyB9ID0gYXdhaXQgU3dhbC5maXJlKHsKICAgICAgICB0aXRsZTogJ1NhdMSxxZ8gTWV0bmluaSBEw7x6ZW5sZScsCiAgICAgICAgaHRtbDogYDxkaXYgY2xhc3M9ImNhcmQiIHN0eWxlPSJ0ZXh0LWFsaWduOmxlZnQ7IGJvcmRlci1sZWZ0OiA1cHggc29saWQgdmFyKC0tc2FsZXMpOyBwYWRkaW5nOjE1cHg7IGJhY2tncm91bmQ6I2VjZmRmNTsiPjxsYWJlbCBzdHlsZT0iZm9udC13ZWlnaHQ6Ym9sZDsiPkJhxZ9sxLFrPC9sYWJlbD48aW5wdXQgaWQ9InN3YWwtdGl0bGUiIGNsYXNzPSJzd2FsMi1pbnB1dCIgc3R5bGU9IndpZHRoOjEwMCU7IG1hcmdpbi1ib3R0b206MTBweDsiCiAgICAgICAgdmFsdWU9IiR7cy50aXRsZX0iPjxsYWJlbCBzdHlsZT0iZm9udC13ZWlnaHQ6Ym9sZDsiPk1ldGluPC9sYWJlbD48dGV4dGFyZWEgaWQ9InN3YWwtdGV4dCIgY2xhc3M9InN3YWwyLXRleHRhcmVhIiBzdHlsZT0ibWluLWhlaWdodDoxNTBweDsiPiR7cy50ZXh0IHx8ICcnfTwvdGV4dGFyZWE+PC9kaXY+YCwKICAgICAgICB3aWR0aDogJzcwMHB4Jywgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwgY29uZmlybUJ1dHRvblRleHQ6ICdLYXlkZXQnLAogICAgICAgIHByZUNvbmZpcm06ICgpID0+IFsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N3YWwtdGl0bGUnKS52YWx1ZSwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N3YWwtdGV4dCcpLnZhbHVlIF0KICAgIH0pOwogICAgaWYgKGZvcm1WYWx1ZXMpIHsKICAgICAgICBjb25zdCBvcmlnaW5hbFRpdGxlID0gcy50aXRsZTsKICAgICAgICBpZihmb3JtVmFsdWVzWzFdICE9PSBzLnRleHQpIHNlbmRVcGRhdGUob3JpZ2luYWxUaXRsZSwgIlRleHQiLCBmb3JtVmFsdWVzWzFdLCAnc2FsZXMnKTsKICAgICAgICBpZihmb3JtVmFsdWVzWzBdICE9PSBvcmlnaW5hbFRpdGxlKSBzZXRUaW1lb3V0KCgpID0+IHNlbmRVcGRhdGUob3JpZ2luYWxUaXRsZSwgIlRpdGxlIiwgZm9ybVZhbHVlc1swXSwgJ3NhbGVzJyksIDUwMCk7CiAgICB9Cn0KYXN5bmMgZnVuY3Rpb24gZWRpdE5ld3MoaW5kZXgpIHsKICAgIGNvbnN0IGkgPSBuZXdzRGF0YVtpbmRleF07CiAgICBsZXQgc3RhdHVzT3B0aW9ucyA9IGA8b3B0aW9uIHZhbHVlPSJBa3RpZiIgJHtpLnN0YXR1cyAhPT0gJ1Bhc2lmJyA/ICdzZWxlY3RlZCcgOiAnJ30+QWt0aWY8L29wdGlvbj48b3B0aW9uIHZhbHVlPSJQYXNpZiIgJHtpLnN0YXR1cyA9PT0gJ1Bhc2lmJyA/ICdzZWxlY3RlZCcgOiAnJ30+UGFzaWY8L29wdGlvbj5gOwogICAgbGV0IHR5cGVPcHRpb25zID0gYDxvcHRpb24gdmFsdWU9ImluZm8iICR7aS50eXBlID09PSAnaW5mbycgPyAnc2VsZWN0ZWQnIDogJyd9PkJpbGdpPC9vcHRpb24+PG9wdGlvbiB2YWx1ZT0idXBkYXRlIiAke2kudHlwZSA9PT0gJ3VwZGF0ZScgPyAnc2VsZWN0ZWQnIDogJyd9PkRlxJ9pxZ9pa2xpazwvb3B0aW9uPjxvcHRpb24gdmFsdWU9ImZpeCIgJHtpLnR5cGUgPT09ICdmaXgnID8gJ3NlbGVjdGVkJyA6ICcnfT7Dh8O2esO8bGTDvDwvb3B0aW9uPmA7CiAgICAKICAgIGNvbnN0IHsgdmFsdWU6IGZvcm1WYWx1ZXMgfSA9IGF3YWl0IFN3YWwuZmlyZSh7CiAgICAgICAgdGl0bGU6ICdEdXl1cnV5dSBEw7x6ZW5sZScsCiAgICAgICAgaHRtbDogYDxkaXYgY2xhc3M9ImNhcmQiIHN0eWxlPSJ0ZXh0LWFsaWduOmxlZnQ7IGJvcmRlci1sZWZ0OiA1cHggc29saWQgdmFyKC0tc2Vjb25kYXJ5KTsgcGFkZGluZzoxNXB4OyBiYWNrZ3JvdW5kOiNmZmY4ZTE7Ij48bGFiZWwgc3R5bGU9ImZvbnQtd2VpZ2h0OmJvbGQ7Ij5CYcWfbMSxazwvbGFiZWw+PGlucHV0IGlkPSJzd2FsLXRpdGxlIiBjbGFzcz0ic3dhbDItaW5wdXQiIHN0eWxlPSJ3aWR0aDoxMDAlOyBtYXJnaW4tYm90dG9tOjEwcHg7IgogICAgICAgIHZhbHVlPSIke2kudGl0bGUgfHwgJyd9Ij48ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7IGdhcDoxMHB4OyBtYXJnaW4tYm90dG9tOjEwcHg7Ij48ZGl2IHN0eWxlPSJmbGV4OjE7Ij48bGFiZWwgc3R5bGU9ImZvbnQtd2VpZ2h0OmJvbGQ7Ij5UYXJpaDwvbGFiZWw+PGlucHV0IGlkPSJzd2FsLWRhdGUiIGNsYXNzPSJzd2FsMi1pbnB1dCIgc3R5bGU9IndpZHRoOjEwMCU7IgogICAgICAgIHZhbHVlPSIke2kuZGF0ZSB8fCAnJ30iPjwvZGl2PjxkaXYgc3R5bGU9ImZsZXg6MTsiPjxsYWJlbCBzdHlsZT0iZm9udC13ZWlnaHQ6Ym9sZDsiPlTDvHI8L2xhYmVsPjxzZWxlY3QgaWQ9InN3YWwtdHlwZSIgY2xhc3M9InN3YWwyLWlucHV0IiBzdHlsZT0id2lkdGg6MTAwJTsiPiR7dHlwZU9wdGlvbnN9PC9zZWxlY3Q+PC9kaXY+PC9kaXY+PGxhYmVsIHN0eWxlPSJmb250LXdlaWdodDpib2xkOyI+TWV0aW48L2xhYmVsPjx0ZXh0YXJlYSBpZD0ic3dhbC1kZXNjIiBjbGFzcz0ic3dhbDItdGV4dGFyZWEiIHN0eWxlPSJtYXJnaW4tYm90dG9tOjEwcHg7Ij4ke2kuZGVzYyB8fCAnJ308L3RleHRhcmVhPjxsYWJlbCBzdHlsZT0iZm9udC13ZWlnaHQ6Ym9sZDsiPkR1cnVtPC9sYWJlbD48c2VsZWN0IGlkPSJzd2FsLXN0YXR1cyIgY2xhc3M9InN3YWwyLWlucHV0IiBzdHlsZT0id2lkdGg6MTAwJTsiPiR7c3RhdHVzT3B0aW9uc308L3NlbGVjdD48L2Rpdj5gLAogICAgICAgIHdpZHRoOiAnNjAwcHgnLCBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLCBjb25maXJtQnV0dG9uVGV4dDogJ0theWRldCcsCiAgICAgICAgcHJlQ29uZmlybTogKCkgPT4gWwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC10aXRsZScpLnZhbHVlLCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC1kYXRlJykudmFsdWUsCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLWRlc2MnKS52YWx1ZSwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N3YWwtdHlwZScpLnZhbHVlLCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC1zdGF0dXMnKS52YWx1ZQogICAgICAgIF0KICAgIH0pOwogICAgaWYgKGZvcm1WYWx1ZXMpIHsKICAgICAgICBjb25zdCBvcmlnaW5hbFRpdGxlID0gaS50aXRsZTsKICAgICAgICBpZihmb3JtVmFsdWVzWzFdICE9PSBpLmRhdGUpIHNlbmRVcGRhdGUob3JpZ2luYWxUaXRsZSwgIkRhdGUiLCBmb3JtVmFsdWVzWzFdLCAnbmV3cycpOwogICAgICAgIGlmKGZvcm1WYWx1ZXNbMl0gIT09IGkuZGVzYykgc2V0VGltZW91dCgoKSA9PiBzZW5kVXBkYXRlKG9yaWdpbmFsVGl0bGUsICJUZXh0IiwgZm9ybVZhbHVlc1syXSwgJ25ld3MnKSwgNTAwKTsKICAgICAgICBpZihmb3JtVmFsdWVzWzNdICE9PSBpLnR5cGUpIHNldFRpbWVvdXQoKCkgPT4gc2VuZFVwZGF0ZShvcmlnaW5hbFRpdGxlLCAiQ2F0ZWdvcnkiLCBmb3JtVmFsdWVzWzNdLCAnbmV3cycpLCAxMDAwKTsKICAgICAgICBpZihmb3JtVmFsdWVzWzRdICE9PSBpLnN0YXR1cykgc2V0VGltZW91dCgoKSA9PiBzZW5kVXBkYXRlKG9yaWdpbmFsVGl0bGUsICJTdGF0dXMiLCBmb3JtVmFsdWVzWzRdLCAnbmV3cycpLCAxNTAwKTsKICAgICAgICBpZihmb3JtVmFsdWVzWzBdICE9PSBvcmlnaW5hbFRpdGxlKSBzZXRUaW1lb3V0KCgpID0+IHNlbmRVcGRhdGUob3JpZ2luYWxUaXRsZSwgIlRpdGxlIiwgZm9ybVZhbHVlc1swXSwgJ25ld3MnKSwgMjAwMCk7CiAgICB9Cn0KLy8gLS0tIFNUQU5EQVJEIE1PREFMUyAoVElDS0VSLCBORVdTLCBHVUlERSwgU0FMRVMpIC0tLQpmdW5jdGlvbiBjbG9zZU1vZGFsKGlkKSB7IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOyB9CmZ1bmN0aW9uIHN0YXJ0VGlja2VyKCkgewogICAgY29uc3QgdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0aWNrZXItY29udGVudCcpOwogICAgY29uc3QgYWN0aXZlTmV3cyA9IG5ld3NEYXRhLmZpbHRlcihpID0+IGkuc3RhdHVzICE9PSAnUGFzaWYnKTsKICAgIGlmKGFjdGl2ZU5ld3MubGVuZ3RoID09PSAwKSB7IHQuaW5uZXJIVE1MID0gIkfDvG5jZWwgZHV5dXJ1IHlvay4iOyB0LnN0eWxlLmFuaW1hdGlvbiA9ICdub25lJzsgcmV0dXJuOyB9CiAgICAKICAgIGxldCB0aWNrZXJUZXh0ID0gYWN0aXZlTmV3cy5tYXAoaSA9PiB7CiAgICAgICAgcmV0dXJuIGA8c3BhbiBzdHlsZT0iY29sb3I6I2ZhYmIwMDsgZm9udC13ZWlnaHQ6Ym9sZDsiPlske2kuZGF0ZX1dPC9zcGFuPiA8c3BhbiBzdHlsZT0iY29sb3I6I2ZmZjsiPiR7aS50aXRsZX06PC9zcGFuPiA8c3BhbiBzdHlsZT0iY29sb3I6I2RkZDsiPiR7aS5kZXNjfTwvc3Bhbj5gOwogICAgfSkuam9pbignICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwOyDigKIgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7ICcpOwogICAgdC5pbm5lckhUTUwgPSB0aWNrZXJUZXh0ICsgJyAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDsg4oCiICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwOyAnICsgdGlja2VyVGV4dDsKICAgIHQuc3R5bGUuYW5pbWF0aW9uID0gJ3RpY2tlci1zY3JvbGwgMTkwcyBsaW5lYXIgaW5maW5pdGUnOwp9CmZ1bmN0aW9uIG9wZW5OZXdzKCkgewogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25ld3MtbW9kYWwnKS5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOwogICAgY29uc3QgYyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZXdzLWNvbnRhaW5lcicpOwogICAgYy5pbm5lckhUTUwgPSAnJzsKICAgIG5ld3NEYXRhLmZvckVhY2goKGksIGluZGV4KSA9PiB7CiAgICAgICAgbGV0IGNsID0gaS50eXBlID09PSAnZml4JyA/ICd0YWctZml4JyA6IChpLnR5cGUgPT09ICd1cGRhdGUnID8gJ3RhZy11cGRhdGUnIDogJ3RhZy1pbmZvJyk7CiAgICAgICAgbGV0IHR4ID0gaS50eXBlID09PSAnZml4JyA/ICfDh8O2esO8bGTDvCcgOiAoaS50eXBlID09PSAndXBkYXRlJyA/ICdEZcSfacWfaWtsaWsnIDogJ0JpbGdpJyk7CiAgICAgICAgbGV0IHBhc3NpdmVTdHlsZSA9IGkuc3RhdHVzID09PSAnUGFzaWYnID8gJ29wYWNpdHk6MC41OyBiYWNrZ3JvdW5kOiNlZWU7JyA6ICcnOwogICAgICAgIGxldCBwYXNzaXZlQmFkZ2UgPSBpLnN0YXR1cyA9PT0gJ1Bhc2lmJyA/ICc8c3BhbiBjbGFzcz0ibmV3cy10YWciIHN0eWxlPSJiYWNrZ3JvdW5kOiM1NTU7IGNvbG9yOndoaXRlOyI+UEFTxLBGPC9zcGFuPicgOiAnJzsKICAgICAgICBsZXQgZWRpdEJ0biA9IChpc0FkbWluTW9kZSAmJiBpc0VkaXRpbmdBY3RpdmUpID8gYDxpIGNsYXNzPSJmYXMgZmEtcGVuY2lsLWFsdCBlZGl0LWljb24iIHN0eWxlPSJ0b3A6MDsgcmlnaHQ6MDsgZm9udC1zaXplOjAuOXJlbTsgcGFkZGluZzo0cHg7IiBvbmNsaWNrPSJldmVudC5zdG9wUHJvcGFnYXRpb24oKTsgZWRpdE5ld3MoJHtpbmRleH0pIj48L2k+YCA6ICcnOwogICAgICAgIGMuaW5uZXJIVE1MICs9IGA8ZGl2IGNsYXNzPSJuZXdzLWl0ZW0iIHN0eWxlPSIke3Bhc3NpdmVTdHlsZX0iPiR7ZWRpdEJ0bn08c3BhbiBjbGFzcz0ibmV3cy1kYXRlIj4ke2kuZGF0ZX08L3NwYW4+PHNwYW4gY2xhc3M9Im5ld3MtdGl0bGUiPiR7aS50aXRsZX0gJHtwYXNzaXZlQmFkZ2V9PC9zcGFuPjxkaXYgY2xhc3M9Im5ld3MtZGVzYyI+JHtpLmRlc2N9PC9kaXY+PHNwYW4gY2xhc3M9Im5ld3MtdGFnICR7Y2x9Ij4ke3R4fTwvc3Bhbj48L2Rpdj5gOwogICAgfSk7Cn0KCgovLyA9PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIOKchSBZYXnEsW4gQWvEscWfxLEgKEUtVGFibG8nZGFuKQovLyA9PT09PT09PT09PT09PT09PT09PT09PT09CmFzeW5jIGZ1bmN0aW9uIGZldGNoQnJvYWRjYXN0RmxvdygpIHsKICAgIGNvbnN0IHIgPSBhd2FpdCBmZXRjaChTQ1JJUFRfVVJMLCB7CiAgICAgICAgbWV0aG9kOiAiUE9TVCIsCiAgICAgICAgaGVhZGVyczogeyAiQ29udGVudC1UeXBlIjogInRleHQvcGxhaW47Y2hhcnNldD11dGYtOCIgfSwKICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgICAgIGFjdGlvbjogImdldEJyb2FkY2FzdEZsb3ciLAogICAgICAgICAgICB1c2VybmFtZTogKHR5cGVvZiBjdXJyZW50VXNlciAhPT0gInVuZGVmaW5lZCIgPyBjdXJyZW50VXNlciA6ICIiKSwKICAgICAgICAgICAgdG9rZW46ICh0eXBlb2YgZ2V0VG9rZW4gPT09ICJmdW5jdGlvbiIgPyBnZXRUb2tlbigpIDogIiIpCiAgICAgICAgfSkKICAgIH0pOwoKICAgIGNvbnN0IGQgPSBhd2FpdCByLmpzb24oKTsKICAgIGlmICghZCB8fCBkLnJlc3VsdCAhPT0gInN1Y2Nlc3MiKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKChkICYmIGQubWVzc2FnZSkgPyBkLm1lc3NhZ2UgOiAiWWF5xLFuIGFrxLHFn8SxIGFsxLFuYW1hZMSxLiIpOwogICAgfQogICAgcmV0dXJuIGQuaXRlbXMgfHwgW107Cn0KCmFzeW5jIGZ1bmN0aW9uIG9wZW5Ccm9hZGNhc3RGbG93KCkgewogIFN3YWwuZmlyZSh7CiAgICB0aXRsZTogIllhecSxbiBBa8SxxZ/EsSIsCiAgICBkaWRPcGVuOiAoKSA9PiBTd2FsLnNob3dMb2FkaW5nKCksCiAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UKICB9KTsKCiAgdHJ5IHsKICAgIGNvbnN0IGl0ZW1zUmF3ID0gYXdhaXQgZmV0Y2hCcm9hZGNhc3RGbG93KCk7CgogICAgaWYgKCFpdGVtc1JhdyB8fCAhaXRlbXNSYXcubGVuZ3RoKSB7CiAgICAgIFN3YWwuZmlyZSgiWWF5xLFuIEFrxLHFn8SxIiwgIkthecSxdCBidWx1bmFtYWTEsS4iLCAiaW5mbyIpOwogICAgICByZXR1cm47CiAgICB9CgogICAgLy8g4pyFIFPEsXJhbGFtYSAoZXBvY2ggdmFyc2Ega2VzaW4sIHlva3NhIHRhcmloK3NhYXRlIGfDtnJlKQogICAgY29uc3QgaXRlbXMgPSBbLi4uaXRlbXNSYXddLnNvcnQoKGEsIGIpID0+IHsKICAgICAgY29uc3QgYWUgPSBOdW1iZXIoYT8uc3RhcnRFcG9jaCB8fCAwKTsKICAgICAgY29uc3QgYmUgPSBOdW1iZXIoYj8uc3RhcnRFcG9jaCB8fCAwKTsKICAgICAgaWYgKGFlICYmIGJlKSByZXR1cm4gYWUgLSBiZTsKCiAgICAgIGNvbnN0IGFrID0gU3RyaW5nKGE/LmRhdGVJU08gfHwgYT8uZGF0ZSB8fCAiIikgKyAiICIgKyBTdHJpbmcoYT8udGltZSB8fCAiIik7CiAgICAgIGNvbnN0IGJrID0gU3RyaW5nKGI/LmRhdGVJU08gfHwgYj8uZGF0ZSB8fCAiIikgKyAiICIgKyBTdHJpbmcoYj8udGltZSB8fCAiIik7CiAgICAgIHJldHVybiBhay5sb2NhbGVDb21wYXJlKGJrKTsKICAgIH0pOwoKICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7CgogICAgLy8g4pyFIFRhcmloZSBnw7ZyZSBncnVwbGEgKGRhdGVJU08pCiAgICBjb25zdCBieURhdGUgPSB7fTsKICAgIGNvbnN0IGRhdGVMYWJlbEJ5S2V5ID0ge307CiAgICBpdGVtcy5mb3JFYWNoKGl0ID0+IHsKICAgICAgY29uc3Qga2V5ID0gU3RyaW5nKGl0Py5kYXRlSVNPIHx8IGl0Py5kYXRlIHx8ICJUYXJpaCBZb2siKTsKICAgICAgaWYgKCFieURhdGVba2V5XSkgYnlEYXRlW2tleV0gPSBbXTsKICAgICAgYnlEYXRlW2tleV0ucHVzaChpdCk7CgogICAgICBpZiAoIWRhdGVMYWJlbEJ5S2V5W2tleV0pIHsKICAgICAgICBkYXRlTGFiZWxCeUtleVtrZXldID0gU3RyaW5nKGl0Py5kYXRlTGFiZWxUciB8fCAiIik7CiAgICAgIH0KICAgIH0pOwoKICAgIC8vIOKchSBQb3B1cCBDU1MgKFN3YWwgacOnaSkKICAgIGNvbnN0IGNzcyA9IGAKICAgICAgPHN0eWxlPgogICAgICAgIC5iYS13cmFweyB0ZXh0LWFsaWduOmxlZnQ7IG1heC1oZWlnaHQ6NjJ2aDsgb3ZlcmZsb3c6YXV0bzsgcGFkZGluZy1yaWdodDo2cHg7IH0KICAgICAgICAuYmEtZGF5eyBtYXJnaW46MTRweCAwIDhweDsgZm9udC13ZWlnaHQ6OTAwOyBjb2xvcjojMGUxYjQyOyBkaXNwbGF5OmZsZXg7IGFsaWduLWl0ZW1zOmNlbnRlcjsgZ2FwOjEwcHg7IH0KCiAgICAgICAgLmJhLXNlY3Rpb257IG1hcmdpbjoxNnB4IDAgOHB4OyBmb250LXdlaWdodDo5MDA7IGNvbG9yOiMwZTFiNDI7IGZvbnQtc2l6ZToxcmVtOyB9CiAgICAgICAgLmJhLWRpdmlkZXJ7IG1hcmdpbjoxNHB4IDA7IGhlaWdodDoxcHg7IGJhY2tncm91bmQ6I2U5ZTllOTsgfQogICAgICAgIC5iYS1lbXB0eXsgcGFkZGluZzoxMHB4IDEycHg7IGJvcmRlcjoxcHggZGFzaGVkICNkZGQ7IGJvcmRlci1yYWRpdXM6MTJweDsgYmFja2dyb3VuZDojZmFmYWZhOyBjb2xvcjojNjY2OyBtYXJnaW46MTBweCAwOyBmb250LXdlaWdodDo3MDA7IH0KICAgICAgICAuYmEtYmFkZ2V7IGZvbnQtc2l6ZTouNzVyZW07IHBhZGRpbmc6NHB4IDhweDsgYm9yZGVyLXJhZGl1czo5OTlweDsgYm9yZGVyOjFweCBzb2xpZCAjZTllOWU5OyBiYWNrZ3JvdW5kOiNmOGY4Zjg7IGNvbG9yOiM0NDQ7IH0KICAgICAgICAuYmEtZ3JpZHsgZGlzcGxheTpncmlkOyBnYXA6OHB4OyB9CiAgICAgICAgLmJhLXJvd3sKICAgICAgICAgIGJvcmRlcjoxcHggc29saWQgI2VlZTsKICAgICAgICAgIGJvcmRlci1sZWZ0OjRweCBzb2xpZCB2YXIoLS1zZWNvbmRhcnkpOwogICAgICAgICAgYm9yZGVyLXJhZGl1czoxMnB4OwogICAgICAgICAgcGFkZGluZzoxMHB4IDEycHg7CiAgICAgICAgICBiYWNrZ3JvdW5kOiNmZmY7CiAgICAgICAgfQogICAgICAgIC5iYS1yb3cucGFzdHsKICAgICAgICAgIGJvcmRlci1sZWZ0LWNvbG9yOiNkOTUzNGY7CiAgICAgICAgICBiYWNrZ3JvdW5kOiNmZmY1ZjU7CiAgICAgICAgfQogICAgICAgIC5iYS10b3B7IGRpc3BsYXk6ZmxleDsganVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47IGdhcDoxMnB4OyBhbGlnbi1pdGVtczpmbGV4LXN0YXJ0OyB9CiAgICAgICAgLmJhLXRpdGxleyBmb250LXdlaWdodDo5MDA7IGNvbG9yOiMyMjI7IGxpbmUtaGVpZ2h0OjEuMjU7IH0KICAgICAgICAuYmEtdGltZXsgZm9udC13ZWlnaHQ6OTAwOyBjb2xvcjojMGUxYjQyOyB3aGl0ZS1zcGFjZTpub3dyYXA7IH0KICAgICAgICAuYmEtc3VieyBtYXJnaW4tdG9wOjZweDsgZm9udC1zaXplOi44NnJlbTsgY29sb3I6IzY2NjsgZGlzcGxheTpmbGV4OyBnYXA6MTRweDsgZmxleC13cmFwOndyYXA7IH0KICAgICAgICAuYmEtbGVnZW5keyBkaXNwbGF5OmZsZXg7IGdhcDoxMHB4OyBmbGV4LXdyYXA6d3JhcDsgbWFyZ2luOjZweCAwIDEwcHg7IH0KICAgICAgICAuYmEtZG90eyBkaXNwbGF5OmlubGluZS1mbGV4OyBhbGlnbi1pdGVtczpjZW50ZXI7IGdhcDo2cHg7IGZvbnQtc2l6ZTouOHJlbTsgY29sb3I6IzQ0NDsgfQogICAgICAgIC5iYS1kb3QgaXsgd2lkdGg6MTBweDsgaGVpZ2h0OjEwcHg7IGJvcmRlci1yYWRpdXM6NTAlOyBkaXNwbGF5OmlubGluZS1ibG9jazsgfQogICAgICAgIC5iYS1kb3QgLnVweyBiYWNrZ3JvdW5kOnZhcigtLXNlY29uZGFyeSk7IH0KICAgICAgICAuYmEtZG90IC5wYXsgYmFja2dyb3VuZDojZDk1MzRmOyB9CiAgICAgIDwvc3R5bGU+CiAgICBgOwoKICAgIGxldCBodG1sID0gYCR7Y3NzfTxkaXYgY2xhc3M9ImJhLXdyYXAiPmA7CiAgICBodG1sICs9IGAKICAgICAgPGRpdiBjbGFzcz0iYmEtbGVnZW5kIj4KICAgICAgICA8c3BhbiBjbGFzcz0iYmEtZG90Ij48aSBjbGFzcz0idXAiPjwvaT4gWWFrbGHFn2FuIC8gR2VsZWNlazwvc3Bhbj4KICAgICAgICA8c3BhbiBjbGFzcz0iYmEtZG90Ij48aSBjbGFzcz0icGEiPjwvaT4gVGFyaWhpIEdlw6dtacWfPC9zcGFuPgogICAgICA8L2Rpdj4KICAgIGA7CgogICAgICAgIC8vIOKchSBZYWtsYcWfYW4gLyBHZWxlY2VrIHZlIEdlw6dtacWfIG9sYXJhayBhecSxcgogICAgY29uc3QgdXBjb21pbmdCeURhdGUgPSB7fTsKICAgIGNvbnN0IHBhc3RCeURhdGUgPSB7fTsKICAgIGNvbnN0IGRhdGVLZXlzID0gT2JqZWN0LmtleXMoYnlEYXRlKTsKCiAgICBkYXRlS2V5cy5mb3JFYWNoKGtleSA9PiB7CiAgICAgIGNvbnN0IGFyciA9IGJ5RGF0ZVtrZXldIHx8IFtdOwogICAgICBhcnIuZm9yRWFjaChpdCA9PiB7CiAgICAgICAgY29uc3Qgc3RhcnRFcG9jaCA9IE51bWJlcihpdD8uc3RhcnRFcG9jaCB8fCAwKTsKICAgICAgICBjb25zdCBpc1Bhc3QgPSBzdGFydEVwb2NoID8gKHN0YXJ0RXBvY2ggPCBub3cpIDogZmFsc2U7CiAgICAgICAgY29uc3QgYnVja2V0ID0gaXNQYXN0ID8gcGFzdEJ5RGF0ZSA6IHVwY29taW5nQnlEYXRlOwogICAgICAgIGlmICghYnVja2V0W2tleV0pIGJ1Y2tldFtrZXldID0gW107CiAgICAgICAgYnVja2V0W2tleV0ucHVzaChpdCk7CiAgICAgIH0pOwogICAgfSk7CgogICAgY29uc3QgcmVuZGVyU2VjdGlvbiA9ICh0aXRsZSwgYnVja2V0LCBlbXB0eVRleHQpID0+IHsKICAgICAgY29uc3Qga2V5cyA9IGRhdGVLZXlzLmZpbHRlcihrID0+IChidWNrZXRba10gJiYgYnVja2V0W2tdLmxlbmd0aCkpOwogICAgICBpZiAoIWtleXMubGVuZ3RoKSB7CiAgICAgICAgaHRtbCArPSBgPGRpdiBjbGFzcz0iYmEtZW1wdHkiPiR7ZXNjYXBlSHRtbChlbXB0eVRleHQpfTwvZGl2PmA7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGh0bWwgKz0gYDxkaXYgY2xhc3M9ImJhLXNlY3Rpb24iPiR7ZXNjYXBlSHRtbCh0aXRsZSl9PC9kaXY+YDsKICAgICAga2V5cy5mb3JFYWNoKGtleSA9PiB7CiAgICAgICAgY29uc3QgbGFiZWwgPSBkYXRlTGFiZWxCeUtleVtrZXldIHx8IF9mb3JtYXRCcm9hZGNhc3REYXRlVHIoeyBkYXRlSVNPOiBrZXkgfSk7CiAgICAgICAgaHRtbCArPSBgPGRpdiBjbGFzcz0iYmEtZGF5Ij4ke2VzY2FwZUh0bWwobGFiZWwpfTwvZGl2PmA7CiAgICAgICAgaHRtbCArPSBgPGRpdiBjbGFzcz0iYmEtZ3JpZCI+YDsKCiAgICAgICAgYnVja2V0W2tleV0uZm9yRWFjaChpdCA9PiB7CiAgICAgICAgICBjb25zdCBzdGFydEVwb2NoID0gTnVtYmVyKGl0Py5zdGFydEVwb2NoIHx8IDApOwogICAgICAgICAgY29uc3QgaXNQYXN0ID0gc3RhcnRFcG9jaCA/IChzdGFydEVwb2NoIDwgbm93KSA6IGZhbHNlOwoKICAgICAgICAgIGNvbnN0IHRpbWUgPSBTdHJpbmcoaXQ/LnRpbWUgfHwgIiIpLnRyaW0oKTsKICAgICAgICAgIGNvbnN0IGV2ZW50ID0gU3RyaW5nKGl0Py5ldmVudCB8fCAiIikudHJpbSgpOwogICAgICAgICAgY29uc3QgYW5ub3VuY2VyID0gU3RyaW5nKGl0Py5hbm5vdW5jZXIgfHwgIiIpLnRyaW0oKTsKCiAgICAgICAgICBodG1sICs9IGAKICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmEtcm93ICR7aXNQYXN0ID8gInBhc3QiIDogIiJ9Ij4KICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJiYS10b3AiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmEtdGl0bGUiPiR7ZXNjYXBlSHRtbChldmVudCB8fCAiLSIpfTwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmEtdGltZSI+JHtlc2NhcGVIdG1sKHRpbWUgfHwgIiIpfTwvZGl2PgogICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImJhLXN1YiI+CiAgICAgICAgICAgICAgICA8c3Bhbj48aSBjbGFzcz0iZmFzIGZhLW1pY3JvcGhvbmUiPjwvaT4gJHtlc2NhcGVIdG1sKGFubm91bmNlciB8fCAiLSIpfTwvc3Bhbj4KICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICB9KTsKCiAgICAgICAgaHRtbCArPSBgPC9kaXY+YDsKICAgICAgfSk7CiAgICB9OwoKICAgIC8vIOKchSDDlm5jZSB5YWtsYcWfYW5sYXIsIHNvbnJhIGdlw6dtacWfbGVyCiAgICByZW5kZXJTZWN0aW9uKCJZYWtsYcWfYW4gLyBHZWxlY2VrIiwgdXBjb21pbmdCeURhdGUsICJZYWtsYcWfYW4geWF5xLFuIGJ1bHVuYW1hZMSxLiIpOwogICAgaHRtbCArPSBgPGRpdiBjbGFzcz0iYmEtZGl2aWRlciI+PC9kaXY+YDsKICAgIHJlbmRlclNlY3Rpb24oIkdlw6dtacWfIiwgcGFzdEJ5RGF0ZSwgIkdlw6dtacWfIHlhecSxbiBidWx1bmFtYWTEsS4iKTsKCiAgICBodG1sICs9IGA8L2Rpdj5gOwoKICAgIFN3YWwuZmlyZSh7CiAgICAgIHRpdGxlOiAiWWF5xLFuIEFrxLHFn8SxIiwKICAgICAgaHRtbCwKICAgICAgd2lkdGg6IDk4MCwKICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICJLYXBhdCIKICAgIH0pOwoKICB9IGNhdGNoIChlcnIpIHsKICAgIFN3YWwuZmlyZSgiSGF0YSIsIGVycj8ubWVzc2FnZSB8fCAiWWF5xLFuIGFrxLHFn8SxIGFsxLFuYW1hZMSxLiIsICJlcnJvciIpOwogIH0KfQoKLy8gWFNTIGtvcnVtYXPEsQoKZnVuY3Rpb24gX2Zvcm1hdEJyb2FkY2FzdERhdGVUcihpdCkgewogICAgLy8gQmFja2VuZCB5ZW5pIGFsYW5sYXLEsSBnw7ZuZGVyaXlvcnNhIGt1bGxhbgogICAgaWYgKGl0ICYmIGl0LmRhdGVMYWJlbFRyKSByZXR1cm4gU3RyaW5nKGl0LmRhdGVMYWJlbFRyKTsKCiAgICAvLyBGYWxsYmFjazogaXQuZGF0ZUlTTyAoeXl5eS1tbS1kZCkgdmV5YSBpdC5kYXRlCiAgICBjb25zdCBzID0gU3RyaW5nKGl0Py5kYXRlSVNPIHx8IGl0Py5kYXRlIHx8ICIiKS50cmltKCk7CiAgICBpZiAoIXMpIHJldHVybiAiVGFyaWggWW9rIjsKCiAgICAvLyBJU08geXl5eS1tbS1kZAogICAgY29uc3QgbSA9IHMubWF0Y2goL14oXGR7NH0pLShcZHsxLDJ9KS0oXGR7MSwyfSkvKTsKICAgIGlmIChtKSB7CiAgICAgICAgY29uc3QgZCA9IG5ldyBEYXRlKE51bWJlcihtWzFdKSwgTnVtYmVyKG1bMl0pIC0gMSwgTnVtYmVyKG1bM10pKTsKICAgICAgICByZXR1cm4gbmV3IEludGwuRGF0ZVRpbWVGb3JtYXQoInRyLVRSIiwgeyBkYXk6ICIyLWRpZ2l0IiwgbW9udGg6ICJsb25nIiwgeWVhcjogIm51bWVyaWMiLCB3ZWVrZGF5OiAibG9uZyIgfSkuZm9ybWF0KGQpOwogICAgfQoKICAgIC8vIGRkLm1tLnl5eXkgLyBkZC9tbS95eXl5CiAgICBjb25zdCBtMiA9IHMubWF0Y2goL14oXGR7MSwyfSlbXC4vLV0oXGR7MSwyfSlbXC4vLV0oXGR7NH0pLyk7CiAgICBpZiAobTIpIHsKICAgICAgICBjb25zdCBkID0gbmV3IERhdGUoTnVtYmVyKG0yWzNdKSwgTnVtYmVyKG0yWzJdKSAtIDEsIE51bWJlcihtMlsxXSkpOwogICAgICAgIHJldHVybiBuZXcgSW50bC5EYXRlVGltZUZvcm1hdCgidHItVFIiLCB7IGRheTogIjItZGlnaXQiLCBtb250aDogImxvbmciLCB5ZWFyOiAibnVtZXJpYyIsIHdlZWtkYXk6ICJsb25nIiB9KS5mb3JtYXQoZCk7CiAgICB9CgogICAgcmV0dXJuIHM7IC8vIGVuIGvDtnTDvCBoYWxpeWxlIGfDtnN0ZXIKfQoKZnVuY3Rpb24gZXNjYXBlSHRtbChzdHIpIHsKICAgIHJldHVybiBTdHJpbmcoc3RyID8/ICIiKQogICAgICAgIC5yZXBsYWNlQWxsKCImIiwgIiZhbXA7IikKICAgICAgICAucmVwbGFjZUFsbCgiPCIsICImbHQ7IikKICAgICAgICAucmVwbGFjZUFsbCgiPiIsICImZ3Q7IikKICAgICAgICAucmVwbGFjZUFsbCgnIicsICImcXVvdDsiKQogICAgICAgIC5yZXBsYWNlQWxsKCInIiwgIiYjMDM5OyIpOwp9CgpmdW5jdGlvbiBvcGVuR3VpZGUoKSB7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3VpZGUtbW9kYWwnKS5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOwogICAgY29uc3QgZ3JpZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdndWlkZS1ncmlkJyk7CiAgICBncmlkLmlubmVySFRNTCA9ICcnOwogICAgc3BvcnRzRGF0YS5mb3JFYWNoKChzLCBpbmRleCkgPT4gewogICAgICAgIGxldCBwcm9uSHRtbCA9IHMucHJvbnVuY2lhdGlvbiA/IGA8ZGl2IGNsYXNzPSJwcm9udW5jaWF0aW9uLWJhZGdlIj4g8J+Xo++4jyAgJHtzLnByb251bmNpYXRpb259PC9kaXY+YCA6ICcnOwogICAgICAgIGxldCBlZGl0QnRuID0gKGlzQWRtaW5Nb2RlICYmIGlzRWRpdGluZ0FjdGl2ZSkgPyBgPGkgY2xhc3M9ImZhcyBmYS1wZW5jaWwtYWx0IGVkaXQtaWNvbiIgc3R5bGU9InRvcDo1cHg7IHJpZ2h0OjVweDsgei1pbmRleDo1MDsiIG9uY2xpY2s9ImV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOyBlZGl0U3BvcnQoJyR7ZXNjYXBlRm9ySnNTdHJpbmcocy50aXRsZSl9JykiPjwvaT5gIDogJyc7CiAgICAgICAgZ3JpZC5pbm5lckhUTUwgKz0gYDxkaXYgY2xhc3M9Imd1aWRlLWl0ZW0iIG9uY2xpY2s9InNob3dTcG9ydERldGFpbCgke2luZGV4fSkiPiR7ZWRpdEJ0bn08aSBjbGFzcz0iZmFzICR7cy5pY29ufSBndWlkZS1pY29uIj48L2k+PHNwYW4gY2xhc3M9Imd1aWRlLXRpdGxlIj4ke3MudGl0bGV9PC9zcGFuPiR7cHJvbkh0bWx9PGRpdiBjbGFzcz0iZ3VpZGUtZGVzYyI+JHtzLmRlc2N9PC9kaXY+PGRpdiBjbGFzcz0iZ3VpZGUtdGlwIj48aSBjbGFzcz0iZmFzIGZhLWxpZ2h0YnVsYiI+PC9pPiAke3MudGlwfTwvZGl2PjxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjhyZW07IGNvbG9yOiM5OTk7IG1hcmdpbi10b3A6NXB4OyI+KERldGF5IGnDp2luIHTEsWtsYSk8L2Rpdj48L2Rpdj5gOwogICAgfSk7Cn0KZnVuY3Rpb24gc2hvd1Nwb3J0RGV0YWlsKGluZGV4KSB7CiAgICBjb25zdCBzcG9ydCA9IHNwb3J0c0RhdGFbaW5kZXhdOwogICAgY29uc3QgZGV0YWlsVGV4dCA9IHNwb3J0LmRldGFpbCA/IHNwb3J0LmRldGFpbC5yZXBsYWNlKC9cbi9nLCc8YnI+JykgOiAiQnUgacOnZXJpayBpw6dpbiBoZW7DvHogZGV0YXkgZWtsZW5tZW1pxZ8uIjsKICAgIGNvbnN0IHByb25EZXRhaWwgPSBzcG9ydC5wcm9udW5jaWF0aW9uID8gYDxkaXYgc3R5bGU9ImNvbG9yOiNlNjUxMDA7IGZvbnQtd2VpZ2h0OmJvbGQ7IG1hcmdpbi1ib3R0b206MTVweDsiPiDwn5ej77iPICBPa3VudcWfdTogJHtzcG9ydC5wcm9udW5jaWF0aW9ufTwvZGl2PmAgOiAnJzsKICAgIFN3YWwuZmlyZSh7CiAgICAgICAgdGl0bGU6IGA8aSBjbGFzcz0iZmFzICR7c3BvcnQuaWNvbn0iIHN0eWxlPSJjb2xvcjojMGUxYjQyOyI+PC9pPiAke3Nwb3J0LnRpdGxlfWAsCiAgICAgICAgaHRtbDogYCR7cHJvbkRldGFpbH08ZGl2IHN0eWxlPSJ0ZXh0LWFsaWduOmxlZnQ7IGZvbnQtc2l6ZToxcmVtOyBsaW5lLWhlaWdodDoxLjY7Ij4ke2RldGFpbFRleHR9PC9kaXY+YCwKICAgICAgICBzaG93Q2xvc2VCdXR0b246IHRydWUsIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwgd2lkdGg6ICc2MDBweCcsIGJhY2tncm91bmQ6ICcjZjhmOWZhJwogICAgfSk7Cn0KZnVuY3Rpb24gb3BlblNhbGVzKCkgewogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NhbGVzLW1vZGFsJykuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKICAgIGNvbnN0IGMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2FsZXMtZ3JpZCcpOwogICAgYy5pbm5lckhUTUwgPSAnJzsKICAgIHNhbGVzU2NyaXB0cy5mb3JFYWNoKChzLCBpbmRleCkgPT4gewogICAgICAgIGxldCBlZGl0QnRuID0gKGlzQWRtaW5Nb2RlICYmIGlzRWRpdGluZ0FjdGl2ZSkgPyBgPGkgY2xhc3M9ImZhcyBmYS1wZW5jaWwtYWx0IGVkaXQtaWNvbiIgc3R5bGU9InRvcDoxMHB4OyByaWdodDo0MHB4OyB6LWluZGV4OjUwOyIgb25jbGljaz0iZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7IGVkaXRTYWxlcygnJHtlc2NhcGVGb3JKc1N0cmluZyhzLnRpdGxlKX0nKSI+PC9pPmAgOiAnJzsKICAgICAgICBjLmlubmVySFRNTCArPSBgPGRpdiBjbGFzcz0ic2FsZXMtaXRlbSIgaWQ9InNhbGVzLSR7aW5kZXh9IiBvbmNsaWNrPSJ0b2dnbGVTYWxlcygnJHtpbmRleH0nKSI+JHtlZGl0QnRufTxkaXYgY2xhc3M9InNhbGVzLWhlYWRlciI+PHNwYW4gY2xhc3M9InNhbGVzLXRpdGxlIj4ke3MudGl0bGV9PC9zcGFuPjxpIGNsYXNzPSJmYXMgZmEtY2hldnJvbi1kb3duIiBpZD0iaWNvbi0ke2luZGV4fSIgc3R5bGU9ImNvbG9yOiMxMGI5ODE7Ij48L2k+PC9kaXY+PGRpdiBjbGFzcz0ic2FsZXMtdGV4dCI+JHsocy50ZXh0IHx8ICcnKS5yZXBsYWNlKC9cbi9nLCc8YnI+Jyl9PGRpdiBzdHlsZT0idGV4dC1hbGlnbjpyaWdodDsgbWFyZ2luLXRvcDoxNXB4OyI+PGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1jb3B5IiBvbmNsaWNrPSJldmVudC5zdG9wUHJvcGFnYXRpb24oKTsgY29weVRleHQoJyR7ZXNjYXBlRm9ySnNTdHJpbmcocy50ZXh0IHx8ICcnKX0nKSI+PGkgY2xhc3M9ImZhcyBmYS1jb3B5Ij48L2k+IEtvcHlhbGE8L2J1dHRvbj48L2Rpdj48L2Rpdj48L2Rpdj5gOwogICAgfSk7Cn0KZnVuY3Rpb24gdG9nZ2xlU2FsZXMoaW5kZXgpIHsKICAgIGNvbnN0IGl0ZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgc2FsZXMtJHtpbmRleH1gKTsKICAgIGNvbnN0IGljb24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgaWNvbi0ke2luZGV4fWApOwogICAgaXRlbS5jbGFzc0xpc3QudG9nZ2xlKCdhY3RpdmUnKTsKICAgIGlmKGl0ZW0uY2xhc3NMaXN0LmNvbnRhaW5zKCdhY3RpdmUnKSl7IGljb24uY2xhc3NMaXN0LnJlcGxhY2UoJ2ZhLWNoZXZyb24tZG93bicsICdmYS1jaGV2cm9uLXVwJyk7IH0gCiAgICBlbHNlIHsgaWNvbi5jbGFzc0xpc3QucmVwbGFjZSgnZmEtY2hldnJvbi11cCcsICdmYS1jaGV2cm9uLWRvd24nKTsgfQp9CgovLyAtLS0gUEVOQUxUWSBHQU1FIC0tLQovLyBUYXNhcsSxbS9Hw7xuY2VsbGVtZTogVGVrcmFybGF5YW4gc29ydSBlbmdlbGksIGFrxLFsbMSxIDUwOjUwLCBkb3VibGUgcm96ZXQsIGRhaGEgbmV0IG1hw6cgc29udSBla3JhbsSxCgpsZXQgcFNjb3JlID0gMCwgcEJhbGxzID0gMTAsIHBDdXJyZW50USA9IG51bGw7CmxldCBwUXVlc3Rpb25RdWV1ZSA9IFtdOyAgICAgICAgLy8gb3R1cnVtIGJveXVuY2Egc29ydWxhY2FrIHNvcnUgaW5kZWtzbGVyaSAoa2FyxLHFn3TEsXLEsWxtxLHFnykKbGV0IHBBc2tlZENvdW50ID0gMDsgICAgICAgICAgICAvLyBrYcOnIHNvcnUgc29ydWxkdQpsZXQgcENvcnJlY3RDb3VudCA9IDA7ICAgICAgICAgIC8vIGthw6cgZG/En3J1CmxldCBwV3JvbmdDb3VudCA9IDA7ICAgICAgICAgICAgLy8ga2HDpyB5YW5sxLHFnwoKZnVuY3Rpb24gc2V0RG91YmxlSW5kaWNhdG9yKGlzQWN0aXZlKSB7CiAgICBjb25zdCBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkb3VibGUtaW5kaWNhdG9yJyk7CiAgICBpZiAoIWVsKSByZXR1cm47CiAgICBlbC5zdHlsZS5kaXNwbGF5ID0gaXNBY3RpdmUgPyAnaW5saW5lLWZsZXgnIDogJ25vbmUnOwp9CgpmdW5jdGlvbiB1cGRhdGVKb2tlckJ1dHRvbnMoKSB7CiAgICBjb25zdCBjYWxsQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2pva2VyLWNhbGwnKTsKICAgIGNvbnN0IGhhbGZCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnam9rZXItaGFsZicpOwogICAgY29uc3QgZG91YmxlQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2pva2VyLWRvdWJsZScpOwoKICAgIGlmIChjYWxsQnRuKSBjYWxsQnRuLmRpc2FibGVkID0gam9rZXJzLmNhbGwgPT09IDA7CiAgICBpZiAoaGFsZkJ0bikgaGFsZkJ0bi5kaXNhYmxlZCA9IGpva2Vycy5oYWxmID09PSAwOwogICAgaWYgKGRvdWJsZUJ0bikgZG91YmxlQnRuLmRpc2FibGVkID0gam9rZXJzLmRvdWJsZSA9PT0gMCB8fCBmaXJzdEFuc3dlckluZGV4ICE9PSAtMTsKCiAgICAvLyBEb3VibGUgYWt0aWZrZW4gZGnEn2VybGVyaSBraWxpdGxlbnNpbgogICAgaWYgKGZpcnN0QW5zd2VySW5kZXggIT09IC0xKSB7CiAgICAgICAgaWYgKGNhbGxCdG4pIGNhbGxCdG4uZGlzYWJsZWQgPSB0cnVlOwogICAgICAgIGlmIChoYWxmQnRuKSBoYWxmQnRuLmRpc2FibGVkID0gdHJ1ZTsKICAgICAgICBpZiAoZG91YmxlQnRuKSBkb3VibGVCdG4uZGlzYWJsZWQgPSB0cnVlOwogICAgfQp9CgpmdW5jdGlvbiB1c2VKb2tlcih0eXBlKSB7CiAgICBpZiAoIXBDdXJyZW50USkgcmV0dXJuOwogICAgaWYgKGpva2Vyc1t0eXBlXSA9PT0gMCkgcmV0dXJuOwogICAgaWYgKGZpcnN0QW5zd2VySW5kZXggIT09IC0xICYmIHR5cGUgIT09ICdkb3VibGUnKSByZXR1cm47CgogICAgam9rZXJzW3R5cGVdID0gMDsKICAgIHVwZGF0ZUpva2VyQnV0dG9ucygpOwoKICAgIGNvbnN0IGN1cnJlbnRRID0gcEN1cnJlbnRROwogICAgY29uc3QgY29ycmVjdEFucyA9IGN1cnJlbnRRLmE7CiAgICBjb25zdCBidG5zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnBlbmFsdHktYnRuJyk7CgogICAgaWYgKHR5cGUgPT09ICdjYWxsJykgewogICAgICAgIGNvbnN0IGV4cGVydHMgPSBbIlVtdXQgQmV5IiwgIkRvxJ91xZ8gQmV5IiwgIkRlbml6IEJleSIsICJFc3JhIEhhbsSxbSJdOwogICAgICAgIGNvbnN0IGV4cGVydCA9IGV4cGVydHNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogZXhwZXJ0cy5sZW5ndGgpXTsKCiAgICAgICAgbGV0IGd1ZXNzID0gY29ycmVjdEFuczsKICAgICAgICAvLyAlODAgZG/En3J1LCAlMjAgeWFubMSxxZ8gdGFobWluCiAgICAgICAgaWYgKE1hdGgucmFuZG9tKCkgPiAwLjggJiYgY3VycmVudFEub3B0cy5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgIGNvbnN0IGluY29ycmVjdCA9IGN1cnJlbnRRLm9wdHMubWFwKChfLCBpKSA9PiBpKS5maWx0ZXIoaSA9PiBpICE9PSBjb3JyZWN0QW5zKTsKICAgICAgICAgICAgZ3Vlc3MgPSBpbmNvcnJlY3RbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogaW5jb3JyZWN0Lmxlbmd0aCldID8/IGNvcnJlY3RBbnM7CiAgICAgICAgfQoKICAgICAgICBTd2FsLmZpcmUoewogICAgICAgICAgICBpY29uOiAnaW5mbycsCiAgICAgICAgICAgIHRpdGxlOiAnIPCfk54gVGVsZWZvbiBKb2tlcmknLAogICAgICAgICAgICBodG1sOiBgJHtleHBlcnR9IHNvcnV5dSBjZXZhcGzEsXlvci4uLjxicj48YnI+IkJlbmltIHRhaG1pbmltICoqJHtTdHJpbmcuZnJvbUNoYXJDb2RlKDY1ICsgZ3Vlc3MpfSoqIMWfxLFra8SxLiBCdW5kYW4gJHtNYXRoLnJhbmRvbSgpIDwgMC44ID8gIsOnb2sgZW1pbmltIiA6ICJlbWluIGRlxJ9pbGltIn0uImAsCiAgICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAnS2FwYXQnCiAgICAgICAgfSk7CgogICAgfSBlbHNlIGlmICh0eXBlID09PSAnaGFsZicpIHsKICAgICAgICBjb25zdCBvcHRMZW4gPSBBcnJheS5pc0FycmF5KGN1cnJlbnRRLm9wdHMpID8gY3VycmVudFEub3B0cy5sZW5ndGggOiAwOwogICAgICAgIGlmIChvcHRMZW4gPD0gMikgewogICAgICAgICAgICBTd2FsLmZpcmUoeyBpY29uOidpbmZvJywgdGl0bGU6J+Kcgu+4jyA1MDo1MCcsIHRleHQ6J0J1IHNvcnVkYSA1MDo1MCB1eWd1bGFuYW1hei4nLCB0b2FzdDp0cnVlLCBwb3NpdGlvbjondG9wJywgc2hvd0NvbmZpcm1CdXR0b246ZmFsc2UsIHRpbWVyOjE4MDAgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIDQrIMWfxLFrdGEgMiB5YW5sxLHFnywgMyDFn8Sxa3RhIDEgeWFubMSxxZ8gZWxlCiAgICAgICAgY29uc3QgcmVtb3ZlQ291bnQgPSBvcHRMZW4gPj0gNCA/IDIgOiAxOwogICAgICAgIGNvbnN0IGluY29ycmVjdCA9IGN1cnJlbnRRLm9wdHMubWFwKChfLCBpKSA9PiBpKS5maWx0ZXIoaSA9PiBpICE9PSBjb3JyZWN0QW5zKTsKICAgICAgICBpbmNvcnJlY3Quc29ydCgoKSA9PiBNYXRoLnJhbmRvbSgpIC0gMC41KS5zbGljZSgwLCByZW1vdmVDb3VudCkuZm9yRWFjaChpZHggPT4gewogICAgICAgICAgICBjb25zdCBiID0gYnRuc1tpZHhdOwogICAgICAgICAgICBpZiAoIWIpIHJldHVybjsKICAgICAgICAgICAgYi5kaXNhYmxlZCA9IHRydWU7CiAgICAgICAgICAgIGIuc3R5bGUudGV4dERlY29yYXRpb24gPSAnbGluZS10aHJvdWdoJzsKICAgICAgICAgICAgYi5zdHlsZS5vcGFjaXR5ID0gJzAuNCc7CiAgICAgICAgfSk7CgogICAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgICAgIGljb246ICdzdWNjZXNzJywKICAgICAgICAgICAgdGl0bGU6ICcg4pyC77iPIDUwOjUwJywKICAgICAgICAgICAgdGV4dDogcmVtb3ZlQ291bnQgPT09IDIgPyAnxLBraSB5YW5sxLHFnyDFn8SxayBlbGVuZGkhJyA6ICdCaXIgeWFubMSxxZ8gxZ/EsWsgZWxlbmRpIScsCiAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICBwb3NpdGlvbjogJ3RvcCcsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdGltZXI6IDE0MDAKICAgICAgICB9KTsKCiAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdkb3VibGUnKSB7CiAgICAgICAgZG91YmxlQ2hhbmNlVXNlZCA9IHRydWU7CiAgICAgICAgc2V0RG91YmxlSW5kaWNhdG9yKHRydWUpOwogICAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgICAgIGljb246ICd3YXJuaW5nJywKICAgICAgICAgICAgdGl0bGU6ICcy77iPIOKDoyDDh2lmdCBDZXZhcCcsCiAgICAgICAgICAgIHRleHQ6ICdCaXIga2V6IHlhbmzEscWfIGNldmFwIGhha2vEsW4gdmFyLicsCiAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICBwb3NpdGlvbjogJ3RvcCcsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdGltZXI6IDIyMDAKICAgICAgICB9KTsKICAgIH0KfQoKCmZ1bmN0aW9uIG9wZW5HYW1lSHViKCkgewogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dhbWUtaHViLW1vZGFsJykuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKfQoKZnVuY3Rpb24gb3BlblF1aWNrRGVjaXNpb25HYW1lKCkgewogICAgdHJ5IHsgY2xvc2VNb2RhbCgnZ2FtZS1odWItbW9kYWwnKTsgfSBjYXRjaChlKSB7fQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1aWNrLW1vZGFsJykuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKCiAgICAvLyBMb2JieSBla3JhbsSxCiAgICBjb25zdCBsb2JieSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxZC1sb2JieScpOwogICAgY29uc3QgZ2FtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxZC1nYW1lJyk7CiAgICBpZiAobG9iYnkpIGxvYmJ5LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgaWYgKGdhbWUpIGdhbWUuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKCiAgICAvLyBSZXNldCBnw7ZzdGVyZ2VsZXIKICAgIGNvbnN0IHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWQtdGltZScpOyBpZiAodCkgdC5pbm5lclRleHQgPSAnMzAnOwogICAgY29uc3QgcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxZC1zY29yZScpOyBpZiAocykgcy5pbm5lclRleHQgPSAnMCc7CiAgICBjb25zdCBzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxZC1zdGVwJyk7IGlmIChzdCkgc3QuaW5uZXJUZXh0ID0gJzAnOwp9CgovLyAtLS0gSElaTEkgS0FSQVIgT1lVTlUgLS0tCmxldCBxZFRpbWVyID0gbnVsbDsKbGV0IHFkVGltZUxlZnQgPSAzMDsKbGV0IHFkU2NvcmUgPSAwOwpsZXQgcWRTdGVwID0gMDsKbGV0IHFkUXVldWUgPSBbXTsKCmNvbnN0IFFVSUNLX0RFQ0lTSU9OX0JBTksgPSBbCiAgewogICAgcTogJ03DvMWfdGVyaTogIkZpeWF0IHBhaGFsxLEsIGlwdGFsIGVkZWNlxJ9pbS4iIMSwbGsgeWFrbGHFn8SxbcSxbiBuZSBvbG1hbMSxPycsCiAgICBvcHRzOiBbCiAgICAgICdIZW1lbiBpcHRhbCBpxZ9sZW1pbmkgYmHFn2xhdGFsxLFtLicsCiAgICAgICdIYWtsxLFzxLFuxLF6LCBzaXppIGFubMSxeW9ydW0uIFBha2V0L2F2YW50YWpsYXJhIGfDtnJlIGFsdGVybmF0aWYgc3VuYXnEsW0gbcSxPycsCiAgICAgICdLYW1wYW55YSB5b2ssIHlhcGFjYWsgYmlyIMWfZXkgeW9rLicKICAgIF0sCiAgICBhOiAxLAogICAgZXhwOiAnRW1wYXRpICsgaWh0aXlhw6cgYW5hbGl6aSBpdGlyYXrEsSB5dW11xZ9hdMSxciB2ZSBpa25hecSxIGFydMSxcsSxci4nCiAgfSwKICB7CiAgICBxOiAnTcO8xZ90ZXJpOiAiVXlndWxhbWEgYcOnxLFsbcSxeW9yLiIgRW4gaMSxemzEsSBpbGsga29udHJvbCBuZT8nLAogICAgb3B0czogWwogICAgICAnxZ5pZnJleWkgc8SxZsSxcmxhdC4nLAogICAgICAnxLBudGVybmV0IGJhxJ9sYW50xLFzxLEgLyBWUE4gLyBETlMga29udHJvbMO8IHlhcHTEsXIuJywKICAgICAgJ0hlbWVuIGNpaGF6xLEgZmFicmlrYSBheWFybGFyxLFuYSBkw7ZuZMO8ci4nCiAgICBdLAogICAgYTogMSwKICAgIGV4cDogJ8OWbmNlIGvDtmsgbmVkZW5pIGRhcmFsdDogYmHEn2xhbnTEsSBtxLEgdXlndWxhbWEgbcSxPyBCw7x5w7xrIGFkxLFtbGFyxLEgc29uYSBixLFyYWsuJwogIH0sCiAgewogICAgcTogJ03DvMWfdGVyaTogIllhecSxbiBkb251eW9yLiIgVGVrbmlrdGUgZG/En3J1IHNvcnUgaGFuZ2lzaT8nLAogICAgb3B0czogWwogICAgICAnSGFuZ2kgY2loYXpkYSAoVFYvdGVsZWZvbikgdmUgaGFuZ2kgYcSfZGEgKFdp4oCRRmkva2FibG8pIG9sdXlvcj8nLAogICAgICAnS2HDpyBnw7xuZMO8ciBiw7Z5bGU/JywKICAgICAgJ8WeaW1kaSBrYXBhdMSxcCBhw6fEsW4uJwogICAgXSwKICAgIGE6IDAsCiAgICBleHA6ICdDaWhheiArIGHEnyBiaWxnaXNpLCBzb3J1bnUgaMSxemzEsSBpem9sZSBldG1leWkgc2HEn2xhci4nCiAgfSwKICB7CiAgICBxOiAnTcO8xZ90ZXJpOiAixLBhZGUgaXN0aXlvcnVtLiIgRW4gZG/En3J1IHnDtm5sZW5kaXJtZT8nLAogICAgb3B0czogWwogICAgICAnSGVtZW4ga2FwYXRhbMSxbS4nLAogICAgICAnxLBhZGUga2/Fn3VsbGFyxLEgdmUgYWTEsW1sYXLEsSBuZXQgYW5sYXQsIGRvxJ9ydSBrYW5hbGEgecO2bmxlbmRpciAoYXNpc3Rhbi9yZWhiZXIpLicsCiAgICAgICdUZWtyYXIgYXJhecSxbi4nCiAgICBdLAogICAgYTogMSwKICAgIGV4cDogJ05ldCBzw7xyZcOnICsgZG/En3J1IGthbmFsID0gbWVtbnVuaXlldCArIHRla3JhciBhcmFtYXnEsSBhemFsdMSxci4nCiAgfSwKICB7CiAgICBxOiAnTcO8xZ90ZXJpOiAiS2FtcGFueWFkYW4geWFyYXJsYW5hbcSxeW9ydW0uIiDEsGxrIGFkxLFtPycsCiAgICBvcHRzOiBbCiAgICAgICdLYW1wYW55YSBrb8WfdWxsYXLEsSAodGFyaWgvcGFrZXQvY2loYXopIHV5Z3VuIG11IGtvbnRyb2wgZXQuJywKICAgICAgJ0RpcmVrdCBrYW1wYW55YXnEsSB0YW7EsW1sYS4nLAogICAgICAnU29ydW4geW9rIGRleWlwIGthcGF0LicKICAgIF0sCiAgICBhOiAwLAogICAgZXhwOiAnVXlndW5sdWsga29udHJvbMO8IHlhcMSxbG1hZGFuIGnFn2xlbSB5YXBtYWsgaGF0YXlhIHPDvHLDvGtsZXIuJwogIH0sCiAgewogICAgcTogJ03DvMWfdGVyaSBzaW5pcmxpOiAiS2ltc2Ugw6fDtnptZWRpISIgTmUgeWFwYXJzxLFuPycsCiAgICBvcHRzOiBbCiAgICAgICdTYWtpbmxlxZ90aXJpY2kgYmlyIGPDvG1sZSArIMO2emV0ICsgbmV0IGFrc2l5b24gcGxhbsSxLicsCiAgICAgICdTxLFyYXlhIGFsYWzEsW0uJywKICAgICAgJ1NlcyB5w7xrc2VsdC4nCiAgICBdLAogICAgYTogMCwKICAgIGV4cDogJ0tvbnRyb2zDvCBnZXJpIGFsbWFrIGnDp2luIGVtcGF0aSArIMO2emV0ICsgcGxhbiDDvMOnbMO8c8O8IMOnYWzEscWfxLFyLicKICB9Cl07CgpmdW5jdGlvbiByZXNldFF1aWNrRGVjaXNpb24oKSB7CiAgICBpZiAocWRUaW1lcikgeyBjbGVhckludGVydmFsKHFkVGltZXIpOyBxZFRpbWVyID0gbnVsbDsgfQogICAgcWRUaW1lTGVmdCA9IDMwOyBxZFNjb3JlID0gMDsgcWRTdGVwID0gMDsgcWRRdWV1ZSA9IFtdOwogICAgb3BlblF1aWNrRGVjaXNpb25HYW1lKCk7Cn0KCmZ1bmN0aW9uIHN0YXJ0UXVpY2tEZWNpc2lvbigpIHsKICAgIGNvbnN0IGJhbmsgPSBBcnJheS5pc0FycmF5KHF1aWNrRGVjaXNpb25RdWVzdGlvbnMpID8gcXVpY2tEZWNpc2lvblF1ZXN0aW9ucyA6IFtdOwogICAgaWYgKCFiYW5rLmxlbmd0aCkgewogICAgICAgIFN3YWwuZmlyZSgnQmlsZ2knLCAnU29ydWxhciBoZW7DvHogecO8a2xlbm1lZGkuIEzDvHRmZW4gYWRtaW4gcGFuZWxkZW4gc29ydWxhcsSxIGVrbGV5aW4gdmUgc2F5ZmF5xLEgeWVuaWxleWluLicsICdpbmZvJyk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGNvbnN0IHRha2UgPSBNYXRoLm1pbig1LCBiYW5rLmxlbmd0aCk7CiAgICBjb25zdCBpZHhzID0gQXJyYXkuZnJvbSh7bGVuZ3RoOiBiYW5rLmxlbmd0aH0sIChfLGkpPT5pKS5zb3J0KCgpPT5NYXRoLnJhbmRvbSgpLTAuNSkuc2xpY2UoMCwgdGFrZSk7CiAgICBxZFF1ZXVlID0gaWR4cy5tYXAoaSA9PiBiYW5rW2ldKTsKICAgIHFkVGltZUxlZnQgPSAzMDsKICAgIHFkU2NvcmUgPSAwOwogICAgcWRTdGVwID0gMDsKCiAgICBjb25zdCBsb2JieSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxZC1sb2JieScpOwogICAgY29uc3QgZ2FtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxZC1nYW1lJyk7CiAgICBpZiAobG9iYnkpIGxvYmJ5LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICBpZiAoZ2FtZSkgZ2FtZS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKCiAgICB1cGRhdGVRdWlja0h1ZCgpOwogICAgcmVuZGVyUXVpY2tRdWVzdGlvbigpOwoKICAgIGlmIChxZFRpbWVyKSBjbGVhckludGVydmFsKHFkVGltZXIpOwogICAgcWRUaW1lciA9IHNldEludGVydmFsKCgpID0+IHsKICAgICAgICBxZFRpbWVMZWZ0IC09IDE7CiAgICAgICAgdXBkYXRlUXVpY2tIdWQoKTsKICAgICAgICBpZiAocWRUaW1lTGVmdCA8PSAwKSB7CiAgICAgICAgICAgIGZpbmlzaFF1aWNrRGVjaXNpb24odHJ1ZSk7CiAgICAgICAgfQogICAgfSwgMTAwMCk7Cn0KCmZ1bmN0aW9uIHVwZGF0ZVF1aWNrSHVkKCkgewogICAgY29uc3QgdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxZC10aW1lJyk7IGlmICh0KSB0LmlubmVyVGV4dCA9IFN0cmluZyhNYXRoLm1heCgwLCBxZFRpbWVMZWZ0KSk7CiAgICBjb25zdCBzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FkLXNjb3JlJyk7IGlmIChzKSBzLmlubmVyVGV4dCA9IFN0cmluZyhxZFNjb3JlKTsKICAgIGNvbnN0IHN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FkLXN0ZXAnKTsgaWYgKHN0KSBzdC5pbm5lclRleHQgPSBTdHJpbmcocWRTdGVwKTsKfQoKZnVuY3Rpb24gcmVuZGVyUXVpY2tRdWVzdGlvbigpIHsKICAgIGNvbnN0IHEgPSBxZFF1ZXVlW3FkU3RlcF07CiAgICBjb25zdCBxRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWQtcXVlc3Rpb24nKTsKICAgIGNvbnN0IG9wdEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FkLW9wdGlvbnMnKTsKICAgIGlmICghcUVsIHx8ICFvcHRFbCB8fCAhcSkgcmV0dXJuOwoKICAgIHFFbC5pbm5lclRleHQgPSBxLnE7CiAgICBvcHRFbC5pbm5lckhUTUwgPSAnJzsKCiAgICBxLm9wdHMuZm9yRWFjaCgodHh0LCBpKSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpOwogICAgICAgIGIuY2xhc3NOYW1lID0gJ3F1aWNrLW9wdCc7CiAgICAgICAgYi5pbm5lclRleHQgPSB0eHQ7CiAgICAgICAgYi5vbmNsaWNrID0gKCkgPT4gYW5zd2VyUXVpY2soaSk7CiAgICAgICAgb3B0RWwuYXBwZW5kQ2hpbGQoYik7CiAgICB9KTsKfQoKZnVuY3Rpb24gYW5zd2VyUXVpY2soaWR4KSB7CiAgICBjb25zdCBxID0gcWRRdWV1ZVtxZFN0ZXBdOwogICAgY29uc3Qgb3B0RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWQtb3B0aW9ucycpOwogICAgaWYgKCFxIHx8ICFvcHRFbCkgcmV0dXJuOwoKICAgIGNvbnN0IGJ0bnMgPSBBcnJheS5mcm9tKG9wdEVsLnF1ZXJ5U2VsZWN0b3JBbGwoJ2J1dHRvbicpKTsKICAgIGJ0bnMuZm9yRWFjaChiID0+IGIuZGlzYWJsZWQgPSB0cnVlKTsKCiAgICBjb25zdCBjb3JyZWN0ID0gKGlkeCA9PT0gcS5hKTsKCiAgICBpZiAoYnRuc1tpZHhdKSBidG5zW2lkeF0uY2xhc3NMaXN0LmFkZChjb3JyZWN0ID8gJ2dvb2QnIDogJ2JhZCcpOwogICAgaWYgKCFjb3JyZWN0ICYmIGJ0bnNbcS5hXSkgYnRuc1txLmFdLmNsYXNzTGlzdC5hZGQoJ2dvb2QnKTsKCiAgICAvLyBwdWFubGFtYTogZG/En3J1ICsyLCB5YW5sxLHFnyAtMQogICAgcWRTY29yZSArPSBjb3JyZWN0ID8gMiA6IC0xOwogICAgaWYgKHFkU2NvcmUgPCAwKSBxZFNjb3JlID0gMDsKICAgIHVwZGF0ZVF1aWNrSHVkKCk7CgogICAgU3dhbC5maXJlKHsKICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICBwb3NpdGlvbjogJ3RvcCcsCiAgICAgICAgaWNvbjogY29ycmVjdCA/ICdzdWNjZXNzJyA6ICd3YXJuaW5nJywKICAgICAgICB0aXRsZTogY29ycmVjdCA/ICdEb8SfcnUgc2XDp2ltIScgOiAnWWFubMSxxZ8gc2XDp2ltJywKICAgICAgICB0ZXh0OiBxLmV4cCwKICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgdGltZXI6IDE4MDAKICAgIH0pOwoKICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIHFkU3RlcCArPSAxOwogICAgICAgIHVwZGF0ZVF1aWNrSHVkKCk7CiAgICAgICAgaWYgKHFkU3RlcCA+PSBxZFF1ZXVlLmxlbmd0aCkgZmluaXNoUXVpY2tEZWNpc2lvbihmYWxzZSk7CiAgICAgICAgZWxzZSByZW5kZXJRdWlja1F1ZXN0aW9uKCk7CiAgICB9LCA2NTApOwp9CgpmdW5jdGlvbiBmaW5pc2hRdWlja0RlY2lzaW9uKHRpbWVvdXQpIHsKICAgIGlmIChxZFRpbWVyKSB7IGNsZWFySW50ZXJ2YWwocWRUaW1lcik7IHFkVGltZXIgPSBudWxsOyB9CgogICAgY29uc3QgbXNnID0gdGltZW91dCA/ICdTw7xyZSBiaXR0aSEnIDogJ0JpdHRpISc7CiAgICBTd2FsLmZpcmUoewogICAgICAgIGljb246ICdpbmZvJywKICAgICAgICB0aXRsZTogYPCfp6AgSMSxemzEsSBLYXJhciAke21zZ31gLAogICAgICAgIGh0bWw6IGA8ZGl2IHN0eWxlPSJ0ZXh0LWFsaWduOmNlbnRlcjsiPgogICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iZm9udC1zaXplOjEuMHJlbTsgbWFyZ2luLWJvdHRvbTo4cHg7Ij5Ta29ydW46IDxiPiR7cWRTY29yZX08L2I+PC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJjb2xvcjojNjY2OyBmb250LXNpemU6MC45cmVtOyI+xLBzdGVyc2VuIHllbmlkZW4gYmHFn2xhdMSxcCByZWtvciBkZW5leWViaWxpcnNpbi48L2Rpdj4KICAgICAgICAgICAgICA8L2Rpdj5gLAogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAnVGFtYW0nCiAgICB9KTsKCiAgICAvLyBMb2JieSdlIGTDtm4KICAgIGNvbnN0IGxvYmJ5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FkLWxvYmJ5Jyk7CiAgICBjb25zdCBnYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FkLWdhbWUnKTsKICAgIGlmIChsb2JieSkgbG9iYnkuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICBpZiAoZ2FtZSkgZ2FtZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgY29uc3QgdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxZC10aW1lJyk7IGlmICh0KSB0LmlubmVyVGV4dCA9ICczMCc7CiAgICBjb25zdCBzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxZC1zdGVwJyk7IGlmIChzdCkgc3QuaW5uZXJUZXh0ID0gJzAnOwp9CgpmdW5jdGlvbiBvcGVuUGVuYWx0eUdhbWUoKSB7CiAgICB0cnkgeyBjbG9zZU1vZGFsKCdnYW1lLWh1Yi1tb2RhbCcpOyB9IGNhdGNoKGUpIHt9CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGVuYWx0eS1tb2RhbCcpLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7CiAgICBzaG93TG9iYnkoKTsKfQoKZnVuY3Rpb24gc2hvd0xvYmJ5KCkgewogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BlbmFsdHktbG9iYnknKS5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BlbmFsdHktZ2FtZS1hcmVhJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgIGZldGNoTGVhZGVyYm9hcmQoKTsKfQoKZnVuY3Rpb24gc3RhcnRHYW1lRnJvbUxvYmJ5KCkgewogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BlbmFsdHktbG9iYnknKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BlbmFsdHktZ2FtZS1hcmVhJykuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICBzdGFydFBlbmFsdHlTZXNzaW9uKCk7Cn0KCmZ1bmN0aW9uIGZldGNoTGVhZGVyYm9hcmQoKSB7CiAgICBjb25zdCB0Ym9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsZWFkZXJib2FyZC1ib2R5Jyk7CiAgICBjb25zdCBsb2FkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGVhZGVyYm9hcmQtbG9hZGVyJyk7CiAgICBjb25zdCB0YWJsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsZWFkZXJib2FyZC10YWJsZScpOwoKICAgIGlmICghdGJvZHkgfHwgIWxvYWRlciB8fCAhdGFibGUpIHJldHVybjsKCiAgICB0Ym9keS5pbm5lckhUTUwgPSAnJzsKICAgIGxvYWRlci5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgIHRhYmxlLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CgogICAgZmV0Y2goU0NSSVBUX1VSTCwgewogICAgICAgIG1ldGhvZDogJ1BPU1QnLAogICAgICAgIGhlYWRlcnM6IHsgIkNvbnRlbnQtVHlwZSI6ICJ0ZXh0L3BsYWluO2NoYXJzZXQ9dXRmLTgiIH0sCiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBhY3Rpb246ICJnZXRMZWFkZXJib2FyZCIgfSkKICAgIH0pCiAgICAudGhlbihyID0+IHIuanNvbigpKQogICAgLnRoZW4oZGF0YSA9PiB7CiAgICAgICAgbG9hZGVyLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgaWYgKGRhdGEucmVzdWx0ICE9PSAic3VjY2VzcyIpIHsKICAgICAgICAgICAgbG9hZGVyLmlubmVyVGV4dCA9ICJZw7xrbGVuZW1lZGkuIjsKICAgICAgICAgICAgbG9hZGVyLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB0YWJsZS5zdHlsZS5kaXNwbGF5ID0gJ3RhYmxlJzsKICAgICAgICBsZXQgaHRtbCA9ICcnOwoKICAgICAgICBpZiAoIWRhdGEubGVhZGVyYm9hcmQgfHwgZGF0YS5sZWFkZXJib2FyZC5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgaHRtbCA9ICc8dHI+PHRkIGNvbHNwYW49IjQiIHN0eWxlPSJ0ZXh0LWFsaWduOmNlbnRlcjsiPkhlbsO8eiBtYcOnIHlhcMSxbG1hZMSxLjwvdGQ+PC90cj4nOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGRhdGEubGVhZGVyYm9hcmQuZm9yRWFjaCgodSwgaSkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgbWVkYWwgPSBpPT09MCA/ICfwn6WHJyA6IChpPT09MSA/ICfwn6WIJyA6IChpPT09MiA/ICfwn6WJJyA6IGA8c3BhbiBjbGFzcz0icmFuay1iYWRnZSI+JHtpKzF9PC9zcGFuPmApKTsKICAgICAgICAgICAgICAgIGNvbnN0IGJnU3R5bGUgPSAodS51c2VybmFtZSA9PT0gY3VycmVudFVzZXIpID8gJ2JhY2tncm91bmQ6cmdiYSgyNTAsIDE4NywgMCwgMC4xKTsnIDogJyc7CiAgICAgICAgICAgICAgICBodG1sICs9IGA8dHIgc3R5bGU9IiR7YmdTdHlsZX0iPjx0ZD4ke21lZGFsfTwvdGQ+PHRkPiR7dS51c2VybmFtZX08L3RkPjx0ZD4ke3UuZ2FtZXN9PC90ZD48dGQ+JHt1LmF2ZXJhZ2V9PC90ZD48L3RyPmA7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICB0Ym9keS5pbm5lckhUTUwgPSBodG1sOwogICAgfSkKICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgbG9hZGVyLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgbG9hZGVyLmlubmVyVGV4dCA9ICJCYcSfbGFudMSxIGhhdGFzxLEuIjsKICAgICAgICBsb2FkZXIuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICB9KTsKfQoKZnVuY3Rpb24gYnVpbGRRdWVzdGlvblF1ZXVlKCkgewogICAgY29uc3QgbiA9IHF1aXpRdWVzdGlvbnMubGVuZ3RoOwogICAgY29uc3QgaWR4cyA9IEFycmF5LmZyb20oeyBsZW5ndGg6IG4gfSwgKF8sIGkpID0+IGkpOwogICAgaWR4cy5zb3J0KCgpID0+IE1hdGgucmFuZG9tKCkgLSAwLjUpOwoKICAgIC8vIDEwIHNvcnUgacOnaW4geWV0ZXIgeW9rc2EsIHlpbmUgZGUgZMO2bmfDvHllIHNva21heWFsxLFtOiBrYWxhbiB0b3BsYXJkYSB0ZWtyYXIgb2xhYmlsaXIuCiAgICAvLyBhbWEgw7ZuY2UgdMO8bSBzb3J1bGFyIGJpciBrZXogZ2Vsc2luLgogICAgcmV0dXJuIGlkeHM7Cn0KCmZ1bmN0aW9uIHN0YXJ0UGVuYWx0eVNlc3Npb24oKSB7CiAgICAvLyBTZXNzaW9uIHJlc2V0CiAgICBwU2NvcmUgPSAwOwogICAgcEJhbGxzID0gMTA7CiAgICBwQXNrZWRDb3VudCA9IDA7CiAgICBwQ29ycmVjdENvdW50ID0gMDsKICAgIHBXcm9uZ0NvdW50ID0gMDsKCiAgICBqb2tlcnMgPSB7IGNhbGw6IDEsIGhhbGY6IDEsIGRvdWJsZTogMSB9OwogICAgZG91YmxlQ2hhbmNlVXNlZCA9IGZhbHNlOwogICAgZmlyc3RBbnN3ZXJJbmRleCA9IC0xOwogICAgc2V0RG91YmxlSW5kaWNhdG9yKGZhbHNlKTsKCiAgICAvLyBTb3J1IGt1eXJ1xJ91CiAgICBwUXVlc3Rpb25RdWV1ZSA9IGJ1aWxkUXVlc3Rpb25RdWV1ZSgpOwoKICAgIHVwZGF0ZUpva2VyQnV0dG9ucygpOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Atc2NvcmUnKS5pbm5lclRleHQgPSBwU2NvcmU7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncC1iYWxscycpLmlubmVyVGV4dCA9IHBCYWxsczsKCiAgICBjb25zdCByZXN0YXJ0QnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3AtcmVzdGFydC1idG4nKTsKICAgIGNvbnN0IG9wdGlvbnNFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwLW9wdGlvbnMnKTsKICAgIGlmIChyZXN0YXJ0QnRuKSByZXN0YXJ0QnRuLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICBpZiAob3B0aW9uc0VsKSBvcHRpb25zRWwuc3R5bGUuZGlzcGxheSA9ICdncmlkJzsKCiAgICByZXNldEZpZWxkKCk7CiAgICBsb2FkUGVuYWx0eVF1ZXN0aW9uKCk7Cn0KCmZ1bmN0aW9uIHBpY2tOZXh0UXVlc3Rpb24oKSB7CiAgICBpZiAocXVpelF1ZXN0aW9ucy5sZW5ndGggPT09IDApIHJldHVybiBudWxsOwoKICAgIC8vIMOWbmNlIGt1eXJ1a3RhbiB0w7xrZXQKICAgIGlmIChwUXVlc3Rpb25RdWV1ZS5sZW5ndGggPiAwKSB7CiAgICAgICAgY29uc3QgaSA9IHBRdWVzdGlvblF1ZXVlLnNoaWZ0KCk7CiAgICAgICAgcmV0dXJuIHF1aXpRdWVzdGlvbnNbaV07CiAgICB9CgogICAgLy8gS3V5cnVrIGJpdHRpIGFtYSB0b3AgZGV2YW0gZWRpeW9yOiBhcnTEsWsgcmFuZG9tIChzb3J1IGF6c2EpCiAgICByZXR1cm4gcXVpelF1ZXN0aW9uc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBxdWl6UXVlc3Rpb25zLmxlbmd0aCldOwp9CgpmdW5jdGlvbiBsb2FkUGVuYWx0eVF1ZXN0aW9uKCkgewogICAgaWYgKHBCYWxscyA8PSAwKSB7IGZpbmlzaFBlbmFsdHlHYW1lKCk7IHJldHVybjsgfQogICAgaWYgKCFBcnJheS5pc0FycmF5KHF1aXpRdWVzdGlvbnMpIHx8IHF1aXpRdWVzdGlvbnMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgU3dhbC5maXJlKCdIYXRhJywgJ1NvcnUgeW9rIScsICd3YXJuaW5nJyk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIHBDdXJyZW50USA9IHBpY2tOZXh0UXVlc3Rpb24oKTsKICAgIGlmICghcEN1cnJlbnRRIHx8ICFwQ3VycmVudFEub3B0cyB8fCBwQ3VycmVudFEub3B0cy5sZW5ndGggPCAyKSB7CiAgICAgICAgU3dhbC5maXJlKCdIYXRhJywgJ0J1IHNvcnUgaGF0YWzEsSBmb3JtYXR0YSAoxZ/EsWsgeW9rKS4nLCAnZXJyb3InKTsKICAgICAgICAvLyBiaXIgc29ucmFraSBzb3J1eXUgZGVuZQogICAgICAgIHBDdXJyZW50USA9IHBpY2tOZXh0UXVlc3Rpb24oKTsKICAgICAgICBpZiAoIXBDdXJyZW50USkgcmV0dXJuOwogICAgfQoKICAgIHBBc2tlZENvdW50Kys7CiAgICBkb3VibGVDaGFuY2VVc2VkID0gZmFsc2U7CiAgICBmaXJzdEFuc3dlckluZGV4ID0gLTE7CiAgICBzZXREb3VibGVJbmRpY2F0b3IoZmFsc2UpOwogICAgdXBkYXRlSm9rZXJCdXR0b25zKCk7CgogICAgY29uc3QgcUVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3AtcXVlc3Rpb24tdGV4dCcpOwogICAgaWYgKHFFbCkgcUVsLmlubmVyVGV4dCA9IHBDdXJyZW50US5xIHx8ICJTb3J1IjsKCiAgICBsZXQgaHRtbCA9ICcnOwogICAgcEN1cnJlbnRRLm9wdHMuZm9yRWFjaCgob3B0LCBpbmRleCkgPT4gewogICAgICAgIGNvbnN0IGxldHRlciA9IFN0cmluZy5mcm9tQ2hhckNvZGUoNjUgKyBpbmRleCk7CiAgICAgICAgaHRtbCArPSBgPGJ1dHRvbiBjbGFzcz0icGVuYWx0eS1idG4iIG9uY2xpY2s9InNob290QmFsbCgke2luZGV4fSkiPiR7bGV0dGVyfTogJHtvcHR9PC9idXR0b24+YDsKICAgIH0pOwoKICAgIGNvbnN0IG9wdGlvbnNFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwLW9wdGlvbnMnKTsKICAgIGlmIChvcHRpb25zRWwpIG9wdGlvbnNFbC5pbm5lckhUTUwgPSBodG1sOwp9CgpmdW5jdGlvbiBzaG9vdEJhbGwoaWR4KSB7CiAgICBjb25zdCBidG5zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnBlbmFsdHktYnRuJyk7CiAgICBjb25zdCBpc0NvcnJlY3QgPSAoaWR4ID09PSBwQ3VycmVudFEuYSk7CgogICAgLy8gRG91YmxlIGpva2VyOiBpbGsgeWFubMSxxZ90YSBiaXIgaGFrIGRhaGEKICAgIGlmICghaXNDb3JyZWN0ICYmIGRvdWJsZUNoYW5jZVVzZWQgJiYgZmlyc3RBbnN3ZXJJbmRleCA9PT0gLTEpIHsKICAgICAgICBmaXJzdEFuc3dlckluZGV4ID0gaWR4OwogICAgICAgIGlmIChidG5zW2lkeF0pIHsKICAgICAgICAgICAgYnRuc1tpZHhdLmNsYXNzTGlzdC5hZGQoJ3dyb25nLWZpcnN0LXRyeScpOwogICAgICAgICAgICBidG5zW2lkeF0uZGlzYWJsZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgICBTd2FsLmZpcmUoeyB0b2FzdDogdHJ1ZSwgcG9zaXRpb246ICd0b3AnLCBpY29uOiAnaW5mbycsIHRpdGxlOiAnxLBsayBIYXRhISBLYWxhbiBIYWtrxLFuOiAxJywgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLCB0aW1lcjogMTQwMCwgYmFja2dyb3VuZDogJyNmZmMxMDcnIH0pOwogICAgICAgIHVwZGF0ZUpva2VyQnV0dG9ucygpOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyBBcnTEsWsgYXTEscWfIGtlc2lubGXFn3RpCiAgICBidG5zLmZvckVhY2goYiA9PiBiLmRpc2FibGVkID0gdHJ1ZSk7CgogICAgY29uc3QgYmFsbFdyYXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmFsbC13cmFwJyk7CiAgICBjb25zdCBrZWVwZXJXcmFwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2tlZXBlci13cmFwJyk7CiAgICBjb25zdCBzaG9vdGVyV3JhcCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaG9vdGVyLXdyYXAnKTsKICAgIGNvbnN0IGdvYWxNc2cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ29hbC1tc2cnKTsKCiAgICBjb25zdCBzaG90RGlyID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogNCk7CiAgICBpZiAoc2hvb3RlcldyYXApIHNob290ZXJXcmFwLmNsYXNzTGlzdC5hZGQoJ3Nob290ZXItcnVuJyk7CgogICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgaWYgKGtlZXBlcldyYXApIHsKICAgICAgICAgICAgaWYgKGlzQ29ycmVjdCkgewogICAgICAgICAgICAgICAgaWYgKHNob3REaXIgPT09IDAgfHwgc2hvdERpciA9PT0gMikga2VlcGVyV3JhcC5jbGFzc0xpc3QuYWRkKCdrZWVwZXItZGl2ZS1yaWdodCcpOwogICAgICAgICAgICAgICAgZWxzZSBrZWVwZXJXcmFwLmNsYXNzTGlzdC5hZGQoJ2tlZXBlci1kaXZlLWxlZnQnKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmIChzaG90RGlyID09PSAwIHx8IHNob3REaXIgPT09IDIpIGtlZXBlcldyYXAuY2xhc3NMaXN0LmFkZCgna2VlcGVyLWRpdmUtbGVmdCcpOwogICAgICAgICAgICAgICAgZWxzZSBrZWVwZXJXcmFwLmNsYXNzTGlzdC5hZGQoJ2tlZXBlci1kaXZlLXJpZ2h0Jyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChpc0NvcnJlY3QpIHsKICAgICAgICAgICAgaWYgKGJhbGxXcmFwKSB7CiAgICAgICAgICAgICAgICBpZiAoc2hvdERpciA9PT0gMCkgYmFsbFdyYXAuY2xhc3NMaXN0LmFkZCgnYmFsbC1zaG9vdC1sZWZ0LXRvcCcpOwogICAgICAgICAgICAgICAgZWxzZSBpZiAoc2hvdERpciA9PT0gMSkgYmFsbFdyYXAuY2xhc3NMaXN0LmFkZCgnYmFsbC1zaG9vdC1yaWdodC10b3AnKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKHNob3REaXIgPT09IDIpIGJhbGxXcmFwLmNsYXNzTGlzdC5hZGQoJ2JhbGwtc2hvb3QtbGVmdC1sb3cnKTsKICAgICAgICAgICAgICAgIGVsc2UgYmFsbFdyYXAuY2xhc3NMaXN0LmFkZCgnYmFsbC1zaG9vdC1yaWdodC1sb3cnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoZ29hbE1zZykgewogICAgICAgICAgICAgICAgICAgIGdvYWxNc2cuaW5uZXJUZXh0ID0gIkdPTCEhISI7CiAgICAgICAgICAgICAgICAgICAgZ29hbE1zZy5zdHlsZS5jb2xvciA9ICIjZmFiYjAwIjsKICAgICAgICAgICAgICAgICAgICBnb2FsTXNnLmNsYXNzTGlzdC5hZGQoJ3Nob3cnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHBTY29yZSsrOwogICAgICAgICAgICAgICAgcENvcnJlY3RDb3VudCsrOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Atc2NvcmUnKS5pbm5lclRleHQgPSBwU2NvcmU7CgogICAgICAgICAgICAgICAgU3dhbC5maXJlKHsgdG9hc3Q6dHJ1ZSwgcG9zaXRpb246J3RvcCcsIGljb246J3N1Y2Nlc3MnLCB0aXRsZTonTcO8a2VtbWVsIMWedXQhJywgc2hvd0NvbmZpcm1CdXR0b246ZmFsc2UsIHRpbWVyOjkwMCwgYmFja2dyb3VuZDonI2E1ZDZhNycgfSk7CiAgICAgICAgICAgIH0sIDQ1MCk7CgogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHBXcm9uZ0NvdW50Kys7CgogICAgICAgICAgICBjb25zdCBzaG93V3JvbmcgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoZ29hbE1zZykgewogICAgICAgICAgICAgICAgICAgIGdvYWxNc2cuc3R5bGUuY29sb3IgPSAiI2VmNTM1MCI7CiAgICAgICAgICAgICAgICAgICAgZ29hbE1zZy5jbGFzc0xpc3QuYWRkKCdzaG93Jyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBTd2FsLmZpcmUoeyBpY29uOidlcnJvcicsIHRpdGxlOidLYcOnxLFyZMSxbiEnLCB0ZXh0OmBEb8SfcnU6ICR7U3RyaW5nLmZyb21DaGFyQ29kZSg2NSArIHBDdXJyZW50US5hKX1gLCBzaG93Q29uZmlybUJ1dHRvbjp0cnVlLCB0aW1lcjoyNDAwLCBiYWNrZ3JvdW5kOicjZWY5YTlhJyB9KTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGlmIChNYXRoLnJhbmRvbSgpID4gMC41KSB7CiAgICAgICAgICAgICAgICBpZiAoYmFsbFdyYXApIHsKICAgICAgICAgICAgICAgICAgICBiYWxsV3JhcC5zdHlsZS5ib3R0b20gPSAiMTYwcHgiOwogICAgICAgICAgICAgICAgICAgIGJhbGxXcmFwLnN0eWxlLmxlZnQgPSAoc2hvdERpciA9PT0gMCB8fCBzaG90RGlyID09PSAyKSA/ICI0MCUiIDogIjYwJSI7CiAgICAgICAgICAgICAgICAgICAgYmFsbFdyYXAuc3R5bGUudHJhbnNmb3JtID0gInNjYWxlKDAuNikiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7IGlmIChnb2FsTXNnKSBnb2FsTXNnLmlubmVyVGV4dCA9ICJLVVJUQVJESSEiOyBzaG93V3JvbmcoKTsgfSwgNDUwKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmIChiYWxsV3JhcCkgYmFsbFdyYXAuY2xhc3NMaXN0LmFkZChNYXRoLnJhbmRvbSgpID4gMC41ID8gJ2JhbGwtbWlzcy1sZWZ0JyA6ICdiYWxsLW1pc3MtcmlnaHQnKTsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4geyBpZiAoZ29hbE1zZykgZ29hbE1zZy5pbm5lclRleHQgPSAiREnFnkFSSSEiOyBzaG93V3JvbmcoKTsgfSwgNDUwKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0sIDMwMCk7CgogICAgLy8gdG9wIGF6YWx0CiAgICBwQmFsbHMtLTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwLWJhbGxzJykuaW5uZXJUZXh0ID0gcEJhbGxzOwoKICAgIHNldFRpbWVvdXQoKCkgPT4geyByZXNldEZpZWxkKCk7IGxvYWRQZW5hbHR5UXVlc3Rpb24oKTsgfSwgMjQwMCk7Cn0KCmZ1bmN0aW9uIHJlc2V0RmllbGQoKSB7CiAgICBjb25zdCBiYWxsV3JhcCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiYWxsLXdyYXAnKTsKICAgIGNvbnN0IGtlZXBlcldyYXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgna2VlcGVyLXdyYXAnKTsKICAgIGNvbnN0IHNob290ZXJXcmFwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nob290ZXItd3JhcCcpOwogICAgY29uc3QgZ29hbE1zZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnb2FsLW1zZycpOwoKICAgIGlmIChiYWxsV3JhcCkgeyBiYWxsV3JhcC5jbGFzc05hbWUgPSAnYmFsbC13cmFwcGVyJzsgYmFsbFdyYXAuc3R5bGUgPSAiIjsgfQogICAgaWYgKGtlZXBlcldyYXApIGtlZXBlcldyYXAuY2xhc3NOYW1lID0gJ2tlZXBlci13cmFwcGVyJzsKICAgIGlmIChzaG9vdGVyV3JhcCkgc2hvb3RlcldyYXAuY2xhc3NOYW1lID0gJ3Nob290ZXItd3JhcHBlcic7CiAgICBpZiAoZ29hbE1zZykgZ29hbE1zZy5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7CgogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnBlbmFsdHktYnRuJykuZm9yRWFjaChiID0+IHsKICAgICAgICBiLmNsYXNzTGlzdC5yZW1vdmUoJ3dyb25nLWZpcnN0LXRyeScpOwogICAgICAgIGIuc3R5bGUudGV4dERlY29yYXRpb24gPSAnJzsKICAgICAgICBiLnN0eWxlLm9wYWNpdHkgPSAnJzsKICAgICAgICBiLnN0eWxlLmJhY2tncm91bmQgPSAnI2ZhYmIwMCc7CiAgICAgICAgYi5zdHlsZS5jb2xvciA9ICcjMGUxYjQyJzsKICAgICAgICBiLnN0eWxlLmJvcmRlckNvbG9yID0gJyNmMGI1MDAnOwogICAgICAgIGIuZGlzYWJsZWQgPSBmYWxzZTsKICAgIH0pOwp9CgpmdW5jdGlvbiBmaW5pc2hQZW5hbHR5R2FtZSgpIHsKICAgIGNvbnN0IHRvdGFsU2hvdHMgPSAxMDsKICAgIGNvbnN0IHRpdGxlID0gcFNjb3JlID49IDggPyAiRUZTQU5FISDwn4+GIiA6IChwU2NvcmUgPj0gNSA/ICLEsHlpIE1hw6d0xLEhIPCfkY8iIDogIkFudHJlbm1hbiBMYXrEsW0g8J+klSIpOwogICAgY29uc3QgYWNjID0gTWF0aC5yb3VuZCgocENvcnJlY3RDb3VudCAvIE1hdGgubWF4KDEsIChwQ29ycmVjdENvdW50ICsgcFdyb25nQ291bnQpKSkgKiAxMDApOwoKICAgIGNvbnN0IHFFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwLXF1ZXN0aW9uLXRleHQnKTsKICAgIGlmIChxRWwpIHsKICAgICAgICBxRWwuaW5uZXJIVE1MID0gYAogICAgICAgICAgICA8ZGl2IHN0eWxlPSJmb250LXNpemU6MS41cmVtOyBjb2xvcjojZmFiYjAwOyBmb250LXdlaWdodDo4MDA7Ij5NQcOHIELEsFRUxLAhPC9kaXY+CiAgICAgICAgICAgIDxkaXYgc3R5bGU9Im1hcmdpbi10b3A6NHB4OyBmb250LXNpemU6MS4xcmVtOyBjb2xvcjojZmZmOyI+JHt0aXRsZX08L2Rpdj4KICAgICAgICAgICAgPGRpdiBzdHlsZT0ibWFyZ2luLXRvcDo4cHg7IGZvbnQtc2l6ZToxcmVtOyBjb2xvcjojZGRkOyI+CiAgICAgICAgICAgICAgICA8Yj5Ta29yOjwvYj4gJHtwU2NvcmV9LyR7dG90YWxTaG90c30gJm5ic3A7IOKAoiAmbmJzcDsKICAgICAgICAgICAgICAgIDxiPkRvxJ9ydWx1azo8L2I+ICR7YWNjfSUKICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgc3R5bGU9Im1hcmdpbi10b3A6NnB4OyBmb250LXNpemU6MC45cmVtOyBjb2xvcjojYmJiOyI+CiAgICAgICAgICAgICAgICBEb8SfcnU6ICR7cENvcnJlY3RDb3VudH0gJm5ic3A7IHwgJm5ic3A7IFlhbmzEscWfOiAke3BXcm9uZ0NvdW50fQogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBzdHlsZT0ibWFyZ2luLXRvcDoxMHB4OyBmb250LXNpemU6MC44NXJlbTsgY29sb3I6I2FhYTsiPgogICAgICAgICAgICAgICAgWWVuaWRlbiBveW5hbWFrIGnDp2luIGHFn2HEn8SxZGFuIGJhxZ9sYXRhYmlsaXJzaW4uCiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIGA7CiAgICB9CgogICAgY29uc3Qgb3B0aW9uc0VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Atb3B0aW9ucycpOwogICAgY29uc3QgcmVzdGFydEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwLXJlc3RhcnQtYnRuJyk7CiAgICBpZiAob3B0aW9uc0VsKSBvcHRpb25zRWwuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgIGlmIChyZXN0YXJ0QnRuKSByZXN0YXJ0QnRuLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwoKICAgIC8vIExlYWRlcmJvYXJkIGxvZyAobWV2Y3V0IGJhY2tlbmQgdXl1bXUpCiAgICBmZXRjaChTQ1JJUFRfVVJMLCB7CiAgICAgICAgbWV0aG9kOiAnUE9TVCcsCiAgICAgICAgaGVhZGVyczogeyAiQ29udGVudC1UeXBlIjogInRleHQvcGxhaW47Y2hhcnNldD11dGYtOCIgfSwKICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGFjdGlvbjogImxvZ1F1aXoiLCB1c2VybmFtZTogY3VycmVudFVzZXIsIHRva2VuOiBnZXRUb2tlbigpLCBzY29yZTogcFNjb3JlICogMTAsIHRvdGFsOiAxMDAgfSkKICAgIH0pLmZpbmFsbHkoKCkgPT4gewogICAgICAgIC8vIGxvYmJ5IHRhYmxvc3VudSBnw7xuY2VsIHR1dAogICAgICAgIHNldFRpbWVvdXQoZmV0Y2hMZWFkZXJib2FyZCwgNjAwKTsKICAgIH0pOwp9CgoKLy8gLS0tIFdJWkFSRCBGVU5DVElPTlMgLS0tCmZ1bmN0aW9uIG9wZW5XaXphcmQoKXsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3aXphcmQtbW9kYWwnKS5zdHlsZS5kaXNwbGF5PSdmbGV4JzsKICAgIGlmIChPYmplY3Qua2V5cyh3aXphcmRTdGVwc0RhdGEpLmxlbmd0aCA9PT0gMCkgewogICAgICAgIFN3YWwuZmlyZSh7IHRpdGxlOiAnxLBhZGUgQXNpc3RhbsSxIFZlcmlzaSBZw7xrbGVuaXlvci4uLicsIGRpZE9wZW46ICgpID0+IFN3YWwuc2hvd0xvYWRpbmcoKSB9KTsKICAgICAgICBsb2FkV2l6YXJkRGF0YSgpLnRoZW4oKCkgPT4geyBTd2FsLmNsb3NlKCk7IGlmICh3aXphcmRTdGVwc0RhdGFbJ3N0YXJ0J10pIHJlbmRlclN0ZXAoJ3N0YXJ0Jyk7IGVsc2UgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3dpemFyZC1ib2R5JykuaW5uZXJIVE1MID0gJzxoMiBzdHlsZT0iY29sb3I6cmVkOyI+QXNpc3RhbiB2ZXJpc2kgZWtzaWsuPC9oMj4nOyB9KQogICAgICAgIC5jYXRjaCgoKSA9PiB7IFN3YWwuY2xvc2UoKTsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3dpemFyZC1ib2R5JykuaW5uZXJIVE1MID0gJzxoMiBzdHlsZT0iY29sb3I6cmVkOyI+VmVyaSDDp2VrbWUgaGF0YXPEsS48L2gyPic7IH0pOwogICAgfSBlbHNlIHsgcmVuZGVyU3RlcCgnc3RhcnQnKTsgfQp9CmZ1bmN0aW9uIHJlbmRlclN0ZXAoayl7CiAgICBjb25zdCBzID0gd2l6YXJkU3RlcHNEYXRhW2tdOwogICAgaWYgKCFzKSB7IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3aXphcmQtYm9keScpLmlubmVySFRNTCA9IGA8aDIgc3R5bGU9ImNvbG9yOnJlZDsiPkhBVEE6IEFkxLFtIElEICgke2t9KSB5b2suPC9oMj5gOyByZXR1cm47IH0KICAgIGNvbnN0IGIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd2l6YXJkLWJvZHknKTsKICAgIGxldCBoID0gYDxoMiBzdHlsZT0iY29sb3I6dmFyKC0tcHJpbWFyeSk7Ij4ke3MudGl0bGUgfHwgJyd9PC9oMj5gOwogICAgaWYocy5yZXN1bHQpIHsKICAgICAgICBsZXQgaSA9IHMucmVzdWx0ID09PSAncmVkJyA/ICcg8J+bkSAnIDogKHMucmVzdWx0ID09PSAnZ3JlZW4nID8gJyDinIUgJyA6ICcg4pqg77iPICcpOwogICAgICAgIGxldCBjID0gcy5yZXN1bHQgPT09ICdyZWQnID8gJ3Jlcy1yZWQnIDogKHMucmVzdWx0ID09PSAnZ3JlZW4nID8gJ3Jlcy1ncmVlbicgOiAncmVzLXllbGxvdycpOwogICAgICAgIGggKz0gYDxkaXYgY2xhc3M9InJlc3VsdC1ib3ggJHtjfSI+PGRpdiBzdHlsZT0iZm9udC1zaXplOjNyZW07bWFyZ2luLWJvdHRvbToxMHB4OyI+JHtpfTwvZGl2PjxoMz4ke3MudGl0bGV9PC9oMz48cD4ke3MudGV4dH08L3A+JHtzLnNjcmlwdCA/IGA8ZGl2IGNsYXNzPSJzY3JpcHQtYm94Ij4ke3Muc2NyaXB0fTwvZGl2PmAgOiAnJ308L2Rpdj48YnV0dG9uIGNsYXNzPSJyZXN0YXJ0LWJ0biIgb25jbGljaz0icmVuZGVyU3RlcCgnc3RhcnQnKSI+PGkgY2xhc3M9ImZhcyBmYS1yZWRvIj48L2k+IEJhxZ9hIETDtm48L2J1dHRvbj5gOwogICAgfSBlbHNlIHsKICAgICAgICBoICs9IGA8cD4ke3MudGV4dH08L3A+PGRpdiBjbGFzcz0id2l6YXJkLW9wdGlvbnMiPmA7CiAgICAgICAgcy5vcHRpb25zLmZvckVhY2gobyA9PiB7IGggKz0gYDxidXR0b24gY2xhc3M9Im9wdGlvbi1idG4iIG9uY2xpY2s9InJlbmRlclN0ZXAoJyR7by5uZXh0fScpIj48aSBjbGFzcz0iZmFzIGZhLWNoZXZyb24tcmlnaHQiPjwvaT4gJHtvLnRleHR9PC9idXR0b24+YDsgfSk7CiAgICAgICAgaCArPSBgPC9kaXY+YDsgaWYoayAhPT0gJ3N0YXJ0JykgaCArPSBgPGJ1dHRvbiBjbGFzcz0icmVzdGFydC1idG4iIG9uY2xpY2s9InJlbmRlclN0ZXAoJ3N0YXJ0JykiIHN0eWxlPSJiYWNrZ3JvdW5kOiNlZWU7Y29sb3I6IzMzMzttYXJnaW4tdG9wOjE1cHg7Ij5CYcWfYSBEw7ZuPC9idXR0b24+YDsKICAgIH0KICAgIGIuaW5uZXJIVE1MID0gaDsKfQovLyAtLS0gVEVDSCBXSVpBUkQgLS0tCmNvbnN0IHR3U3RhdGUgPSB7IGN1cnJlbnRTdGVwOiAnc3RhcnQnLCBoaXN0b3J5OiBbXSB9OwpmdW5jdGlvbiBvcGVuVGVjaFdpemFyZCgpIHsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0ZWNoLXdpemFyZC1tb2RhbCcpLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7CiAgICBpZiAoT2JqZWN0LmtleXModGVjaFdpemFyZERhdGEpLmxlbmd0aCA9PT0gMCkgewogICAgICAgIFN3YWwuZmlyZSh7IHRpdGxlOiAnVmVyaWxlciBZw7xrbGVuaXlvci4uLicsIGRpZE9wZW46ICgpID0+IFN3YWwuc2hvd0xvYWRpbmcoKSB9KTsKICAgICAgICBsb2FkVGVjaFdpemFyZERhdGEoKS50aGVuKCgpID0+IHsgU3dhbC5jbG9zZSgpOyB0d1Jlc2V0V2l6YXJkKCk7IH0pOwogICAgfSBlbHNlIHsgdHdSZW5kZXJTdGVwKCk7IH0KfQpmdW5jdGlvbiB0d1JlbmRlclN0ZXAoKSB7CiAgICBjb25zdCBjb250ZW50RGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RlY2gtd2l6YXJkLWNvbnRlbnQnKTsKICAgIGNvbnN0IGJhY2tCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndHctYnRuLWJhY2snKTsKICAgIGNvbnN0IHN0ZXBEYXRhID0gdGVjaFdpemFyZERhdGFbdHdTdGF0ZS5jdXJyZW50U3RlcF07CiAgICBpZiAodHdTdGF0ZS5oaXN0b3J5Lmxlbmd0aCA+IDApIGJhY2tCdG4uc3R5bGUuZGlzcGxheSA9ICdibG9jayc7IGVsc2UgYmFja0J0bi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgaWYgKCFzdGVwRGF0YSkgeyBjb250ZW50RGl2LmlubmVySFRNTCA9IGA8ZGl2IGNsYXNzPSJhbGVydCIgc3R5bGU9ImNvbG9yOnJlZDsiPkhhdGE6IEFkxLFtIGJ1bHVuYW1hZMSxICgke3R3U3RhdGUuY3VycmVudFN0ZXB9KS48L2Rpdj5gOyByZXR1cm47IH0KICAgIGxldCBodG1sID0gYDxkaXYgY2xhc3M9InRlY2gtc3RlcC10aXRsZSI+JHtzdGVwRGF0YS50aXRsZSB8fCAnJ308L2Rpdj5gOwogICAgaWYgKHN0ZXBEYXRhLnRleHQpIGh0bWwgKz0gYDxwIHN0eWxlPSJmb250LXNpemU6MXJlbTsgbWFyZ2luLWJvdHRvbToxNXB4OyI+JHtzdGVwRGF0YS50ZXh0fTwvcD5gOwogICAgaWYgKHN0ZXBEYXRhLnNjcmlwdCkgewogICAgICAgIGNvbnN0IHNhZmVTY3JpcHQgPSBlbmNvZGVVUklDb21wb25lbnQoc3RlcERhdGEuc2NyaXB0KTsKICAgICAgICBodG1sICs9IGA8ZGl2IGNsYXNzPSJ0ZWNoLXNjcmlwdC1ib3giPjxzcGFuIGNsYXNzPSJ0ZWNoLXNjcmlwdC1sYWJlbCI+TcO8xZ90ZXJpeWUgaWxldGlsZWNlazo8L3NwYW4+IiR7c3RlcERhdGEuc2NyaXB0fSI8ZGl2IHN0eWxlPSJtYXJnaW4tdG9wOjEwcHg7IHRleHQtYWxpZ246cmlnaHQ7Ij48YnV0dG9uIGNsYXNzPSJidG4gYnRuLWNvcHkiIHN0eWxlPSJmb250LXNpemU6MC44cmVtOyBwYWRkaW5nOjVweCAxMHB4OyIgb25jbGljaz0iY29weVNjcmlwdENvbnRlbnQoJyR7c2FmZVNjcmlwdH0nKSI+PGkgY2xhc3M9ImZhcyBmYS1jb3B5Ij48L2k+IEtvcHlhbGE8L2J1dHRvbj48L2Rpdj48L2Rpdj5gOwogICAgfQogICAgaWYgKHN0ZXBEYXRhLmFsZXJ0KSBodG1sICs9IGA8ZGl2IGNsYXNzPSJ0ZWNoLWFsZXJ0Ij4ke3N0ZXBEYXRhLmFsZXJ0fTwvZGl2PmA7CiAgICBpZiAoc3RlcERhdGEuYnV0dG9ucyAmJiBzdGVwRGF0YS5idXR0b25zLmxlbmd0aCA+IDApIHsKICAgICAgICBodG1sICs9IGA8ZGl2IGNsYXNzPSJ0ZWNoLWJ1dHRvbnMtYXJlYSI+YDsKICAgICAgICBzdGVwRGF0YS5idXR0b25zLmZvckVhY2goYnRuID0+IHsgbGV0IGJ0bkNsYXNzID0gYnRuLnN0eWxlID09PSAnb3B0aW9uJyA/ICd0ZWNoLWJ0bi1vcHRpb24nIDogJ3RlY2gtYnRuLXByaW1hcnknOyBodG1sICs9IGA8YnV0dG9uIGNsYXNzPSJ0ZWNoLWJ0biAke2J0bkNsYXNzfSIgb25jbGljaz0idHdDaGFuZ2VTdGVwKCcke2J0bi5uZXh0fScpIj4ke2J0bi50ZXh0fTwvYnV0dG9uPmA7IH0pOwogICAgICAgIGh0bWwgKz0gYDwvZGl2PmA7CiAgICB9CiAgICBjb250ZW50RGl2LmlubmVySFRNTCA9IGh0bWw7Cn0KZnVuY3Rpb24gdHdDaGFuZ2VTdGVwKG5ld1N0ZXApIHsgdHdTdGF0ZS5oaXN0b3J5LnB1c2godHdTdGF0ZS5jdXJyZW50U3RlcCk7IHR3U3RhdGUuY3VycmVudFN0ZXAgPSBuZXdTdGVwOyB0d1JlbmRlclN0ZXAoKTsgfQpmdW5jdGlvbiB0d0dvQmFjaygpIHsgaWYgKHR3U3RhdGUuaGlzdG9yeS5sZW5ndGggPiAwKSB7IHR3U3RhdGUuY3VycmVudFN0ZXAgPSB0d1N0YXRlLmhpc3RvcnkucG9wKCk7IHR3UmVuZGVyU3RlcCgpOyB9IH0KZnVuY3Rpb24gdHdSZXNldFdpemFyZCgpIHsgdHdTdGF0ZS5jdXJyZW50U3RlcCA9ICdzdGFydCc7IHR3U3RhdGUuaGlzdG9yeSA9IFtdOyB0d1JlbmRlclN0ZXAoKTsgfQovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIC0tLSBZRU7EsCBLQUzEsFRFIExNUyBNT0TDnEzDnCAoVEFNIEVLUkFOIEVOVEVHUkFTWU9OVSkgLS0tCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gTW9kw7xsw7wgQcOnCmZ1bmN0aW9uIG9wZW5RdWFsaXR5QXJlYSgpIHsKICAgIC8vIEVza2kgbW9kYWzEsSBrYXBhdCAoZcSfZXIgYcOnxLFrc2EpCiAgICBjb25zdCBvbGRNb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWFsaXR5LW1vZGFsJyk7CiAgICBpZihvbGRNb2RhbCkgb2xkTW9kYWwuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgIC8vIFRhbSBla3JhbsSxIGHDpwogICAgY29uc3QgZnVsbFNjcmVlbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWFsaXR5LWZ1bGxzY3JlZW4nKTsKICAgIGZ1bGxTY3JlZW4uc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKICAgIC8vIEt1bGxhbsSxY8SxIGJpbGdpc2luaSBnw7xuY2VsbGUKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxLXNpZGUtbmFtZScpLmlubmVyVGV4dCA9IGN1cnJlbnRVc2VyOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Etc2lkZS1yb2xlJykuaW5uZXJUZXh0ID0gaXNBZG1pbk1vZGUgPyAnWcO2bmV0aWNpJyA6ICdUZW1zaWxjaSc7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncS1zaWRlLWF2YXRhcicpLmlubmVyVGV4dCA9IGN1cnJlbnRVc2VyLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpOwogICAgLy8gRMO2bmVtIGZpbHRyZXNpbmkgZG9sZHVyCiAgICBwb3B1bGF0ZU1vbnRoRmlsdGVyRnVsbCgpOwogICAgLy8gWWV0a2kga29udHJvbMO8IChBZG1pbiBidXRvbmxhcsSxbsSxIGfDtnN0ZXIvZ2l6bGUpCiAgICBjb25zdCBhZG1pbkZpbHRlcnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRtaW4tZmlsdGVycycpOwogICAgY29uc3QgYXNzaWduQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Fzc2lnbi10cmFpbmluZy1idG4nKTsKICAgIGNvbnN0IG1hbnVhbEZlZWRiYWNrQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hbnVhbC1mZWVkYmFjay1hZG1pbi1idG4nKTsKICAgIAogICAgaWYgKGlzQWRtaW5Nb2RlKSB7CiAgICAgICAgaWYoYWRtaW5GaWx0ZXJzKSBhZG1pbkZpbHRlcnMuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKICAgICAgICBpZihhc3NpZ25CdG4pIGFzc2lnbkJ0bi5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICBpZihtYW51YWxGZWVkYmFja0J0bikgbWFudWFsRmVlZGJhY2tCdG4uc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKICAgICAgICAKICAgICAgICAvLyBLdWxsYW7EsWPEsSBsaXN0ZXNpIGJvxZ9zYSDDp2VrLCBzb25yYSBmaWx0cmVsZXJpIGRvbGR1cgogICAgICAgIGlmIChhZG1pblVzZXJMaXN0Lmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICBmZXRjaFVzZXJMaXN0Rm9yQWRtaW4oKS50aGVuKHVzZXJzID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGdyb3VwU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3EtYWRtaW4tZ3JvdXAnKTsKICAgICAgICAgICAgICAgIGlmKGdyb3VwU2VsZWN0KSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZ3JvdXBzID0gWy4uLm5ldyBTZXQodXNlcnMubWFwKHUgPT4gdS5ncm91cCkpXS5zb3J0KCk7CiAgICAgICAgICAgICAgICAgICAgZ3JvdXBTZWxlY3QuaW5uZXJIVE1MID0gYDxvcHRpb24gdmFsdWU9ImFsbCI+VMO8bSBHcnVwbGFyPC9vcHRpb24+YCArIGdyb3Vwcy5tYXAoZyA9PiBgPG9wdGlvbiB2YWx1ZT0iJHtnfSI+JHtnfTwvb3B0aW9uPmApLmpvaW4oJycpOwogICAgICAgICAgICAgICAgICAgIHVwZGF0ZUFnZW50TGlzdEJhc2VkT25Hcm91cCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcG9wdWxhdGVEYXNoYm9hcmRGaWx0ZXJzKCk7IC8vIERhc2hib2FyZCBmaWx0cmVsZXJpbmkgZGUgZG9sZHVyCiAgICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHBvcHVsYXRlRGFzaGJvYXJkRmlsdGVycygpOyAvLyBMaXN0ZSB6YXRlbiB2YXJzYSBkaXJla3QgZG9sZHVyCiAgICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgICBpZihhZG1pbkZpbHRlcnMpIGFkbWluRmlsdGVycy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgIGlmKGFzc2lnbkJ0bikgYXNzaWduQnRuLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgaWYobWFudWFsRmVlZGJhY2tCdG4pIG1hbnVhbEZlZWRiYWNrQnRuLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgCiAgICAgICAgLy8gQWRtaW4gZGXEn2lsc2UgZmlsdHJlbGVyaSBnaXpsZQogICAgICAgIGNvbnN0IGRhc2hGaWx0ZXJBcmVhID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3ZpZXctZGFzaGJvYXJkIC5xLXZpZXctaGVhZGVyID4gZGl2Jyk7CiAgICAgICAgaWYoZGFzaEZpbHRlckFyZWEgJiYgZGFzaEZpbHRlckFyZWEuc3R5bGUuZGlzcGxheSAhPT0gJ25vbmUnKSB7CiAgICAgICAgICAgICAvLyBCdXJhZGEgYmFzaXTDp2UgZGFzaGJvYXJkIGZpbHRyZSBmb25rc2l5b251IGFkbWluIGtvbnRyb2zDvCB5YXDEsXlvci4KICAgICAgICAgICAgIHBvcHVsYXRlRGFzaGJvYXJkRmlsdGVycygpOyAKICAgICAgICB9CiAgICB9CiAgICAvLyBWYXJzYXnEsWxhbiBzZWttZXlpIGHDpwogICAgLy8gVMSxa2xhbm1hIHNpbcO8bGFzeW9udSBpbGUgaWxrIHNla21leWkgYWt0aWYgZXQKICAgIGNvbnN0IGRlZmF1bHRUYWIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucS1uYXYtaXRlbS5hY3RpdmUnKTsKICAgIGlmIChkZWZhdWx0VGFiKSB7CiAgICAgICAgc3dpdGNoUXVhbGl0eVRhYignZGFzaGJvYXJkJywgZGVmYXVsdFRhYik7CiAgICB9Cn0KLy8gTW9kw7xsw7wgS2FwYXQKZnVuY3Rpb24gY2xvc2VGdWxsUXVhbGl0eSgpIHsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWFsaXR5LWZ1bGxzY3JlZW4nKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgLy8gRcSfZXIgcXVzZXJzIGlzZSAoc2FkZWNlIGthbGl0ZSB5ZXRraXNpIHZhcnNhKSBsb2dvdXQgeWFwbWFsxLEgdmV5YSB1eWFyxLEgdmVybWVsaQogICAgaWYobG9jYWxTdG9yYWdlLmdldEl0ZW0oInNTcG9ydFJvbGUiKSA9PT0gJ3F1c2VycycpIHsKICAgICAgICBsb2dvdXQoKTsKICAgIH0KfQovLyBTZWttZSBEZcSfacWfdGlybWUKZnVuY3Rpb24gc3dpdGNoUXVhbGl0eVRhYih0YWJOYW1lLCBlbGVtZW50KSB7CiAgICAvLyBNZW51IGFjdGl2ZSBjbGFzcwogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnEtbmF2LWl0ZW0nKS5mb3JFYWNoKGl0ZW0gPT4gaXRlbS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKSk7CiAgICAvLyBFbGVtZW50IHZhcnNhIG9udSBha3RpZiB5YXAsIHlva3NhIHZhcnNhecSxbGFuxLEgKGRhc2hib2FyZCkgYnVsdXAgYWt0aWYgeWFwCiAgICBpZiAoZWxlbWVudCkgewogICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICB9IGVsc2UgewogICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC5xLW5hdi1pdGVtW29uY2xpY2sqPSIke3RhYk5hbWV9Il1gKS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgIH0KICAgIAogICAgLy8gVmlldyBhY3RpdmUgY2xhc3MKICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5xLXZpZXctc2VjdGlvbicpLmZvckVhY2goc2VjdGlvbiA9PiBzZWN0aW9uLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpKTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGB2aWV3LSR7dGFiTmFtZX1gKS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgIC8vIFZlcmkgWcO8a2xlbWUKICAgIGlmICh0YWJOYW1lID09PSAnZGFzaGJvYXJkJykgbG9hZFF1YWxpdHlEYXNoYm9hcmQoKTsKICAgIGVsc2UgaWYgKHRhYk5hbWUgPT09ICdldmFsdWF0aW9ucycpIGZldGNoRXZhbHVhdGlvbnNGb3JBZ2VudCgpOwogICAgLy8gRMOcWkVMVE1FOiBGZWVkYmFjayBzZWttZXNpIGHDp8SxbMSxcmtlbiDDtm5jZSBGZWVkYmFja19Mb2dzIMOnZWtpbG1lbGkKICAgIGVsc2UgaWYgKHRhYk5hbWUgPT09ICdmZWVkYmFjaycpIHsKICAgICAgICBwb3B1bGF0ZUZlZWRiYWNrRmlsdGVycygpOwogICAgICAgIHJlZnJlc2hGZWVkYmFja0RhdGEoKTsKICAgIH0KICAgIGVsc2UgaWYgKHRhYk5hbWUgPT09ICd0cmFpbmluZycpIGxvYWRUcmFpbmluZ0RhdGEoKTsKfQovLyAtLS0gREFTSEJPQVJEIEZPTktTxLBZT05MQVJJIC0tLQpmdW5jdGlvbiBwb3B1bGF0ZU1vbnRoRmlsdGVyRnVsbCgpIHsKICAgIGNvbnN0IHNlbGVjdElkcyA9IFsncS1kYXNoLW1vbnRoJ107IC8vIFNhZGVjZSB5ZW5pIGZpbHRyZQogICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTsKICAgIGNvbnN0IGN1cnJlbnRNb250aCA9IG5vdy5nZXRNb250aCgpOwogICAgY29uc3QgY3VycmVudFllYXIgPSBub3cuZ2V0RnVsbFllYXIoKTsKICAgIAogICAgc2VsZWN0SWRzLmZvckVhY2goaWQgPT4gewogICAgICAgIGNvbnN0IGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOwogICAgICAgIGlmKCFlbCkgcmV0dXJuOwogICAgICAgIGVsLmlubmVySFRNTCA9ICcnOwogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNjsgaSsrKSB7CiAgICAgICAgICAgIGxldCBtb250aCA9IChjdXJyZW50TW9udGggLSBpICsgMTIpICUgMTI7CiAgICAgICAgICAgIGxldCB5ZWFyID0gY3VycmVudFllYXIgLSAoY3VycmVudE1vbnRoIC0gaSA8IDAgPyAxIDogMCk7CiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gYCR7U3RyaW5nKG1vbnRoICsgMSkucGFkU3RhcnQoMiwgJzAnKX0uJHt5ZWFyfWA7CiAgICAgICAgICAgIGNvbnN0IHRleHQgPSBgJHtNT05USF9OQU1FU1ttb250aF19ICR7eWVhcn1gOwogICAgICAgICAgICBjb25zdCBvcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTsKICAgICAgICAgICAgb3B0LnZhbHVlID0gdmFsdWU7IG9wdC50ZXh0Q29udGVudCA9IHRleHQ7CiAgICAgICAgICAgIGlmKGk9PT0wKSBvcHQuc2VsZWN0ZWQgPSB0cnVlOwogICAgICAgICAgICBlbC5hcHBlbmRDaGlsZChvcHQpOwogICAgICAgIH0KICAgIH0pOwp9Ci8vIFlFTsSwOiBEYXNoYm9hcmQgRmlsdHJlbGVyaW5pIERvbGR1cm1hCmZ1bmN0aW9uIHBvcHVsYXRlRGFzaGJvYXJkRmlsdGVycygpIHsKICAgIGNvbnN0IGdyb3VwU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3EtZGFzaC1ncm91cCcpOwogICAgY29uc3QgYWdlbnRTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncS1kYXNoLWFnZW50Jyk7CiAgICBpZighaXNBZG1pbk1vZGUpIHsKICAgICAgICBpZihncm91cFNlbGVjdCkgZ3JvdXBTZWxlY3Quc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICBpZihhZ2VudFNlbGVjdCkgYWdlbnRTZWxlY3Quc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICByZXR1cm47CiAgICB9IGVsc2UgewogICAgICAgIGlmKGdyb3VwU2VsZWN0KSBncm91cFNlbGVjdC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICBpZihhZ2VudFNlbGVjdCkgYWdlbnRTZWxlY3Quc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICB9CiAgICAKICAgIGlmKCFncm91cFNlbGVjdCkgcmV0dXJuOwogICAgCiAgICBjb25zdCBncm91cHMgPSBbLi4ubmV3IFNldChhZG1pblVzZXJMaXN0Lm1hcCh1ID0+IHUuZ3JvdXApLmZpbHRlcihnID0+IGcpKV0uc29ydCgpOwogICAgZ3JvdXBTZWxlY3QuaW5uZXJIVE1MID0gJzxvcHRpb24gdmFsdWU9ImFsbCI+VMO8bSBHcnVwbGFyPC9vcHRpb24+JzsKICAgIGdyb3Vwcy5mb3JFYWNoKGcgPT4gewogICAgICAgIGNvbnN0IG9wdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpOwogICAgICAgIG9wdC52YWx1ZSA9IGc7IG9wdC5pbm5lclRleHQgPSBnOwogICAgICAgIGdyb3VwU2VsZWN0LmFwcGVuZENoaWxkKG9wdCk7CiAgICB9KTsKICAgIC8vIMSwbGsgecO8a2xlbWVkZSB0w7xtIGFnZW50bGFyxLEgbGlzdGVsZQogICAgdXBkYXRlRGFzaEFnZW50TGlzdCgpOwp9Ci8vIFlFTsSwOiBEYXNoYm9hcmQgQWdlbnQgTGlzdGVzaW5pIEfDvG5jZWxsZW1lCmZ1bmN0aW9uIHVwZGF0ZURhc2hBZ2VudExpc3QoKSB7CiAgICBjb25zdCBncm91cFNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxLWRhc2gtZ3JvdXAnKTsKICAgIGNvbnN0IGFnZW50U2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3EtZGFzaC1hZ2VudCcpOwogICAgaWYoIWFnZW50U2VsZWN0KSByZXR1cm47CiAgICBjb25zdCBzZWxlY3RlZEdyb3VwID0gZ3JvdXBTZWxlY3QudmFsdWU7CiAgICBhZ2VudFNlbGVjdC5pbm5lckhUTUwgPSAnPG9wdGlvbiB2YWx1ZT0iYWxsIj5Uw7xtIFRlbXNpbGNpbGVyPC9vcHRpb24+JzsKICAgIAogICAgbGV0IGZpbHRlcmVkVXNlcnMgPSBhZG1pblVzZXJMaXN0OwogICAgaWYgKHNlbGVjdGVkR3JvdXAgIT09ICdhbGwnKSB7CiAgICAgICAgZmlsdGVyZWRVc2VycyA9IGFkbWluVXNlckxpc3QuZmlsdGVyKHUgPT4gdS5ncm91cCA9PT0gc2VsZWN0ZWRHcm91cCk7CiAgICB9CiAgICBmaWx0ZXJlZFVzZXJzLmZvckVhY2godSA9PiB7CiAgICAgICAgY29uc3Qgb3B0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7CiAgICAgICAgb3B0LnZhbHVlID0gdS5uYW1lOyAKICAgICAgICBvcHQuaW5uZXJUZXh0ID0gdS5uYW1lOwogICAgICAgIGFnZW50U2VsZWN0LmFwcGVuZENoaWxkKG9wdCk7CiAgICB9KTsKICAgIAogICAgdXBkYXRlRGFzaFJpbmdUaXRsZSgpOwogICAgcmVmcmVzaFF1YWxpdHlEYXRhKCk7Cn0KCi8vIOKchSBEYXNoYm9hcmQgcmluZyBiYcWfbMSxxJ/EsSArIGFkbWluIHRlbXNpbGNpIG9ydGFsYW1hbGFyxLEKZnVuY3Rpb24gdXBkYXRlRGFzaFJpbmdUaXRsZSgpIHsKICAgIGNvbnN0IHRpdGxlRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncS1kYXNoLXJpbmctdGl0bGUnKSB8fCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncS1kYXNoLXJpbmctdGl0bGUnLnJlcGxhY2UoJ3RpdGxlJywndGl0bGUnKSk7CiAgICAvLyAoaWQga2VzaW46IHEtZGFzaC1yaW5nLXRpdGxlKQogICAgY29uc3QgdEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3EtZGFzaC1yaW5nLXRpdGxlJyk7CiAgICBpZighdEVsKSByZXR1cm47CgogICAgaWYoIWlzQWRtaW5Nb2RlKSB7CiAgICAgICAgdEVsLnRleHRDb250ZW50ID0gJ1B1YW4gRHVydW11JzsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgY29uc3QgZ1NlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxLWRhc2gtZ3JvdXAnKTsKICAgIGNvbnN0IGFTZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncS1kYXNoLWFnZW50Jyk7CiAgICBjb25zdCBnID0gZ1NlbCA/IGdTZWwudmFsdWUgOiAnYWxsJzsKICAgIGNvbnN0IGEgPSBhU2VsID8gYVNlbC52YWx1ZSA6ICdhbGwnOwoKICAgIGlmKGEgJiYgYSAhPT0gJ2FsbCcpIHsKICAgICAgICB0RWwudGV4dENvbnRlbnQgPSBgJHthfSBQdWFuIER1cnVtdWA7CiAgICB9IGVsc2UgaWYoZyAmJiBnICE9PSAnYWxsJykgewogICAgICAgIHRFbC50ZXh0Q29udGVudCA9IGAke2d9IFRha8SxbSBPcnRhbGFtYXPEsWA7CiAgICB9IGVsc2UgewogICAgICAgIHRFbC50ZXh0Q29udGVudCA9ICdHZW5lbCBQdWFuIE9ydGFsYW1hc8SxJzsKICAgIH0KfQoKLy8gQWRtaW4gacOnaW46IHRlbXNpbGNpIG9ydGFsYW1hbGFyxLEgbGlzdGVzaW5pIGJhcwpmdW5jdGlvbiByZW5kZXJEYXNoQWdlbnRTY29yZXMoZXZhbHMpIHsKICAgIGNvbnN0IGJveCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxLWRhc2gtYWdlbnQtc2NvcmVzJyk7CiAgICBpZighYm94KSByZXR1cm47CgogICAgLy8gU2FkZWNlIGFkbWluICsgYWdlbnQ9YWxsIGlrZW4gZ8O2c3RlciAoeW9rc2EgZ2VyZWtzaXoga2FsYWJhbMSxaykKICAgIGlmKCFpc0FkbWluTW9kZSkgeyBib3guc3R5bGUuZGlzcGxheT0nbm9uZSc7IHJldHVybjsgfQoKICAgIGNvbnN0IGdTZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncS1kYXNoLWdyb3VwJyk7CiAgICBjb25zdCBhU2VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3EtZGFzaC1hZ2VudCcpOwogICAgY29uc3QgZyA9IGdTZWwgPyBnU2VsLnZhbHVlIDogJ2FsbCc7CiAgICBjb25zdCBhID0gYVNlbCA/IGFTZWwudmFsdWUgOiAnYWxsJzsKCiAgICBpZihhICYmIGEgIT09ICdhbGwnKSB7IGJveC5zdHlsZS5kaXNwbGF5PSdub25lJzsgcmV0dXJuOyB9CgogICAgLy8gZXZhbHMgLT4gYWdlbnQgYmF6bMSxIG9ydGFsYW1hCiAgICBjb25zdCBieUFnZW50ID0ge307CiAgICAoZXZhbHMgfHwgW10pLmZvckVhY2goZSA9PiB7CiAgICAgICAgY29uc3QgYWdlbnQgPSBlLmFnZW50IHx8ICdOL0EnOwogICAgICAgIGNvbnN0IGdyb3VwID0gZS5ncm91cCB8fCAnJzsKICAgICAgICBjb25zdCBzY29yZSA9IHBhcnNlRmxvYXQoZS5zY29yZSkgfHwgMDsKICAgICAgICBpZighYnlBZ2VudFthZ2VudF0pIGJ5QWdlbnRbYWdlbnRdID0geyB0b3RhbDowLCBjb3VudDowLCBncm91cDogZ3JvdXAgfTsKICAgICAgICBieUFnZW50W2FnZW50XS50b3RhbCArPSBzY29yZTsKICAgICAgICBieUFnZW50W2FnZW50XS5jb3VudCArPSAxOwogICAgICAgIC8vIGdyb3VwIGJvxZ9zYSBzb24gZ8O2csO8bGVuaSB5YXoKICAgICAgICBpZighYnlBZ2VudFthZ2VudF0uZ3JvdXAgJiYgZ3JvdXApIGJ5QWdlbnRbYWdlbnRdLmdyb3VwID0gZ3JvdXA7CiAgICB9KTsKCiAgICBjb25zdCByb3dzID0gT2JqZWN0LmtleXMoYnlBZ2VudCkubWFwKG5hbWUgPT4gewogICAgICAgIGNvbnN0IG8gPSBieUFnZW50W25hbWVdOwogICAgICAgIHJldHVybiB7IG5hbWUsIGdyb3VwOiBvLmdyb3VwIHx8IChnICE9PSAnYWxsJyA/IGcgOiAnJyksIGF2Zzogby5jb3VudCA/IChvLnRvdGFsL28uY291bnQpIDogMCwgY291bnQ6by5jb3VudCB9OwogICAgfSk7CgogICAgLy8gRcSfZXIgZ3JvdXAgc2XDp2lsaXlzZSBzYWRlY2UgbyBncnVidW4ga3VsbGFuxLFjxLFsYXLEsSB6YXRlbiBnZWxpeW9yOyBhbWEgZ2FyYW50aSBvbHN1bgogICAgY29uc3QgZmlsdGVyZWRSb3dzID0gKGcgJiYgZyAhPT0gJ2FsbCcpID8gcm93cy5maWx0ZXIociA9PiAoci5ncm91cCB8fCAnJykgPT09IGcpIDogcm93czsKCiAgICAvLyBTxLFyYWxhOiBlbiBkw7zFn8O8ayBvcnRhbGFtYSDDvHN0dGUgKGl5aWxlxZ90aXJtZSBhbGFuxLEpCiAgICBmaWx0ZXJlZFJvd3Muc29ydCgoeCx5KT0+IHguYXZnIC0geS5hdmcpOwoKICAgIGlmKGZpbHRlcmVkUm93cy5sZW5ndGggPT09IDApIHsgYm94LnN0eWxlLmRpc3BsYXk9J25vbmUnOyByZXR1cm47IH0KCiAgICAvLyDEsGxrIDgga2nFn2l5aSBnw7ZzdGVyCiAgICBjb25zdCB0b3AgPSBmaWx0ZXJlZFJvd3Muc2xpY2UoMCwgOCk7CgogICAgYm94LmlubmVySFRNTCA9IHRvcC5tYXAociA9PiBgCiAgICAgICAgPGRpdiBjbGFzcz0iZGFzLWl0ZW0iPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJkYXMtbGVmdCI+CiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iZGFzLW5hbWUiPiR7ZXNjYXBlSHRtbChyLm5hbWUpfTwvc3Bhbj4KICAgICAgICAgICAgICAgICR7ci5ncm91cCA/IGA8c3BhbiBjbGFzcz0iZGFzLWdyb3VwIj4ke2VzY2FwZUh0bWwoci5ncm91cCl9PC9zcGFuPmAgOiBgYH0KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImRhcy1zY29yZSI+JHsoci5hdmd8fDApLnRvRml4ZWQoMSl9PC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICBgKS5qb2luKCcnKTsKCiAgICBib3guc3R5bGUuZGlzcGxheSA9ICdncmlkJzsKfQoKLy8gRGV0YXkgYWxhbsSxbsSxIHRvbGVyYW5zbMSxIHBhcnNlIGV0CmZ1bmN0aW9uIHNhZmVQYXJzZURldGFpbHMoZGV0YWlscykgewogICAgaWYoIWRldGFpbHMpIHJldHVybiBudWxsOwogICAgaWYoQXJyYXkuaXNBcnJheShkZXRhaWxzKSkgcmV0dXJuIGRldGFpbHM7CiAgICBpZih0eXBlb2YgZGV0YWlscyA9PT0gJ29iamVjdCcpIHJldHVybiBkZXRhaWxzOwogICAgaWYodHlwZW9mIGRldGFpbHMgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgY29uc3QgcyA9IGRldGFpbHMudHJpbSgpOwogICAgICAgIGlmKCFzKSByZXR1cm4gbnVsbDsKICAgICAgICAvLyBCYXrEsSBlc2tpIGthecSxdGxhciDDp2lmdCB0xLFybmFrIGthw6fEscWfbMSxIGdlbGViaWxpcgogICAgICAgIGNvbnN0IHRyeUxpc3QgPSBbcywgcy5yZXBsYWNlKC9cIi9nLCciJyksIHMucmVwbGFjZSgvJy9nLCciJyldOwogICAgICAgIGZvcihjb25zdCBjYW5kIG9mIHRyeUxpc3QpewogICAgICAgICAgICB0cnl7CiAgICAgICAgICAgICAgICBjb25zdCBwYXJzZWQgPSBKU09OLnBhcnNlKGNhbmQpOwogICAgICAgICAgICAgICAgaWYoQXJyYXkuaXNBcnJheShwYXJzZWQpKSByZXR1cm4gcGFyc2VkOwogICAgICAgICAgICB9Y2F0Y2goZSl7fQogICAgICAgIH0KICAgIH0KICAgIHJldHVybiBudWxsOwp9CgovLyDinIUgWUVOxLA6IEZlZWRiYWNrIChHZXJpIEJpbGRpcmltbGVyKSBGaWx0cmVsZXJpbmkgRG9sZHVybWEKZnVuY3Rpb24gcG9wdWxhdGVGZWVkYmFja0ZpbHRlcnMoKSB7CiAgICBjb25zdCBncm91cFNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxLWZlZWRiYWNrLWdyb3VwJyk7CiAgICBjb25zdCBhZ2VudFNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxLWZlZWRiYWNrLWFnZW50Jyk7CiAgICBpZiAoIWdyb3VwU2VsZWN0IHx8ICFhZ2VudFNlbGVjdCkgcmV0dXJuOwoKICAgIGlmKCFpc0FkbWluTW9kZSkgewogICAgICAgIGdyb3VwU2VsZWN0LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgYWdlbnRTZWxlY3Quc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICByZXR1cm47CiAgICB9IGVsc2UgewogICAgICAgIGdyb3VwU2VsZWN0LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgIGFnZW50U2VsZWN0LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgfQoKICAgIGNvbnN0IGdyb3VwcyA9IFsuLi5uZXcgU2V0KGFkbWluVXNlckxpc3QubWFwKHUgPT4gdS5ncm91cCkuZmlsdGVyKGcgPT4gZykpXS5zb3J0KCk7CiAgICBncm91cFNlbGVjdC5pbm5lckhUTUwgPSAnPG9wdGlvbiB2YWx1ZT0iYWxsIj5Uw7xtIEdydXBsYXI8L29wdGlvbj4nOwogICAgZ3JvdXBzLmZvckVhY2goZyA9PiB7CiAgICAgICAgY29uc3Qgb3B0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7CiAgICAgICAgb3B0LnZhbHVlID0gZzsKICAgICAgICBvcHQudGV4dENvbnRlbnQgPSBnOwogICAgICAgIGdyb3VwU2VsZWN0LmFwcGVuZENoaWxkKG9wdCk7CiAgICB9KTsKCiAgICAvLyDEsGxrIHnDvGtsZW1lZGUgdMO8bSBhZ2VudGxhcsSxIGxpc3RlbGUKICAgIHVwZGF0ZUZlZWRiYWNrQWdlbnRMaXN0KGZhbHNlKTsKfQoKZnVuY3Rpb24gdXBkYXRlRmVlZGJhY2tBZ2VudExpc3Qoc2hvdWxkUmVmcmVzaD10cnVlKSB7CiAgICBjb25zdCBncm91cFNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxLWZlZWRiYWNrLWdyb3VwJyk7CiAgICBjb25zdCBhZ2VudFNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxLWZlZWRiYWNrLWFnZW50Jyk7CiAgICBpZighZ3JvdXBTZWxlY3QgfHwgIWFnZW50U2VsZWN0KSByZXR1cm47CgogICAgY29uc3Qgc2VsZWN0ZWRHcm91cCA9IGdyb3VwU2VsZWN0LnZhbHVlOwoKICAgIC8vIHNlw6dpbGVuIGdydWJhIGfDtnJlIGt1bGxhbsSxY8SxbGFyxLEgZmlsdHJlbGUKICAgIGNvbnN0IGZpbHRlcmVkVXNlcnMgPSBhZG1pblVzZXJMaXN0LmZpbHRlcih1ID0+IHsKICAgICAgICBpZighdSB8fCAhdS51c2VybmFtZSkgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmKHNlbGVjdGVkR3JvdXAgPT09ICdhbGwnKSByZXR1cm4gdHJ1ZTsKICAgICAgICByZXR1cm4gdS5ncm91cCA9PT0gc2VsZWN0ZWRHcm91cDsKICAgIH0pOwoKICAgIGNvbnN0IGFnZW50cyA9IGZpbHRlcmVkVXNlcnMKICAgICAgICAubWFwKHUgPT4gdS51c2VybmFtZSkKICAgICAgICAuZmlsdGVyKGEgPT4gYSkKICAgICAgICAuc29ydCgoYSxiKSA9PiBhLmxvY2FsZUNvbXBhcmUoYiwgJ3RyJykpOwoKICAgIGFnZW50U2VsZWN0LmlubmVySFRNTCA9ICc8b3B0aW9uIHZhbHVlPSJhbGwiPlTDvG0gVGVtc2lsY2lsZXI8L29wdGlvbj4nOwogICAgYWdlbnRzLmZvckVhY2goYSA9PiB7CiAgICAgICAgY29uc3Qgb3B0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7CiAgICAgICAgb3B0LnZhbHVlID0gYTsKICAgICAgICBvcHQudGV4dENvbnRlbnQgPSBhOwogICAgICAgIGFnZW50U2VsZWN0LmFwcGVuZENoaWxkKG9wdCk7CiAgICB9KTsKCiAgICBpZihzaG91bGRSZWZyZXNoKSByZWZyZXNoRmVlZGJhY2tEYXRhKCk7Cn0KCmFzeW5jIGZ1bmN0aW9uIGZldGNoRXZhbHVhdGlvbnNGb3JGZWVkYmFjaygpIHsKICAgIGNvbnN0IGdyb3VwU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3EtZmVlZGJhY2stZ3JvdXAnKTsKICAgIGNvbnN0IGFnZW50U2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3EtZmVlZGJhY2stYWdlbnQnKTsKCiAgICBsZXQgdGFyZ2V0QWdlbnQgPSBjdXJyZW50VXNlcjsKICAgIGxldCB0YXJnZXRHcm91cCA9ICdhbGwnOwoKICAgIGlmIChpc0FkbWluTW9kZSkgewogICAgICAgIHRhcmdldEFnZW50ID0gYWdlbnRTZWxlY3QgPyBhZ2VudFNlbGVjdC52YWx1ZSA6ICdhbGwnOwogICAgICAgIHRhcmdldEdyb3VwID0gZ3JvdXBTZWxlY3QgPyBncm91cFNlbGVjdC52YWx1ZSA6ICdhbGwnOwogICAgfQoKICAgIHRyeSB7CiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChTQ1JJUFRfVVJMLCB7CiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLAogICAgICAgICAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAndGV4dC9wbGFpbjtjaGFyc2V0PXV0Zi04JyB9LAogICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgICAgICAgICBhY3Rpb246ICdmZXRjaEV2YWx1YXRpb25zJywKICAgICAgICAgICAgICAgIHRhcmdldEFnZW50OiB0YXJnZXRBZ2VudCwKICAgICAgICAgICAgICAgIHRhcmdldEdyb3VwOiB0YXJnZXRHcm91cCwKICAgICAgICAgICAgICAgIHVzZXJuYW1lOiBjdXJyZW50VXNlciwKICAgICAgICAgICAgICAgIHRva2VuOiBnZXRUb2tlbigpCiAgICAgICAgICAgIH0pCiAgICAgICAgfSk7CiAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTsKICAgICAgICBpZiAoZGF0YS5yZXN1bHQgPT09ICJzdWNjZXNzIikgewogICAgICAgICAgICBhbGxFdmFsdWF0aW9uc0RhdGEgPSAoZGF0YS5ldmFsdWF0aW9ucyB8fCBbXSkucmV2ZXJzZSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFsbEV2YWx1YXRpb25zRGF0YSA9IFtdOwogICAgICAgIH0KICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBhbGxFdmFsdWF0aW9uc0RhdGEgPSBbXTsKICAgIH0KfQoKYXN5bmMgZnVuY3Rpb24gcmVmcmVzaEZlZWRiYWNrRGF0YSgpIHsKICAgIC8vIEZlZWRiYWNrIGVrcmFuxLEgacOnaW4gKGFkbWluIGZpbHRyZWxlcmluZSBnw7ZyZSkgZGXEn2VybGVuZGlybWVsZXJpICsgbG9nbGFyxLEgw6dlaywgc29ucmEgbGlzdGV5aSBiYXMKICAgIGF3YWl0IGZldGNoRXZhbHVhdGlvbnNGb3JGZWVkYmFjaygpOwogICAgYXdhaXQgZmV0Y2hGZWVkYmFja0xvZ3MoKTsKICAgIGxvYWRGZWVkYmFja0xpc3QoKTsKfQoKCmZ1bmN0aW9uIHJlZnJlc2hRdWFsaXR5RGF0YSgpIHsKICAgIGxvYWRRdWFsaXR5RGFzaGJvYXJkKCk7Cn0KYXN5bmMgZnVuY3Rpb24gZmV0Y2hFdmFsdWF0aW9uc0ZvckRhc2hib2FyZCgpIHsKICAgIC8vIERhc2hib2FyZCBmaWx0cmVsZXJpbmUgZ8O2cmUgZGXEn2VybGVuZGlybWVsZXJpIMOnZWsgKGFkbWluIGlzZSBzZcOnaWxlbiBncnVwL3RlbXNpbGNpeWUgZ8O2cmUpCiAgICBjb25zdCBncm91cFNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxLWRhc2gtZ3JvdXAnKTsKICAgIGNvbnN0IGFnZW50U2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3EtZGFzaC1hZ2VudCcpOwoKICAgIGxldCB0YXJnZXRBZ2VudCA9IGN1cnJlbnRVc2VyOwogICAgbGV0IHRhcmdldEdyb3VwID0gJ2FsbCc7CgogICAgaWYgKGlzQWRtaW5Nb2RlKSB7CiAgICAgICAgdGFyZ2V0QWdlbnQgPSBhZ2VudFNlbGVjdCA/IGFnZW50U2VsZWN0LnZhbHVlIDogJ2FsbCc7CiAgICAgICAgdGFyZ2V0R3JvdXAgPSBncm91cFNlbGVjdCA/IGdyb3VwU2VsZWN0LnZhbHVlIDogJ2FsbCc7CiAgICB9CgogICAgdHJ5IHsKICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKFNDUklQVF9VUkwsIHsKICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsCiAgICAgICAgICAgIGhlYWRlcnM6IHsgIkNvbnRlbnQtVHlwZSI6ICJ0ZXh0L3BsYWluO2NoYXJzZXQ9dXRmLTgiIH0sCiAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsKICAgICAgICAgICAgICAgIGFjdGlvbjogImZldGNoRXZhbHVhdGlvbnMiLAogICAgICAgICAgICAgICAgdGFyZ2V0QWdlbnQ6IHRhcmdldEFnZW50LAogICAgICAgICAgICAgICAgdGFyZ2V0R3JvdXA6IHRhcmdldEdyb3VwLAogICAgICAgICAgICAgICAgdXNlcm5hbWU6IGN1cnJlbnRVc2VyLAogICAgICAgICAgICAgICAgdG9rZW46IGdldFRva2VuKCkKICAgICAgICAgICAgfSkKICAgICAgICB9KTsKICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpOwogICAgICAgIGlmIChkYXRhLnJlc3VsdCA9PT0gInN1Y2Nlc3MiKSB7CiAgICAgICAgICAgIGFsbEV2YWx1YXRpb25zRGF0YSA9IChkYXRhLmV2YWx1YXRpb25zIHx8IFtdKS5yZXZlcnNlKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYWxsRXZhbHVhdGlvbnNEYXRhID0gW107CiAgICAgICAgfQogICAgfSBjYXRjaCAoZSkgewogICAgICAgIGFsbEV2YWx1YXRpb25zRGF0YSA9IFtdOwogICAgfQp9CmZ1bmN0aW9uIGxvYWRRdWFsaXR5RGFzaGJvYXJkKCkgewogICAgLy8gVmVyaWxlcmkgw6dlayAoc2lsZW50IG1vZGUpLCB2ZXJpIGdlbGluY2UgZ3JhZmlrbGVyaSDDp2l6CiAgICBmZXRjaEV2YWx1YXRpb25zRm9yRGFzaGJvYXJkKCkudGhlbigoKSA9PiB7CiAgICAgICAgY29uc3QgbW9udGhTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncS1kYXNoLW1vbnRoJyk7CiAgICAgICAgY29uc3QgZ3JvdXBTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncS1kYXNoLWdyb3VwJyk7CiAgICAgICAgY29uc3QgYWdlbnRTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncS1kYXNoLWFnZW50Jyk7CiAgICAgICAgY29uc3Qgc2VsZWN0ZWRNb250aCA9IG1vbnRoU2VsZWN0ID8gbW9udGhTZWxlY3QudmFsdWUgOiAnJzsKICAgICAgICBjb25zdCBzZWxlY3RlZEdyb3VwID0gZ3JvdXBTZWxlY3QgPyBncm91cFNlbGVjdC52YWx1ZSA6ICdhbGwnOwogICAgICAgIGNvbnN0IHNlbGVjdGVkQWdlbnQgPSBhZ2VudFNlbGVjdCA/IGFnZW50U2VsZWN0LnZhbHVlIDogJ2FsbCc7CiAgICAgICAgCiAgICAgICAgbGV0IGZpbHRlcmVkID0gYWxsRXZhbHVhdGlvbnNEYXRhLmZpbHRlcihlID0+IHsKICAgICAgICAgICAgY29uc3QgZURhdGUgPSBlLmRhdGUuc3Vic3RyaW5nKDMpOyAvLyBkZC5NTS55eXl5IC0+IE1NLnl5eXkKICAgICAgICAgICAgY29uc3QgbWF0Y2hNb250aCA9IChlRGF0ZSA9PT0gc2VsZWN0ZWRNb250aCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBsZXQgbWF0Y2hHcm91cCA9IHRydWU7CiAgICAgICAgICAgIGxldCBtYXRjaEFnZW50ID0gdHJ1ZTsKICAgICAgICAgICAgLy8gQWRtaW4gZmlsdHJlbGVtZSBtYW50xLHEn8SxCiAgICAgICAgICAgIGlmIChpc0FkbWluTW9kZSkgewogICAgICAgICAgICAgICAgLy8gRcSfZXIgdmVyaSBpw6dpbmRlIGdydXAgYmlsZ2lzaSB2YXJzYSBvbnUga3VsbGFuLCB5b2tzYSBhZG1pblVzZXJMaXN0J3RlbiBiYWttYWsgZ2VyZWtpci4KICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZEdyb3VwICE9PSAnYWxsJykgewogICAgICAgICAgICAgICAgICAgIGlmIChlLmdyb3VwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoR3JvdXAgPSAoZS5ncm91cCA9PT0gc2VsZWN0ZWRHcm91cCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdXNlciA9IGFkbWluVXNlckxpc3QuZmluZCh1ID0+IHUubmFtZSA9PT0gZS5hZ2VudCk7CiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoR3JvdXAgPSAodXNlciAmJiB1c2VyLmdyb3VwID09PSBzZWxlY3RlZEdyb3VwKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZEFnZW50ICE9PSAnYWxsJyAmJiBlLmFnZW50ICE9PSBzZWxlY3RlZEFnZW50KSBtYXRjaEFnZW50ID0gZmFsc2U7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBBZG1pbiBkZcSfaWxzZSBzYWRlY2Uga2VuZGkgdmVyaXNpCiAgICAgICAgICAgICAgICBpZihlLmFnZW50ICE9PSBjdXJyZW50VXNlcikgbWF0Y2hBZ2VudCA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIE1BTlVFTCBrYXnEsXRsYXLEsSBkYXNoYm9hcmQnZGEgZ8O2c3Rlcm1lCiAgICAgICAgICAgIGNvbnN0IGlzTWFudWFsID0gZS5jYWxsSWQgJiYgU3RyaW5nKGUuY2FsbElkKS50b1VwcGVyQ2FzZSgpLnN0YXJ0c1dpdGgoJ01BTlVFTC0nKTsKICAgICAgICAgICAgcmV0dXJuIG1hdGNoTW9udGggJiYgbWF0Y2hHcm91cCAmJiBtYXRjaEFnZW50ICYmICFpc01hbnVhbDsKICAgICAgICB9KTsKICAgICAgICBjb25zdCB0b3RhbCA9IGZpbHRlcmVkLnJlZHVjZSgoYWNjLCBjdXJyKSA9PiBhY2MgKyAocGFyc2VJbnQoY3Vyci5zY29yZSl8fDApLCAwKTsKICAgICAgICBjb25zdCBjb3VudCA9IGZpbHRlcmVkLmxlbmd0aDsKICAgICAgICBjb25zdCBhdmcgPSBjb3VudCA+IDAgPyAodG90YWwgLyBjb3VudCkudG9GaXhlZCgxKSA6IDA7CiAgICAgICAgY29uc3QgdGFyZ2V0SGl0ID0gZmlsdGVyZWQuZmlsdGVyKGUgPT4gZS5zY29yZSA+PSA5MCkubGVuZ3RoOwogICAgICAgIGNvbnN0IHJhdGUgPSBjb3VudCA+IDAgPyBNYXRoLnJvdW5kKCh0YXJnZXRIaXQgLyBjb3VudCkgKiAxMDApIDogMDsKICAgICAgICAvLyBVSSBHw7xuY2VsbGUKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncS1kYXNoLXNjb3JlJykuaW5uZXJUZXh0ID0gYXZnOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxLWRhc2gtY291bnQnKS5pbm5lclRleHQgPSBjb3VudDsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncS1kYXNoLXRhcmdldCcpLmlubmVyVGV4dCA9IGAlJHtyYXRlfWA7CiAgICAgICAgCiAgICAgICAgLy8gUmluZyBDaGFydCBSZW5naQogICAgICAgIGNvbnN0IHJpbmcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncS1kYXNoLXJpbmcnKTsKICAgICAgICBsZXQgY29sb3IgPSAnIzJlN2QzMic7CiAgICAgICAgaWYoYXZnIDwgNzApIGNvbG9yID0gJyNkMzJmMmYnOyBlbHNlIGlmKGF2ZyA8IDg1KSBjb2xvciA9ICcjZWQ2YzAyJzsKICAgICAgICBjb25zdCByYXRpbyA9IChhdmcgLyAxMDApICogMTAwOwogICAgICAgIGlmKHJpbmcpIHJpbmcuc3R5bGUuYmFja2dyb3VuZCA9IGBjb25pYy1ncmFkaWVudCgke2NvbG9yfSAke3JhdGlvfSUsICNlZWUgJHtyYXRpb30lKWA7CiAgICAgICAgaWYoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3EtZGFzaC1yaW5nLXRleHQnKSkgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3EtZGFzaC1yaW5nLXRleHQnKS5pbm5lclRleHQgPSBNYXRoLnJvdW5kKGF2Zyk7CiAgICAgICAgdXBkYXRlRGFzaFJpbmdUaXRsZSgpOwogICAgICAgIC8vIEFkbWluIGnDp2luOiB0ZW1zaWxjaSBvcnRhbGFtYWxhcsSxCiAgICAgICAgcmVuZGVyRGFzaEFnZW50U2NvcmVzKGZpbHRlcmVkKTsKICAgICAgICAvLyBHcmFmaWsgw4dpemRpcgogICAgICAgIHJlbmRlckRhc2hib2FyZENoYXJ0KGZpbHRlcmVkKTsKICAgIH0pOwp9CmZ1bmN0aW9uIHJlbmRlckRhc2hib2FyZENoYXJ0KGRhdGEpIHsKICAgIGNvbnN0IGN0eCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxLWJyZWFrZG93bi1jaGFydCcpOwogICAgaWYgKCFjdHgpIHJldHVybjsKICAgIGlmIChkYXNoYm9hcmRDaGFydCkgewogICAgICAgIGRhc2hib2FyZENoYXJ0LmRlc3Ryb3koKTsKICAgIH0KICAgIC8vIC0tLSBLUsSwVEVSIEJBWkxJIEFOQUzEsFogLS0tCiAgICBsZXQgcXVlc3Rpb25TdGF0cyA9IHt9OwogICAgaWYgKGRhdGEubGVuZ3RoID4gMCkgewogICAgICAgIGRhdGEuZm9yRWFjaChpdGVtID0+IHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8vIERldGF5IHZlcmlzaW5pIGtvbnRyb2wgZXQsIHN0cmluZyBpc2UgcGFyc2UgZXQKICAgICAgICAgICAgICAgIGxldCBkZXRhaWxzID0gc2FmZVBhcnNlRGV0YWlscyhpdGVtLmRldGFpbHMpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZihBcnJheS5pc0FycmF5KGRldGFpbHMpKSB7CiAgICAgICAgICAgICAgICAgICAgZGV0YWlscy5mb3JFYWNoKGQgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBsZXQgcUZ1bGxUZXh0ID0gZC5xOyAvLyBUYW0gbWV0aW4KICAgICAgICAgICAgICAgICAgICAgICAgLy8gU29ydXl1IGFuYWh0YXIgb2xhcmFrIGt1bGxhbiAoa8Sxc2FsdMSxbG3EscWfIHZlcnNpeW9udSkKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHFTaG9ydFRleHQgPSBxRnVsbFRleHQubGVuZ3RoID4gMjUgPyBxRnVsbFRleHQuc3Vic3RyaW5nKDAsIDI1KSArICcuLi4nIDogcUZ1bGxUZXh0OwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFxdWVzdGlvblN0YXRzW3FTaG9ydFRleHRdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBmdWxsVGV4dCdpIHR1dHV5b3J1eiBraSB0b29sdGlwJ3RlIGfDtnN0ZXJlYmlsZWxpbQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVlc3Rpb25TdGF0c1txU2hvcnRUZXh0XSA9IHsgZWFybmVkOiAwLCBtYXg6IDAsIGZ1bGxUZXh0OiBxRnVsbFRleHQgfTsgCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXN0aW9uU3RhdHNbcVNob3J0VGV4dF0uZWFybmVkICs9IHBhcnNlSW50KGQuc2NvcmUgfHwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXN0aW9uU3RhdHNbcVNob3J0VGV4dF0ubWF4ICs9IHBhcnNlSW50KGQubWF4IHx8IDApOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAvLyBKU09OIHBhcnNlIGhhdGFzxLEgdmV5YSBlc2tpIHZlcmkgZm9ybWF0xLEKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJEZXRheSB2ZXJpc2kgacWfbGVuZW1lZGkiLCBlKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQogICAgLy8gxLBzdGF0aXN0aWtsZXJpIGRpeml5ZSDDp2V2aXJpcCBiYcWfYXLEsSBvcmFuxLFuYSBnw7ZyZSBzxLFyYWxhCiAgICBsZXQgc3RhdHNBcnJheSA9IE9iamVjdC5rZXlzKHF1ZXN0aW9uU3RhdHMpLm1hcChrZXkgPT4gewogICAgICAgIGxldCBzID0gcXVlc3Rpb25TdGF0c1trZXldOwogICAgICAgIC8vIEJhxZ9hcsSxIG9yYW7EsSAlCiAgICAgICAgbGV0IHBlcmNlbnRhZ2UgPSBzLm1heCA+IDAgPyAocy5lYXJuZWQgLyBzLm1heCkgKiAxMDAgOiAwOwogICAgICAgIHJldHVybiB7IGxhYmVsOiBrZXksIGZ1bGxMYWJlbDogcy5mdWxsVGV4dCwgdmFsdWU6IHBlcmNlbnRhZ2UgfTsKICAgIH0pOwogICAgCiAgICAvLyBCYcWfYXLEsSBvcmFuxLFuYSBnw7ZyZSBhcnRhbiBzxLFyYWxhbWEgKEVuIGTDvMWfw7xrIGJhxZ9hcsSxIGVuIGJhxZ90YSkKICAgIHN0YXRzQXJyYXkuc29ydCgoYSwgYikgPT4gYS52YWx1ZSAtIGIudmFsdWUpOwogICAgLy8gRcSfZXIgZGV0YXkga8SxcsSxbMSxbcSxIHlva3NhIChlc2tpL2JvxZ8ga2F5xLF0bGFyKSwgdGVtc2lsY2kgb3J0YWxhbWFzxLFuYSBnw7ZyZSBrxLFyxLFsxLFtIGfDtnN0ZXIKICAgIGlmIChzdGF0c0FycmF5Lmxlbmd0aCA9PT0gMCkgewogICAgICAgIGNvbnN0IGJ5QWdlbnQgPSB7fTsKICAgICAgICBkYXRhLmZvckVhY2goaXQgPT4gewogICAgICAgICAgICBjb25zdCBhID0gaXQuYWdlbnQgfHwgJ04vQSc7CiAgICAgICAgICAgIGNvbnN0IHMgPSBwYXJzZUZsb2F0KGl0LnNjb3JlKSB8fCAwOwogICAgICAgICAgICBpZighYnlBZ2VudFthXSkgYnlBZ2VudFthXSA9IHsgdG90YWw6MCwgY291bnQ6MCB9OwogICAgICAgICAgICBieUFnZW50W2FdLnRvdGFsICs9IHM7CiAgICAgICAgICAgIGJ5QWdlbnRbYV0uY291bnQgKz0gMTsKICAgICAgICB9KTsKICAgICAgICBjb25zdCBhQXJyID0gT2JqZWN0LmtleXMoYnlBZ2VudCkubWFwKG5hbWUgPT4gKHsKICAgICAgICAgICAgbGFiZWw6IG5hbWUubGVuZ3RoID4gMjUgPyBuYW1lLnN1YnN0cmluZygwLDI1KSArICcuLi4nIDogbmFtZSwKICAgICAgICAgICAgZnVsbExhYmVsOiBuYW1lLAogICAgICAgICAgICB2YWx1ZTogYnlBZ2VudFtuYW1lXS5jb3VudCA/IChieUFnZW50W25hbWVdLnRvdGFsL2J5QWdlbnRbbmFtZV0uY291bnQpIDogMAogICAgICAgIH0pKTsKICAgICAgICBhQXJyLnNvcnQoKHgseSk9PiB4LnZhbHVlIC0geS52YWx1ZSk7CiAgICAgICAgbGV0IHRvcElzc3VlcyA9IGFBcnIuc2xpY2UoMCwgNik7CiAgICAgICAgbGV0IGNoYXJ0TGFiZWxzID0gdG9wSXNzdWVzLm1hcChpID0+IGkubGFiZWwpOwogICAgICAgIGxldCBjaGFydERhdGEgPSB0b3BJc3N1ZXMubWFwKGkgPT4gaS52YWx1ZS50b0ZpeGVkKDEpKTsKCiAgICAgICAgZGFzaGJvYXJkQ2hhcnQgPSBuZXcgQ2hhcnQoY3R4LCB7CiAgICAgICAgICAgIHR5cGU6ICdiYXInLAogICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgICBsYWJlbHM6IGNoYXJ0TGFiZWxzLAogICAgICAgICAgICAgICAgZGF0YXNldHM6IFt7CiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdPcnRhbGFtYSBQdWFuJywKICAgICAgICAgICAgICAgICAgICBkYXRhOiBjaGFydERhdGEsCiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBjaGFydERhdGEubWFwKHZhbCA9PiB2YWwgPCA3MCA/ICdyZ2JhKDIxMSwgNDcsIDQ3LCAwLjcpJyA6ICh2YWwgPCA4NSA/ICdyZ2JhKDIzNywgMTA4LCAyLCAwLjcpJyA6ICdyZ2JhKDQ2LCAxMjUsIDUwLCAwLjcpJykpLAogICAgICAgICAgICAgICAgICAgIGJvcmRlckNvbG9yOiBjaGFydERhdGEubWFwKHZhbCA9PiB2YWwgPCA3MCA/ICcjYjcxYzFjJyA6ICh2YWwgPCA4NSA/ICcjZTY1MTAwJyA6ICcjMWI1ZTIwJykpLAogICAgICAgICAgICAgICAgICAgIGJvcmRlcldpZHRoOiAxLAogICAgICAgICAgICAgICAgICAgIGJvcmRlclJhZGl1czogNAogICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgb3B0aW9uczogewogICAgICAgICAgICAgICAgcmVzcG9uc2l2ZTogdHJ1ZSwKICAgICAgICAgICAgICAgIG1haW50YWluQXNwZWN0UmF0aW86IGZhbHNlLAogICAgICAgICAgICAgICAgaW5kZXhBeGlzOiAneScsCiAgICAgICAgICAgICAgICBzY2FsZXM6IHsKICAgICAgICAgICAgICAgICAgICB4OiB7IGJlZ2luQXRaZXJvOiB0cnVlLCBtYXg6IDEwMCwgZ3JpZDogeyBjb2xvcjogJyNmMGYwZjAnIH0gfSwKICAgICAgICAgICAgICAgICAgICB5OiB7IGdyaWQ6IHsgZGlzcGxheTogZmFsc2UgfSB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcGx1Z2luczogewogICAgICAgICAgICAgICAgICAgIGxlZ2VuZDogeyBkaXNwbGF5OiBmYWxzZSB9LAogICAgICAgICAgICAgICAgICAgIHRvb2x0aXA6IHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogZnVuY3Rpb24oY29udGV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb250ZXh0Lmxlbmd0aCA+IDApIHJldHVybiB0b3BJc3N1ZXNbY29udGV4dFswXS5kYXRhSW5kZXhdLmZ1bGxMYWJlbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJyc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IGZ1bmN0aW9uKGNvbnRleHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29udGV4dC5wYXJzZWQueCArICcgT3J0YWxhbWEnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIFNhZGVjZSBlbiBkw7zFn8O8ayA2IGtyaXRlcmkgZ8O2c3RlcgogICAgbGV0IHRvcElzc3VlcyA9IHN0YXRzQXJyYXkuc2xpY2UoMCwgNik7CiAKICAgIGxldCBjaGFydExhYmVscyA9IHRvcElzc3Vlcy5tYXAoaSA9PiBpLmxhYmVsKTsKICAgIGxldCBjaGFydERhdGEgPSB0b3BJc3N1ZXMubWFwKGkgPT4gaS52YWx1ZS50b0ZpeGVkKDEpKTsKICAgIGRhc2hib2FyZENoYXJ0ID0gbmV3IENoYXJ0KGN0eCwgewogICAgICAgIHR5cGU6ICdiYXInLAogICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgbGFiZWxzOiBjaGFydExhYmVscywKICAgICAgICAgICAgZGF0YXNldHM6IFt7CiAgICAgICAgICAgICAgICBsYWJlbDogJ0JhxZ9hcsSxIE9yYW7EsSAoJSknLAogICAgICAgICAgICAgICAgZGF0YTogY2hhcnREYXRhLAogICAgICAgICAgICAgICAgLy8gS3JpdGVyIEJhemzEsSBSZW5rbGVuZGlybWUKICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogY2hhcnREYXRhLm1hcCh2YWwgPT4gdmFsIDwgNzAgPyAncmdiYSgyMTEsIDQ3LCA0NywgMC43KScgOiAodmFsIDwgOTAgPyAncmdiYSgyMzcsIDEwOCwgMiwgMC43KScgOiAncmdiYSg0NiwgMTI1LCA1MCwgMC43KScpKSwKICAgICAgICAgICAgICAgIGJvcmRlckNvbG9yOiBjaGFydERhdGEubWFwKHZhbCA9PiB2YWwgPCA3MCA/ICcjYjcxYzFjJyA6ICh2YWwgPCA5MCA/ICcjZTY1MTAwJyA6ICcjMWI1ZTIwJykpLAogICAgICAgICAgICAgICAgYm9yZGVyV2lkdGg6IDEsCiAgICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6IDQKICAgICAgICAgICAgfV0KICAgICAgICB9LAogICAgICAgIG9wdGlvbnM6IHsKICAgICAgICAgICAgcmVzcG9uc2l2ZTogdHJ1ZSwKICAgICAgICAgICAgbWFpbnRhaW5Bc3BlY3RSYXRpbzogZmFsc2UsCiAgICAgICAgICAgIGluZGV4QXhpczogJ3knLCAvLyBZYXRheSDDp3VidWsgZ3JhZmlrCiAgICAgICAgICAgIHNjYWxlczogewogICAgICAgICAgICAgICAgeDogeyAKICAgICAgICAgICAgICAgICAgICBiZWdpbkF0WmVybzogdHJ1ZSwgCiAgICAgICAgICAgICAgICAgICAgbWF4OiAxMDAsCiAgICAgICAgICAgICAgICAgICAgZ3JpZDogeyBjb2xvcjogJyNmMGYwZjAnIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB5OiB7CiAgICAgICAgICAgICAgICAgICAgZ3JpZDogeyBkaXNwbGF5OiBmYWxzZSB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHBsdWdpbnM6IHsKICAgICAgICAgICAgICAgIGxlZ2VuZDogeyBkaXNwbGF5OiBmYWxzZSB9LAogICAgICAgICAgICAgICAgdG9vbHRpcDogewogICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrczogewogICAgICAgICAgICAgICAgICAgICAgICAvLyBUb29sdGlwIGJhxZ9sxLHEn8SxbmRhIHRhbSBtZXRuaSBnw7ZzdGVyaWxtZXNpCiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBmdW5jdGlvbihjb250ZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29udGV4dC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YUluZGV4ID0gY29udGV4dFswXS5kYXRhSW5kZXg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZnVsbExhYmVsJ2kga3VsbGFuYXJhayB0YW0gbWV0bmkgZMO2bmTDvHIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdG9wSXNzdWVzW2RhdGFJbmRleF0uZnVsbExhYmVsOyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IGZ1bmN0aW9uKGNvbnRleHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjb250ZXh0LnBhcnNlZC54ICsgJyUgQmHFn2FyxLEnOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSk7Cn0KLy8gLS0tIEXEnsSwVMSwTSBNT0TDnEzDnCAoWUVOxLApIC0tLQpmdW5jdGlvbiBsb2FkVHJhaW5pbmdEYXRhKCkgewogICAgY29uc3QgbGlzdEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RyYWluaW5nLWxpc3QnKTsKICAgIGxpc3RFbC5pbm5lckhUTUwgPSAnPGRpdiBzdHlsZT0iZ3JpZC1jb2x1bW46MS8tMTsgdGV4dC1hbGlnbjpjZW50ZXI7Ij5Zw7xrbGVuaXlvci4uLjwvZGl2Pic7CiAgICAKICAgIGZldGNoKFNDUklQVF9VUkwsIHsKICAgICAgICBtZXRob2Q6ICdQT1NUJywKICAgICAgICBoZWFkZXJzOiB7ICJDb250ZW50LVR5cGUiOiAidGV4dC9wbGFpbjtjaGFyc2V0PXV0Zi04IiB9LAogICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgYWN0aW9uOiAiZ2V0VHJhaW5pbmdzIiwgdXNlcm5hbWU6IGN1cnJlbnRVc2VyLCB0b2tlbjogZ2V0VG9rZW4oKSB9KQogICAgfSkudGhlbihyID0+IHIuanNvbigpKS50aGVuKGRhdGEgPT4gewogICAgICAgIGxpc3RFbC5pbm5lckhUTUwgPSAnJzsKICAgICAgICBpZihkYXRhLnJlc3VsdCA9PT0gJ3N1Y2Nlc3MnICYmIGRhdGEudHJhaW5pbmdzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgZGF0YS50cmFpbmluZ3MuZm9yRWFjaCh0ID0+IHsKICAgICAgICAgICAgICAgIGxldCBzdGF0dXNIdG1sID0gdC5pc0NvbXBsZXRlZCAKICAgICAgICAgICAgICAgICAgICA/IGA8YnV0dG9uIGNsYXNzPSJ0LWJ0biB0LWJ0bi1kb25lIj48aSBjbGFzcz0iZmFzIGZhLWNoZWNrIj48L2k+IFRhbWFtbGFuZMSxPC9idXR0b24+YAogICAgICAgICAgICAgICAgICAgIDogYDxidXR0b24gY2xhc3M9InQtYnRuIHQtYnRuLXN0YXJ0IiBvbmNsaWNrPSJvcGVuVHJhaW5pbmdMaW5rKCcke3QuaWR9JywgJyR7dC5saW5rfScpIj5FxJ9pdGltZSBHaXQ8L2J1dHRvbj5gOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsZXQgZG9jSHRtbCA9IHQuZG9jTGluayAmJiB0LmRvY0xpbmsgIT09ICdOL0EnIAogICAgICAgICAgICAgICAgICAgID8gYDxhIGhyZWY9IiR7dC5kb2NMaW5rfSIgdGFyZ2V0PSJfYmxhbmsiIGNsYXNzPSJ0LWRvYy1saW5rIj48aSBjbGFzcz0iZmFzIGZhLWZpbGUtZG93bmxvYWQiPjwvaT4gRMO2a8O8bWFuxLEgxLBuZGlyPC9hPmAgCiAgICAgICAgICAgICAgICAgICAgOiAnJzsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gR8OcTkNFTExFTk3EsMWeIEtBUlQgWUFQSVNJIChUYXJpaCB2ZSBTw7xyZSBFa2xlbmRpKQogICAgICAgICAgICAgICAgbGlzdEVsLmlubmVySFRNTCArPSBgCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0LWNhcmQiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InQtY2FyZC1oZWFkZXIiPgogICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj4ke3QudGl0bGV9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0idC1zdGF0dXMtYmFkZ2UiPkF0YW5tYTogJHt0LmRhdGV9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InQtY2FyZC1ib2R5Ij4KICAgICAgICAgICAgICAgICAgICAgICAgJHt0LmRlc2N9CiAgICAgICAgICAgICAgICAgICAgICAgICR7ZG9jSHRtbH0KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0ibWFyZ2luLXRvcDoxMHB4OyBkaXNwbGF5OmZsZXg7IGp1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuOyBmb250LXNpemU6MC44cmVtOyBjb2xvcjojNjY2OyBwYWRkaW5nLXRvcDoxMHB4OyBib3JkZXItdG9wOjFweCBkYXNoZWQgI2VlZTsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48c3Ryb25nPlPDvHJlOjwvc3Ryb25nPiAke3QuZHVyYXRpb24gfHwgJ0JlbGlydGlsbWVkaSd9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxzdHJvbmc+QmHFn2xhbmfEscOnOjwvc3Ryb25nPiAke3Quc3RhcnREYXRlIHx8ICdOL0EnfSAtIDxzdHJvbmc+Qml0acWfOjwvc3Ryb25nPiAke3QuZW5kRGF0ZSB8fCAnTi9BJ308L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjhyZW07IGNvbG9yOiM5OTk7IG1hcmdpbi10b3A6NXB4OyI+QXRheWFuOiAke3QuY3JlYXRvcn08L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0LWNhcmQtZm9vdGVyIj4KICAgICAgICAgICAgICAgICAgICAgICAgJHtzdGF0dXNIdG1sfQogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbGlzdEVsLmlubmVySFRNTCA9ICc8ZGl2IHN0eWxlPSJncmlkLWNvbHVtbjoxLy0xOyB0ZXh0LWFsaWduOmNlbnRlcjsgcGFkZGluZzoyMHB4OyBjb2xvcjojODg4OyI+QXRhbm3EscWfIGXEn2l0aW0gYnVsdW5tdXlvci48L2Rpdj4nOwogICAgICAgIH0KICAgIH0pOwp9CmZ1bmN0aW9uIG9wZW5UcmFpbmluZ0xpbmsoaWQsIGxpbmspIHsKICAgIGlmKGxpbmsgJiYgbGluayAhPT0gJ04vQScpIHsKICAgICAgICB3aW5kb3cub3BlbihsaW5rLCAnX2JsYW5rJyk7CiAgICB9IGVsc2UgewogICAgICAgIFN3YWwuZmlyZSgnVXlhcsSxJywgJ0J1IGXEn2l0aW0gacOnaW4gZ2XDp2VybGkgYmlyIGxpbmsgYnVsdW5tYW1ha3RhZMSxci4nLCAnd2FybmluZycpOwogICAgfQogICAgCiAgICAvLyBMaW5rZSB0xLFrbGFkxLFrdGFuIHNvbnJhIG9uYXkgc29yCiAgICBTd2FsLmZpcmUoewogICAgICAgIHRpdGxlOiAnRcSfaXRpbWkgVGFtYW1sYWTEsW4gbcSxPycsCiAgICAgICAgdGV4dDogIkXEn2l0aW0gacOnZXJpxJ9pbmkgaW5jZWxleWlwIGFubGFkxLF5c2FuIG9uYXlsYS4iLAogICAgICAgIGljb246ICdxdWVzdGlvbicsCiAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogJ0V2ZXQsIFRhbWFtbGFkxLFtJywKICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiAnRGFoYSBTb25yYScKICAgIH0pLnRoZW4oKHJlc3VsdCkgPT4gewogICAgICAgIGlmIChyZXN1bHQuaXNDb25maXJtZWQpIHsKICAgICAgICAgICAgY29tcGxldGVUcmFpbmluZyhpZCk7CiAgICAgICAgfQogICAgfSk7Cn0KZnVuY3Rpb24gY29tcGxldGVUcmFpbmluZyhpZCkgewogICAgZmV0Y2goU0NSSVBUX1VSTCwgewogICAgICAgIG1ldGhvZDogJ1BPU1QnLAogICAgICAgIGhlYWRlcnM6IHsgIkNvbnRlbnQtVHlwZSI6ICJ0ZXh0L3BsYWluO2NoYXJzZXQ9dXRmLTgiIH0sCiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBhY3Rpb246ICJjb21wbGV0ZVRyYWluaW5nIiwgdHJhaW5pbmdJZDogaWQsIHVzZXJuYW1lOiBjdXJyZW50VXNlciwgdG9rZW46IGdldFRva2VuKCkgfSkKICAgIH0pLnRoZW4ociA9PiByLmpzb24oKSkudGhlbihkID0+IHsKICAgICAgICBpZihkLnJlc3VsdCA9PT0gJ3N1Y2Nlc3MnKSB7CiAgICAgICAgICAgIFN3YWwuZmlyZSgnSGFyaWthIScsICdFxJ9pdGltIHRhbWFtbGFuZMSxIG9sYXJhayBpxZ9hcmV0bGVuZGkuJywgJ3N1Y2Nlc3MnKTsKICAgICAgICAgICAgbG9hZFRyYWluaW5nRGF0YSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFN3YWwuZmlyZSgnSGF0YScsIGQubWVzc2FnZSwgJ2Vycm9yJyk7CiAgICAgICAgfQogICAgfSk7Cn0KYXN5bmMgZnVuY3Rpb24gYXNzaWduVHJhaW5pbmdQb3B1cCgpIHsKICAgIGNvbnN0IHsgdmFsdWU6IGZvcm1WYWx1ZXMgfSA9IGF3YWl0IFN3YWwuZmlyZSh7CiAgICAgICAgdGl0bGU6ICdZZW5pIEXEn2l0aW0gJiBEw7Zrw7xtYW4gQXRhJywKICAgICAgICBodG1sOiBgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9InQtbW9kYWwtZ3JpZCI+CiAgICAgICAgICAgICAgICA8aW5wdXQgaWQ9InN3YWwtdC10aXRsZSIgY2xhc3M9InN3YWwyLWlucHV0IiBwbGFjZWhvbGRlcj0iRcSfaXRpbSBCYcWfbMSxxJ/EsSIgc3R5bGU9ImdyaWQtY29sdW1uOiAxIC8gNDsiPgogICAgICAgICAgICAgICAgPHRleHRhcmVhIGlkPSJzd2FsLXQtZGVzYyIgY2xhc3M9InN3YWwyLXRleHRhcmVhIiBzdHlsZT0iaGVpZ2h0OjEwMHB4OyBncmlkLWNvbHVtbjogMSAvIDQ7IiBwbGFjZWhvbGRlcj0iRcSfaXRpbSBhw6fEsWtsYW1hc8SxIHZleWEgdGFsaW1hdGxhci4uLiI+PC90ZXh0YXJlYT4KICAgICAgICAgICAgICAgIDxpbnB1dCBpZD0ic3dhbC10LWxpbmsiIGNsYXNzPSJzd2FsMi1pbnB1dCIgcGxhY2Vob2xkZXI9IlZpZGVvL0XEn2l0aW0gTGlua2kgKFVSTCkiIHN0eWxlPSJncmlkLWNvbHVtbjogMSAvIDQ7Ij4KICAgICAgICAgICAgICAgIDxpbnB1dCBpZD0ic3dhbC10LWRvYyIgY2xhc3M9InN3YWwyLWlucHV0IiBwbGFjZWhvbGRlcj0iRMO2a8O8bWFuIExpbmtpIChEcml2ZS9QREYgVVJMKSAoxLBzdGXEn2UgQmHEn2zEsSkiIHN0eWxlPSJncmlkLWNvbHVtbjogMSAvIDQ7Ij4KICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJkYXRlIiBpZD0ic3dhbC10LXN0YXJ0IiBjbGFzcz0ic3dhbDItaW5wdXQiIHZhbHVlPSIke25ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zdWJzdHJpbmcoMCwgMTApfSI+CiAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iZGF0ZSIgaWQ9InN3YWwtdC1lbmQiIGNsYXNzPSJzd2FsMi1pbnB1dCI+CiAgICAgICAgICAgICAgICA8aW5wdXQgaWQ9InN3YWwtdC1kdXJhdGlvbiIgY2xhc3M9InN3YWwyLWlucHV0IiBwbGFjZWhvbGRlcj0iU8O8cmUgKMOWcm46IDIwZGspIj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxzZWxlY3QgaWQ9InN3YWwtdC10YXJnZXQiIGNsYXNzPSJzd2FsMi1pbnB1dCIgb25jaGFuZ2U9InVwZGF0ZVRyYWluaW5nVGFyZ2V0KHRoaXMudmFsdWUpIiBzdHlsZT0ibWFyZ2luLXRvcDoxMHB4OyI+CiAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJHZW5lbCI+SGVya2VzZSAoVMO8bSBFa2lwKTwvb3B0aW9uPgogICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iVGVsZXNhdMSxxZ8iPlRlbGVzYXTEscWfIEVraWJpPC9vcHRpb24+CiAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJDaGF0Ij5DaGF0IEVraWJpPC9vcHRpb24+CiAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJJbmRpdmlkdWFsIj5LacWfaXllIMOWemVsPC9vcHRpb24+CiAgICAgICAgICAgIDwvc2VsZWN0PgogICAgICAgICAgICA8c2VsZWN0IGlkPSJzd2FsLXQtYWdlbnQiIGNsYXNzPSJzd2FsMi1pbnB1dCIgc3R5bGU9ImRpc3BsYXk6bm9uZTsgd2lkdGg6MTAwJTsiPjwvc2VsZWN0PgogICAgICAgIGAsCiAgICAgICAgZm9jdXNDb25maXJtOiBmYWxzZSwKICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAnQXRhJywKICAgICAgICBkaWRPcGVuOiAoKSA9PiB7CiAgICAgICAgICAgIHdpbmRvdy51cGRhdGVUcmFpbmluZ1RhcmdldCA9IGZ1bmN0aW9uKHZhbCkgewogICAgICAgICAgICAgICAgY29uc3QgYWdlbnRTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC10LWFnZW50Jyk7CiAgICAgICAgICAgICAgICBhZ2VudFNlbGVjdC5zdHlsZS5kaXNwbGF5ID0gdmFsID09PSAnSW5kaXZpZHVhbCcgPyAnYmxvY2snIDogJ25vbmUnOwogICAgICAgICAgICAgICAgaWYgKHZhbCA9PT0gJ0luZGl2aWR1YWwnKSB7CiAgICAgICAgICAgICAgICAgICAgYWdlbnRTZWxlY3QuaW5uZXJIVE1MID0gYWRtaW5Vc2VyTGlzdC5tYXAodSA9PiBgPG9wdGlvbiB2YWx1ZT0iJHt1Lm5hbWV9Ij4ke3UubmFtZX08L29wdGlvbj5gKS5qb2luKCcnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgdXBkYXRlVHJhaW5pbmdUYXJnZXQoJ0dlbmVsJyk7CiAgICAgICAgfSwKICAgICAgICBwcmVDb25maXJtOiAoKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHRhcmdldCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLXQtdGFyZ2V0JykudmFsdWU7CiAgICAgICAgICAgIGNvbnN0IGFnZW50ID0gdGFyZ2V0ID09PSAnSW5kaXZpZHVhbCcgPyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC10LWFnZW50JykudmFsdWUgOiAnJzsKICAgICAgICAgICAgaWYgKCFkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC10LXRpdGxlJykudmFsdWUgfHwgKCF0YXJnZXQgJiYgIWFnZW50KSkgewogICAgICAgICAgICAgICAgU3dhbC5zaG93VmFsaWRhdGlvbk1lc3NhZ2UoJ0JhxZ9sxLFrIHZlIEF0YW1hIEFsYW7EsSBib8WfIGLEsXJha8SxbGFtYXonKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgdGl0bGU6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLXQtdGl0bGUnKS52YWx1ZSwKICAgICAgICAgICAgICAgIGRlc2M6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLXQtZGVzYycpLnZhbHVlLAogICAgICAgICAgICAgICAgbGluazogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N3YWwtdC1saW5rJykudmFsdWUsCiAgICAgICAgICAgICAgICBkb2NMaW5rOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC10LWRvYycpLnZhbHVlIHx8ICdOL0EnLAogICAgICAgICAgICAgICAgdGFyZ2V0OiB0YXJnZXQsCiAgICAgICAgICAgICAgICB0YXJnZXRBZ2VudDogYWdlbnQsIC8vIEtpxZ9peWUgw7Z6ZWwgYXRhbWEgacOnaW4KICAgICAgICAgICAgICAgIGNyZWF0b3I6IGN1cnJlbnRVc2VyLAogICAgICAgICAgICAgICAgc3RhcnREYXRlOiBmb3JtYXREYXRlVG9ERE1NWVlZWShkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC10LXN0YXJ0JykudmFsdWUpLCAKICAgICAgICAgICAgICAgIGVuZERhdGU6IGZvcm1hdERhdGVUb0RETU1ZWVlZKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLXQtZW5kJykudmFsdWUpLCAKICAgICAgICAgICAgICAgIGR1cmF0aW9uOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC10LWR1cmF0aW9uJykudmFsdWUgCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KTsKICAgIGlmIChmb3JtVmFsdWVzKSB7CiAgICAgICAgU3dhbC5maXJlKHt0aXRsZTonQXRhbsSxeW9yLi4uJywgZGlkT3BlbjooKT0+U3dhbC5zaG93TG9hZGluZygpfSk7CiAgICAgICAgZmV0Y2goU0NSSVBUX1VSTCwgewogICAgICAgICAgICBtZXRob2Q6ICdQT1NUJywKICAgICAgICAgICAgaGVhZGVyczogeyAiQ29udGVudC1UeXBlIjogInRleHQvcGxhaW47Y2hhcnNldD11dGYtOCIgfSwKICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBhY3Rpb246ICJhc3NpZ25UcmFpbmluZyIsIHVzZXJuYW1lOiBjdXJyZW50VXNlciwgdG9rZW46IGdldFRva2VuKCksIC4uLmZvcm1WYWx1ZXMgfSkKICAgICAgICB9KS50aGVuKHI9PnIuanNvbigpKS50aGVuKGQ9PnsKICAgICAgICAgICAgU3dhbC5maXJlKCdCYcWfYXLEsWzEsScsICdFxJ9pdGltIGF0YW5kxLEuJywgJ3N1Y2Nlc3MnKTsKICAgICAgICAgICAgbG9hZFRyYWluaW5nRGF0YSgpOwogICAgICAgIH0pOwogICAgfQp9Ci8vIC0tLSBGRUVEQkFDSyBNT0TDnEzDnCAtLS0KCi8vIFlFTsSwIEZPTktTxLBZT046IEZlZWRiYWNrX0xvZ3MndSDDp2VrbWVrIGnDp2luCmFzeW5jIGZ1bmN0aW9uIGZldGNoRmVlZGJhY2tMb2dzKCkgewogICAgdHJ5IHsKICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaChTQ1JJUFRfVVJMLCB7CiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLAogICAgICAgICAgICBoZWFkZXJzOiB7ICJDb250ZW50LVR5cGUiOiAidGV4dC9wbGFpbjtjaGFyc2V0PXV0Zi04IiB9LAogICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGFjdGlvbjogImZldGNoRmVlZGJhY2tMb2dzIiwgdXNlcm5hbWU6IGN1cnJlbnRVc2VyLCB0b2tlbjogZ2V0VG9rZW4oKSB9KQogICAgICAgIH0pOwogICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXMuanNvbigpOwogICAgICAgIGlmIChkYXRhLnJlc3VsdCA9PT0gInN1Y2Nlc3MiKSB7CiAgICAgICAgICAgIGZlZWRiYWNrTG9nc0RhdGEgPSBkYXRhLmZlZWRiYWNrTG9ncyB8fCBbXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmZWVkYmFja0xvZ3NEYXRhID0gW107CiAgICAgICAgfQogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJGZWVkYmFjayBMb2dzIMOnZWtpbGlya2VuIGhhdGEgb2x1xZ90dToiLCBlcnJvcik7CiAgICAgICAgZmVlZGJhY2tMb2dzRGF0YSA9IFtdOwogICAgfQp9CgovLyBZQVJESU1DSSBGT05LU8SwWU9OOiBEw7ZuZW0gYmlsZ2lzaW5pIE1NLllZWVkgZm9ybWF0xLFuZGEgZMO2bmTDvHLDvHIKZnVuY3Rpb24gZm9ybWF0UGVyaW9kKHBlcmlvZFN0cmluZykgewogICAgaWYgKCFwZXJpb2RTdHJpbmcgfHwgcGVyaW9kU3RyaW5nID09PSAnTi9BJykgcmV0dXJuICdOL0EnOwogICAgCiAgICAvLyBaYXRlbiBNTS5ZWVlZIGZvcm1hdMSxbmRheXNhIGRpcmVrdCBkw7ZuZMO8cgogICAgaWYgKHBlcmlvZFN0cmluZy5tYXRjaCgvXlxkezJ9XC5cZHs0fSQvKSkgewogICAgICAgIHJldHVybiBwZXJpb2RTdHJpbmc7CiAgICB9CiAgICAKICAgIC8vIEXEn2VyIHV6dW4gYmlyIERhdGUgc3RyaW5nJ2kgaXNlICjDtnI6IFdlZCBPY3QgMDEgMjAyNS4uLikgdGFyaWggbmVzbmVzaW5lIMOnZXZpcgogICAgdHJ5IHsKICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUocGVyaW9kU3RyaW5nKTsKICAgICAgICBpZiAoIWlzTmFOKGRhdGUuZ2V0VGltZSgpKSkgewogICAgICAgICAgICBjb25zdCBtb250aCA9IFN0cmluZyhkYXRlLmdldE1vbnRoKCkgKyAxKS5wYWRTdGFydCgyLCAnMCcpOwogICAgICAgICAgICBjb25zdCB5ZWFyID0gZGF0ZS5nZXRGdWxsWWVhcigpOwogICAgICAgICAgICByZXR1cm4gYCR7bW9udGh9LiR7eWVhcn1gOwogICAgICAgIH0KICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAvLyBIYXRhIG9sdcWfdXJzYSBvbGR1xJ91IGdpYmkgYsSxcmFrIHZleWEgTi9BIGTDtm5kw7xyCiAgICAgICAgY29uc29sZS5lcnJvcigiRMO2bmVtIGZvcm1hdGxhbWEgaGF0YXPEsToiLCBlKTsKICAgIH0KICAgIAogICAgcmV0dXJuIHBlcmlvZFN0cmluZzsgLy8gQmHFn2thIGZvcm1hdHRhIGdlbGlyc2UgeWluZSBkZSBvbGR1xJ91IGdpYmkgZMO2bmTDvHIKfQoKZnVuY3Rpb24gbG9hZEZlZWRiYWNrTGlzdCgpIHsKICAgIGNvbnN0IGxpc3RFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmZWVkYmFjay1saXN0Jyk7CiAgICBsaXN0RWwuaW5uZXJIVE1MID0gJyc7CiAgICAKICAgIC8vIEFkbWluIGJ1dG9udW51IGfDtnN0ZXIvZ2l6bGUKICAgIGNvbnN0IG1hbnVhbEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYW51YWwtZmVlZGJhY2stYWRtaW4tYnRuJyk7CiAgICBpZihtYW51YWxCdG4pIG1hbnVhbEJ0bi5zdHlsZS5kaXNwbGF5ID0gaXNBZG1pbk1vZGUgPyAnZmxleCcgOiAnbm9uZSc7CiAgICAKICAgIC8vIFlFTsSwIEbEsExUUkVMRU1FIE1BTlRJxJ5JOiBTYWRlY2UgZmVlZGJhY2tUeXBlICdNYWlsJyBvbGFubGFyIFZFWUEgY2FsbElkICdNQU5VRUwnIG9sYW5sYXIgbGlzdGVsZW5pci4KICAgIGNvbnN0IGZlZWRiYWNrSXRlbXMgPSBhbGxFdmFsdWF0aW9uc0RhdGEuZmlsdGVyKGUgPT4gewogICAgICAgIC8vIGZlZWRiYWNrVHlwZSBrb250cm9sw7wgKELDvHnDvGsva8O8w6fDvGsgaGFyZiBkdXlhcmzEsWzEscSfxLFuxLEgb3J0YWRhbiBrYWxkxLFyxLFyxLF6KQogICAgICAgIGNvbnN0IGlzTWFpbEZlZWRiYWNrID0gZS5mZWVkYmFja1R5cGUgJiYgZS5mZWVkYmFja1R5cGUudG9Mb3dlckNhc2UoKSA9PT0gJ21haWwnOwogICAgICAgIC8vIE1hbnVlbCBrb250cm9sw7wKICAgICAgICBjb25zdCBpc01hbnVhbEZlZWRiYWNrID0gZS5jYWxsSWQgJiYgU3RyaW5nKGUuY2FsbElkKS50b1VwcGVyQ2FzZSgpLnN0YXJ0c1dpdGgoJ01BTlVFTC0nKTsKICAgICAgICAKICAgICAgICByZXR1cm4gaXNNYWlsRmVlZGJhY2sgfHwgaXNNYW51YWxGZWVkYmFjazsKICAgIH0pOwogICAgaWYoZmVlZGJhY2tJdGVtcy5sZW5ndGggPT09IDApIHsKICAgICAgICBsaXN0RWwuaW5uZXJIVE1MID0gJzxkaXYgc3R5bGU9InBhZGRpbmc6MjBweDsgdGV4dC1hbGlnbjpjZW50ZXI7IGNvbG9yOiM4ODg7Ij5Hw7Zyw7xudMO8bGVuZWNlayBmaWx0cmVsZW5tacWfIGdlcmkgYmlsZGlyaW0geW9rIChTYWRlY2UgTWFpbCB2ZXlhIE1hbnVlbCkuPC9kaXY+JzsKICAgICAgICByZXR1cm47CiAgICB9CiAgICAKICAgIGZlZWRiYWNrSXRlbXMuZm9yRWFjaChlID0+IHsKICAgICAgICAvLyBHZWxpxZ90aXJtZTogw4dhxJ9yxLEgVGFyaWhpIHZlIElEIGVrbGVuZGkgKEdlbGnFn21pxZ8gS2FydCBUYXNhcsSxbcSxKQogICAgICAgIGNvbnN0IGZlZWRiYWNrQ2xhc3MgPSBlLmZlZWRiYWNrVHlwZSA9PT0gJ1PDtnpsw7wnID8gJyMyMTk2ZjMnIDogKGUuZmVlZGJhY2tUeXBlID09PSAnTWFpbCcgPyAnI2U2NTEwMCcgOiAoZS5mZWVkYmFja1R5cGUgPT09ICdCaWxnaWxlbmRpcm1lJyA/ICcjMDI4OGQxJyA6IChlLmZlZWRiYWNrVHlwZSA9PT0gJ0ZlZWRiYWNrJyA/ICcjMmU3ZDMyJyA6ICcjMTBiOTgxJykpKTsKICAgICAgICAKICAgICAgICAvLyBNQU5VRUwgQ2FsbElEJ2RlbiDDtm4gZWtpIHRlbWl6bGUKICAgICAgICBjb25zdCBjbGVhbkNhbGxJZCA9IFN0cmluZyhlLmNhbGxJZCkudG9VcHBlckNhc2UoKS5zdGFydHNXaXRoKCdNQU5VRUwtJykgPyBTdHJpbmcoZS5jYWxsSWQpLnN1YnN0cmluZyg3KSA6IGUuY2FsbElkOwogICAgICAgIAogICAgICAgIC8vIEtvbnUvQmHFn2zEsWsgYmlsZ2lzaSAnZGV0YWlscycgYWxhbsSxbmRhbiBnZWxpciAoTWFudWVsIGdlcmkgYmlsZGlyaW0gacOnaW4pCiAgICAgICAgLy8gRcSfZXIgZGV0YXkgYWxhbsSxIEpTT04gaXNlICh5YW5pIG5vcm1hbCBkZcSfZXJsZW5kaXJtZSkgdmV5YSBib8Wfc2EgdmFyc2F5xLFsYW4gbWV0aW4ga3VsbGFuCiAgICAgICAgY29uc3QgaXNFdmFsdWF0aW9uRGV0YWlsID0gU3RyaW5nKGUuZGV0YWlscykuc3RhcnRzV2l0aCgnWycpOwogICAgICAgIGNvbnN0IGZlZWRiYWNrVG9waWMgPSBpc0V2YWx1YXRpb25EZXRhaWwgPyAnRGXEn2VybGVuZGlybWUgS29udXN1JyA6IChlLmRldGFpbHMgfHwgJ0JlbGlydGlsbWVtacWfJyk7CiAgICAgICAgCiAgICAgICAgLy8gRMO2bmVtLCBLYW5hbCB2ZSBUaXBpIGJlbGlybGUgKE1hbnVlbCBrYXnEsXRsYXJkYSBidSBiaWxnaWxlcmkgRXZhbHVhdGlvbnMndGFuIGRlxJ9pbCwgRmVlZGJhY2tfTG9ncyd0YW4gw6dla2l5b3J1eikKICAgICAgICBjb25zdCBpc01hbnVhbCA9IFN0cmluZyhlLmNhbGxJZCkudG9VcHBlckNhc2UoKS5zdGFydHNXaXRoKCdNQU5VRUwtJyk7CiAgICAgICAgCiAgICAgICAgbGV0IHBlcmlvZCA9IGUucGVyaW9kIHx8IGUuZGF0ZS5zdWJzdHJpbmcoMyk7CiAgICAgICAgbGV0IGNoYW5uZWwgPSAoZS5jaGFubmVsICYmIFN0cmluZyhlLmNoYW5uZWwpLnRyaW0oKSkgPyBTdHJpbmcoZS5jaGFubmVsKS50cmltKCkgOiAnWW9rJzsKICAgICAgICBjb25zdCBpbmZvVHlwZSA9IGUuZmVlZGJhY2tUeXBlIHx8ICdZb2snOwoKICAgICAgICAvLyBEw5xaRUxUTUUgTUFOVEnEnkk6IEXEn2VyIGthecSxdCBNYW51ZWwgaXNlLCBkZXRheWzEsSBiaWxnaXlpIGZlZWRiYWNrTG9nc0RhdGEnZGFuIMOnZWsuCiAgICAgICAgaWYgKGlzTWFudWFsKSB7CiAgICAgICAgICAgIC8vIENhbGxJZCdkZWtpIE1BTlVFTC0gw7ZuIGVraW5pIGF0YXJhayBGZWVkYmFja19Mb2dzJ3Rha2kgQ2FsbF9JRCBpbGUgZcWfbGXFn3Rpcm1lCiAgICAgICAgICAgIGNvbnN0IGxvZ1JvdyA9IGZlZWRiYWNrTG9nc0RhdGEuZmluZCh4ID0+IFN0cmluZyh4LmNhbGxJZCkgPT09IFN0cmluZyhjbGVhbkNhbGxJZCkpOwogICAgICAgICAgICBpZiAobG9nUm93KSB7CiAgICAgICAgICAgICAgICAvLyBBcHBzIFNjcmlwdCd0ZW4gZ2VsZW4gcGVyaW9kIGRlxJ9lcmluaSBmb3JtYXRsYSAoVGFyaWggTmVzbmVzaS9TdHJpbmcgb2xtYSBpaHRpbWFsaW5lIGthcsWfxLEpCiAgICAgICAgICAgICAgICBwZXJpb2QgPSBmb3JtYXRQZXJpb2QobG9nUm93LnBlcmlvZCkgfHwgcGVyaW9kOwogICAgICAgICAgICAgICAgY2hhbm5lbCA9IGxvZ1Jvdy5jaGFubmVsICYmIGxvZ1Jvdy5jaGFubmVsICE9PSAnTi9BJyA/IGxvZ1Jvdy5jaGFubmVsIDogJ1lvayc7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgbGlzdEVsLmlubmVySFRNTCArPSBgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZlZWRiYWNrLWNhcmQiIHN0eWxlPSJib3JkZXItbGVmdC1jb2xvcjogJHtmZWVkYmFja0NsYXNzfTsiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmVlZGJhY2staGVhZGVyIj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJmb250LXdlaWdodDpib2xkOyBjb2xvcjojMGUxYjQyOyBmb250LXNpemU6MS4xcmVtOyI+JHtlLmFnZW50fTwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZlZWRiYWNrLWluZm8tcmlnaHQiPgogICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj48aSBjbGFzcz0iZmFzIGZhLXVzZXItY2hlY2siPjwvaT4gRGXEn2VybGV5ZW46ICR7ZS5ldmFsdWF0b3J9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj48aSBjbGFzcz0iZmFzIGZhLWlkLWJhZGdlIj48L2k+IMOHYcSfcsSxIElEOiAke2NsZWFuQ2FsbElkfTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4+PGkgY2xhc3M9ImZhcyBmYS1jYWxlbmRhci1hbHQiPjwvaT4gVGFyaWg6ICR7ZS5jYWxsRGF0ZX08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZlZWRiYWNrLWJvZHkiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtd2VpZ2h0OmJvbGQ7IGNvbG9yOiMzMzM7IG1hcmdpbi1ib3R0b206NXB4OyI+S29udS9Bw6fEsWtsYW1hOiAke2ZlZWRiYWNrVG9waWN9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iY29sb3I6IzU1NTsgbGluZS1oZWlnaHQ6MS41OyBmb250LXNpemU6MC45NXJlbTsiPiR7ZS5mZWVkYmFja308L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmVlZGJhY2stZm9vdGVyIj4KICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4OyBnYXA6MTBweDsgZm9udC1zaXplOjAuN3JlbTsgY29sb3I6IzY2NjsgZm9udC13ZWlnaHQ6NjAwOyBtYXJnaW4tcmlnaHQ6MTBweDsiPgogICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj48aSBjbGFzcz0iZmFzIGZhLWNhbGVuZGFyLXdlZWsiPjwvaT4gRMO2bmVtOiAke3BlcmlvZH08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuPjxpIGNsYXNzPSJmYXMgZmEtY29tbWVudC1hbHQiPjwvaT4gS2FuYWw6ICR7Y2hhbm5lbH08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuPjxpIGNsYXNzPSJmYXMgZmEtdGFnIj48L2k+IFRpcDogJHtpbmZvVHlwZX08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgPC9kaXY+YDsKICAgIH0pOwp9Ci8vIEFkbWlubGVyIGnDp2luIG1hbnVlbCBnZXJpIGJpbGRpcmltIGVrbGVtZSAow4dhxJ9yxLEgZMSxxZ/EsSBrb251bGFyIGnDp2luKQphc3luYyBmdW5jdGlvbiBhZGRNYW51YWxGZWVkYmFja1BvcHVwKCkgewogICAgaWYgKCFpc0FkbWluTW9kZSkgcmV0dXJuOwogICAgCiAgICAvLyBBZG1pbiB1c2VyIGxpc3Rlc2kgeW9rc2EgecO8a2xlCiAgICBpZiAoYWRtaW5Vc2VyTGlzdC5sZW5ndGggPT09IDApIHsKICAgICAgICBTd2FsLmZpcmUoeyB0aXRsZTogJ0t1bGxhbsSxY8SxIExpc3Rlc2kgWcO8a2xlbml5b3IuLi4nLCBkaWRPcGVuOiAoKSA9PiBTd2FsLnNob3dMb2FkaW5nKCkgfSk7CiAgICAgICAgYXdhaXQgZmV0Y2hVc2VyTGlzdEZvckFkbWluKCk7CiAgICAgICAgU3dhbC5jbG9zZSgpOwogICAgfQogICAgLy8gRMO2bmVtIGZpbHRyZSBzZcOnZW5la2xlcmluaSBvbHXFn3R1cgogICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTsKICAgIGNvbnN0IGN1cnJlbnRNb250aCA9IG5vdy5nZXRNb250aCgpOwogICAgY29uc3QgY3VycmVudFllYXIgPSBub3cuZ2V0RnVsbFllYXIoKTsKICAgIGxldCBtb250aE9wdGlvbnMgPSAnJzsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNjsgaSsrKSB7CiAgICAgICAgbGV0IG1vbnRoID0gKGN1cnJlbnRNb250aCAtIGkgKyAxMikgJSAxMjsKICAgICAgICBsZXQgeWVhciA9IGN1cnJlbnRZZWFyIC0gKGN1cnJlbnRNb250aCAtIGkgPCAwID8gMSA6IDApOwogICAgICAgIGNvbnN0IHRleHQgPSBgJHtNT05USF9OQU1FU1ttb250aF19ICR7eWVhcn1gOwogICAgICAgIGNvbnN0IHZhbHVlID0gYCR7U3RyaW5nKG1vbnRoICsgMSkucGFkU3RhcnQoMiwgJzAnKX0uJHt5ZWFyfWA7IC8vIEJhY2tlbmQnaW4gYmVrbGVkacSfaSBNTS5ZWVlZIGZvcm1hdMSxCiAgICAgICAgY29uc3QgaXNDdXJyZW50ID0gKGkgPT09IDApOwogICAgICAgIG1vbnRoT3B0aW9ucyArPSBgPG9wdGlvbiB2YWx1ZT0iJHt2YWx1ZX0iICR7aXNDdXJyZW50ID8gJ3NlbGVjdGVkJyA6ICcnfT4ke3RleHR9PC9vcHRpb24+YDsKICAgIH0KICAgIAogICAgLy8gWUVOxLAgSFRNTCBUQVNBUklNSTogRGFoYSBkw7x6ZW5saSB2ZSBldGlrZXRsaSBmb3JtCiAgICBjb25zdCBuZXdIdG1sQ29udGVudCA9IGAKICAgICAgICA8ZGl2IGNsYXNzPSJtYW51YWwtZmVlZGJhY2stZm9ybSI+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPgogICAgICAgICAgICAgICAgPGxhYmVsIGZvcj0ibWFudWFsLXEtYWdlbnQiPlRlbXNpbGNpIEFkxLEgPHNwYW4gY2xhc3M9InJlcXVpcmVkIj4qPC9zcGFuPjwvbGFiZWw+CiAgICAgICAgICAgICAgICA8c2VsZWN0IGlkPSJtYW51YWwtcS1hZ2VudCIgY2xhc3M9InN3YWwyLWlucHV0Ij48L3NlbGVjdD4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPgogICAgICAgICAgICAgICAgPGxhYmVsIGZvcj0ibWFudWFsLXEtdG9waWMiPktvbnUgLyBCYcWfbMSxayA8c3BhbiBjbGFzcz0icmVxdWlyZWQiPio8L3NwYW4+PC9sYWJlbD4KICAgICAgICAgICAgICAgIDxpbnB1dCBpZD0ibWFudWFsLXEtdG9waWMiIGNsYXNzPSJzd2FsMi1pbnB1dCIgcGxhY2Vob2xkZXI9IkdlcmkgYmlsZGlyaW0ga29udXN1ICjDlnJuOiBZZW5pIEthbXBhbnlhIEJpbGdpbGVuZGlybWVzaSkiPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImdyaWQtMi1jb2xzIj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPgogICAgICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9Im1hbnVhbC1xLWNhbGxpZCI+w4dhxJ9yxLEvRXRraWxlxZ9pbSBJRCA8c3BhbiBjbGFzcz0icmVxdWlyZWQiPio8L3NwYW4+PC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICA8aW5wdXQgaWQ9Im1hbnVhbC1xLWNhbGxpZCIgY2xhc3M9InN3YWwyLWlucHV0IiBwbGFjZWhvbGRlcj0iSUQgKMOWcm46IDEyMzQ1NikiPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIj4KICAgICAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJtYW51YWwtcS1kYXRlIj5UYXJpaCA8c3BhbiBjbGFzcz0icmVxdWlyZWQiPio8L3NwYW4+PC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iZGF0ZSIgaWQ9Im1hbnVhbC1xLWRhdGUiIGNsYXNzPSJzd2FsMi1pbnB1dCIgdmFsdWU9IiR7bmV3IERhdGUoKS50b0lTT1N0cmluZygpLnN1YnN0cmluZygwLCAxMCl9Ij4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iZ3JpZC0zLWNvbHMiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCI+CiAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGZvcj0ibWFudWFsLXEtY2hhbm5lbCI+S2FuYWw8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgIDxzZWxlY3QgaWQ9Im1hbnVhbC1xLWNoYW5uZWwiIGNsYXNzPSJzd2FsMi1pbnB1dCI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IlRlbGVmb24iPlRlbGVmb248L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iQ2FubMSxIERlc3RlayI+Q2FubMSxIERlc3Rlazwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJFLXBvc3RhIj5FLXBvc3RhPC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IlNvc3lhbCBNZWR5YSI+U29zeWFsIE1lZHlhPC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IllvayI+WW9rL0RpxJ9lcjwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgIDwvc2VsZWN0PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIj4KICAgICAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJtYW51YWwtcS1wZXJpb2QiPkTDtm5lbTwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgPHNlbGVjdCBpZD0ibWFudWFsLXEtcGVyaW9kIiBjbGFzcz0ic3dhbDItaW5wdXQiPiR7bW9udGhPcHRpb25zfTwvc2VsZWN0PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIj4KICAgICAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJtYW51YWwtcS10eXBlIj5UaXA8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgIDxzZWxlY3QgaWQ9Im1hbnVhbC1xLXR5cGUiIGNsYXNzPSJzd2FsMi1pbnB1dCI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IkZlZWRiYWNrIj5GZWVkYmFjazwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJCaWxnaWxlbmRpcm1lIj5CaWxnaWxlbmRpcm1lPC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IlPDtnpsw7wiPlPDtnpsw7w8L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iTWFpbCI+TWFpbDwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSLDlnplbCI+w5Z6ZWwgS29udTwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgIDwvc2VsZWN0PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAKICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCI+CiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJtYW51YWwtcS1mZWVkYmFjayI+R2VyaSBCaWxkaXJpbSBEZXRheWxhcsSxIDxzcGFuIGNsYXNzPSJyZXF1aXJlZCI+Kjwvc3Bhbj48L2xhYmVsPgogICAgICAgICAgICAgICAgPHRleHRhcmVhIGlkPSJtYW51YWwtcS1mZWVkYmFjayIgY2xhc3M9InN3YWwyLXRleHRhcmVhIiBwbGFjZWhvbGRlcj0iQnVyYXlhIGdlcmkgYmlsZGlyaW1pbiBkZXRheWzEsSBtZXRuaW5pIGdpcmluaXouLi4iPjwvdGV4dGFyZWE+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICAgIDxzdHlsZT4KICAgICAgICAgICAgLyogTWFudWVsIEdlcmkgQmlsZGlyaW0gRm9ybXUgU3RpbCDEsHlpbGXFn3Rpcm1lbGVyaSAqLwogICAgICAgICAgICAubWFudWFsLWZlZWRiYWNrLWZvcm0gewogICAgICAgICAgICAgICAgdGV4dC1hbGlnbjogbGVmdDsKICAgICAgICAgICAgICAgIHBhZGRpbmc6IDEwcHg7CiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZmNmY2ZjOwogICAgICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogOHB4OwogICAgICAgICAgICAgICAgYm9yZGVyOiAxcHggc29saWQgI2VlZTsKICAgICAgICAgICAgfQogICAgICAgICAgICAuZm9ybS1ncm91cCB7CiAgICAgICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAxMnB4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIC5mb3JtLWdyb3VwIGxhYmVsIHsKICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogMC44NXJlbTsKICAgICAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7CiAgICAgICAgICAgICAgICBjb2xvcjogdmFyKC0tcHJpbWFyeSk7CiAgICAgICAgICAgICAgICBkaXNwbGF5OiBibG9jazsKICAgICAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDRweDsKICAgICAgICAgICAgfQogICAgICAgICAgICAuZ3JpZC0yLWNvbHMgewogICAgICAgICAgICAgICAgZGlzcGxheTogZ3JpZDsKICAgICAgICAgICAgICAgIGdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIDFmcjsKICAgICAgICAgICAgICAgIGdhcDogMTVweDsKICAgICAgICAgICAgfQogICAgICAgICAgICAuZ3JpZC0zLWNvbHMgewogICAgICAgICAgICAgICAgZGlzcGxheTogZ3JpZDsKICAgICAgICAgICAgICAgIGdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIDFmciAxZnI7CiAgICAgICAgICAgICAgICBnYXA6IDE1cHg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLnJlcXVpcmVkIHsKICAgICAgICAgICAgICAgIGNvbG9yOiB2YXIoLS1hY2NlbnQpOwogICAgICAgICAgICAgICAgZm9udC1zaXplOiAwLjlyZW07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLyogSW5wdXQvU2VsZWN0L1RleHRhcmVhIHN0aWxsZXJpbmkgZ2VuZWwgc3dhbDItaW5wdXQgc3RpbGluZGVuIGRldnJhbGTEsWsgKi8KICAgICAgICAgICAgLm1hbnVhbC1mZWVkYmFjay1mb3JtIC5zd2FsMi1pbnB1dCwgLm1hbnVhbC1mZWVkYmFjay1mb3JtIC5zd2FsMi10ZXh0YXJlYSB7CiAgICAgICAgICAgICAgICB3aWR0aDogMTAwJSAhaW1wb3J0YW50OwogICAgICAgICAgICAgICAgYm94LXNpemluZzogYm9yZGVyLWJveCAhaW1wb3J0YW50OwogICAgICAgICAgICAgICAgbWFyZ2luOiAwICFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICBwYWRkaW5nOiAxMHB4IDEycHggIWltcG9ydGFudDsKICAgICAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNkY2RjZGMgIWltcG9ydGFudDsKICAgICAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDZweCAhaW1wb3J0YW50OwogICAgICAgICAgICAgICAgZm9udC1zaXplOiAwLjk1cmVtICFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICB0cmFuc2l0aW9uOiBib3JkZXItY29sb3IgMC4ycywgYm94LXNoYWRvdyAwLjJzOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC5tYW51YWwtZmVlZGJhY2stZm9ybSAuc3dhbDItaW5wdXQ6Zm9jdXMsIC5tYW51YWwtZmVlZGJhY2stZm9ybSAuc3dhbDItdGV4dGFyZWE6Zm9jdXMgewogICAgICAgICAgICAgICAgYm9yZGVyLWNvbG9yOiB2YXIoLS1zZWNvbmRhcnkpICFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICBib3gtc2hhZG93OiAwIDAgMCAycHggcmdiYSgyNTAsIDE4NywgMCwgMC4yKSAhaW1wb3J0YW50OwogICAgICAgICAgICB9CiAgICAgICAgICAgIC5tYW51YWwtZmVlZGJhY2stZm9ybSAuc3dhbDItdGV4dGFyZWEgewogICAgICAgICAgICAgICAgbWluLWhlaWdodDogMTAwcHg7CiAgICAgICAgICAgICAgICByZXNpemU6IHZlcnRpY2FsOwogICAgICAgICAgICB9CiAgICAgICAgPC9zdHlsZT4KICAgIGA7CiAgICAKICAgIC8vIE1vZGFsxLEgZ8O2csO8bnTDvGRla2kgZ2liaSBkw7x6ZW5sZWRpayAoQWdlbnQgU2VsZWN0IHZlIHNhZGUgYWxhbmxhcikKICAgIGNvbnN0IHsgdmFsdWU6IGZvcm1WYWx1ZXMgfSA9IGF3YWl0IFN3YWwuZmlyZSh7CiAgICAgICAgdGl0bGU6ICdNYW51ZWwgR2VyaSBCaWxkaXJpbSBZYXonLAogICAgICAgIGh0bWw6IG5ld0h0bWxDb250ZW50LAogICAgICAgIHdpZHRoOiAnNjAwcHgnLCAvLyBNb2RhbCBnZW5pxZ9sacSfaW5pIGFydMSxcmTEsWsKICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAnPGkgY2xhc3M9ImZhcyBmYS1zYXZlIj48L2k+IEtheWRldCcsCiAgICAgICAgZGlkT3BlbjogKCkgPT4gewogICAgICAgICAgICBjb25zdCBzZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFudWFsLXEtYWdlbnQnKTsKICAgICAgICAgICAgYWRtaW5Vc2VyTGlzdC5mb3JFYWNoKHUgPT4gc2VsLmlubmVySFRNTCArPSBgPG9wdGlvbiB2YWx1ZT0iJHt1Lm5hbWV9Ij4ke3UubmFtZX08L29wdGlvbj5gKTsKICAgICAgICB9LAogICAgICAgIHByZUNvbmZpcm06ICgpID0+IHsKICAgICAgICAgICAgY29uc3QgYWdlbnROYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hbnVhbC1xLWFnZW50JykudmFsdWU7CiAgICAgICAgICAgIGNvbnN0IHRvcGljID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hbnVhbC1xLXRvcGljJykudmFsdWU7CiAgICAgICAgICAgIGNvbnN0IGZlZWRiYWNrID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hbnVhbC1xLWZlZWRiYWNrJykudmFsdWU7CiAgICAgICAgICAgIGNvbnN0IGZlZWRiYWNrVHlwZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYW51YWwtcS10eXBlJykudmFsdWU7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBZRU7EsCBBTEFOTEFSCiAgICAgICAgICAgIGNvbnN0IGNoYW5uZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFudWFsLXEtY2hhbm5lbCcpLnZhbHVlOwogICAgICAgICAgICBjb25zdCBwZXJpb2QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFudWFsLXEtcGVyaW9kJykudmFsdWU7IC8vIE1NLllZWVkgZm9ybWF0xLFuZGEKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFlFTsSwIFpPUlVOTFUgS09OVFJPTExFUgogICAgICAgICAgICBjb25zdCBjYWxsSWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFudWFsLXEtY2FsbGlkJykudmFsdWUudHJpbSgpOwogICAgICAgICAgICBjb25zdCByYXdDYWxsRGF0ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYW51YWwtcS1kYXRlJykudmFsdWU7CiAgICAgICAgICAgIGNvbnN0IGNhbGxEYXRlID0gZm9ybWF0RGF0ZVRvRERNTVlZWVkocmF3Q2FsbERhdGUpOwogICAgICAgICAgICBpZiAoIWFnZW50TmFtZSB8fCAhZmVlZGJhY2sgfHwgIWNhbGxJZCB8fCAhcmF3Q2FsbERhdGUgfHwgIXRvcGljKSB7IC8vIEtvbnUvQmHFn2zEsWsgZGEgem9ydW5sdSB5YXDEsWxkxLEKICAgICAgICAgICAgICAgICBTd2FsLnNob3dWYWxpZGF0aW9uTWVzc2FnZSgnVMO8bSAoKikgacWfYXJldGxpIGFsYW5sYXIgem9ydW5sdWR1ciEnKTsgCiAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBLb251IHNhZGVjZSBiYcWfbMSxayBvbGFyYWsgZ8O2bmRlcmlsaXlvci4gRMO2bmVtIHZlIEthbmFsIGF5csSxIGFsYW5sYXIgb2xhcmFrIGfDtm5kZXJpbGVjZWsuCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBhZ2VudE5hbWUsCiAgICAgICAgICAgICAgICAvLyBCYWNrZW5kJ2RlIGF5csSxIGxvZ2xhbWEgacOnaW4gQ2FsbElEJ3lpIE1BTlVFTCBpbGUgYmHFn2xhdMSxeW9ydXouCiAgICAgICAgICAgICAgICBjYWxsSWQ6ICJNQU5VRUwtIiArIGNhbGxJZCwgCiAgICAgICAgICAgICAgICBjYWxsRGF0ZTogY2FsbERhdGUsCiAgICAgICAgICAgICAgICBzY29yZTogMTAwLCAvLyBNYW51ZWwgb2xkdcSfdSBpw6dpbiB0YW0gcHVhbgogICAgICAgICAgICAgICAgZGV0YWlsczogdG9waWMsIC8vIFNhZGVjZSBrb251eXUgZ8O2bmRlcml5b3J1egogICAgICAgICAgICAgICAgZmVlZGJhY2ssCiAgICAgICAgICAgICAgICBmZWVkYmFja1R5cGUsCiAgICAgICAgICAgICAgICBhZ2VudEdyb3VwOiAiR2VuZWwiLCAvLyBNYW51ZWwgb2xkdcSfdSBpw6dpbiBHZW5lbCBHcnVwIG9sYXJhayBrYXlkZWRpbGlyLgogICAgICAgICAgICAgICAgLy8gw4fDllrDnE06IFllbmkgYWxhbmxhcsSxIGVrbGl5b3J1egogICAgICAgICAgICAgICAgY2hhbm5lbDogY2hhbm5lbCwKICAgICAgICAgICAgICAgIHBlcmlvZDogcGVyaW9kCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgfSk7CiAgICBpZiAoZm9ybVZhbHVlcykgewogICAgICAgIC8vIE3DnEtFUlJFUiBLT05UUk9MOiBBeW7EsSB0ZW1zaWxjaSArIGF5bsSxIENhbGwgSUQgZGFoYSDDtm5jZSBrYXlkZWRpbGRpeXNlIHV5YXIKICAgICAgICB0cnkgewogICAgICAgICAgICBjb25zdCBub3JtQWdlbnQgPSBTdHJpbmcoZm9ybVZhbHVlcy5hZ2VudE5hbWUgfHwgJycpLnRyaW0oKS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICBjb25zdCBub3JtQ2FsbElkID0gU3RyaW5nKGZvcm1WYWx1ZXMuY2FsbElkIHx8ICcnKS50cmltKCk7CiAgICAgICAgICAgIGNvbnN0IGlzRHVwID0gQXJyYXkuaXNBcnJheShhbGxFdmFsdWF0aW9uc0RhdGEpICYmIGFsbEV2YWx1YXRpb25zRGF0YS5zb21lKGUgPT4KICAgICAgICAgICAgICAgIFN0cmluZyhlLmFnZW50IHx8IGUuYWdlbnROYW1lIHx8ICcnKS50cmltKCkudG9Mb3dlckNhc2UoKSA9PT0gbm9ybUFnZW50ICYmCiAgICAgICAgICAgICAgICBTdHJpbmcoZS5jYWxsSWQgfHwgJycpLnRyaW0oKSA9PT0gbm9ybUNhbGxJZAogICAgICAgICAgICApOwoKICAgICAgICAgICAgaWYgKGlzRHVwKSB7CiAgICAgICAgICAgICAgICBjb25zdCBkZWNpc2lvbiA9IGF3YWl0IFN3YWwuZmlyZSh7CiAgICAgICAgICAgICAgICAgICAgaWNvbjogJ3dhcm5pbmcnLAogICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnTcO8a2VycmVyIERpbmxlbWUnLAogICAgICAgICAgICAgICAgICAgIGh0bWw6IGA8ZGl2IHN0eWxlPSJ0ZXh0LWFsaWduOmxlZnQ7IGxpbmUtaGVpZ2h0OjEuNDsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGI+JHtmb3JtVmFsdWVzLmFnZW50TmFtZX08L2I+IGnDp2luIDxiPkNhbGwgSUQ6ICR7ZXNjYXBlSHRtbChmb3JtVmFsdWVzLmNhbGxJZCl9PC9iPiBkYWhhIMO2bmNlIGtheWRlZGlsbWnFnyBnw7Zyw7xuw7x5b3IuPGJyPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gc3R5bGU9ImNvbG9yOiM2NjY7IGZvbnQtc2l6ZTowLjlyZW07Ij5ZaW5lIGRlIHllbmkga2F5xLF0IG9sdcWfdHVybWFrIGlzdGl5b3IgbXVzdW4/PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5gLAogICAgICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICdFdmV0LCBrYXlkZXQnLAogICAgICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6ICdWYXpnZcOnJywKICAgICAgICAgICAgICAgICAgICByZXZlcnNlQnV0dG9uczogdHJ1ZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBpZiAoIWRlY2lzaW9uLmlzQ29uZmlybWVkKSByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIGNvbnNvbGUud2FybignRHVwbGljYXRlIGNoZWNrIGZhaWxlZCcsIGUpOwogICAgICAgIH0KCiAgICAgICAgU3dhbC5maXJlKHsgdGl0bGU6ICdLYXlkZWRpbGl5b3IuLi4nLCBkaWRPcGVuOiAoKSA9PiBTd2FsLnNob3dMb2FkaW5nKCkgfSk7CiAgICAgICAgZmV0Y2goU0NSSVBUX1VSTCwgeyAKICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsIAogICAgICAgICAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAndGV4dC9wbGFpbjtjaGFyc2V0PXV0Zi04JyB9LAogICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGFjdGlvbjogImxvZ0V2YWx1YXRpb24iLCB1c2VybmFtZTogY3VycmVudFVzZXIsIHRva2VuOiBnZXRUb2tlbigpLCAuLi5mb3JtVmFsdWVzIH0pIAogICAgICAgIH0pCiAgICAgICAgLnRoZW4ociA9PiByLmpzb24oKSkudGhlbihhc3luYyBkID0+IHsKICAgICAgICAgICAgaWYgKGQucmVzdWx0ID09PSAic3VjY2VzcyIpIHsgCiAgICAgICAgICAgICAgICBTd2FsLmZpcmUoeyBpY29uOiAnc3VjY2VzcycsIHRpdGxlOiAnS2F5ZGVkaWxkaScsIHRpbWVyOiAxNTAwLCBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UgfSk7CiAgICAgICAgICAgICAgICAvLyBEw5xaRUxUTUU6IEhlbSBldmFsdWF0aW9ucyBoZW0gZGUgZmVlZGJhY2sgbG9ncyBnw7xuY2VsbGVubWVsaQogICAgICAgICAgICAgICAgZmV0Y2hFdmFsdWF0aW9uc0ZvckFnZW50KGZvcm1WYWx1ZXMuYWdlbnROYW1lKTsKICAgICAgICAgICAgICAgIGZldGNoRmVlZGJhY2tMb2dzKCkudGhlbigoKSA9PiB7IGxvYWRGZWVkYmFja0xpc3QoKTsgfSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZC5yZXN1bHQgPT09ICJkdXBsaWNhdGUiKSB7CiAgICAgICAgICAgICAgICBjb25zdCBkZWNpc2lvbiA9IGF3YWl0IFN3YWwuZmlyZSh7CiAgICAgICAgICAgICAgICAgICAgaWNvbjogJ3dhcm5pbmcnLAogICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnTcO8a2VycmVyIERpbmxlbWUnLAogICAgICAgICAgICAgICAgICAgIGh0bWw6IGA8ZGl2IHN0eWxlPSJ0ZXh0LWFsaWduOmxlZnQ7IGxpbmUtaGVpZ2h0OjEuNDsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGI+JHtmb3JtVmFsdWVzLmFnZW50TmFtZX08L2I+IGnDp2luIDxiPkNhbGwgSUQ6ICR7ZXNjYXBlSHRtbChmb3JtVmFsdWVzLmNhbGxJZCl9PC9iPiB6YXRlbiB2YXIuPGJyPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gc3R5bGU9ImNvbG9yOiM2NjY7IGZvbnQtc2l6ZTowLjlyZW07Ij5ZaW5lIGRlIHllbmkga2F5xLF0IG9sdcWfdHVydWxzdW4gbXU/PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5gLAogICAgICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICdFdmV0LCB6b3JsYSBrYXlkZXQnLAogICAgICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6ICdWYXpnZcOnJywKICAgICAgICAgICAgICAgICAgICByZXZlcnNlQnV0dG9uczogdHJ1ZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBpZiAoZGVjaXNpb24uaXNDb25maXJtZWQpIHsKICAgICAgICAgICAgICAgICAgICBTd2FsLmZpcmUoeyB0aXRsZTogJ0theWRlZGlsaXlvci4uLicsIGRpZE9wZW46ICgpID0+IFN3YWwuc2hvd0xvYWRpbmcoKSB9KTsKICAgICAgICAgICAgICAgICAgICBmZXRjaChTQ1JJUFRfVVJMLCB7IAogICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJywKICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ3RleHQvcGxhaW47Y2hhcnNldD11dGYtOCcgfSwKICAgICAgICAgICAgICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBhY3Rpb246ICJsb2dFdmFsdWF0aW9uIiwgdXNlcm5hbWU6IGN1cnJlbnRVc2VyLCB0b2tlbjogZ2V0VG9rZW4oKSwgZm9yY2U6IHRydWUsIC4uLmZvcm1WYWx1ZXMgfSkKICAgICAgICAgICAgICAgICAgICB9KS50aGVuKHIyID0+IHIyLmpzb24oKSkudGhlbihkMiA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkMi5yZXN1bHQgPT09ICJzdWNjZXNzIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgU3dhbC5maXJlKHsgaWNvbjogJ3N1Y2Nlc3MnLCB0aXRsZTogJ0theWRlZGlsZGknLCB0aW1lcjogMTUwMCwgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmV0Y2hFdmFsdWF0aW9uc0ZvckFnZW50KGZvcm1WYWx1ZXMuYWdlbnROYW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZldGNoRmVlZGJhY2tMb2dzKCkudGhlbigoKSA9PiB7IGxvYWRGZWVkYmFja0xpc3QoKTsgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTd2FsLmZpcmUoJ0hhdGEnLCBkMi5tZXNzYWdlLCAnZXJyb3InKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgeyAKICAgICAgICAgICAgICAgIFN3YWwuZmlyZSgnSGF0YScsIGQubWVzc2FnZSwgJ2Vycm9yJyk7IAogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9Cn0KYXN5bmMgZnVuY3Rpb24gZmV0Y2hFdmFsdWF0aW9uc0ZvckFnZW50KGZvcmNlZE5hbWUsIHNpbGVudD1mYWxzZSkgewogICAgY29uc3QgbGlzdEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V2YWx1YXRpb25zLWxpc3QnKTsKICAgIGlmKCFzaWxlbnQpIGxpc3RFbC5pbm5lckhUTUwgPSAnWcO8a2xlbml5b3IuLi4nOwogICAgY29uc3QgZ3JvdXBTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncS1hZG1pbi1ncm91cCcpOwogICAgY29uc3QgYWdlbnRTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncS1hZG1pbi1hZ2VudCcpOwogICAgCiAgICBsZXQgdGFyZ2V0QWdlbnQgPSBmb3JjZWROYW1lIHx8IGN1cnJlbnRVc2VyOwogICAgbGV0IHRhcmdldEdyb3VwID0gJ2FsbCc7CiAgICAKICAgIGlmIChpc0FkbWluTW9kZSAmJiBhZ2VudFNlbGVjdCkgewogICAgICAgIHRhcmdldEFnZW50ID0gZm9yY2VkTmFtZSB8fCBhZ2VudFNlbGVjdC52YWx1ZTsKICAgICAgICB0YXJnZXRHcm91cCA9IGdyb3VwU2VsZWN0ID8gZ3JvdXBTZWxlY3QudmFsdWUgOiAnYWxsJzsKICAgIH0KICAgIHRyeSB7CiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChTQ1JJUFRfVVJMLCB7CiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLCBoZWFkZXJzOiB7ICJDb250ZW50LVR5cGUiOiAidGV4dC9wbGFpbjtjaGFyc2V0PXV0Zi04IiB9LAogICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGFjdGlvbjogImZldGNoRXZhbHVhdGlvbnMiLCB0YXJnZXRBZ2VudDogdGFyZ2V0QWdlbnQsIHRhcmdldEdyb3VwOiB0YXJnZXRHcm91cCwgdXNlcm5hbWU6IGN1cnJlbnRVc2VyLCB0b2tlbjogZ2V0VG9rZW4oKSB9KQogICAgICAgIH0pOwogICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7CiAgICAgICAgCiAgICAgICAgaWYgKGRhdGEucmVzdWx0ID09PSAic3VjY2VzcyIpIHsKICAgICAgICAgICAgLy8gRW4geWVuaSBlbiDDvHN0dGUgb2xtYXPEsSBpw6dpbiB0ZXJzIMOnZXZpcgogICAgICAgICAgICBhbGxFdmFsdWF0aW9uc0RhdGEgPSBkYXRhLmV2YWx1YXRpb25zLnJldmVyc2UoKTsKICAgICAgICAgICAgaWYoc2lsZW50KSByZXR1cm47IC8vIFNpbGVudCBtb2RlIGlzZSBidXJhZGEgYml0aXIgKHZlcmkgecO8a2xlbmRpKQogICAgICAgICAgICBsaXN0RWwuaW5uZXJIVE1MID0gJyc7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTYWRlY2Ugbm9ybWFsIGRlxJ9lcmxlbmRpcm1lbGVyaSBmaWx0cmVsZSB2ZSBnw7ZzdGVyCiAgICAgICAgICAgIGNvbnN0IG5vcm1hbEV2YWx1YXRpb25zID0gYWxsRXZhbHVhdGlvbnNEYXRhLmZpbHRlcihlID0+ICFTdHJpbmcoZS5jYWxsSWQpLnRvVXBwZXJDYXNlKCkuc3RhcnRzV2l0aCgnTUFOVUVMLScpKTsKICAgICAgICAgICAgaWYgKG5vcm1hbEV2YWx1YXRpb25zLmxlbmd0aCA9PT0gMCkgeyBsaXN0RWwuaW5uZXJIVE1MID0gYDxwIHN0eWxlPSJ0ZXh0LWFsaWduOmNlbnRlcjsgY29sb3I6IzY2NjsiPkthecSxdCB5b2suPC9wPmA7IHJldHVybjsgfQogICAgICAgICAgICAKICAgICAgICAgICAgbm9ybWFsRXZhbHVhdGlvbnMuZm9yRWFjaCgoZXZhbEl0ZW0sIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBzY29yZUNvbG9yID0gZXZhbEl0ZW0uc2NvcmUgPj0gOTAgPyAnIzJlN2QzMicgOiAoZXZhbEl0ZW0uc2NvcmUgPj0gNzAgPyAnI2VkNmMwMicgOiAnI2QzMmYyZicpOwogICAgICAgICAgICAgICAgbGV0IGVkaXRCdG4gPSBpc0FkbWluTW9kZSA/IGA8aSBjbGFzcz0iZmFzIGZhLXBlbiIgc3R5bGU9ImZvbnQtc2l6ZToxcmVtOyBjb2xvcjojZmFiYjAwOyBjdXJzb3I6cG9pbnRlcjsgbWFyZ2luLXJpZ2h0OjVweDsiIG9uY2xpY2s9ImV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOyBlZGl0RXZhbHVhdGlvbignJHtldmFsSXRlbS5jYWxsSWR9JykiPjwvaT5gIDogJyc7CiAgICAgICAgICAgICAgICBsZXQgYWdlbnROYW1lRGlzcGxheSA9ICh0YXJnZXRBZ2VudCA9PT0gJ2FsbCcgfHwgdGFyZ2V0QWdlbnQgPT09IHRhcmdldEdyb3VwKSA/IGA8c3BhbiBzdHlsZT0iZm9udC1zaXplOjAuOHJlbTsgZm9udC13ZWlnaHQ6Ym9sZDsgY29sb3I6IzU1NTsgYmFja2dyb3VuZDojZWVlOyBwYWRkaW5nOjJweCA2cHg7IGJvcmRlci1yYWRpdXM6NHB4OyBtYXJnaW4tbGVmdDoxMHB4OyI+JHtldmFsSXRlbS5hZ2VudH08L3NwYW4+YCA6ICcnOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBEZXRheSBIVE1MIG9sdcWfdHVybWEKICAgICAgICAgICAgICAgIGxldCBkZXRhaWxIdG1sID0gJyc7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIC8vIEpTT04nxLEgacWfbGVya2VuIG9sYXPEsSBoYXRhbGFyYSBrYXLFn8SxIHRyeS1jYXRjaAogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRldGFpbE9iaiA9IEpTT04ucGFyc2UoZXZhbEl0ZW0uZGV0YWlscyk7CiAgICAgICAgICAgICAgICAgICAgZGV0YWlsSHRtbCA9ICc8dGFibGUgc3R5bGU9IndpZHRoOjEwMCU7IGZvbnQtc2l6ZTowLjg1cmVtOyBib3JkZXItY29sbGFwc2U6Y29sbGFwc2U7IG1hcmdpbi10b3A6MTBweDsiPic7CiAgICAgICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZGV0YWlsT2JqKSkgewogICAgICAgICAgICAgICAgICAgICAgICBkZXRhaWxPYmouZm9yRWFjaChpdGVtID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCByb3dDb2xvciA9IGl0ZW0uc2NvcmUgPCBpdGVtLm1heCA/ICcjZmZlYmVlJyA6ICcjZjlmOWY5JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBub3RlRGlzcGxheSA9IGl0ZW0ubm90ZSA/IGA8YnI+PGVtIHN0eWxlPSJjb2xvcjogI2QzMmYyZjsgZm9udC1zaXplOjAuOHJlbTsiPihOb3Q6ICR7aXRlbS5ub3RlfSk8L2VtPmAgOiAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldGFpbEh0bWwgKz0gYDx0ciBzdHlsZT0iYmFja2dyb3VuZDoke3Jvd0NvbG9yfTsgYm9yZGVyLWJvdHRvbToxcHggc29saWQgI2ZmZjsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBzdHlsZT0icGFkZGluZzo4cHg7IGJvcmRlci1yYWRpdXM6NHB4OyI+JHtpdGVtLnF9JHtub3RlRGlzcGxheX08L3RkPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBzdHlsZT0icGFkZGluZzo4cHg7IGZvbnQtd2VpZ2h0OmJvbGQ7IHRleHQtYWxpZ246cmlnaHQ7Ij4ke2l0ZW0uc2NvcmV9LyR7aXRlbS5tYXh9PC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdHI+YDsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gSlNPTiBvbG1hc8SxbmEgcmHEn21lbiBhcnJheSBkZcSfaWxzZSAobWFudWVsIG5vdGxhcikKICAgICAgICAgICAgICAgICAgICAgICAgZGV0YWlsSHRtbCA9IGA8cCBzdHlsZT0id2hpdGUtc3BhY2U6cHJlLXdyYXA7IG1hcmdpbjowOyBmb250LXNpemU6MC45cmVtOyBiYWNrZ3JvdW5kOiNmZmY4ZTE7IHBhZGRpbmc6MTBweDsgYm9yZGVyLXJhZGl1czo0cHg7Ij4ke2V2YWxJdGVtLmRldGFpbHN9PC9wPmA7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGRldGFpbEh0bWwgKz0gJzwvdGFibGU+JzsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsgCiAgICAgICAgICAgICAgICAgICAgLy8gSlNPTiBwYXJzZSBoYXRhc8SxIHZleWEgZXNraS9tYW51ZWwgdmVyaSBmb3JtYXTEsQogICAgICAgICAgICAgICAgICAgIGRldGFpbEh0bWwgPSBgPHAgc3R5bGU9IndoaXRlLXNwYWNlOnByZS13cmFwOyBtYXJnaW46MDsgZm9udC1zaXplOjAuOXJlbTsgYmFja2dyb3VuZDojZmZmOGUxOyBwYWRkaW5nOjEwcHg7IGJvcmRlci1yYWRpdXM6NHB4OyI+JHtldmFsSXRlbS5kZXRhaWxzfTwvcD5gOyAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gR2VsacWfdGlybWU6IMOHYcSfcsSxIFRhcmloaSB2ZSBEaW5sZW5tZSBUYXJpaGkKICAgICAgICAgICAgICAgIGNvbnN0IGNhbGxEYXRlRGlzcGxheSA9IGV2YWxJdGVtLmNhbGxEYXRlICYmIGV2YWxJdGVtLmNhbGxEYXRlICE9PSAnTi9BJyA/IGV2YWxJdGVtLmNhbGxEYXRlIDogJ04vQSc7CiAgICAgICAgICAgICAgICBjb25zdCBsaXN0ZW5EYXRlRGlzcGxheSA9IGV2YWxJdGVtLmRhdGUgfHwgJ04vQSc7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxpc3RFbC5pbm5lckhUTUwgKz0gYAogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZXZhbHVhdGlvbi1zdW1tYXJ5IiBpZD0iZXZhbC1zdW1tYXJ5LSR7aW5kZXh9IiBzdHlsZT0iYm9yZGVyLWxlZnQ6NHB4IHNvbGlkICR7c2NvcmVDb2xvcn07IHBhZGRpbmc6MTVweDsgbWFyZ2luLWJvdHRvbToxMHB4OyBib3JkZXItcmFkaXVzOjhweDsgYmFja2dyb3VuZDojZmZmOyBjdXJzb3I6cG9pbnRlcjsiIG9uY2xpY2s9InRvZ2dsZUV2YWx1YXRpb25EZXRhaWwoJHtpbmRleH0pIj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7IGp1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuOyBhbGlnbi1pdGVtczpjZW50ZXI7Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtd2VpZ2h0OjcwMDsgY29sb3I6IzJjM2U1MDsiPiR7ZXZhbEl0ZW0uYWdlbnR9ICR7YWdlbnROYW1lRGlzcGxheX08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwhLS0gR2VsacWfdGlybWU6IMOHYcSfcsSxIFRhcmloaSB2ZSBEaW5sZW5tZSBUYXJpaGkgLS0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJldmFsLWRhdGUtaW5mbyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4+PGkgY2xhc3M9ImZhcyBmYS1waG9uZSI+PC9pPiDDh2HEn3LEsTogJHtjYWxsRGF0ZURpc3BsYXl9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuPjxpIGNsYXNzPSJmYXMgZmEtaGVhZHBob25lcyI+PC9pPiBEaW5sZW5tZTogJHtsaXN0ZW5EYXRlRGlzcGxheX08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjc1cmVtOyBjb2xvcjojOTk5OyBtYXJnaW4tdG9wOjJweDsiPklEOiAke2V2YWxJdGVtLmNhbGxJZH08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9InRleHQtYWxpZ246cmlnaHQ7Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAke2VkaXRCdG59IDxzcGFuIHN0eWxlPSJmb250LXdlaWdodDo4MDA7IGZvbnQtc2l6ZToxLjZyZW07IGNvbG9yOiR7c2NvcmVDb2xvcn07Ij4ke2V2YWxJdGVtLnNjb3JlfTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZXZhbHVhdGlvbi1kZXRhaWxzLWNvbnRlbnQiIGlkPSJldmFsLWRldGFpbHMtJHtpbmRleH0iPgogICAgICAgICAgICAgICAgICAgICAgICAke2RldGFpbEh0bWx9CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9Im1hcmdpbi10b3A6MTBweDsgYmFja2dyb3VuZDojZjhmOWZhOyBwYWRkaW5nOjEwcHg7IGJvcmRlci1yYWRpdXM6NHB4OyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Ryb25nPkZlZWRiYWNrOjwvc3Ryb25nPiAke2V2YWxJdGVtLmZlZWRiYWNrIHx8ICctJ30KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj5gOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9IGNhdGNoKGVycikgeyBpZighc2lsZW50KSBsaXN0RWwuaW5uZXJIVE1MID0gYDxwIHN0eWxlPSJjb2xvcjpyZWQ7IHRleHQtYWxpZ246Y2VudGVyOyI+SGF0YSBvbHXFn3R1LjwvcD5gOyB9Cn0KZnVuY3Rpb24gdXBkYXRlQWdlbnRMaXN0QmFzZWRPbkdyb3VwKCkgewogICAgY29uc3QgZ3JvdXBTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncS1hZG1pbi1ncm91cCcpOwogICAgY29uc3QgYWdlbnRTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncS1hZG1pbi1hZ2VudCcpOwogICAgaWYoIWdyb3VwU2VsZWN0IHx8ICFhZ2VudFNlbGVjdCkgcmV0dXJuOwogICAgY29uc3Qgc2VsZWN0ZWRHcm91cCA9IGdyb3VwU2VsZWN0LnZhbHVlOwogICAgYWdlbnRTZWxlY3QuaW5uZXJIVE1MID0gJyc7CiAgICAKICAgIGxldCBmaWx0ZXJlZFVzZXJzID0gYWRtaW5Vc2VyTGlzdDsKICAgIGlmIChzZWxlY3RlZEdyb3VwICE9PSAnYWxsJykgewogICAgICAgIGZpbHRlcmVkVXNlcnMgPSBhZG1pblVzZXJMaXN0LmZpbHRlcih1ID0+IHUuZ3JvdXAgPT09IHNlbGVjdGVkR3JvdXApOwogICAgICAgIGFnZW50U2VsZWN0LmlubmVySFRNTCA9IGA8b3B0aW9uIHZhbHVlPSJhbGwiPi0tIFTDvG0gJHtzZWxlY3RlZEdyb3VwfSBFa2liaSAtLTwvb3B0aW9uPmA7CiAgICB9IGVsc2UgewogICAgICAgIGFnZW50U2VsZWN0LmlubmVySFRNTCA9IGA8b3B0aW9uIHZhbHVlPSJhbGwiPi0tIFTDvG0gVGVtc2lsY2lsZXIgLS08L29wdGlvbj5gOwogICAgfQogICAgZmlsdGVyZWRVc2Vycy5mb3JFYWNoKHUgPT4geyBhZ2VudFNlbGVjdC5pbm5lckhUTUwgKz0gYDxvcHRpb24gdmFsdWU9IiR7dS5uYW1lfSI+JHt1Lm5hbWV9PC9vcHRpb24+YDsgfSk7CiAgICBmZXRjaEV2YWx1YXRpb25zRm9yQWdlbnQoKTsKfQpmdW5jdGlvbiBmZXRjaFVzZXJMaXN0Rm9yQWRtaW4oKSB7CiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICBmZXRjaChTQ1JJUFRfVVJMLCB7CiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLCBoZWFkZXJzOiB7ICJDb250ZW50LVR5cGUiOiAidGV4dC9wbGFpbjtjaGFyc2V0PXV0Zi04IiB9LAogICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGFjdGlvbjogImdldFVzZXJMaXN0IiwgdXNlcm5hbWU6IGN1cnJlbnRVc2VyLCB0b2tlbjogZ2V0VG9rZW4oKSB9KQogICAgICAgIH0pLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuanNvbigpKS50aGVuKGRhdGEgPT4gewogICAgICAgICAgICBpZiAoZGF0YS5yZXN1bHQgPT09ICJzdWNjZXNzIikgeyBhZG1pblVzZXJMaXN0ID0gZGF0YS51c2Vycy5maWx0ZXIodSA9PiB1Lmdyb3VwICE9PSAnWcO2bmV0aW0nKTsgcmVzb2x2ZShhZG1pblVzZXJMaXN0KTsgfSAKICAgICAgICAgICAgZWxzZSByZXNvbHZlKFtdKTsKICAgICAgICB9KS5jYXRjaChlcnIgPT4gcmVzb2x2ZShbXSkpOwogICAgfSk7Cn0KZnVuY3Rpb24gZmV0Y2hDcml0ZXJpYShncm91cE5hbWUpIHsKICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgIGZldGNoKFNDUklQVF9VUkwsIHsKICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsIGhlYWRlcnM6IHsgIkNvbnRlbnQtVHlwZSI6ICJ0ZXh0L3BsYWluO2NoYXJzZXQ9dXRmLTgiIH0sCiAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgYWN0aW9uOiAiZ2V0Q3JpdGVyaWEiLCBncm91cDogZ3JvdXBOYW1lLCB1c2VybmFtZTogY3VycmVudFVzZXIsIHRva2VuOiBnZXRUb2tlbigpIH0pCiAgICAgICAgfSkudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpLnRoZW4oZGF0YSA9PiB7CiAgICAgICAgICAgIGlmIChkYXRhLnJlc3VsdCA9PT0gInN1Y2Nlc3MiKSByZXNvbHZlKGRhdGEuY3JpdGVyaWEgfHwgW10pOyBlbHNlIHJlc29sdmUoW10pOwogICAgICAgIH0pLmNhdGNoKGVyciA9PiByZXNvbHZlKFtdKSk7CiAgICB9KTsKfQpmdW5jdGlvbiB0b2dnbGVFdmFsdWF0aW9uRGV0YWlsKGluZGV4KSB7CiAgICBjb25zdCBkZXRhaWxFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBldmFsLWRldGFpbHMtJHtpbmRleH1gKTsKICAgIGlmIChkZXRhaWxFbC5zdHlsZS5tYXhIZWlnaHQgJiYgZGV0YWlsRWwuc3R5bGUubWF4SGVpZ2h0ICE9PSAnMHB4JykgeyBkZXRhaWxFbC5zdHlsZS5tYXhIZWlnaHQgPSAnMHB4JzsgZGV0YWlsRWwuc3R5bGUubWFyZ2luVG9wID0gJzAnOyB9IAogICAgZWxzZSB7IGRldGFpbEVsLnN0eWxlLm1heEhlaWdodCA9IGRldGFpbEVsLnNjcm9sbEhlaWdodCArIDUwMCArICdweCc7IGRldGFpbEVsLnN0eWxlLm1hcmdpblRvcCA9ICcxMHB4JzsgfQp9CmFzeW5jIGZ1bmN0aW9uIGV4cG9ydEV2YWx1YXRpb25zKCkgewogICAgaWYgKCFpc0FkbWluTW9kZSkgcmV0dXJuOwogICAgY29uc3QgeyBpc0NvbmZpcm1lZCB9ID0gYXdhaXQgU3dhbC5maXJlKHsgaWNvbjogJ3F1ZXN0aW9uJywgdGl0bGU6ICdSYXBvciDEsG5kaXJpbHNpbiBtaT8nLCBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLCBjb25maXJtQnV0dG9uVGV4dDogJ8SwbmRpcicgfSk7CiAgICBpZiAoIWlzQ29uZmlybWVkKSByZXR1cm47CiAgICBTd2FsLmZpcmUoeyB0aXRsZTogJ0hhesSxcmxhbsSxeW9yLi4uJywgZGlkT3BlbjogKCkgPT4gU3dhbC5zaG93TG9hZGluZygpIH0pOwogICAgCiAgICBjb25zdCBncm91cFNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxLWFkbWluLWdyb3VwJyk7CiAgICBjb25zdCBhZ2VudFNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxLWFkbWluLWFnZW50Jyk7CiAgICAKICAgIGZldGNoKFNDUklQVF9VUkwsIHsKICAgICAgICBtZXRob2Q6ICdQT1NUJywgaGVhZGVyczogeyAiQ29udGVudC1UeXBlIjogInRleHQvcGxhaW47Y2hhcnNldD11dGYtOCIgfSwKICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgICAgIGFjdGlvbjogImV4cG9ydEV2YWx1YXRpb25zIiwKICAgICAgICAgICAgdGFyZ2V0QWdlbnQ6IGFnZW50U2VsZWN0ID8gYWdlbnRTZWxlY3QudmFsdWUgOiAnYWxsJywKICAgICAgICAgICAgdGFyZ2V0R3JvdXA6IGdyb3VwU2VsZWN0ID8gZ3JvdXBTZWxlY3QudmFsdWUgOiAnYWxsJywKICAgICAgICAgICAgdXNlcm5hbWU6IGN1cnJlbnRVc2VyLCB0b2tlbjogZ2V0VG9rZW4oKQogICAgICAgIH0pCiAgICB9KS50aGVuKHIgPT4gci5qc29uKCkpLnRoZW4oZGF0YSA9PiB7CiAgICAgICAgaWYgKGRhdGEucmVzdWx0ID09PSAic3VjY2VzcyIgJiYgZGF0YS5jc3ZEYXRhKSB7CiAgICAgICAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbIlx1ZmVmZiIgKyBkYXRhLmNzdkRhdGFdLCB7IHR5cGU6ICd0ZXh0L2NzdjtjaGFyc2V0PXV0Zi04OycgfSk7CiAgICAgICAgICAgIGNvbnN0IGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7CiAgICAgICAgICAgIGNvbnN0IHVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7CiAgICAgICAgICAgIGxpbmsuc2V0QXR0cmlidXRlKCJocmVmIiwgdXJsKTsgbGluay5zZXRBdHRyaWJ1dGUoImRvd25sb2FkIiwgZGF0YS5maWxlTmFtZSk7CiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobGluayk7IGxpbmsuY2xpY2soKTsgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChsaW5rKTsKICAgICAgICAgICAgU3dhbC5maXJlKCdCYcWfYXLEsWzEsScsICdSYXBvciBpbmRpcmlsZGkuJywgJ3N1Y2Nlc3MnKTsKICAgICAgICB9IGVsc2UgeyBTd2FsLmZpcmUoJ0hhdGEnLCBkYXRhLm1lc3NhZ2UgfHwgJ1ZlcmkgYWzEsW5hbWFkxLEuJywgJ2Vycm9yJyk7IH0KICAgIH0pOwp9Ci8vIC0tLSBFVkFMVUFUSU9OIFBPUFVQICYgRURJVCAtLS0KYXN5bmMgZnVuY3Rpb24gbG9nRXZhbHVhdGlvblBvcHVwKCkgewogICAgY29uc3QgYWdlbnRTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncS1hZG1pbi1hZ2VudCcpOwogICAgY29uc3QgYWdlbnROYW1lID0gYWdlbnRTZWxlY3QgPyBhZ2VudFNlbGVjdC52YWx1ZSA6ICIiOwogICAgCiAgICBpZiAoIWFnZW50TmFtZSB8fCBhZ2VudE5hbWUgPT09ICdhbGwnKSB7IFN3YWwuZmlyZSgnVXlhcsSxJywgJ0zDvHRmZW4gbGlzdGVkZW4gYmlyIHRlbXNpbGNpIHNlw6dpbml6LicsICd3YXJuaW5nJyk7IHJldHVybjsgfQogICAgCiAgICBsZXQgYWdlbnRHcm91cCA9ICdHZW5lbCc7CiAgICBjb25zdCBmb3VuZFVzZXIgPSBhZG1pblVzZXJMaXN0LmZpbmQodSA9PiB1Lm5hbWUudG9Mb3dlckNhc2UoKSA9PT0gYWdlbnROYW1lLnRvTG93ZXJDYXNlKCkpOwogICAgaWYgKGZvdW5kVXNlciAmJiBmb3VuZFVzZXIuZ3JvdXApIHsgYWdlbnRHcm91cCA9IGZvdW5kVXNlci5ncm91cDsgfQogICAgCiAgICBjb25zdCBpc0NoYXQgPSBhZ2VudEdyb3VwLmluZGV4T2YoJ0NoYXQnKSA+IC0xOwogICAgY29uc3QgaXNUZWxlc2F0aXMgPSBhZ2VudEdyb3VwLmluZGV4T2YoJ1RlbGVzYXTEscWfJykgPiAtMTsKICAgIGlmIChpc0NoYXQpIGFnZW50R3JvdXAgPSAnQ2hhdCc7CiAgICAKICAgIFN3YWwuZmlyZSh7IHRpdGxlOiAnSGF6xLFybGFuxLF5b3IuLi4nLCBkaWRPcGVuOiAoKSA9PiBTd2FsLnNob3dMb2FkaW5nKCkgfSk7CiAgICBsZXQgY3JpdGVyaWFMaXN0ID0gW107CiAgICBpZihhZ2VudEdyb3VwICYmIGFnZW50R3JvdXAgIT09ICdHZW5lbCcpIHsgY3JpdGVyaWFMaXN0ID0gYXdhaXQgZmV0Y2hDcml0ZXJpYShhZ2VudEdyb3VwKTsgfSAKICAgIFN3YWwuY2xvc2UoKTsKICAgIAogICAgY29uc3QgaXNDcml0ZXJpYUJhc2VkID0gY3JpdGVyaWFMaXN0Lmxlbmd0aCA+IDA7CiAgICBsZXQgY3JpdGVyaWFGaWVsZHNIdG1sID0gJyc7CiAgICAKICAgIGlmIChpc0NyaXRlcmlhQmFzZWQpIHsKICAgICAgICBjcml0ZXJpYUZpZWxkc0h0bWwgKz0gYDxkaXYgY2xhc3M9ImNyaXRlcmlhLWNvbnRhaW5lciI+YDsKICAgICAgICBjcml0ZXJpYUxpc3QuZm9yRWFjaCgoYywgaSkgPT4gewogICAgICAgICAgICBsZXQgcHRzID0gcGFyc2VJbnQoYy5wb2ludHMpIHx8IDA7CiAgICAgICAgICAgIGlmIChwdHMgPT09IDApIHJldHVybjsKICAgICAgICAgICAgLy8gR2VsacWfdGlybWU6IFB1YW4gYmHFn2zEscSfxLEgw7xzdMO8bmUgZ2VsaW5jZSB0YW0gbWV0aW4gZ8O2c3RlcmlsbWVzaSBpw6dpbiB0aXRsZSBla2xlbmRpCiAgICAgICAgICAgIGNvbnN0IGZ1bGxUZXh0ID0gZXNjYXBlRm9ySnNTdHJpbmcoYy50ZXh0KTsgCiAgICAgICAgICAgIGlmIChpc0NoYXQpIHsKICAgICAgICAgICAgICAgIGxldCBtUHRzID0gcGFyc2VJbnQoYy5tZWRpdW1TY29yZSkgfHwgMDsgbGV0IGJQdHMgPSBwYXJzZUludChjLmJhZFNjb3JlKSB8fCAwOwogICAgICAgICAgICAgICAgY3JpdGVyaWFGaWVsZHNIdG1sICs9IGA8ZGl2IGNsYXNzPSJjcml0ZXJpYS1yb3ciIGlkPSJyb3ctJHtpfSIgZGF0YS1tYXgtc2NvcmU9IiR7cHRzfSI+PGRpdiBjbGFzcz0iY3JpdGVyaWEtaGVhZGVyIj48c3BhbiB0aXRsZT0iJHtmdWxsVGV4dH0iPiR7aSsxfS4gJHtjLnRleHR9PC9zcGFuPjxzcGFuIHN0eWxlPSJmb250LXNpemU6MC44cmVtOyI+TWF4OiAke3B0c308L3NwYW4+PC9kaXY+PGRpdiBjbGFzcz0iY3JpdGVyaWEtY29udHJvbHMiPjxkaXYgY2xhc3M9ImV2YWwtYnV0dG9uLWdyb3VwIj48YnV0dG9uIGNsYXNzPSJldmFsLWJ1dHRvbiBldmFsLWdvb2QgYWN0aXZlIiBkYXRhLXNjb3JlPSIke3B0c30iIG9uY2xpY2s9InNldEJ1dHRvblNjb3JlKCR7aX0sICR7cHRzfSwgJHtwdHN9KSI+xLB5aSAoJHtwdHN9KTwvYnV0dG9uPiR7bVB0cyA+IDAgPyBgPGJ1dHRvbiBjbGFzcz0iZXZhbC1idXR0b24gZXZhbC1tZWRpdW0iIGRhdGEtc2NvcmU9IiR7bVB0c30iIG9uY2xpY2s9InNldEJ1dHRvblNjb3JlKCR7aX0sICR7bVB0c30sICR7cHRzfSkiPk9ydGEgKCR7bVB0c30pPC9idXR0b24+YCA6ICcnfSR7YlB0cyA+IDAgPyBgPGJ1dHRvbiBjbGFzcz0iZXZhbC1idXR0b24gZXZhbC1iYWQiIGRhdGEtc2NvcmU9IiR7YlB0c30iIG9uY2xpY2s9InNldEJ1dHRvblNjb3JlKCR7aX0sICR7YlB0c30sICR7cHRzfSkiPkvDtnTDvCAoJHtiUHRzfSk8L2J1dHRvbj5gIDogJyd9PC9kaXY+PHNwYW4gY2xhc3M9InNjb3JlLWJhZGdlIiBpZD0iYmFkZ2UtJHtpfSIgc3R5bGU9Im1hcmdpbi10b3A6OHB4OyBkaXNwbGF5OmJsb2NrOyBiYWNrZ3JvdW5kOiMyZTdkMzI7Ij4ke3B0c308L3NwYW4+PC9kaXY+PGlucHV0IHR5cGU9InRleHQiIGlkPSJub3RlLSR7aX0iIGNsYXNzPSJub3RlLWlucHV0IiBwbGFjZWhvbGRlcj0iTm90Li4uIiBzdHlsZT0iZGlzcGxheTpub25lOyI+PC9kaXY+YDsKICAgICAgICAgICAgfSBlbHNlIGlmIChpc1RlbGVzYXRpcykgewogICAgICAgICAgICAgICAgIGNyaXRlcmlhRmllbGRzSHRtbCArPSBgPGRpdiBjbGFzcz0iY3JpdGVyaWEtcm93IiBpZD0icm93LSR7aX0iIGRhdGEtbWF4LXNjb3JlPSIke3B0c30iPjxkaXYgY2xhc3M9ImNyaXRlcmlhLWhlYWRlciI+PHNwYW4gdGl0bGU9IiR7ZnVsbFRleHR9Ij4ke2krMX0uICR7Yy50ZXh0fTwvc3Bhbj48c3Bhbj5NYXg6ICR7cHRzfTwvc3Bhbj48L2Rpdj48ZGl2IGNsYXNzPSJjcml0ZXJpYS1jb250cm9scyIgc3R5bGU9ImRpc3BsYXk6ZmxleDsgYWxpZ24taXRlbXM6Y2VudGVyOyBnYXA6MTVweDsgYmFja2dyb3VuZDojZjlmOWY5OyI+PGlucHV0IHR5cGU9InJhbmdlIiBjbGFzcz0iY3VzdG9tLXJhbmdlIHNsaWRlci1pbnB1dCIgaWQ9InNsaWRlci0ke2l9IiBtaW49IjAiIG1heD0iJHtwdHN9IiB2YWx1ZT0iJHtwdHN9IiBkYXRhLWluZGV4PSIke2l9IiBvbmlucHV0PSJ1cGRhdGVSb3dTbGlkZXJTY29yZSgke2l9LCAke3B0c30pIiBzdHlsZT0iZmxleC1ncm93OjE7Ij48c3BhbiBjbGFzcz0ic2NvcmUtYmFkZ2UiIGlkPSJiYWRnZS0ke2l9IiBzdHlsZT0iYmFja2dyb3VuZDojMmU3ZDMyOyI+JHtwdHN9PC9zcGFuPjwvZGl2PjxpbnB1dCB0eXBlPSJ0ZXh0IiBpZD0ibm90ZS0ke2l9IiBjbGFzcz0ibm90ZS1pbnB1dCIgcGxhY2Vob2xkZXI9Ik5vdC4uLiIgc3R5bGU9ImRpc3BsYXk6bm9uZTsiPjwvZGl2PmA7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICBjcml0ZXJpYUZpZWxkc0h0bWwgKz0gYDwvZGl2PmA7CiAgICB9CiAgICAKICAgIC8vIEfDnE5DRUxMRU5NxLDFniBNT0RBTDogQ2FsbCBJRCB6b3J1bmx1IHlhcMSxbGTEsQogICAgY29uc3QgY29udGVudEh0bWwgPSBgCiAgICAgICAgPGRpdiBjbGFzcz0iZXZhbC1tb2RhbC13cmFwcGVyIj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2NvcmUtZGFzaGJvYXJkIj48ZGl2PjxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjlyZW07Ij5EZcSfZXJsZW5kaXJpbGVuPC9kaXY+PGRpdiBzdHlsZT0iZm9udC1zaXplOjEuMnJlbTsgZm9udC13ZWlnaHQ6Ym9sZDsgY29sb3I6I2ZhYmIwMDsiPiR7YWdlbnROYW1lfTwvZGl2PjwvZGl2PjxkaXYgY2xhc3M9InNjb3JlLWNpcmNsZS1vdXRlciIgaWQ9InNjb3JlLXJpbmciPjxkaXYgY2xhc3M9InNjb3JlLWNpcmNsZS1pbm5lciIgaWQ9ImxpdmUtc2NvcmUiPiR7aXNDcml0ZXJpYUJhc2VkID8gJzEwMCcgOiAnMTAwJ308L2Rpdj48L2Rpdj48L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iZXZhbC1oZWFkZXItY2FyZCI+PGRpdj48bGFiZWw+Q2FsbCBJRCA8c3BhbiBzdHlsZT0iY29sb3I6cmVkOyI+Kjwvc3Bhbj48L2xhYmVsPjxpbnB1dCBpZD0iZXZhbC1jYWxsaWQiIGNsYXNzPSJzd2FsMi1pbnB1dCIgc3R5bGU9ImhlaWdodDozNXB4OyBtYXJnaW46MDsgd2lkdGg6MTAwJTsiIHBsYWNlaG9sZGVyPSJDYWxsIElEIj48L2Rpdj48ZGl2PjxsYWJlbD5UYXJpaDwvbGFiZWw+PGlucHV0IHR5cGU9ImRhdGUiIGlkPSJldmFsLWNhbGxkYXRlIiBjbGFzcz0ic3dhbDItaW5wdXQiIHN0eWxlPSJoZWlnaHQ6MzVweDsgbWFyZ2luOjA7IHdpZHRoOjEwMCU7IiB2YWx1ZT0iJHtuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3Vic3RyaW5nKDAsIDEwKX0iPjwvZGl2PjwvZGl2PgogICAgICAgICAgICAke2lzQ3JpdGVyaWFCYXNlZCA/IGNyaXRlcmlhRmllbGRzSHRtbCA6IGA8ZGl2IHN0eWxlPSJwYWRkaW5nOjE1cHg7IGJvcmRlcjoxcHggZGFzaGVkICNjY2M7IHRleHQtYWxpZ246Y2VudGVyOyI+PGxhYmVsPk1hbnVlbCBQdWFuPC9sYWJlbD48YnI+PGlucHV0IGlkPSJldmFsLW1hbnVhbC1zY29yZSIgdHlwZT0ibnVtYmVyIiBjbGFzcz0ic3dhbDItaW5wdXQiIHZhbHVlPSIxMDAiIG1pbj0iMCIgbWF4PSIxMDAiIHN0eWxlPSJ3aWR0aDoxMDBweDsgdGV4dC1hbGlnbjpjZW50ZXI7Ij48L2Rpdj48dGV4dGFyZWEgaWQ9ImV2YWwtZGV0YWlscyIgY2xhc3M9InN3YWwyLXRleHRhcmVhIiBwbGFjZWhvbGRlcj0iRGV0YXlsYXIuLi4iPjwvdGV4dGFyZWE+YH0KICAgICAgICAgICAgPGRpdiBzdHlsZT0ibWFyZ2luLXRvcDoxNXB4OyBwYWRkaW5nOjEwcHg7IGJhY2tncm91bmQ6I2ZhZmFmYTsgYm9yZGVyOjFweCBzb2xpZCAjZWVlOyI+PGxhYmVsPkdlcmkgQmlsZGlyaW0gVGlwaTwvbGFiZWw+PHNlbGVjdCBpZD0iZmVlZGJhY2stdHlwZSIgY2xhc3M9InN3YWwyLWlucHV0IiBzdHlsZT0id2lkdGg6MTAwJTsgaGVpZ2h0OjQwcHg7IG1hcmdpbjowOyI+PG9wdGlvbiB2YWx1ZT0iWW9rIiBzZWxlY3RlZD5Zb2s8L29wdGlvbj48b3B0aW9uIHZhbHVlPSJTw7Z6bMO8Ij5Tw7Z6bMO8PC9vcHRpb24+PG9wdGlvbiB2YWx1ZT0iTWFpbCI+TWFpbDwvb3B0aW9uPjwvc2VsZWN0PjwvZGl2PgogICAgICAgICAgICA8ZGl2IHN0eWxlPSJtYXJnaW4tdG9wOjE1cHg7Ij48bGFiZWw+R2VuZWwgR2VyaSBCaWxkaXJpbTwvbGFiZWw+PHRleHRhcmVhIGlkPSJldmFsLWZlZWRiYWNrIiBjbGFzcz0ic3dhbDItdGV4dGFyZWEiIHN0eWxlPSJtYXJnaW4tdG9wOjVweDsgaGVpZ2h0OjgwcHg7Ij48L3RleHRhcmVhPjwvZGl2PgogICAgICAgIDwvZGl2PmA7CiAgICAKICAgIGNvbnN0IHsgdmFsdWU6IGZvcm1WYWx1ZXMgfSA9IGF3YWl0IFN3YWwuZmlyZSh7CiAgICAgICAgaHRtbDogY29udGVudEh0bWwsIHdpZHRoOiAnNjAwcHgnLCBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLCBjb25maXJtQnV0dG9uVGV4dDogJyDwn5K+ICBLYXlkZXQnLAogICAgICAgIGRpZE9wZW46ICgpID0+IHsgCiAgICAgICAgICAgIGlmIChpc1RlbGVzYXRpcykgd2luZG93LnJlY2FsY1RvdGFsU2xpZGVyU2NvcmUoKTsgCiAgICAgICAgICAgIGVsc2UgaWYgKGlzQ2hhdCkgd2luZG93LnJlY2FsY1RvdGFsU2NvcmUoKTsgCiAgICAgICAgfSwKICAgICAgICBwcmVDb25maXJtOiAoKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGNhbGxJZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdldmFsLWNhbGxpZCcpLnZhbHVlLnRyaW0oKTsKICAgICAgICAgICAgaWYgKCFjYWxsSWQpIHsKICAgICAgICAgICAgICAgIFN3YWwuc2hvd1ZhbGlkYXRpb25NZXNzYWdlKCdDYWxsIElEIGFsYW7EsSBib8WfIGLEsXJha8SxbGFtYXohJyk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IGNhbGxEYXRlUmF3ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V2YWwtY2FsbGRhdGUnKS52YWx1ZTsKICAgICAgICAgICAgY29uc3QgZGF0ZVBhcnRzID0gY2FsbERhdGVSYXcuc3BsaXQoJy0nKTsKICAgICAgICAgICAgY29uc3QgZm9ybWF0dGVkQ2FsbERhdGUgPSBkYXRlUGFydHMubGVuZ3RoID09PSAzID8gYCR7ZGF0ZVBhcnRzWzJdfS4ke2RhdGVQYXJ0c1sxXX0uJHtkYXRlUGFydHNbMF19YCA6IGNhbGxEYXRlUmF3OwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKGlzQ3JpdGVyaWFCYXNlZCkgewogICAgICAgICAgICAgICAgbGV0IHRvdGFsID0gMDsgbGV0IGRldGFpbHNBcnIgPSBbXTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY3JpdGVyaWFMaXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYyA9IGNyaXRlcmlhTGlzdFtpXTsgaWYgKHBhcnNlSW50KGMucG9pbnRzKSA9PT0gMCkgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgbGV0IHZhbCA9IDA7IGxldCBub3RlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYG5vdGUtJHtpfWApLnZhbHVlOwogICAgICAgICAgICAgICAgICAgIGlmIChpc0NoYXQpIHZhbCA9IHBhcnNlSW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBiYWRnZS0ke2l9YCkuaW5uZXJUZXh0KSB8fCAwOwogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGlzVGVsZXNhdGlzKSB2YWwgPSBwYXJzZUludChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgc2xpZGVyLSR7aX1gKS52YWx1ZSkgfHwgMDsKICAgICAgICAgICAgICAgICAgICB0b3RhbCArPSB2YWw7IGRldGFpbHNBcnIucHVzaCh7IHE6IGMudGV4dCwgbWF4OiBwYXJzZUludChjLnBvaW50cyksIHNjb3JlOiB2YWwsIG5vdGU6IG5vdGUgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4geyBhZ2VudE5hbWUsIGFnZW50R3JvdXAsIGNhbGxJZCwgY2FsbERhdGU6IGZvcm1hdHRlZENhbGxEYXRlLCBzY29yZTogdG90YWwsIGRldGFpbHM6IEpTT04uc3RyaW5naWZ5KGRldGFpbHNBcnIpLCBmZWVkYmFjazogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V2YWwtZmVlZGJhY2snKS52YWx1ZSwgZmVlZGJhY2tUeXBlOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmVlZGJhY2stdHlwZScpLnZhbHVlIH07CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4geyBhZ2VudE5hbWUsIGFnZW50R3JvdXAsIGNhbGxJZCwgY2FsbERhdGU6IGZvcm1hdHRlZENhbGxEYXRlLCBzY29yZTogcGFyc2VJbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V2YWwtbWFudWFsLXNjb3JlJykudmFsdWUpLCBkZXRhaWxzOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXZhbC1kZXRhaWxzJykudmFsdWUsIGZlZWRiYWNrOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmVlZGJhY2stdHlwZScpLnZhbHVlIH07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KTsKICAgIGlmIChmb3JtVmFsdWVzKSB7CiAgICAgICAgU3dhbC5maXJlKHsgdGl0bGU6ICdLYXlkZWRpbGl5b3IuLi4nLCBkaWRPcGVuOiAoKSA9PiBTd2FsLnNob3dMb2FkaW5nKCkgfSk7CiAgICAgICAgZmV0Y2goU0NSSVBUX1VSTCwgeyAKICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsIAogICAgICAgICAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAndGV4dC9wbGFpbjtjaGFyc2V0PXV0Zi04JyB9LAogICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGFjdGlvbjogImxvZ0V2YWx1YXRpb24iLCB1c2VybmFtZTogY3VycmVudFVzZXIsIHRva2VuOiBnZXRUb2tlbigpLCAuLi5mb3JtVmFsdWVzIH0pIAogICAgICAgIH0pCiAgICAgICAgLnRoZW4ociA9PiByLmpzb24oKSkudGhlbihkID0+IHsKICAgICAgICAgICAgaWYgKGQucmVzdWx0ID09PSAic3VjY2VzcyIpIHsgCiAgICAgICAgICAgICAgICBTd2FsLmZpcmUoeyBpY29uOiAnc3VjY2VzcycsIHRpdGxlOiAnS2F5ZGVkaWxkaScsIHRpbWVyOiAxNTAwLCBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UgfSk7CiAgICAgICAgICAgICAgICAvLyBEw5xaRUxUTUU6IEhlbSBldmFsdWF0aW9ucyBoZW0gZGUgZmVlZGJhY2sgbG9ncyBnw7xuY2VsbGVubWVsaQogICAgICAgICAgICAgICAgZmV0Y2hFdmFsdWF0aW9uc0ZvckFnZW50KGZvcm1WYWx1ZXMuYWdlbnROYW1lKTsKICAgICAgICAgICAgICAgIGZldGNoRmVlZGJhY2tMb2dzKCkudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgbG9hZEZlZWRiYWNrTGlzdCgpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7IAogICAgICAgICAgICAgICAgU3dhbC5maXJlKCdIYXRhJywgZC5tZXNzYWdlLCAnZXJyb3InKTsgCiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KfQphc3luYyBmdW5jdGlvbiBlZGl0RXZhbHVhdGlvbih0YXJnZXRDYWxsSWQpIHsKICAgIGNvbnN0IGV2YWxEYXRhID0gYWxsRXZhbHVhdGlvbnNEYXRhLmZpbmQoaXRlbSA9PiBTdHJpbmcoaXRlbS5jYWxsSWQpLnRyaW0oKSA9PT0gU3RyaW5nKHRhcmdldENhbGxJZCkudHJpbSgpKTsKICAgIGlmICghZXZhbERhdGEpIHsgU3dhbC5maXJlKCdIYXRhJywgJ0thecSxdCBidWx1bmFtYWTEsS4nLCAnZXJyb3InKTsgcmV0dXJuOyB9CiAgICAKICAgIGNvbnN0IGFnZW50TmFtZSA9IGV2YWxEYXRhLmFnZW50OwogICAgY29uc3QgYWdlbnRHcm91cFJhdyA9IGV2YWxEYXRhLmdyb3VwIHx8ICdHZW5lbCc7CiAgICBjb25zdCBpc0NoYXQgPSBhZ2VudEdyb3VwUmF3LmluZGV4T2YoJ0NoYXQnKSA+IC0xOwogICAgY29uc3QgaXNUZWxlc2F0aXMgPSBhZ2VudEdyb3VwUmF3LmluZGV4T2YoJ1RlbGVzYXTEscWfJykgPiAtMTsKICAgIGxldCBhZ2VudEdyb3VwID0gaXNDaGF0ID8gJ0NoYXQnIDogKGlzVGVsZXNhdGlzID8gJ1RlbGVzYXTEscWfJyA6ICdHZW5lbCcpOwogICAgCiAgICBTd2FsLmZpcmUoeyB0aXRsZTogJ8SwbmNlbGVuaXlvci4uLicsIGRpZE9wZW46ICgpID0+IFN3YWwuc2hvd0xvYWRpbmcoKSB9KTsKICAgIGxldCBjcml0ZXJpYUxpc3QgPSBbXTsKICAgIGlmKGFnZW50R3JvdXAgJiYgYWdlbnRHcm91cCAhPT0gJ0dlbmVsJykgY3JpdGVyaWFMaXN0ID0gYXdhaXQgZmV0Y2hDcml0ZXJpYShhZ2VudEdyb3VwKTsKICAgIFN3YWwuY2xvc2UoKTsKICAgIAogICAgY29uc3QgaXNDcml0ZXJpYUJhc2VkID0gY3JpdGVyaWFMaXN0Lmxlbmd0aCA+IDA7CiAgICBsZXQgb2xkRGV0YWlscyA9IFtdOyB0cnkgeyBvbGREZXRhaWxzID0gSlNPTi5wYXJzZShldmFsRGF0YS5kZXRhaWxzIHx8ICJbXSIpOyB9IGNhdGNoKGUpIHsgb2xkRGV0YWlscyA9IFtdOyB9CiAgICAKICAgIC8vIEfDnE5DRUxMRU5NxLDFniBNT0RBTDogQ2FsbCBJRCBnw7ZzdGVyaWxpeW9yCiAgICBsZXQgY29udGVudEh0bWwgPSBgPGRpdiBjbGFzcz0iZXZhbC1tb2RhbC13cmFwcGVyIiBzdHlsZT0iYm9yZGVyLXRvcDo1cHggc29saWQgIzE5NzZkMjsiPjxkaXYgY2xhc3M9InNjb3JlLWRhc2hib2FyZCI+PGRpdj48ZGl2IHN0eWxlPSJmb250LXNpemU6MC45cmVtOyI+RMOcWkVOTEVORU48L2Rpdj48ZGl2IHN0eWxlPSJmb250LXNpemU6MS4ycmVtOyBmb250LXdlaWdodDpib2xkOyBjb2xvcjojMTk3NmQyOyI+JHthZ2VudE5hbWV9PC9kaXY+PC9kaXY+PGRpdiBjbGFzcz0ic2NvcmUtY2lyY2xlLW91dGVyIiBpZD0ic2NvcmUtcmluZyI+PGRpdiBjbGFzcz0ic2NvcmUtY2lyY2xlLWlubmVyIiBpZD0ibGl2ZS1zY29yZSI+JHtldmFsRGF0YS5zY29yZX08L2Rpdj48L2Rpdj48L2Rpdj48ZGl2IGNsYXNzPSJldmFsLWhlYWRlci1jYXJkIj48ZGl2PjxsYWJlbD5DYWxsIElEPC9sYWJlbD48aW5wdXQgaWQ9ImV2YWwtY2FsbGlkIiBjbGFzcz0ic3dhbDItaW5wdXQiIHZhbHVlPSIke2V2YWxEYXRhLmNhbGxJZH0iIHJlYWRvbmx5IHN0eWxlPSJiYWNrZ3JvdW5kOiNlZWU7IGhlaWdodDozNXB4OyB3aWR0aDoxMDAlOyI+PC9kaXY+PC9kaXY+YDsKICAgIAogICAgaWYgKGlzQ3JpdGVyaWFCYXNlZCkgewogICAgICAgIGNvbnRlbnRIdG1sICs9IGA8ZGl2IGNsYXNzPSJjcml0ZXJpYS1jb250YWluZXIiPmA7CiAgICAgICAgY3JpdGVyaWFMaXN0LmZvckVhY2goKGMsIGkpID0+IHsKICAgICAgICAgICAgbGV0IHB0cyA9IHBhcnNlSW50KGMucG9pbnRzKSB8fCAwOyBpZihwdHM9PT0wKSByZXR1cm47CiAgICAgICAgICAgIGxldCBtUHRzID0gcGFyc2VJbnQoYy5tZWRpdW1TY29yZSkgfHwgMDsgbGV0IGJQdHMgPSBwYXJzZUludChjLmJhZFNjb3JlKSB8fCAwOwogICAgICAgICAgICBsZXQgb2xkSXRlbSA9IG9sZERldGFpbHMuZmluZChkID0+IGQucSA9PT0gYy50ZXh0KSB8fCAob2xkRGV0YWlsc1tpXSA/IG9sZERldGFpbHNbaV0gOiB7c2NvcmU6cHRzLCBub3RlOicnfSk7CiAgICAgICAgICAgIGxldCBjVmFsID0gcGFyc2VJbnQob2xkSXRlbS5zY29yZSk7IGxldCBjTm90ZSA9IG9sZEl0ZW0ubm90ZSB8fCAnJzsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEdlbGnFn3Rpcm1lOiBQdWFuIGJhxZ9sxLHEn8SxIMO8c3TDvG5lIGdlbGluY2UgdGFtIG1ldGluIGfDtnN0ZXJpbG1lc2kgacOnaW4gdGl0bGUgZWtsZW5kaQogICAgICAgICAgICBjb25zdCBmdWxsVGV4dCA9IGVzY2FwZUZvckpzU3RyaW5nKGMudGV4dCk7IAogICAgICAgICAgICBpZiAoaXNDaGF0KSB7CiAgICAgICAgICAgICAgICBsZXQgZ0FjdCA9IGNWYWwgPT09IHB0cyA/ICdhY3RpdmUnIDogJyc7IGxldCBtQWN0ID0gKGNWYWw9PT1tUHRzICYmIG1QdHMhPT0wKSA/ICdhY3RpdmUnIDogJyc7IGxldCBiQWN0ID0gKGNWYWw9PT1iUHRzICYmIGJQdHMhPT0wKSA/ICdhY3RpdmUnIDogJyc7CiAgICAgICAgICAgICAgICBpZihjVmFsPT09MCAmJiBiUHRzPT09MCkgYkFjdCA9ICdhY3RpdmUnOyBlbHNlIGlmIChjVmFsPT09MCAmJiBiUHRzPjApIHsgZ0FjdD0nJzsgbUFjdD0nJzsgYkFjdD0nJzsgfQogICAgICAgICAgICAgICAgY29udGVudEh0bWwgKz0gYDxkaXYgY2xhc3M9ImNyaXRlcmlhLXJvdyIgaWQ9InJvdy0ke2l9IiBkYXRhLW1heC1zY29yZT0iJHtwdHN9Ij48ZGl2IGNsYXNzPSJjcml0ZXJpYS1oZWFkZXIiPjxzcGFuIHRpdGxlPSIke2Z1bGxUZXh0fSI+JHtpKzF9LiAke2MudGV4dH08L3NwYW4+PHNwYW4+TWF4OiAke3B0c308L3NwYW4+PC9kaXY+PGRpdiBjbGFzcz0iY3JpdGVyaWEtY29udHJvbHMiPjxkaXYgY2xhc3M9ImV2YWwtYnV0dG9uLWdyb3VwIj48YnV0dG9uIGNsYXNzPSJldmFsLWJ1dHRvbiBldmFsLWdvb2QgJHtnQWN0fSIgZGF0YS1zY29yZT0iJHtwdHN9IiBvbmNsaWNrPSJzZXRCdXR0b25TY29yZSgke2l9LCAke3B0c30sICR7cHRzfSkiPsSweWk8L2J1dHRvbj4ke21QdHM+MD9gPGJ1dHRvbiBjbGFzcz0iZXZhbC1idXR0b24gZXZhbC1tZWRpdW0gJHttQWN0fSIgZGF0YS1zY29yZT0iJHttUHRzfSIgb25jbGljaz0ic2V0QnV0dG9uU2NvcmUoJHtpfSwgJHttUHRzfSwgJHtwdHN9KSI+T3J0YTwvYnV0dG9uPmA6Jyd9JHtiUHRzPjA/YDxidXR0b24gY2xhc3M9ImV2YWwtYnV0dG9uIGV2YWwtYmFkICR7YkFjdH0iIGRhdGEtc2NvcmU9IiR7YlB0c30iIG9uY2xpY2s9InNldEJ1dHRvblNjb3JlKCR7aX0sICR7YlB0c30sICR7cHRzfSkiPkvDtnTDvDwvYnV0dG9uPmA6Jyd9PC9kaXY+PHNwYW4gY2xhc3M9InNjb3JlLWJhZGdlIiBpZD0iYmFkZ2UtJHtpfSI+JHtjVmFsfTwvc3Bhbj48L2Rpdj48aW5wdXQgdHlwZT0idGV4dCIgaWQ9Im5vdGUtJHtpfSIgY2xhc3M9Im5vdGUtaW5wdXQiIHZhbHVlPSIke2NOb3RlfSIgc3R5bGU9ImRpc3BsYXk6JHtjVmFsPHB0cz8nYmxvY2snOidub25lJ30iPjwvZGl2PmA7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNUZWxlc2F0aXMpIHsKICAgICAgICAgICAgICAgIGNvbnRlbnRIdG1sICs9IGA8ZGl2IGNsYXNzPSJjcml0ZXJpYS1yb3ciIGlkPSJyb3ctJHtpfSIgZGF0YS1tYXgtc2NvcmU9IiR7cHRzfSI+PGRpdiBjbGFzcz0iY3JpdGVyaWEtaGVhZGVyIj48c3BhbiB0aXRsZT0iJHtmdWxsVGV4dH0iPiR7aSsxfS4gJHtjLnRleHR9PC9zcGFuPjxzcGFuPk1heDogJHtwdHN9PC9zcGFuPjwvZGl2PjxkaXYgY2xhc3M9ImNyaXRlcmlhLWNvbnRyb2xzIiBzdHlsZT0iZGlzcGxheTpmbGV4OyBiYWNrZ3JvdW5kOiNmOWY5Zjk7Ij48aW5wdXQgdHlwZT0icmFuZ2UiIGNsYXNzPSJjdXN0b20tcmFuZ2Ugc2xpZGVyLWlucHV0IiBpZD0ic2xpZGVyLSR7aX0iIG1pbj0iMCIgbWF4PSIke3B0c30iIHZhbHVlPSIke2NWYWx9IiBkYXRhLWluZGV4PSIke2l9IiBvbmlucHV0PSJ1cGRhdGVSb3dTbGlkZXJTY29yZSgke2l9LCAke3B0c30pIiBzdHlsZT0iZmxleC1ncm93OjE7Ij48c3BhbiBjbGFzcz0ic2NvcmUtYmFkZ2UiIGlkPSJiYWRnZS0ke2l9Ij4ke2NWYWx9PC9zcGFuPjwvZGl2PjxpbnB1dCB0eXBlPSJ0ZXh0IiBpZD0ibm90ZS0ke2l9IiBjbGFzcz0ibm90ZS1pbnB1dCIgdmFsdWU9IiR7Y05vdGV9IiBzdHlsZT0iZGlzcGxheToke2NWYWw8cHRzPydibG9jayc6J25vbmUnfSI+PC9kaXY+YDsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIGNvbnRlbnRIdG1sICs9IGA8L2Rpdj5gOwogICAgfSBlbHNlIHsKICAgICAgICBjb250ZW50SHRtbCArPSBgPGRpdiBzdHlsZT0icGFkZGluZzoxNXB4OyBib3JkZXI6MXB4IGRhc2hlZCAjY2NjOyB0ZXh0LWFsaWduOmNlbnRlcjsiPjxsYWJlbD5NYW51ZWwgUHVhbjwvbGFiZWw+PGJyPjxpbnB1dCBpZD0iZXZhbC1tYW51YWwtc2NvcmUiIHR5cGU9Im51bWJlciIgY2xhc3M9InN3YWwyLWlucHV0IiB2YWx1ZT0iJHtldmFsRGF0YS5zY29yZX0iIG1pbj0iMCIgbWF4PSIxMDAiIHN0eWxlPSJ3aWR0aDoxMDBweDsiPjwvZGl2Pjx0ZXh0YXJlYSBpZD0iZXZhbC1kZXRhaWxzIiBjbGFzcz0ic3dhbDItdGV4dGFyZWEiPiR7dHlwZW9mIGV2YWxEYXRhLmRldGFpbHM9PT0nc3RyaW5nJz9ldmFsRGF0YS5kZXRhaWxzOicnfTwvdGV4dGFyZWE+YDsKICAgIH0KICAgIGNvbnRlbnRIdG1sICs9IGA8ZGl2PjxsYWJlbD5SZXZpemUgRmVlZGJhY2s8L2xhYmVsPjx0ZXh0YXJlYSBpZD0iZXZhbC1mZWVkYmFjayIgY2xhc3M9InN3YWwyLXRleHRhcmVhIj4ke2V2YWxEYXRhLmZlZWRiYWNrfHwnJ308L3RleHRhcmVhPjwvZGl2PjwvZGl2PmA7CiAgICAKICAgIGNvbnN0IHsgdmFsdWU6IGZvcm1WYWx1ZXMgfSA9IGF3YWl0IFN3YWwuZmlyZSh7CiAgICAgICAgaHRtbDogY29udGVudEh0bWwsIHdpZHRoOiAnNjAwcHgnLCBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLCBjb25maXJtQnV0dG9uVGV4dDogJyDwn5K+ICBHw7xuY2VsbGUnLAogICAgICAgIGRpZE9wZW46ICgpID0+IHsgaWYgKGlzVGVsZXNhdGlzKSB3aW5kb3cucmVjYWxjVG90YWxTbGlkZXJTY29yZSgpOyBlbHNlIGlmIChpc0NoYXQpIHdpbmRvdy5yZWNhbGNUb3RhbFNjb3JlKCk7IH0sCiAgICAgICAgcHJlQ29uZmlybTogKCkgPT4gewogICAgICAgICAgICBjb25zdCBjYWxsSWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXZhbC1jYWxsaWQnKS52YWx1ZTsKICAgICAgICAgICAgY29uc3QgZmVlZGJhY2sgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXZhbC1mZWVkYmFjaycpLnZhbHVlOwogICAgICAgICAgICBpZiAoaXNDcml0ZXJpYUJhc2VkKSB7CiAgICAgICAgICAgICAgICBsZXQgdG90YWwgPSAwOyBsZXQgZGV0YWlsc0FyciA9IFtdOwogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjcml0ZXJpYUxpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjID0gY3JpdGVyaWFMaXN0W2ldOyBpZiAocGFyc2VJbnQoYy5wb2ludHMpID09PSAwKSBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICBsZXQgdmFsID0gMDsgbGV0IG5vdGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgbm90ZS0ke2l9YCkudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzQ2hhdCkgdmFsID0gcGFyc2VJbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGJhZGdlLSR7aX1gKS5pbm5lclRleHQpIHx8IDA7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoaXNUZWxlc2F0aXMpIHZhbCA9IHBhcnNlSW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBzbGlkZXItJHtpfWApLnZhbHVlKSB8fCAwOwogICAgICAgICAgICAgICAgICAgIGVsc2UgdmFsID0gcGFyc2VJbnQoYy5wb2ludHMpOwogICAgICAgICAgICAgICAgICAgIHRvdGFsICs9IHZhbDsgZGV0YWlsc0Fyci5wdXNoKHsgcTogYy50ZXh0LCBtYXg6IHBhcnNlSW50KGMucG9pbnRzKSwgc2NvcmU6IHZhbCwgbm90ZTogbm90ZSB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB7IGFnZW50TmFtZSwgY2FsbElkLCBzY29yZTogdG90YWwsIGRldGFpbHM6IEpTT04uc3RyaW5naWZ5KGRldGFpbHNBcnIpLCBmZWVkYmFjayB9OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIHsgYWdlbnROYW1lLCBjYWxsSWQsIHNjb3JlOiBwYXJzZUludChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXZhbC1tYW51YWwtc2NvcmUnKS52YWx1ZSksIGRldGFpbHM6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdldmFsLWRldGFpbHMnKS52YWx1ZSwgZmVlZGJhY2sgfTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0pOwogICAgaWYgKGZvcm1WYWx1ZXMpIHsKICAgICAgICBTd2FsLmZpcmUoeyB0aXRsZTogJ0fDvG5jZWxsZW5peW9yLi4uJywgZGlkT3BlbjogKCkgPT4gU3dhbC5zaG93TG9hZGluZygpIH0pOwogICAgICAgIGZldGNoKFNDUklQVF9VUkwsIHsgCiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLCAKICAgICAgICAgICAgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ3RleHQvcGxhaW47Y2hhcnNldD11dGYtOCcgfSwKICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBhY3Rpb246ICJ1cGRhdGVFdmFsdWF0aW9uIiwgdXNlcm5hbWU6IGN1cnJlbnRVc2VyLCB0b2tlbjogZ2V0VG9rZW4oKSwgLi4uZm9ybVZhbHVlcyB9KSAKICAgICAgICB9KQogICAgICAgIC50aGVuKHIgPT4gci5qc29uKCkpLnRoZW4oZCA9PiB7CiAgICAgICAgICAgIGlmIChkLnJlc3VsdCA9PT0gInN1Y2Nlc3MiKSB7IAogICAgICAgICAgICAgICAgU3dhbC5maXJlKHsgaWNvbjogJ3N1Y2Nlc3MnLCB0aXRsZTogJ0fDvG5jZWxsZW5kaScsIHRpbWVyOiAxNTAwLCBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UgfSk7IAogICAgICAgICAgICAgICAgLy8gRMOcWkVMVE1FOiBHw7xuY2VsbGVtZSBzb25yYXPEsSBoZW0gZXZhbHVhdGlvbnMgaGVtIGRlIGZlZWRiYWNrIGxvZ3MgZ8O8bmNlbGxlbm1lbGkKICAgICAgICAgICAgICAgIGZldGNoRXZhbHVhdGlvbnNGb3JBZ2VudChhZ2VudE5hbWUpOwogICAgICAgICAgICAgICAgZmV0Y2hGZWVkYmFja0xvZ3MoKS50aGVuKCgpID0+IHsKICAgICAgICAgICAgICAgICAgICBsb2FkRmVlZGJhY2tMaXN0KCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSAKICAgICAgICAgICAgZWxzZSB7IFN3YWwuZmlyZSgnSGF0YScsIGQubWVzc2FnZSwgJ2Vycm9yJyk7IH0KICAgICAgICB9KTsKICAgIH0KfQ==";
 const _bin=atob(_b);
 const _bytes=new Uint8Array(_bin.length);
 for(let i=0;i<_bin.length;i++) _bytes[i]=_bin.charCodeAt(i);
 const _code=new TextDecoder('utf-8').decode(_bytes);
 (0,eval)(_code);
})();
